<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.css" integrity="sha256-gkQVf8UKZgQ0HyuxL/VnacadJ+D2Kox2TCEBuNQg5+w=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"vinyyang.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.22.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":true,"comments":{"style":"tabs","active":"giscus","storage":true,"lazyload":false,"nav":null,"activeClass":"giscus"},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="数据分析方法（外教版）">
<meta property="og:type" content="article">
<meta property="og:title" content="数据分析方法（外教版）">
<meta property="og:url" content="https://vinyyang.github.io/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E6%96%B9%E6%B3%95%EF%BC%88%E5%A4%96%E6%95%99%E7%89%88%EF%BC%89/index.html">
<meta property="og:site_name" content="Viny与CS的邂逅">
<meta property="og:description" content="数据分析方法（外教版）">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://vinyyang.github.io/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E6%96%B9%E6%B3%95%EF%BC%88%E5%A4%96%E6%95%99%E7%89%88%EF%BC%89/image-20250602194049048.png">
<meta property="og:image" content="https://vinyyang.github.io/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E6%96%B9%E6%B3%95%EF%BC%88%E5%A4%96%E6%95%99%E7%89%88%EF%BC%89/image-20250602194242290.png">
<meta property="og:image" content="https://vinyyang.github.io/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E6%96%B9%E6%B3%95%EF%BC%88%E5%A4%96%E6%95%99%E7%89%88%EF%BC%89/image-20250602194334420.png">
<meta property="og:image" content="https://vinyyang.github.io/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E6%96%B9%E6%B3%95%EF%BC%88%E5%A4%96%E6%95%99%E7%89%88%EF%BC%89/image-20250602202143367.png">
<meta property="og:image" content="https://vinyyang.github.io/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E6%96%B9%E6%B3%95%EF%BC%88%E5%A4%96%E6%95%99%E7%89%88%EF%BC%89/image-20250602194345924.png">
<meta property="article:published_time" content="2025-06-02T07:43:55.000Z">
<meta property="article:modified_time" content="2025-06-02T13:02:39.331Z">
<meta property="article:author" content="Viny Yang">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://vinyyang.github.io/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E6%96%B9%E6%B3%95%EF%BC%88%E5%A4%96%E6%95%99%E7%89%88%EF%BC%89/image-20250602194049048.png">


<link rel="canonical" href="https://vinyyang.github.io/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E6%96%B9%E6%B3%95%EF%BC%88%E5%A4%96%E6%95%99%E7%89%88%EF%BC%89/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://vinyyang.github.io/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E6%96%B9%E6%B3%95%EF%BC%88%E5%A4%96%E6%95%99%E7%89%88%EF%BC%89/","path":"数据分析方法（外教版）/","title":"数据分析方法（外教版）"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>数据分析方法（外教版） | Viny与CS的邂逅</title>
  

  <script src="/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?7d748fca465d5b9edd218c485f0a2579"></script>






<script src="//sdk.jinrishici.com/v2/browser/jinrishici.js"></script>
<script>
  jinrishici.load((result) => {
    let jrsc = document.getElementById('jrsc');
    const data = result.data;
    let author = data.origin.author;
    let title = '《' + data.origin.title + '》';
    let content = data.content.substr(0, data.content.length - 1);
    let dynasty = data.origin.dynasty.substr(0, data.origin.dynasty.length - 1);
    jrsc.innerText = content + ' @ ' + dynasty + '·' + author + title;
  });
</script>
<div style="text-align: center"><span id="jrsc" >正在加载今日诗词....</span></div>
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Viny与CS的邂逅" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Viny与CS的邂逅</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">虽千万人吾往矣</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-guestbook"><a href="/guestbook/" rel="section"><i class="fa fa-book fa-fw"></i>留言板</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%BE%E4%BB%B6%E6%80%BB%E7%BB%93"><span class="nav-number">1.</span> <span class="nav-text">课件总结</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Week-1"><span class="nav-number">1.1.</span> <span class="nav-text">Week 1</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B9%BB%E7%81%AF%E7%89%87%E5%86%85%E5%AE%B9%E7%BF%BB%E8%AF%91%E4%B8%8E%E6%A6%82%E8%A7%88"><span class="nav-number">1.1.1.</span> <span class="nav-text">幻灯片内容翻译与概览</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%E6%A2%B3%E7%90%86-first-week-pdf"><span class="nav-number">1.1.2.</span> <span class="nav-text">知识点梳理 (first_week.pdf)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Week-2"><span class="nav-number">1.2.</span> <span class="nav-text">Week 2</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B9%BB%E7%81%AF%E7%89%87%E5%86%85%E5%AE%B9%E7%BF%BB%E8%AF%91%E4%B8%8E%E6%A6%82%E8%A7%88-2"><span class="nav-number">1.2.1.</span> <span class="nav-text">幻灯片内容翻译与概览</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%E6%A2%B3%E7%90%86-second-week-pdf"><span class="nav-number">1.2.2.</span> <span class="nav-text">知识点梳理 (second_week.pdf)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Week-3"><span class="nav-number">1.3.</span> <span class="nav-text">Week 3</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B9%BB%E7%81%AF%E7%89%87%E5%86%85%E5%AE%B9%E7%BF%BB%E8%AF%91%E4%B8%8E%E6%A6%82%E8%A7%88-3"><span class="nav-number">1.3.1.</span> <span class="nav-text">幻灯片内容翻译与概览</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%E6%A2%B3%E7%90%86-third-week-pdf"><span class="nav-number">1.3.2.</span> <span class="nav-text">知识点梳理 (third_week.pdf)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Week-4"><span class="nav-number">1.4.</span> <span class="nav-text">Week 4</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B9%BB%E7%81%AF%E7%89%87%E5%86%85%E5%AE%B9%E7%BF%BB%E8%AF%91%E4%B8%8E%E6%A6%82%E8%A7%88-4"><span class="nav-number">1.4.1.</span> <span class="nav-text">幻灯片内容翻译与概览</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%E6%A2%B3%E7%90%86-fourth-week-pdf"><span class="nav-number">1.4.2.</span> <span class="nav-text">知识点梳理 (fourth_week.pdf)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E6%80%BB%E7%BB%93"><span class="nav-number">2.</span> <span class="nav-text">题目总结</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#first-week"><span class="nav-number">2.1.</span> <span class="nav-text">first week</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9D%A5%E8%87%AA-2024-test-sol-pdf-2024%E5%B9%B4%E6%98%A5%E5%AD%A3%E6%B5%8B%E8%AF%95%E9%A2%98%E8%A7%A3%E6%9E%90"><span class="nav-number">2.2.</span> <span class="nav-text">来自 2024_test_sol.pdf (2024年春季测试题解析)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9D%A5%E8%87%AA-test-sol-2-pdf-2025%E5%B9%B4%E6%98%A5%E5%AD%A3%E6%B5%8B%E8%AF%95%E9%A2%98%E8%A7%A3%E6%9E%90-%E5%8D%B3%E4%BB%8A%E5%B9%B4%E7%9A%84%E6%B5%8B%E8%AF%95"><span class="nav-number">2.2.1.</span> <span class="nav-text">来自 test_sol(2).pdf (2025年春季测试题解析 - 即今年的测试)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E6%80%BB%E7%BB%93"><span class="nav-number">3.</span> <span class="nav-text">代码总结</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Lecture-1"><span class="nav-number">3.1.</span> <span class="nav-text">Lecture 1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Lecture-2"><span class="nav-number">3.2.</span> <span class="nav-text">Lecture 2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Lecture-3%EF%BC%9A%E6%9B%B2%E7%BA%BF%E6%8B%9F%E5%90%88%E4%B8%8E%E5%88%86%E7%B1%BB%E8%A7%A3%E9%87%8A%E5%8F%98%E9%87%8F-Fitting-Curves-and-Categorical-Explanatory-Variables"><span class="nav-number">3.3.</span> <span class="nav-text">Lecture 3：曲线拟合与分类解释变量 (Fitting Curves and Categorical Explanatory Variables)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Lecture-4%EF%BC%9A%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2-Data-Transformations-%E7%89%B9%E5%88%AB%E6%98%AFLog%E8%BD%AC%E6%8D%A2"><span class="nav-number">3.4.</span> <span class="nav-text">Lecture 4：数据转换 (Data Transformations) - 特别是Log转换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Lecture-5%EF%BC%9A%E5%B9%82%E5%BE%8B%E6%A8%A1%E5%9E%8B-Power-Law-Models"><span class="nav-number">3.5.</span> <span class="nav-text">Lecture 5：幂律模型 (Power Law Models)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Lecture-6%EF%BC%9A%E5%8C%85%E5%90%AB%E6%95%B0%E5%80%BC%E5%92%8C%E5%9B%A0%E5%AD%90%E8%A7%A3%E9%87%8A%E5%8F%98%E9%87%8F%E7%9A%84%E7%BA%BF%E6%80%A7%E6%A8%A1%E5%9E%8B-Linear-Models-with-Numeric-and-Factor-Explanatory-Variables-%E4%BA%A4%E4%BA%92%E4%BD%9C%E7%94%A8%E6%A8%A1%E5%9E%8B"><span class="nav-number">3.6.</span> <span class="nav-text">Lecture 6：包含数值和因子解释变量的线性模型 (Linear Models with Numeric and Factor Explanatory Variables) - 交互作用模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Lecture-7"><span class="nav-number">3.7.</span> <span class="nav-text">Lecture 7</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Lecture-8%EF%BC%9A%E5%A4%9A%E9%87%8D%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92%E4%B8%8E%E5%85%B1%E7%BA%BF%E6%80%A7%E9%97%AE%E9%A2%98-Multiple-Linear-Regression-and-Multicollinearity"><span class="nav-number">3.8.</span> <span class="nav-text">Lecture 8：多重线性回归与共线性问题 (Multiple Linear Regression and Multicollinearity)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Lecture-9%EF%BC%9A%E5%8F%8C%E5%9B%A0%E5%AD%90%E6%96%B9%E5%B7%AE%E5%88%86%E6%9E%90-Two-way-ANOVA"><span class="nav-number">3.9.</span> <span class="nav-text">Lecture 9：双因子方差分析 (Two-way ANOVA)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Lecture-10%EF%BC%9A%E5%B9%BF%E4%B9%89%E7%BA%BF%E6%80%A7%E6%A8%A1%E5%9E%8B-Generalized-Linear-Models-Poisson-%E5%92%8C-Binomial-%E5%9B%9E%E5%BD%92"><span class="nav-number">3.10.</span> <span class="nav-text">Lecture 10：广义线性模型 (Generalized Linear Models) - Poisson 和 Binomial 回归</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Lecture-11"><span class="nav-number">3.11.</span> <span class="nav-text">Lecture 11</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Viny Yang"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Viny Yang</p>
  <div class="site-description" itemprop="description">陌上花开，可缓缓归矣</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">9</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/VinyYang" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;VinyYang" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/images/email.png" title="E-Mail → &#x2F;images&#x2F;email.png" rel="noopener me"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="/images/wechat.png" title="Wechat → &#x2F;images&#x2F;wechat.png" rel="noopener me"><i class="fab fa-weixin fa-fw"></i>Wechat</a>
      </span>
      <span class="links-of-author-item">
        <a href="/images/qq.png" title="QQ → &#x2F;images&#x2F;qq.png" rel="noopener me"><i class="fab fa-qq fa-fw"></i>QQ</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          链接
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <a href="https://zhuanlan.zhihu.com/p/618864711" title="https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;618864711" rel="noopener" target="_blank">配置主题</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://zhuanlan.zhihu.com/p/671308695" title="https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;671308695" rel="noopener" target="_blank">重新部署</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://copilot.github.com/" title="https:&#x2F;&#x2F;copilot.github.com&#x2F;" rel="noopener" target="_blank">Copilot</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://chat.deepseek.com/" title="https:&#x2F;&#x2F;chat.deepseek.com&#x2F;" rel="noopener" target="_blank">DeepSeek</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://chatgpt.com/" title="https:&#x2F;&#x2F;chatgpt.com&#x2F;" rel="noopener" target="_blank">ChatGPT</a>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://vinyyang.github.io/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E6%96%B9%E6%B3%95%EF%BC%88%E5%A4%96%E6%95%99%E7%89%88%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Viny Yang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Viny与CS的邂逅">
      <meta itemprop="description" content="陌上花开，可缓缓归矣">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="数据分析方法（外教版） | Viny与CS的邂逅">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          数据分析方法（外教版）
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-06-02 15:43:55 / 修改时间：21:02:39" itemprop="dateCreated datePublished" datetime="2025-06-02T15:43:55+08:00">2025-06-02</time>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>

    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>104k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3:09</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>数据分析方法（外教版）</p>
<h2 id="课件总结">课件总结</h2>
<h3 id="Week-1">Week 1</h3>
<p><code>first_week.pdf</code> - 第一周内容回顾与基础</p>
<h4 id="幻灯片内容翻译与概览">幻灯片内容翻译与概览</h4>
<p><strong>幻灯片 1: Stats 201 - 背景检查 (Yes/No 问题)</strong></p>
<ul>
<li>大家都学过 Stats 210 吗？</li>
<li>我们在 Stats 210 中是否讲授了线性回归？</li>
<li>你了解以下概念吗？
<ul>
<li>估计 (Estimation)</li>
<li>假设检验 (Hypothesis testing)</li>
<li>置信区间 (Confidence interval)</li>
</ul>
</li>
<li>你听说过线性/二项/泊松回归吗？</li>
<li><strong>气泡备注</strong>: 我敢打赌你以为你懂这三个概念。目标是推动你更好地理解它们，而不仅仅是应付考试。它们是任何初级统计/数据科学课程的核心。它们的定义和使用方式塑造了所有早期/传统的从数据中提取信息的方法。</li>
</ul>
<p><strong>幻灯片 2: 数据分析是关于什么的？</strong></p>
<ul>
<li>理解一个变量
<ul>
<li>中心或离散程度</li>
</ul>
</li>
<li>理解两个或多个变量
<ul>
<li>它们之间的关系</li>
</ul>
</li>
</ul>
<p><strong>幻灯片 3: 什么是相关性 (Correlation)？</strong></p>
<ul>
<li>相关性是衡量两个变量<strong>线性</strong>相关的程度。</li>
<li>皮尔逊系数 ρX,Y=σXσYcov(X,Y)=σXσYE[(X−μx)(Y−μy)]</li>
</ul>
<p><img src="/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E6%96%B9%E6%B3%95%EF%BC%88%E5%A4%96%E6%95%99%E7%89%88%EF%BC%89/image-20250602194049048.png" alt="image-20250602194049048"></p>
<p><strong>幻灯片 4: 那么关联性 (Association) 呢？相关性 vs 关联性</strong></p>
<ul>
<li>(图示展示了不同类型的相关性和关联性散点图：强正相关、弱正相关、关联（曲线）、无关联；强负相关、弱负相关、关联（曲线）、无关联)
<ul>
<li><strong>要点</strong>: 相关性主要指线性关系，而关联性是更广泛的概念，可以包括非线性关系。</li>
</ul>
</li>
</ul>
<p><strong>幻灯片 5: 那么因果关系 (Causality) 呢？相关性/关联性 vs 因果关系</strong></p>
<ul>
<li>(图示：无关联；关联；相关性；因果关系)</li>
<li>(示例图：炎热干燥的夏天天气可能同时导致冰淇淋销量增加和晒伤人数增加。冰淇淋销量和晒伤人数之间可能存在相关性，但它们之间不一定是直接的因果关系，而是都由天气这个共同因素引起。)
<ul>
<li><strong>要点</strong>: 相关性或关联性不等于因果关系。</li>
</ul>
</li>
</ul>
<p><strong>幻灯片 6: 快速回顾</strong></p>
<ul>
<li><strong>第1章</strong>: 介绍，术语，符号 (对应教材 <code>STATS201 book SWU 2023.pdf</code> 第1章)</li>
<li><strong>第2章</strong>: 线性模型 - 基础 (对应教材 <code>STATS201 book SWU 2023.pdf</code> 第2章)</li>
<li><strong>第3章</strong>: 零模型 vs t检验 (对应教材 <code>STATS201 book SWU 2023.pdf</code> 第3章)</li>
</ul>
<p><strong>幻灯片 7: 真伪判断题</strong></p>
<ul>
<li>(题目及解析见后续单独整理的文档)</li>
</ul>
<p><strong>幻灯片 8: 多项选择题</strong></p>
<ul>
<li>(题目及解析见后续单独整理的文档)</li>
</ul>
<p><strong>幻灯片 9: 简答题 (R输出解读)</strong></p>
<ul>
<li>(题目及解析见后续单独整理的文档)</li>
<li><strong>R输出截图</strong>: 展示了一个简单线性回归 <code>summary(lm(y~x))</code> 的结果，包括：
<ul>
<li><code>Call</code>: 模型公式。</li>
<li><code>Residuals</code>: 残差的最小值、第一四分位数、中位数、第三四分位数、最大值。</li>
<li><code>Coefficients</code>:
<ul>
<li><code>(Intercept)</code> (截距) 和 <code>x</code> (斜率) 的估计值 (Estimate)、标准误 (Std. Error)、t值 (t value)、p值 (Pr(&gt;|t|))。</li>
<li>显著性代码 (Signif. codes)。</li>
</ul>
</li>
<li><code>Residual standard error</code>: 残差标准误，自由度。</li>
<li><code>Multiple R-squared</code>: R平方 (决定系数)。</li>
<li><code>Adjusted R-squared</code>: 调整后的R平方。</li>
<li><code>F-statistic</code>: F统计量，自由度，p值 (用于检验整个模型的显著性)。</li>
</ul>
</li>
</ul>
<p><strong>幻灯片 10: 什么是置信区间 (Confidence Interval)？</strong></p>
<ul>
<li>
<p>置信区间 (CI) 是对未知参数的一系列估计。</p>
</li>
<li>
<p>参数未知但固定，也就是说，它不是随机的！</p>
</li>
<li>
<p>CI 是在一定的置信水平下根据不确定性计算出来的。</p>
</li>
<li>
<p><strong>理论结果 - 抽样分布</strong>:</p>
<ul>
<li>
<p>假设误差项 ϵi∼iidNormal(0,σ2) (注意幻灯片中 σ 未平方，但标准理论中误差项方差为 σ2)。</p>
</li>
<li>
<p>β^0∼Normal(β0,σ0)，其中 σ0=σ2(n1+∑(xi−xˉ)2xˉ2)。</p>
</li>
<li>
<p>β^1∼Normal(β1,σ1)，其中 σ1=∑(xi−xˉ)2σ2。</p>
</li>
<li>
<p>当 σ 未知时，使用 t 分布：</p>
<ul>
<li>
<p>σ^0β^0−β0∼tn−2</p>
</li>
<li>
<p>σ^1β^1−β1∼tn−2</p>
</li>
<li>
<p>σ^2=n−21∑(yi−y^i)2 (残差方差的无偏估计)。</p>
</li>
</ul>
<p><img src="/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E6%96%B9%E6%B3%95%EF%BC%88%E5%A4%96%E6%95%99%E7%89%88%EF%BC%89/image-20250602194242290.png" alt="image-20250602194242290"></p>
</li>
</ul>
</li>
</ul>
<p><strong>幻灯片 11: 回顾检验与置信区间的二分法</strong></p>
<ul>
<li>(图示：标准正态/t分布图，中间是接受域，两边黄色区域是拒绝域，对应于双边检验。)</li>
<li><strong>气泡备注 (关于“零模型的置信区间是否总比简单线性模型的置信区间窄”的问题)</strong>: 错误。虽然实践中通常如此，但理论上可以构建反例。零模型的标准误（用于估计总体均值 μY 的CI）是 s/n。简单线性模型中对条件均值 E[Y∣x0] 的预测的标准误是 sn1+∑(xi−xˉ)2(x0−xˉ)2。当 x0 远离 xˉ 或 x 的散布程度小时，SLR的CI可能更宽。</li>
</ul>
<p><img src="/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E6%96%B9%E6%B3%95%EF%BC%88%E5%A4%96%E6%95%99%E7%89%88%EF%BC%89/image-20250602194334420.png" alt="image-20250602194334420"></p>
<p><strong>幻灯片 12: 真伪判断题</strong></p>
<ul>
<li>(题目及解析见后续单独整理的文档)</li>
</ul>
<p><strong>幻灯片 13: 不确定性 (Uncertainty)</strong></p>
<ul>
<li>(图示1：相同置信水平，不同估计量。估计量 μ2 的置信区间比 μ1 的宽，表明 μ2 的不确定性更大。)</li>
<li>(图示2：相同估计量，不同置信水平。99% 置信区间比 95% 置信区间宽。)</li>
</ul>
<p><strong>幻灯片 14: 多项选择题</strong></p>
<ul>
<li>(题目及解析见后续单独整理的文档)</li>
</ul>
<h4 id="知识点梳理-first-week-pdf">知识点梳理 (first_week.pdf)</h4>
<p>这份第一周的课件主要是对统计学基础知识进行回顾和铺垫，特别是针对线性回归的核心概念。</p>
<ol>
<li><strong>统计推断三大基石</strong>:
<ul>
<li><strong>估计 (Estimation)</strong>: 对未知总体参数进行估计，包括点估计和区间估计。</li>
<li><strong>假设检验 (Hypothesis Testing)</strong>: 根据样本信息判断对总体的某个假设是否成立。强调了p值的正确定义：在原假设为真的前提下，观察到当前样本或更极端结果的概率。</li>
<li><strong>置信区间 (Confidence Interval)</strong>: 提供参数估计的一个区间范围，并伴随一个置信水平。其频率学派解释是：如果重复抽样多次并构造多个这样的区间，那么大约有（例如）95%的区间会包含真实的参数值。参数本身是固定的，区间是随机的。</li>
</ul>
</li>
<li><strong>变量间关系</strong>:
<ul>
<li><strong>数据分析目标</strong>: 理解单个变量的分布特征（中心、离散度）和多个变量之间的关系。</li>
<li><strong>相关性 (Correlation)</strong>: 特指两个变量间的<strong>线性</strong>关系强度和方向，常用皮尔逊相关系数衡量。</li>
<li><strong>关联性 (Association)</strong>: 比相关性更广泛，包括线性和非线性关系。</li>
<li><strong>因果关系 (Causality)</strong>: 强调相关不等于因果，需要警惕混淆变量和 spurious correlation（伪相关）。</li>
</ul>
</li>
<li><strong>简单线性回归 (SLR) 核心概念</strong>:
<ul>
<li><strong>模型假设</strong>: Yi=β0+β1xi+ϵi，其中误差项 ϵi 独立同分布于 N(0,σ2)。这是理解和正确应用SLR的前提。</li>
<li><strong>R输出解读</strong>:
<ul>
<li><code>summary(lm_object)</code> 提供了系数估计、标准误、t统计量、p值、R平方、F统计量等关键信息。</li>
<li><strong>统计显著性</strong>: 通常通过斜率 β1 的p值判断。若p值小于预设的显著性水平（如0.05），则认为解释变量与响应变量之间存在显著的线性关系。</li>
<li><strong>实际显著性</strong>: 除了统计显著性，还需要考虑效应的大小（如斜率的绝对值）和模型的解释能力（如R平方）在特定应用场景下是否有实际意义。</li>
</ul>
</li>
<li><strong>参数估计的抽样分布与置信区间</strong>:
<ul>
<li>β^0 和 β^1 的抽样分布在理论上是正态的（或当 σ2 用样本估计时为t分布）。</li>
<li>置信区间公式基于这些抽样分布。</li>
</ul>
</li>
</ul>
</li>
<li><strong>置信区间的性质</strong>:
<ul>
<li>置信区间的宽度受置信水平、样本量和数据变异性的影响。</li>
<li>更高的置信水平（如99% vs 95%）会导致更宽的置信区间。</li>
<li>更大的不确定性（如更大的标准误）会导致更宽的置信区间。</li>
</ul>
</li>
</ol>
<p><strong>与R代码和教材的联系</strong>:</p>
<ul>
<li><code>lecture_1.R</code> 中的 <code>t.test()</code>, <code>cor()</code>, <code>lm()</code>, <code>summary()</code>, <code>confint()</code>, <code>predict()</code> 等函数操作都与本周课件回顾的概念直接相关。</li>
<li>教材 <code>STATS201 book SWU 2023.pdf</code> 的第1章（线性回归入门）、第2章（简单线性回归基础）和第3章（零模型与t检验的等价性）是本周回顾内容的详细展开。</li>
</ul>
<p>这部分内容为后续学习更复杂的模型打下了坚实的基础，强调了对基本统计概念的准确理解和对模型假设的重视。</p>
<h3 id="Week-2">Week 2</h3>
<h4 id="幻灯片内容翻译与概览-2">幻灯片内容翻译与概览</h4>
<p><strong>幻灯片 1: (概率与参数估计的思考题 - 续)</strong></p>
<ul>
<li>(牌堆示例图，与 <code>first_week.pdf</code> 幻灯片1类似，继续探讨随机性、固定参数和概率的概念。)
<ul>
<li><strong>文字</strong>: &quot;你可能认为两者都是随机的，相应的概率也可以定义为p值。但回想一下，我们假设一个是未知但固定的。&quot;</li>
<li><strong>牌桌</strong>:
<ul>
<li><strong>双方随机 (Both Random)</strong>: P(T=K)=1/13 (老师抽到K的概率)</li>
<li><strong>双方固定 (Both fixed)</strong>: P(T=K∣T=K)=1 (老师是K，已知老师是K的概率)</li>
<li><strong>一个随机，一个固定 (One random, one fixed)</strong>: P(Same∣T=K,S=Q)=0 (老师是K，学生是Q，牌面相同的概率)</li>
<li><strong>一个随机，一个未知但固定 (How about 1 random and 1 unknown but fixed?)</strong>: 这是统计推断的核心情景，我们观察随机样本，推断固定的总体参数。</li>
</ul>
</li>
<li><strong>&quot;After&quot; vs &quot;Before&quot;</strong>: 暗示了数据观察前后对参数认识的改变（从先验到后验的贝叶斯思想，或频率学派中参数固定但我们通过数据估计它）。</li>
<li><strong>核心问题</strong>: &quot;理解潜在的随机性从何而来。&quot; (通常来自抽样过程和个体变异)。</li>
</ul>
</li>
</ul>
<p><strong>幻灯片 2: (置信区间的频率学派解释 - 续)</strong></p>
<ul>
<li>(与 <code>first_week.pdf</code> 幻灯片2类似的图示，多条置信区间围绕着真实的总体均值，有的包含有的不包含。)
<ul>
<li><strong>文字</strong>: &quot;样本均值 (sample mean) -&gt; 置信区间 (Confidence Interval) -&gt; 包含真实均值 (includes true mean) / 不包含真实均值 (misses true mean)&quot;</li>
<li><strong>文字</strong>: &quot;真实的总体均值 (TRUE population mean)&quot;</li>
<li><strong>文字</strong>: &quot;新样本均值 (new sample mean) -&gt; 新置信区间 (new CI)&quot;</li>
</ul>
</li>
</ul>
<p><strong>幻灯片 3: 线性模型 - 在重复抽样下</strong></p>
<ul>
<li>(一个从左到右的红色粗箭头，象征着从数据收集到模型建立再到推断的整个过程，是在“重复抽样”的理论框架下进行的。)
<ul>
<li><strong>文字</strong>: &quot;进行实验 (Conduct experiment) -&gt; 收集数据 (Collect data) -&gt; 找到一些有意义的数字 (Find some meaningful numbers) -&gt; 计算均值 (Compute mean) -&gt; 计算置信区间 (Compute CI)&quot;</li>
</ul>
</li>
</ul>
<p><strong>幻灯片 4: 关键组成部分是什么？</strong></p>
<ul>
<li>(与 <code>first_week.pdf</code> 幻灯片4和 <code>fourth_week.pdf</code> 幻灯片1类似的流程图，再次强调线性模型的构成要素。)
<ul>
<li><strong>数据 (Data)</strong> -&gt; <strong>参数估计 (<strong>β^0,β^1,…</strong>)</strong> -&gt; <strong>置信区间 (Confidence Interval) / 假设检验 (Hypothesis Testing) / 估计 (Estimation)</strong></li>
<li><strong>数据 (Data)</strong> + <strong>模型 (Model)</strong> -&gt; (加入<strong>新数据 (New Data)</strong>) -&gt; <strong>预测 (Prediction) / 预测区间 (Prediction Interval)</strong></li>
<li><strong>估计方法</strong>: <strong>最大似然 (Maximum Likelihood) / 最小二乘法 (Least-squares)</strong></li>
<li><strong>假设 (Assumptions)</strong> (例如：误差独立同正态分布，线性，方差齐性) -&gt; <strong>检查假设的工具和违反假设时的补救措施 (Tools to check assumptions and remedies for assumption violations)</strong></li>
</ul>
</li>
</ul>
<p><strong>幻灯片 5: 什么是分类变量？</strong></p>
<ul>
<li>分类变量是具有两个或多个互斥类别的变量。</li>
<li>例如：
<ul>
<li>一个是/否的二元变量。</li>
<li>水果类型的变量。</li>
<li>年龄组的变量。</li>
</ul>
</li>
<li>通常没有内在顺序，即<strong>名义变量 (nominal)</strong>。
<ul>
<li>名义变量是没有明确顺序的变量。</li>
</ul>
</li>
<li>如果有明确顺序，则称为<strong>有序变量 (ordinal)</strong>。</li>
<li><strong>气泡备注</strong>: 本课程我们只处理名义分类变量。</li>
</ul>
<p><strong>幻灯片 6: 一个分类预测变量 - 模型结构是什么？</strong></p>
<ul>
<li><strong>线性模型</strong>: Yi∼Normal(μi,σ)</li>
<li><strong>对比</strong>:
<ul>
<li><strong>数值预测变量 x</strong>: μi=β0+β1xi
<ul>
<li>x 每变化一个单位，Y的均值变化 β1 个单位。</li>
</ul>
</li>
<li><strong>二元预测变量 z (0/1编码)</strong>: μi=β0∗+β1∗zi
<ul>
<li>这等价于：
<ul>
<li>当 zi=0 时, μi=β0∗ (基准组均值)</li>
<li>当 zi=1 时, μi=β0∗+β1∗ (另一组均值)</li>
</ul>
</li>
<li>β1∗ 代表 z=1 (如&quot;Yes&quot;) 相对于 z=0 (如&quot;No&quot;) 对截距的额外影响，即两组均值之差。</li>
<li><strong>文字</strong>: &quot;当z为Yes（即z=1）而不是No时，会在截距上增加一个额外的分量。&quot;</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>幻灯片 7: 幂律线性模型 - 解释</strong></p>
<ul>
<li>回顾对数线性模型 log(Yi)=β0+β1xi+ϵi, 其中 ϵi∼iidNormal(0,σ2):
<ul>
<li>模型可以写成 μlog(y)=β0+β1x，则 Y 的中位数 median(Y)=eβ0+β1x=eβ0eβ1x。</li>
<li>x 每增加一个单位， Y 的<strong>中位数</strong>乘以 eβ1 (即增加 100×(eβ1−1) )。</li>
</ul>
</li>
<li>回顾对数-对数 (幂律) 模型 log(Yi)=β0∗+β1∗log(xi)+ϵi, 其中 ϵi∼iidNormal(0,σ2):
<ul>
<li>模型可以写成 μlog(y)=β0∗+β1∗log(x)，则 Y 的中位数 \text{median}(Y) = e^{\beta_0^} x^{\beta_1^} = \alpha x^{\beta_1^*}。</li>
<li>如果 x 变为 1.01x (增加1%)，则新的中位数与原中位数的比值为 \frac{\alpha (1.01x)^{\beta_1^}}{\alpha x^{\beta_1^}} = 1.01^{\beta_1^*}。</li>
<li>根据泰勒展开，1.01^{\beta_1^} \approx 1 + \beta_1^ \times 0.01。</li>
<li>所以，x 每增加1%， Y 的<strong>中位数</strong>大约增加 β1∗。</li>
</ul>
</li>
</ul>
<p><strong>幻灯片 8: 简单线性模型 - 模型方程、斜率的CI、均值和个体Y的CI/PI (复习)</strong></p>
<ul>
<li>模型: Yi=β0+β1xi+ϵi, xi是数值型, ϵi∼iidNormal(0,σ2)。</li>
<li>R代码: <code>fit = lm(y~x, data=df)</code>, <code>confint(fit)</code>。
<ul>
<li><strong>斜率置信区间解释</strong>: &quot;我们估计 x 每增加一个单位， y 的均值变化在 -0.24 到 0.12 之间。&quot; (示例数据)</li>
</ul>
</li>
<li>预测: <code>new.df = data.frame(x=1)</code>, <code>predict(fit, new.df, interval=&quot;confidence&quot;)</code> 和 <code>predict(fit, new.df, interval=&quot;prediction&quot;)</code>。
<ul>
<li><strong>均值置信区间和个体预测区间解释</strong>: &quot;我们估计当 x=1 时，y 的均值在 -0.35 到 0.17 之间，而一个特定的 y 值在 -1.84 到 1.66 之间。&quot; (示例数据)</li>
</ul>
</li>
</ul>
<p><strong>幻灯片 9: 分类预测变量 (二元) (复习)</strong></p>
<ul>
<li>模型: Yi=β0+β1zi+ϵi, zi是二元变量, ϵi∼iidNormal(0,σ2)。</li>
<li><strong>二元变量系数的CI解释</strong>: &quot;我们估计 z 为1/是 (Yes) 而不是否 (No) 会使得 y 的均值增加 -0.55 到 0.13 个单位。&quot; (示例数据)</li>
<li><strong>均值和个体Y的CI/PI解释</strong>: &quot;我们估计当 z=1 时，y 的均值在 -0.37 到 0.12 之间，而一个特定的 y 值在 -1.86 到 1.61 之间。&quot; (示例数据)</li>
</ul>
<p><strong>幻灯片 10: 二次模型 (复习)</strong></p>
<ul>
<li>模型: Yi=β0+β1xi+β2xi2+ϵi, xi是数值型, ϵi∼iidNormal(0,σ2)。</li>
<li>用途: 通常用于处理由于非线性关系导致的拟合不足。</li>
<li>系数的CI解释不那么直接有意义。</li>
<li>均值和个体Y的CI/PI解释方法保持不变。</li>
<li>R代码: <code>fit = lm(y ~ x + I(x^2), data=df)</code>。</li>
<li><strong>均值和个体预测区间解释</strong>: &quot;我们估计当 x=1 时，y 的均值在 -0.35 到 0.18 之间，而一个特定的 y 值在 -1.84 到 1.67 之间。&quot; (示例数据)</li>
<li><strong>气泡备注</strong>: 你不仅需要单独理解第8至14页（此处指幻灯片编号）的解释。但也需要能将其扩展到混合情况，例如乘法模型中的二次项，或对数线性模型中的分类变量等。</li>
</ul>
<p><strong>幻灯片 11: 乘法对数线性模型 (复习)</strong></p>
<ul>
<li>模型: log(Yi)=β0+β1xi+ϵi, xi是数值型, ϵi∼iidNormal(0,σ2)。</li>
<li><strong>斜率的CI解释 (反转换后)</strong>: &quot;我们估计 x 每增加一个单位， y 的中位数增加 -41.6% 到 36.5%。&quot; (示例数据)</li>
<li><strong>中位数和个体Y的CI/PI解释 (反转换后)</strong>: &quot;我们估计当 x=1 时，y 的中位数在 0.12 到 0.43 之间，而一个特定的 y 值在 0.0036 到 14.45 之间。&quot; (示例数据)</li>
</ul>
<p><strong>幻灯片 12: 乘法对数线性模型 (含分类变量) (复习)</strong></p>
<ul>
<li>模型: log(Yi)=β0+β1zi+ϵi, zi是二元变量, ϵi∼iidNormal(0,σ2)。</li>
<li><strong>系数的CI解释</strong>: &quot;我们估计 z 为1/是 (Yes) 而不是否 (No) 会使得 y 的中位数增加 -67.6% 到 66.6%。&quot; (示例数据)</li>
<li><strong>中位数和个体Y的CI/PI解释</strong>: &quot;我们估计当 z=1 时，y 的中位数在 0.12 到 0.40 之间，而一个特定的 y 值在 0.0035 到 13.86 之间。&quot; (示例数据)</li>
</ul>
<p><strong>幻灯片 13: 幂律模型 (Log-log) (复习)</strong></p>
<ul>
<li>模型: log(Yi)=β0+β1log(xi)+ϵi, xi是正数值型, ϵi∼iidNormal(0,σ2)。</li>
<li><strong>斜率的CI解释</strong>: &quot;我们估计 x 每增加一个百分比， y 的中位数大约增加 -0.20% 到 0.19%。&quot; (示例数据)</li>
<li><strong>中位数和个体Y的CI/PI解释</strong>: &quot;我们估计当 x=1 时，y 的中位数在 0.16 到 0.42 之间，而一个特定的 y 值在 0.0041 到 16.05 之间。&quot; (示例数据)</li>
</ul>
<p><strong>幻灯片 14: Log-log模型的近似解释 (复习)</strong></p>
<ul>
<li>&quot;x 增加1% 导致 y 的中位数大约增加 β1 &quot; 这个解释是基于泰勒展开的近似：1.01β1−1≈β1×0.01。</li>
<li>当变化较大时（如 x 增加50%），不应使用此近似。应计算 1.5β1−1。</li>
</ul>
<p><strong>幻灯片 15: 什么是交互作用 (Interaction)？ (复习)</strong></p>
<ul>
<li>“交互作用”描述了一个变量 z 改变了另外两个变量 y 和 x 之间关系的情况。</li>
<li>(图示1：空气温度和物种对体温的交互作用 - 不同物种体温随空气温度变化的趋势线不平行。)</li>
<li>(图示2：加糖后时间和搅拌对咖啡甜度的交互作用 - 搅拌会加速糖溶解，从而改变甜度随时间变化的曲线。)</li>
</ul>
<p><strong>幻灯片 16: 线性模型 - 二元变量z (交互作用的引入) (复习)</strong></p>
<ul>
<li>假设数值变量 y 和 x 之间的关系取决于二元变量 z。</li>
<li>最简单的方法是使用两个模型 (等价于一个包含交互作用的单一模型): Yi={β0+β1xi+ϵiif zi=0, (β0+β2)+(β1+β3)xi+ϵiif zi=1, 这等价于 Yi=β0+β1xi+β2zi+β3xizi+ϵi。 其中 β2 是截距的差异，β3 是斜率的差异。</li>
</ul>
<h4 id="知识点梳理-second-week-pdf">知识点梳理 (second_week.pdf)</h4>
<p>这份第二周的课件主要是对第一周介绍的各种线性模型形式（简单线性、含分类变量、二次项、对数转换、幂律模型）进行<strong>系统性的复习和总结</strong>，重点在于<strong>模型方程的统一理解</strong>和<strong>参数解释的规范化</strong>，并再次强调了<strong>交互作用</strong>的概念。</p>
<ol>
<li><strong>统计推断的本质与随机性</strong>:
<ul>
<li>通过“抽牌”的例子，引导学生思考统计推断中“未知但固定”的参数与“随机”的样本数据之间的关系，强调理解随机性的来源是正确进行统计推断的基础。</li>
<li>再次通过图形展示置信区间的频率学派含义：多次重复实验，置信区间会围绕真实参数波动，其中一定比例（如95%）的区间会包含该参数。</li>
</ul>
</li>
<li><strong>线性模型的通用框架与关键组件</strong>:
<ul>
<li>重申了线性模型分析的基本流程：从数据出发，通过参数估计（如最大似然、最小二乘）建立模型，然后进行假设检验、置信区间估计、预测等。</li>
<li>强调了模型假设的重要性，以及检查假设和处理违规情况的必要性。</li>
</ul>
</li>
<li><strong>分类预测变量的模型结构</strong>:
<ul>
<li>明确了名义分类变量和有序分类变量的区别，并指出本课程主要关注名义分类变量。</li>
<li>详细解释了当模型中包含一个二元分类预测变量（如0/1编码）时，模型 μi=β0∗+β1∗zi 中，β0∗ 代表基准组的均值，β1∗ 代表另一组相对于基准组的均值差异。</li>
</ul>
</li>
<li><strong>各种线性模型形式的解释范式总结</strong>:
<ul>
<li><strong>简单线性模型 (<strong>Y∼Xnumeric</strong>)</strong>: 解释斜率 β1 对 Y 均值的影响。</li>
<li><strong>含二元分类变量的模型 (<strong>Y∼Zbinary</strong>)</strong>: 解释指示变量系数 β1 对 Y 均值的差异影响。</li>
<li><strong>二次模型 (<strong>Y∼X+X2</strong>)</strong>: 重点在于描述曲线关系和进行预测，单个系数的解释意义不大。</li>
<li><strong>对数线性模型 (<strong>log(Y)∼Xnumeric</strong>)</strong>: 解释 X 的单位变化对 Y <strong>中位数</strong>的<strong>乘性</strong>影响或<strong>百分比</strong>变化。</li>
<li><strong>对数线性模型 (含分类变量</strong> log(Y)∼Zbinary**)<strong>: 解释分类变量不同水平下 Y <strong>中位数</strong>的</strong>比率<strong>或</strong>百分比差异**。</li>
<li><strong>幂律模型 (<strong>log(Y)∼log(Xnumeric)</strong>)</strong>: 解释 X 的<strong>百分比变化</strong>对 Y <strong>中位数</strong>的<strong>百分比变化</strong>的影响（弹性概念）。强调了1%近似解释的局限性，对于较大百分比变化需要精确计算。</li>
</ul>
</li>
<li><strong>交互作用的再强调</strong>:
<ul>
<li>再次定义交互作用：一个变量改变了另外两个变量之间的关系。</li>
<li>通过代数形式解释了包含一个数值变量和一个二元分类变量的交互作用模型，说明它等价于为分类变量的每个水平拟合一条具有不同截距和斜率的直线。</li>
</ul>
</li>
</ol>
<p><strong>与R代码和教材的联系</strong>:</p>
<ul>
<li>本周课件内容是对 <code>lecture_1.R</code> 到 <code>lecture_6.R</code> 中涉及的各种模型解释方法的一个高度概括和对比总结。</li>
<li>它系统性地对应了教材 <code>STATS201 book SWU 2023.pdf</code> 中第1-8章关于不同线性模型形式的解释部分。例如，第1、2章的简单线性回归，第4章的曲线拟合（二次模型），第5章的二元分类变量，第6章的乘法模型（对数线性），第7章的幂律模型，以及第8章的交互作用模型。</li>
</ul>
<p>这份课件的核心价值在于提供了一个统一的框架来理解和解释不同类型的线性模型及其变体，帮助学生巩固之前学习的知识点，并为后续更复杂的模型（如多重回归、GLM）做好准备。它强调了不仅要会拟合模型，更要会正确地解释模型结果。</p>
<h3 id="Week-3">Week 3</h3>
<h4 id="幻灯片内容翻译与概览-3">幻灯片内容翻译与概览</h4>
<p><strong>幻灯片 1: 执行摘要 (Executive Summary) - 示例1 (Exam vs Test &amp; Attendance 交互模型 - 复习)</strong></p>
<ul>
<li>我们想要量化学生的考试分数与出勤率和测试分数之间的关系。</li>
<li>测试分数和考试分数之间存在明显的线性关系，但这种关系在规律出勤和非规律出勤的学生之间有所不同。</li>
<li>我们估计，非规律出勤学生每额外获得一分测试分数（满分20分），其期望考试分数将增加1.8到3.7分。</li>
<li>对于规律出勤的学生，每测试分数对应的期望考试分数额外增加0.04到2.2分。</li>
<li>$^+$由于两组的斜率不同，我们需要单独讨论每个斜率。</li>
</ul>
<p><strong>幻灯片 2: 方法与假设检查 (Method and Assumption Checks) - 示例1 (复习)</strong></p>
<ul>
<li>由于我们有两个解释变量，一个是数值型，一个是因子型，我们拟合了一个线性模型，该模型为每个出勤组使用了不同的截距和斜率（即交互作用模型）。</li>
<li>所有模型假设均得到满足。</li>
<li>我们不能移除交互作用项 (P值 = 0.043)。</li>
<li>我们的最终模型解释了学生考试分数变异性的63%（中等程度），其形式为： Exami=β0+β1×Testi+β2×Attendi+β3×Attendi×Testi+ϵi, 其中 Attendi=1 如果学生 i 规律出勤，否则为0，并且 ϵi∼iidN(0,σ2)，β0,β1,β2,β3 是固定但未知的参数。</li>
</ul>
<p><strong>幻灯片 3: (奥卡姆剃刀与模型复杂度 - 复习)</strong></p>
<ul>
<li>当样本量相对较小时，我们常常面临两个或多个具有相似解释能力模型的情况。</li>
<li>我们更喜欢一个更简单的模型，即具有较少假设/参数的模型。</li>
<li>复杂性就像构建模型的成本。我们知道总能实现完美拟合，即饱和模型，但这将耗费一切！</li>
<li>一个好的模型应该始终平衡拟合优度和复杂性。</li>
<li>当面临具有相似解释能力模型时，最终取决于成本。</li>
<li><strong>核心思想</strong>: 假设、限制和变量数量。数据大小。奥卡姆剃刀支持更简洁（优雅）的解决方案，该方案能持续解释我们现在观察到的现象。<strong>保持简单 (Keep it simple!)</strong></li>
<li>(图示：地心说 vs 日心说，日心说模型更简单且解释力更强。)</li>
</ul>
<p><strong>幻灯片 4: 方法与假设检查 - 示例2 (Thyroid drug experiment - 无交互作用，最终简化模型 - 复习)</strong></p>
<ul>
<li>探索性图表建议，为解释小鼠甲状腺重量，我们首先拟合了包含解释变量药物治疗和体重的线性模型及其交互作用。但交互作用项不显著 (P值=0.11)。</li>
<li>移除了交互作用项后重新拟合模型。然而，治疗效应不显著 (P值=0.37)，因此也被移除。</li>
<li>小鼠被随机分配到各组，测量是相互独立的。</li>
<li>所有其他模型假设均得到满足。一个潜在的影响点被调查过，但考虑到其位置以及该数据集极小的规模（16个观测值），我们将忽略它。</li>
<li>我们的最终模型是 thyroidi=β0+β1×weighti+ϵi，其中 ϵi∼iidN(0,σ2)，β0,β1 是固定但未知的参数。</li>
<li>我们的模型解释了甲状腺重量变异性的大约82%。</li>
</ul>
<p><strong>幻灯片 5: 执行摘要 - 示例2 (复习)</strong></p>
<ul>
<li>我们想要评估一种新开发的旨在增加甲状腺重量（毫克）的药物的效果。</li>
<li>我们唯一能报告的是，体型较大的小鼠拥有较大的甲状腺。我们可以报告这种效应的大小，但由于它不是研究问题的一部分，所以我们不这样做。</li>
<li>我们没有证据相信这种药物能增加小鼠甲状腺的期望大小。</li>
</ul>
<p><strong>幻灯片 6: 什么是 Anova (方差分析)？</strong></p>
<ul>
<li><strong>Analysis of Variance (方差分析)</strong></li>
<li>它基于<strong>分解响应变量的方差</strong>。</li>
<li>它可以用来“<strong>削减 (shave)</strong>”我们的模型，即决定我们是否可以移除一个变量。</li>
</ul>
<p><strong>幻灯片 7: 为什么不（总是）使用T检验？ (在多重回归/ANOVA情境下)</strong></p>
<ul>
<li>(R代码示例：<code>y ~ x * z</code>，其中x是数值，z是二元(0/1)指示变量)
<ul>
<li><code>x = rnorm(100); z = c(rep(0, 50), rep(1, 50))</code></li>
<li><code>y = 0.5 + 0.1*x + rnorm(100, sd = 0.1)</code> (注意这里生成y时没有包含z或x:z的效应，所以理论上z和x:z的系数应为0)</li>
<li><code>df = data.frame(y=y, x=x, z=z)</code></li>
<li><code>summary(lm(y ~ x*z, data=df))</code></li>
</ul>
</li>
<li>(输出 <code>summary()</code> 的 Coefficients 部分，显示了 <code>(Intercept)</code>, <code>x</code>, <code>z</code>, <code>x:z</code> 的t检验结果。在这个模拟数据中，<code>z</code> 和 <code>x:z</code> 的p值可能会随机地显得显著或不显著。)</li>
<li><strong>气泡备注 (指向 <code>x:z</code> 的t检验)</strong>: 在这种情况下 (指交互作用项只有一个参数，如两个二元因子或一个数值一个二元因子的交互)，T检验足够了。</li>
<li><strong>批注 (指向所有系数的t检验)</strong>: 这些T检验中的每一个都在测试，在模型中存在其他系数的情况下，该系数是否为零。</li>
</ul>
<p><strong>幻灯片 8: 一次削减一个beta (模型简化过程 - 基于t检验)</strong></p>
<ul>
<li>(R代码示例：<code>summary(lm(y ~ x+z, data=df))</code>，即从 <code>x*z</code> 模型中移除了不显著的交互作用项 <code>x:z</code> 后的模型)</li>
<li>(输出显示 <code>z</code> 的t检验不显著)</li>
<li><strong>文字</strong>: “下一步是削减掉z。”</li>
<li>(圈出 Multiple R-squared: 0.4819)</li>
<li><strong>文字</strong>: “R平方之前是0.4829” (指包含交互作用时，移除不显著项对R平方影响很小，但调整R平方可能提高，自由度增加)。</li>
</ul>
<p><strong>幻灯片 9: 无论哪种方式，结论相同 (关于移除顺序)</strong></p>
<ul>
<li>(R代码示例：<code>summary(lm(y ~ x + x:z, data=df))</code>，这是一个不寻常的模型形式，包含了 <code>x</code> 和 <code>x:z</code> 但没有 <code>z</code> 的主效应。通常不推荐这样做，除非有强理论依据。标准做法是遵循层次原则，如果包含交互项，则其组成的主效应也应包含在内。)</li>
<li>(输出显示 <code>x:z</code> 的t检验不显著)</li>
<li><strong>文字</strong>: “下一步是削减掉交互作用项。” (这与幻灯片7的结论一致，即交互作用不显著)</li>
</ul>
<p><strong>幻灯片 10: 根据奥卡姆剃刀</strong></p>
<ul>
<li>(R代码示例：<code>summary(lm(y ~ x, data=df))</code>，进一步简化模型，只剩下x，假设之前的步骤已确定z和交互作用均不显著。)</li>
<li><strong>文字</strong>: “这是一个更好的模型。” (前提是简化是合理的)</li>
</ul>
<p><strong>幻灯片 11: 超过两个类别 (多水平因子)</strong></p>
<ul>
<li>(R代码示例：创建一个有3个水平(0,1,2)的因子z，并拟合 <code>lm(y ~ z, data=df)</code>)
<ul>
<li><code>z = c(rep(0, 25), rep(1, 25), rep(2, 50))</code></li>
<li><code>y = 1 + ifelse(z==2, 0.1, 0) + rnorm(100, sd = 0.1)</code> (这里生成y时，z=0和z=1的均值相同，z=2的均值高0.1)</li>
<li><code>df = data.frame(y=y, z=factor(z))</code></li>
<li><code>summary(lm(y~z, data=df))</code></li>
</ul>
</li>
<li>(输出 <code>summary()</code> 显示了 <code>(Intercept)</code> (对应z=0的均值)，<code>z1</code> (z=1与z=0的均值差)，<code>z2</code> (z=2与z=0的均值差) 的t检验结果。)</li>
<li><strong>文字 (指向 <code>z1</code> 的p值 (0.339) 和 <code>z2</code> 的p值 (1.43e-06))</strong>: “对于z是否有用，没有总体结论！” (因为一个比较不显著，一个显著，t检验无法告诉我们z这个因子作为一个整体是否有用。)</li>
<li><strong>文字 (指向右侧)</strong>: “我们想要检验 H0:β~1=β~2=0” (这里 β~1,β~2 指的是与因子z相关的参数，即 <code>z1</code> 和 <code>z2</code> 的系数，暗示需要一个整体检验，即F检验。)</li>
</ul>
<p><strong>幻灯片 12: 如果组间均值的变异性很大，z可能有用</strong></p>
<ul>
<li>(图示：Y对Z的条状图/散点图，显示了三组(z=0,1,2)的均值 yˉ0,yˉ1,yˉ2 和总体均值 yˉ )</li>
<li><strong>组间方差 (Between-group variance)</strong>: VarBetween=k−11∑j=1k(yˉj−yˉ)2 (这里k是组数，幻灯片用3-1)</li>
</ul>
<p><strong>幻灯片 13: 如果组内均值的变异性很小，z可能有用</strong></p>
<ul>
<li>(与幻灯片12类似的图示)</li>
<li><strong>组内方差 (Within-group variance)</strong>: VarWithin=N−k1∑j=1k∑i=1nj(yij−yˉj)2 (N是总样本量, nj是第j组样本量)</li>
<li><strong>F统计量</strong>: F=VarWithinVarBetween (更准确地说是 MSBetween/MSWithin，均方)</li>
</ul>
<p><strong>幻灯片 14: F检验在summary输出中 (针对整个模型) vs anova()</strong></p>
<ul>
<li>(幻灯片11中 <code>summary(lm(y~z, data=df))</code> 的完整输出)</li>
<li><strong>F-statistic</strong>: 16.23 on 2 and 97 DF, p-value: 8.336e-07。这个F检验是针对整个模型（即因子z作为一个整体）是否显著的检验。</li>
<li><strong>文字 (指向p值)</strong>: “检验 H0:β1=β2=0 的p值” (这里 β1,β2 指的是与因子z的非基准水平相关的系数)。</li>
<li><strong>结论</strong>: F检验回答了一个特定的系数集合是否同时为零的问题。它回答了一个模型/分类变量是否有用的问题。</li>
</ul>
<p><strong>幻灯片 15: F对于F值多大才算大？ (F分布)</strong></p>
<ul>
<li>可以证明F比率/F统计量服从<strong>F分布</strong>。</li>
<li>F分布由两个参数 d1 (分子自由度) 和 d2 (分母自由度) 定义。</li>
<li>为了判断因子z是否有用 (对于单因素ANOVA):
<ul>
<li>d1=类别数−1</li>
<li>d2=总数据点数−类别数</li>
</ul>
</li>
<li>有了F统计量的分布，我们就可以正式检验 H0:β1=β2=⋯=βk=0 (k是与因子相关的非基准水平系数个数)。</li>
</ul>
<p><strong>幻灯片 16: 一般的F检验 (使用 <code>anova()</code> 函数)</strong></p>
<ul>
<li><code>anova(lm(y~z, data=df))</code> 输出显示因子 <code>z</code> (作为一个整体) 的F检验结果，与 <code>summary()</code> 中的F检验结果一致（对于单因子模型）。</li>
<li><code>anova(lm(y ~ z*x, data=df))</code> (幻灯片中为 <code>y ~ z+x+z:x</code>，应理解为包含交互作用的模型) 输出<strong>序贯方差分析表 (Type I SS)</strong>。
<ul>
<li>在这种表中，每个项（如 <code>z</code>, <code>x</code>, <code>z:x</code>）的F检验是在调整了模型中<strong>位于它前面</strong>的项之后进行的。因此，变量进入模型的顺序会影响其F检验的P值。</li>
</ul>
</li>
</ul>
<p><strong>幻灯片 17: (解释变量的变异性对斜率估计稳定性的影响 - 复习)</strong></p>
<ul>
<li>简单线性模型中，斜率的标准误 SE(β^1)=∑(xi−xˉ)2σ。</li>
<li>如果解释变量 xi 的散布程度 (∑(xi−xˉ)2) 很小（即 xi 值非常集中），则 SE(β^1) 会很大，导致 β^1 的估计非常不稳定。</li>
<li>(图示：左图显示解释变量 xi 变异性小，多次抽样得到的回归线非常不稳定。右图显示解释变量 xi 变异性大，回归线相对稳定。)</li>
</ul>
<p><strong>幻灯片 18: (多重共线性简介 - 复习)</strong></p>
<ul>
<li>一般来说，解释/预测变量的配置可能会导致<strong>多重共线性 (multicollinearity)</strong>，从而影响模型/估计量标准误的稳定性。</li>
<li>当模型中有多个数值解释变量 x 和 z 时，它们之间的相关性会影响模型的稳定性。</li>
</ul>
<h4 id="知识点梳理-third-week-pdf">知识点梳理 (third_week.pdf)</h4>
<p>这份第三周的课件重点回顾和深化了<strong>模型选择</strong>的策略，特别是<strong>奥卡姆剃刀原则</strong>的应用，并详细介绍了<strong>方差分析 (ANOVA)</strong> 和 <strong>F检验</strong>在评估多水平因子变量或一组解释变量整体显著性时的核心作用。同时，它也再次提及并强调了<strong>多重共线性</strong>对模型稳定性的潜在影响。</p>
<ol>
<li><strong>模型选择与奥卡姆剃刀 (Occam's Razor)</strong>:
<ul>
<li><strong>原则</strong>: 在多个具有相似解释能力的模型中，应选择最简单的那个（即参数最少的）。强调了在拟合优度和模型复杂性之间进行权衡。</li>
<li><strong>实践</strong>: 通常通过逐步移除模型中不显著的项（基于t检验或F检验的p值）来简化模型。</li>
<li><strong>示例</strong>: 课件通过甲状腺药物实验的案例（从交互作用模型逐步简化到仅含体重的主效应模型）和模拟的R代码 (<code>y ~ x*z</code> -&gt; <code>y ~ x+z</code> -&gt; <code>y ~ x</code>) 演示了这一过程。</li>
<li>对应教材 <code>STATS201 book SWU 2023.pdf</code> 第9章 (第14-20页) 的模型选择部分。</li>
</ul>
</li>
<li><strong>方差分析 (ANOVA) 与 F检验</strong>:
<ul>
<li><strong>ANOVA的本质</strong>: 将响应变量的总变异分解为由不同解释变量（或因子水平）引起的变异和残差变异。</li>
<li><strong>F检验的用途</strong>:
<ul>
<li><strong>检验多水平因子的整体显著性</strong>: 当一个分类解释变量有三个或更多水平时，<code>summary()</code>输出中对各指示变量的t检验只能说明该水平与基准水平的差异是否显著，而不能判断该因子变量作为一个整体是否对响应变量有显著影响。此时需要F检验（通常由<code>anova()</code>函数或<code>summary()</code>输出中的F-statistic提供）来检验与该因子相关的所有系数是否同时为零。</li>
<li><strong>检验交互作用的整体显著性</strong>: 对于包含多个因子或数值与因子交互作用的模型，F检验可以评估整个交互作用部分的显著性。</li>
<li><strong>比较嵌套模型</strong>: F检验可以用来比较一个复杂模型和一个简化模型（复杂模型的子集），判断移除的项是否显著影响模型的拟合优度。</li>
</ul>
</li>
<li><strong>F统计量的构造</strong>: 其基本思想是比较组间（或模型解释的）变异与组内（或残差）变异。F统计量服从F分布，其形状由分子自由度 (df1) 和分母自由度 (df2) 决定。</li>
<li><strong><code>anova()</code> 函数</strong>: 在R中，<code>anova(lm_object)</code> 会生成一个方差分析表。对于包含多个解释变量的模型，它通常给出的是<strong>序贯F检验 (Type I Sum of Squares)</strong>，这意味着变量进入模型的顺序会影响其F检验的p值。</li>
<li>对应教材 <code>STATS201 book SWU 2023.pdf</code> 第9章 (第18, 23页) 和第11章 (第12页) 关于 <code>anova()</code> 的使用。</li>
</ul>
</li>
<li><strong>解释变量的配置与模型稳定性</strong>:
<ul>
<li>再次强调了简单线性回归中解释变量 x 的散布程度 (∑(xi−xˉ)2) 对斜率估计稳定性的重要性。如果 x 的值域很窄，斜率估计的标准误会很大。</li>
<li>引出了多重共线性的概念：当模型中存在多个解释变量，并且它们之间高度相关时，会导致参数估计不稳定，标准误增大，难以解释单个变量的独立效应。</li>
</ul>
</li>
</ol>
<p><strong>与R代码和教材的联系</strong>:</p>
<ul>
<li><code>lecture_7.R</code> 中的教学方法案例 (<code>teach.df</code>) 完美地演示了从交互作用模型开始，通过 <code>anova()</code> 检验交互作用，然后简化到主效应模型，并使用 <code>relevel()</code> 进行不同基准的比较，这些都与本周课件的核心内容一致。</li>
<li><code>lecture_8.R</code> 中的婴儿出生体重案例，虽然主要目标是多重回归，但也涉及了模型简化和变量选择的思想。</li>
<li>教材 <code>STATS201 book SWU 2023.pdf</code> 第9章（不含交互作用的模型）和第11章（单因素ANOVA）是本周课件的主要理论和实践依据。</li>
</ul>
<p>这份课件通过回顾、实例和理论讲解，帮助学生理解模型选择的逻辑，掌握使用F检验评估因子和交互作用整体效应的方法，并初步认识到解释变量间关系对模型稳定性的影响。</p>
<h3 id="Week-4">Week 4</h3>
<h4 id="幻灯片内容翻译与概览-4">幻灯片内容翻译与概览</h4>
<p><strong>幻灯片 1: 回顾线性模型</strong></p>
<ul>
<li>(与 <code>second_week.pdf</code> 幻灯片4类似的流程图，展示线性模型的各个组成部分和流程。)
<ul>
<li>数据 (Data) → 参数估计 (β^0,β^1,…) → [置信区间 (Confidence Interval) / 假设检验 (Hypothesis Testing) / 估计 (Estimation)]</li>
<li>数据 (Data) + 模型 (Model) → (加入新数据 (New Data)) → [预测 (Prediction) / 预测区间 (Prediction Interval)]</li>
<li>估计方法: 最大似然 (Maximum Likelihood) / 最小二乘法 (Least-squares)</li>
<li>假设 (Assumptions): Yi=β0+β1xi+ϵi, ϵi∼iidN(0,σ2); 线性性 (Linearity); 方差齐性 (EOV / Constant Variance); 正态性 (Normality)。</li>
</ul>
</li>
</ul>
<p><strong>幻灯片 2: 假设检验与置信区间的局限性</strong></p>
<ul>
<li>显著性水平（例如，通常为5%或95%水平）仅适用于<strong>单个</strong>检验或估计，而<strong>不适用于一系列</strong>检验或估计。(多重比较问题)</li>
<li>仅当该估计或检验<strong>不是由数据本身所启发或建议</strong>时，它们才是合适的。(数据窥探/p-hacking问题)</li>
<li><strong>气泡备注</strong>: 回想一下课堂上的两个模拟研究 (可能指第一类错误率的膨胀和数据驱动的假设)。</li>
</ul>
<p><strong>幻灯片 3: 关于二项分布、正态分布、泊松分布的故事</strong></p>
<ul>
<li>棣莫弗关于赌博问题的研究引出了第一个钟形曲线（正态分布的早期形式，作为二项分布的近似）。</li>
<li>伽利略到高斯关于天文观测中误差的研究（误差理论，正态分布）。</li>
<li><strong>二项分布 (Binomial)</strong>: P(Y=y)=(yn)py(1−p)n−y, y∈0,1,...,n (离散)。</li>
<li><strong>正态分布 (Normal)</strong>: fY(y)=2πσ21exp(−2σ2(y−μ)2), y∈(−∞,∞) (连续)。</li>
<li><strong>中心极限定理 (Central Limit Theorem)</strong>: 若 Yi 是来自<strong>任何分布</strong>的独立同分布随机变量，均值为 μ，方差为 σ2，则当 n→∞ 时，它们的和（或均值）∑i=1nYi 近似服从正态分布。</li>
<li><strong>泊松分布 (Poisson)</strong>: y∈0,1,2,3,.... 泊松的二项分布极限定理得到了泊松分布：若 pn 是一系列在 (0, 1] 之间的实数，使得序列 npn 收敛到一个有限的极限 μ，则 limn→∞(yn)pny(1−pn)n−y=y!μyexp(−μ)。</li>
</ul>
<p><strong>幻灯片 4: 如果n或均值很小怎么办？</strong></p>
<ul>
<li>(图1：Normal Vs Poisson (mu=0.5)) 当泊松分布的均值 μ 很小时（如0.5），其分布是高度右偏的，与对称的正态分布差异显著。</li>
<li>(图2：Normal Vs Binomial (n=6, p=0.75)) 当二项分布的试验次数 n 较小，或成功概率 p 接近0或1时，其分布也会偏斜，与正态近似差异较大。</li>
</ul>
<p><strong>幻灯片 5: 在回归模型中的价值 (普通LM处理非正态数据的局限性)</strong></p>
<ul>
<li><strong>左图 (Poisson data)</strong>: 真实数据是泊松分布（随x指数增长的均值）。如果用普通线性模型（如多项式回归，图中红线）去拟合，可能在数据范围内看似可以，但模型形式不正确。蓝线（泊松回归）能更好地捕捉指数趋势。</li>
<li><strong>右图 (Beyond Observed Poisson data)</strong>: 展示了外推的危险。普通线性模型（红线）在外推时可能产生非常不合理（甚至为负）的预测，而基于正确分布假设的泊松回归（蓝线）外推更为稳健。</li>
</ul>
<p><strong>幻灯片 6: 解释不同类型的回归模型 (总结)</strong></p>
<ul>
<li>
<p><strong>线性回归模型 (Linear regression model)</strong>:</p>
<ul>
<li>Yi∼Normal(μi,σ2), μi=β0+β1xi.</li>
<li>解释: x 每增加一个单位，Y 的<strong>均值</strong>增加 β1 个单位。</li>
</ul>
</li>
<li>
<p><strong>对数线性模型 (Log-linear model, Y取对数)</strong>:</p>
<ul>
<li>log(Yi)∼Normal(μi,σ2), μi=β0+β1xi (这里 μi=E[log(Yi)]).</li>
<li>解释: x 每增加一个单位，Y 的<strong>中位数</strong>乘以 exp(β1) (即增加 100×[exp(β1)−1] )。</li>
</ul>
</li>
<li>
<p><strong>幂律模型 (Power Law model, Y和X均取对数)</strong>:</p>
<ul>
<li>
<p>log(Yi)∼Normal(μi,σ2), μi=β0+β1log(xi).$Y_i=\beta_0x_i^{\beta_1}$</p>
</li>
<li>
<p>解释: x 每增加1%，Y 的<strong>中位数</strong>大约增加 β1。</p>
</li>
<li>
<blockquote>
<p><strong>幂律模型 (<strong>log(Y)∼log(X)</strong>)</strong>: 在这个模型中，解释变量 X 也进行了<strong>对数转换</strong>。因此，系数 β1 反映的是当 log(X) 发生一个单位变化时，log(Y) 的期望值会发生 β1 的变化。 然而，在实际解释中，我们通常更关心原始变量 X 的<strong>相对变化（即百分比变化）*<em>所带来的影响。例如，我们想知道当*</em></strong> X <em><strong>*增加1%时，*<em><strong>Y <em><strong>*的中位数会如何变化。 如果*</strong></em> X <em><strong>*增加1%，那么新的*</strong></em> X新=X×(1+0.01)=1.01X</strong></em>*。 此时，*<em><strong>log(X新)−log(X旧)=log(1.01X)−log(X)=log(1.01)</strong></em>*。 根据模型，*<em><strong>log(Y) <em><strong>*的变化量是*</strong></em> Δlog(Y)=β1×Δlog(X)=β1×log(1.01)</strong></em>*。 所以，*<em><strong>log(Y中位数,旧Y中位数,新)=β1log(1.01)=log((1.01)β1)</strong></em>*。 两边取指数得到*</strong></em> Y中位数,旧Y中位数,新=(1.01)β1****。 对于小的百分比变化**** r****（例如**** r=0.01 <em><strong>*代表1%），根据泰勒展开近似，*</strong></em>(1+r)β1≈1+β1r****。 因此，*<em><strong><mark>(1.01)β1≈1+β1×0.01</mark></strong></em>*。****</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p><strong>泊松回归模型 (Poisson regression model)</strong>:</p>
<ul>
<li>Yi∼Poisson(μi), log(μi)=β0+β1xi.</li>
<li>解释: x 每增加一个单位，Y 的<strong>均值</strong>乘以 exp(β1) (即增加 100×[exp(β1)−1] )。</li>
</ul>
</li>
<li>
<p><strong>Logistic回归模型 (Logistic regression model)</strong>:</p>
<ul>
<li>Yi∼Binomial(ni,pi), logit(pi)=β0+β1xi.</li>
<li>解释: (见幻灯片8)</li>
</ul>
</li>
<li>
<p><strong>广义线性模型 (GLM) 通式</strong>:</p>
<ul>
<li>Yi∼某种指数族分布(θi), g(θi)=β0+β1xi (g(⋅) 是连接函数)。</li>
</ul>
</li>
</ul>
<p><img src="/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E6%96%B9%E6%B3%95%EF%BC%88%E5%A4%96%E6%95%99%E7%89%88%EF%BC%89/image-20250602202143367.png" alt="image-20250602202143367"></p>
<p><strong>幻灯片 7: Logit - 几率的对数 (Odds 和 Log-Odds)</strong></p>
<ul>
<li><strong>几率 (Odds)</strong>: o=O(Y=1)=P(Y=0)P(Y=1)=1−pp。</li>
<li><strong>概率与几率转换</strong>: p=o+1o。</li>
<li><strong>对数几率 (Logit)</strong>: η=Logit(p)=log(o)=log(1−pp)。</li>
<li><strong>Logit的反函数 (Logistic函数)</strong>: p=1+exp(η)exp(η)。</li>
<li>概率 p∈[0,1] 对应几率 o∈[0,∞)，对应对数几率 η∈(−∞,∞)。</li>
</ul>
<p><strong>幻灯片 8: 解释包含数值和分类变量的GLM</strong></p>
<ul>
<li>模型形式 (以包含一个数值变量 xi 和一个二元分类变量 zi 为例，可能还有交互作用): g(θi)=β0+β1xi+β2zi(+β3xizi for interaction)</li>
<li><strong>泊松回归解释</strong>:
<ul>
<li>当 z 固定时，x 每增加一个单位，Y 的<strong>均值</strong>增加 100×[exp(β1)−1]。</li>
<li>当 x 固定时，若 z=1 (相比于 z=0)，Y 的<strong>均值</strong>高出 100×[exp(β2)−1]。</li>
<li><strong>交互作用</strong>: 当 z=1 时，x 每增加一个单位，Y 的<strong>均值</strong>增加 100×[exp(β1+β3)−1]。交互作用本身解释复杂，常需结合图形。</li>
</ul>
</li>
<li><strong>Logistic回归解释</strong>:
<ul>
<li>当 z 固定时，x 每增加一个单位，Y=1 的<strong>几率 (Odds)</strong> 增加 100×[exp(β1)−1]。</li>
<li>当 x 固定时，若 z=1 (相比于 z=0)，Y=1 的<strong>几率</strong>高出 100×[exp(β2)−1]。</li>
<li><strong>交互作用</strong>: 当 z=1 时，x 每增加一个单位，Y=1 的<strong>几率</strong>增加 100×[exp(β1+β3)−1]。</li>
</ul>
</li>
<li><strong>注意</strong>: 当分类变量有三个或更多类别时，应使用ANOVA/卡方检验（针对GLM是偏差分析中的似然比检验或Wald检验的推广）来评估其总体显著性，而不是单个指示变量的z检验（或t检验）。</li>
</ul>
<h4 id="知识点梳理-fourth-week-pdf">知识点梳理 (fourth_week.pdf)</h4>
<p>这份第四周的课件是广义线性模型 (GLM) 的一个重要总结和扩展，它回顾了线性模型的局限性，引入了GLM处理非正态响应（特别是计数和比例数据）的必要性，并系统地对比了不同模型（包括普通线性模型及其对数转换形式、泊松回归、Logistic回归）的解释框架。</p>
<ol>
<li><strong>传统线性模型 (LM) 的回顾与局限</strong>:
<ul>
<li>再次强调LM的核心假设（误差正态、独立、同方差，关系线性）。</li>
<li>指出传统假设检验和置信区间的局限性，特别是<strong>多重比较问题</strong>（一系列检验会使第一类错误率膨胀）和<strong>数据窥探</strong>（由数据启发的检验可能导致假阳性）。</li>
</ul>
</li>
<li><strong>常见离散分布及其与正态分布的关系</strong>:
<ul>
<li>回顾了<strong>二项分布</strong>和<strong>泊松分布</strong>的概率质量函数和适用场景。</li>
<li>通过<strong>中心极限定理</strong>和<strong>泊松的二项极限定理</strong>建立了它们与正态分布的联系。</li>
<li>通过图形清晰展示了当参数（二项分布的n，泊松分布的$\mu$）较小时，这些离散分布与正态近似的差异，强调了在这些情况下直接使用基于正态假设的LM是不合适的。</li>
<li>对应教材 <code>STATS201 book SWU 2023.pdf</code> 第13章 (第20-27页) 和第15章 (第4-6页)。</li>
</ul>
</li>
<li><strong>广义线性模型 (GLM) 的引入与优势</strong>:
<ul>
<li><strong>动机</strong>: 当响应变量是计数（Poisson）或比例/二元（Binomial）时，LM的假设不满足。直接对这类数据使用LM或简单地对其进行对数转换都有其局限性（如log(0)问题，预测值超出范围，方差结构不匹配）。</li>
<li><strong>GLM结构</strong>:
<ol>
<li><strong>随机部分</strong>: 响应变量 Yi 服从某个指数族分布（如Poisson, Binomial）。</li>
<li><strong>系统部分</strong>: 解释变量的线性组合 ηi=β0+β1xi1+…。</li>
<li><strong>连接函数 (Link Function)</strong> g(⋅): 连接响应变量的期望值 E[Yi]=μi 与线性预测子 ηi，即 g(μi)=ηi。</li>
</ol>
</li>
<li>对应教材 <code>STATS201 book SWU 2023.pdf</code> 第13章 (第29-31页) 对GLM的介绍。</li>
</ul>
</li>
<li><strong>特定GLM模型及其解释</strong>:
<ul>
<li><strong>泊松回归 (Poisson Regression)</strong>:
<ul>
<li>用于计数数据。</li>
<li>连接函数: 对数连接，log(μi)=ηi。</li>
<li>解释: 解释变量每改变一个单位，响应变量的<strong>均值</strong> μi 乘以 exp(βj)。</li>
<li>对应教材第13章。</li>
</ul>
</li>
<li><strong>Logistic回归 (Logistic Regression)</strong>:
<ul>
<li>用于二元数据 (0/1) 或比例数据。</li>
<li>连接函数: Logit连接，logit(pi)=log(1−pipi)=ηi。</li>
<li>解释: 解释变量每改变一个单位，事件发生的<strong>几率 (Odds)</strong> pi/(1−pi) 乘以 exp(βj)。</li>
<li>对应教材第15章。</li>
</ul>
</li>
<li>课件系统对比了普通LM、对数转换LM、泊松回归和Logistic回归在解释系数时的不同侧重点（均值 vs 中位数 vs 几率）和形式（加性 vs 乘性）。</li>
</ul>
</li>
<li><strong>包含分类变量和交互作用的GLM解释</strong>:
<ul>
<li>当GLM中包含数值和分类解释变量（及其交互作用）时，解释方法与LM中的类似，但需要将效应最终转换回响应变量的原始尺度（均值或几率）的乘性变化或百分比变化。</li>
<li>强调了交互作用使得解释变得复杂，通常需要结合具体水平进行描述或可视化。</li>
<li>提醒对于多水平分类变量，需要进行整体显著性检验（如偏差分析中的卡方检验或F检验）。</li>
</ul>
</li>
</ol>
<p><strong>与R代码和教材的联系</strong>:</p>
<ul>
<li><code>lecture_10.R</code> 和 <code>lecture_11.R</code> 中的代码实例（CRAN数据、地震数据、鲷鱼数据、篮球数据、挑战者号数据、黑线鳕数据）完美地演示了本周课件中介绍的Poisson回归和Logistic回归的应用，包括模型拟合 (<code>glm()</code>)、参数解释、过离散处理 (<code>family=quasipoisson</code> 或 <code>quasibinomial</code>)、预测 (<code>predictGLM()</code>) 以及与传统LM的对比。</li>
<li>教材 <code>STATS201 book SWU 2023.pdf</code> 的第13章（泊松模型）、第14章（泊松模型实例）、第15章（二项模型）和第16章（列联表分析）是本周课件内容的详细理论基础和应用案例。</li>
</ul>
<p>这份课件是整个课程从传统线性模型过渡到更广泛的广义线性模型的关键，它不仅介绍了GLM的理论框架，更重要的是教会学生如何根据数据类型选择合适的模型并正确解释模型结果。</p>
<blockquote>
<p>在对数线性模型 (log(Y)=β0+β1X) 和幂律模型（或称对数-对数模型，log(Y)=β0+β1log(X)) 中，虽然响应变量 Y 都进行了对数转换，使得我们关注的是 Y 的中位数的相对变化（乘性或百分比），但由于解释变量 X 的处理方式不同，导致了系数 β1 解释上的核心差异。</p>
<p><strong>辨析原因</strong>：</p>
<p>关键在于解释变量 X 在模型中是<strong>原始尺度</strong>还是<strong>对数尺度</strong>。</p>
<ol>
<li><strong>对数线性模型 (<strong>log(Y)∼X</strong>)</strong>:
<ul>
<li>模型中 X 是其原始单位。因此，我们考察的是当 X 发生一个<strong>绝对单位</strong>的变化时（例如，年龄增加1岁，温度升高1摄氏度），log(Y) 会发生 β1 的变化。</li>
<li>由于 log(Y新中位数)−log(Y旧中位数)=β1，这意味着 log(Y新中位数/Y旧中位数)=β1，所以 Y新中位数/Y旧中位数=exp(β1)。</li>
<li>因此，Y 的中位数会变为原来的 exp(β1) 倍，或者说变化了 (exp(β1)−1)×100。这里解释的是 X <strong>每单位绝对变化</strong>对 Y 中位数的<strong>乘性或百分比影响</strong>。</li>
</ul>
</li>
<li><strong>幂律模型 (<strong>log(Y)∼log(X)</strong>)</strong>:
<ul>
<li>模型中 X 也被取了对数。因此，我们考察的是当 log(X) 发生一个单位变化时，log(Y) 会发生 β1 的变化。log(X) 变化一个单位，近似对应于 X 本身发生一个较大的乘性变化（乘以 e≈2.718 倍）。</li>
<li>然而，在解释幂律模型时，我们更常关注 X 发生一个小的<strong>相对百分比变化</strong>（例如1%）时的影响。如果 X 增加1%，即 X 变为 1.01X，那么 log(X) 的变化量是 log(1.01X)−log(X)=log(1.01)。</li>
<li>根据模型，log(Y) 的变化量是 β1×Δ(log(X))=β1×log(1.01)。</li>
<li>所以，Y新中位数/Y旧中位数=exp(β1×log(1.01))=(1.01)β1。</li>
<li>对于小的百分比变化（如1%，即0.01），根据泰勒展开近似，(1+r)β1≈1+β1r。所以 (1.01)β1≈1+β1×0.01。</li>
<li>这意味着 Y 的中位数大约变化了 (β1×0.01)×100。这里解释的是 X <strong>每1%的相对变化</strong>对 Y 中位数的<strong>百分比影响</strong>，这个 β1 就是所谓的弹性系数。</li>
</ul>
</li>
</ol>
<p><strong>总结来说</strong>：</p>
<ul>
<li>在对数线性模型中，由于 X 未取对数，我们解释的是 X <strong>绝对变化一个单位</strong>的影响。</li>
<li>在幂律模型中，由于 X 也取了对数，我们通常解释的是 X <strong>相对变化一个百分点</strong>的影响。</li>
</ul>
<p><strong>举例说明</strong>：</p>
<p>假设我们研究广告投入 (Advertising, 单位：万元) 对产品销量 (Sales, 单位：万件) 的影响。</p>
<ol>
<li><strong>如果我们拟合了对数线性模型</strong>: log(Sales)=2.5+0.05×Advertising
<ul>
<li>这里的 β^1=0.05。</li>
<li><strong>解释</strong>: 广告投入每增加1万元，产品销量的中位数预计会乘以 exp(0.05)≈1.0513 倍，即大约增加 (1.0513−1)×100。</li>
</ul>
</li>
<li><strong>如果我们拟合了幂律模型 (对数-对数模型)</strong>: log(Sales)=1.8+0.6×log(Advertising)
<ul>
<li>这里的 β^1=0.6。</li>
<li><strong>解释</strong>: 广告投入每增加1%，产品销量的中位数预计大约会增加 0.6。这意味着销量的广告弹性是0.6。</li>
</ul>
</li>
</ol>
<p>在这个例子中，两种模型中的系数 0.05 和 0.6 的含义是完全不同的，因为它们对应的是解释变量不同类型的变化（绝对单位变化 vs. 百分比变化）。选择哪种模型取决于我们对变量间关系的理论假设以及数据的实际表现。</p>
</blockquote>
<h2 id="题目总结">题目总结</h2>
<h3 id="first-week">first week</h3>
<p><img src="/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E6%96%B9%E6%B3%95%EF%BC%88%E5%A4%96%E6%95%99%E7%89%88%EF%BC%89/image-20250602194345924.png" alt="image-20250602194345924"></p>
<p><strong>判断题 (幻灯片 7)</strong></p>
<ol>
<li><strong>题目</strong>: 在假设检验中，如果我们拒绝原假设，那么备择假设必定为真。
<ul>
<li><strong>判断</strong>: 错误。</li>
<li><strong>解析</strong>: 统计推断是基于概率的。拒绝原假设意味着我们有足够的证据表明原假设不太可能为真，因此我们选择相信备择假设。然而，这并不排除我们犯了<strong>第一类错误</strong>（Type I error），即错误地拒绝了一个真实的原假设。我们永远不能100%确定备择假设为真，只能说数据更支持备择假设。</li>
</ul>
</li>
<li><strong>题目</strong>: 在假设检验中，通常所说的p值是原假设为真的概率。
<ul>
<li><strong>判断</strong>: 错误。</li>
<li><strong>解析</strong>: 这是一个非常常见的对p值的误解。p值是在假定原假设（H0）为真的条件下，观察到当前样本统计量或更极端统计量的概率。它衡量的是样本数据与原假设之间的一致性程度，而不是原假设本身为真的概率。</li>
</ul>
</li>
<li><strong>题目</strong>: 在假设检验中，通常所说的p值是“如果原假设为真，在重复试验中观察到与我们所见数据一样极端或更极端的数据的概率”。
<ul>
<li><strong>判断</strong>: 正确。</li>
<li><strong>解析</strong>: 这正是p值的准确定义。它描述的是在原假设成立的世界里，我们当前观察到的数据（或比它更不利于原假设的数据）出现的可能性有多大。如果这个可能性很小（即p值很小），我们就倾向于怀疑原假设的真实性。</li>
</ul>
</li>
</ol>
<p><strong>多项选择题 (幻灯片 8)</strong></p>
<p><strong>题目</strong>: 一个简单线性模型的潜在假设是： A. Yi∼Normal(0,σ2) B. Yi=β0+β1xi+ϵi 其中 ϵi∼Normal(0,σ2) C. Yi=β0+β1xi+ϵi 其中 ϵi∼iidNormal(0,σ2) D. Yi=β0+β1xi+ϵi 其中 ϵi∼iidNormal(0,σi2)</p>
<ul>
<li><strong>正确选项</strong>: C</li>
<li><strong>解析</strong>:
<ul>
<li><strong>A 选项</strong>: 错误。该选项描述的是响应变量 Yi 本身服从均值为0的正态分布，这通常不符合实际情况，并且没有体现解释变量 xi 的作用。在线性回归中，我们假设的是误差项 ϵi 服从正态分布。</li>
<li><strong>B 选项</strong>: 错误。虽然正确描述了模型结构和误差项 ϵi 服从均值为0、方差为 σ2 的正态分布，但它遗漏了误差项之间<strong>独立同分布 (iid - independently and identically distributed)</strong> 的重要假设。</li>
<li><strong>C 选项</strong>: <strong>正确</strong>。这个选项完整且准确地表述了简单线性回归模型的核心假设：响应变量 Yi 是解释变量 xi 的线性函数加上一个误差项 ϵi，并且这些误差项是独立同分布的，服从均值为0、方差恒为 σ2 的正态分布。</li>
<li><strong>D 选项</strong>: 错误。σi2 表示误差项的方差随观测值 i 的不同而变化，这描述的是<strong>异方差性 (heteroscedasticity)</strong>。简单线性回归的标准假设是<strong>同方差性 (homoscedasticity)</strong>。</li>
</ul>
</li>
</ul>
<p><strong>简答题 (R输出解读练习) (幻灯片 9)</strong></p>
<p><strong>背景</strong>: 给定以下R输出的摘要信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Call:</span><br><span class="line">lm(formula = y ~ x)</span><br><span class="line"></span><br><span class="line">Residuals:</span><br><span class="line">    Min      1Q  Median      3Q     Max</span><br><span class="line">-0.44158 -0.12497 -0.01459  0.11600  0.60595</span><br><span class="line"></span><br><span class="line">Coefficients:</span><br><span class="line">            Estimate Std. Error t value Pr(&gt;|t|)</span><br><span class="line">(Intercept) 99.99212    0.01343  7445.8   &lt;2e-16 ***</span><br><span class="line">x            0.06885    0.01308     5.263  3.68e-07 ***</span><br><span class="line">---</span><br><span class="line">Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span><br><span class="line"></span><br><span class="line">Residual standard error: 0.1895 on 198 degrees of freedom</span><br><span class="line">Multiple R-squared:  0.1227,    Adjusted R-squared:  0.1183</span><br><span class="line">F-statistic: 27.7 on 1 and 198 DF,  p-value: 3.675e-07</span><br></pre></td></tr></table></figure>
<ol>
<li><strong>题目</strong>: 当 x=0.5 时，给出 y 的预测值。
<ul>
<li><strong>解析</strong>:
<ul>
<li>预测值 y^=β^0+β^1x。</li>
<li>从输出中可知，β^0=99.99212 (截距的Estimate)，β^1=0.06885 (x的Estimate)。</li>
<li>所以，当 x=0.5 时，y^=99.99212+0.06885×0.5=99.99212+0.034425=100.026545。</li>
<li>(课件中手写备注的计算 99.9212×0.06885×0.5=3.44 是错误的，它似乎将截距、斜率和x值相乘了，这不符合线性回归的预测方式。)</li>
</ul>
</li>
</ul>
</li>
<li><strong>题目</strong>: 判断 x 和 y 之间的线性关系是否统计显著。请说明理由。
<ul>
<li><strong>解析</strong>:
<ul>
<li>x 和 y 之间的线性关系是<strong>统计显著的</strong>。</li>
<li>理由：我们关注解释变量 x 的系数（即斜率 β1）是否显著不为零。原假设是 H0:β1=0。从R输出的 <code>Coefficients</code> 部分可以看到，变量 <code>x</code> 对应的p值 (<code>Pr(&gt;|t|)</code>) 是 3.68×10−7 (即 <code>3.68e-07</code>)。这个p值远小于常见的显著性水平（如 α=0.05, 0.01 或 0.001）。因此，我们有非常强的统计证据拒绝原假设，结论是 x 的系数（斜率）显著不为零，表明 x 和 y 之间存在统计上显著的线性关系。</li>
</ul>
</li>
</ul>
</li>
<li><strong>题目</strong>: 判断 x 和 y 之间的线性关系是否实际显著。请说明理由。
<ul>
<li><strong>解析</strong>:
<ul>
<li>判断实际显著性需要结合具体情境和领域知识，仅从统计输出无法直接给出明确的“是”或“否”的答案。</li>
<li>理由：
<ul>
<li><strong>统计显著性</strong>: 如上所述，关系是统计显著的。</li>
<li><strong>效应大小 (Effect Size)</strong>: 斜率的估计值 β^1=0.06885。这意味着 x 每增加一个单位，y 的均值预计增加约0.069个单位。这个效应的大小是否具有实际意义，取决于 x 和 y 的单位以及它们所代表的实际量。例如，如果 y 是以百万美元计的利润，x 是广告投入（单位：万美元），那么 x 每增加一万美元，利润均值增加0.069百万美元（即6.9万美元），这可能被认为是实际显著的。但如果 y 是学生成绩（百分制），x 是学习时间（小时），那么学习时间每增加一小时，成绩均值增加0.069分，这个效应可能就太小了，不具有实际显著性。</li>
<li><strong>模型解释力 (Explanatory Power)</strong>: R2=0.1227 (Multiple R-squared)，这意味着模型中的 x 解释了 y 总变异的约12.27%。这个解释比例相对较低，表明模型中还有大量未被 x 解释的 y 的变异。在某些领域，12%的解释力可能被认为有一定价值，但在其他领域可能被认为不足。</li>
<li><strong>结论</strong>: 要判断实际显著性，需要将这些统计结果（效应大小、模型解释力）放回具体的应用背景中进行评估。课件中的气泡备注也强调了这一点：“它是否足够大取决于上下文...是否足够大是主观的，并取决于单位。所以这里的重点是展示你理解这一点，而不是给出一个具体的数字或‘是/否’的答案。”</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><strong>题目</strong>: 计算斜率的95%置信区间。
<ul>
<li><strong>解析</strong>:
<ul>
<li>斜率 β1 的95%置信区间可以使用公式：β^1±tα/2,n−p×SE(β^1)。</li>
<li>从R输出中：β^1=0.06885，SE(β^1)=0.01308。</li>
<li>自由度 df=n−p=198 (其中 n 是样本量，p 是参数个数，这里 p=2，包括截距和斜率)。</li>
<li>t0.025,198 的临界值。课件中使用了近似值1.97。我们可以用R精确计算：<code>qt(0.975, df=198)</code> 结果约为 1.9719。</li>
<li>使用课件的1.97：
<ul>
<li>下限: 0.06885−1.97×0.01308=0.06885−0.0257676=0.0430824≈0.0431</li>
<li>上限: 0.06885+1.97×0.01308=0.06885+0.0257676=0.0946176≈0.0946</li>
</ul>
</li>
<li>所以，斜率的95%置信区间约为 (0.0431, 0.0946)。由于该区间不包含0，这也进一步证实了斜率是统计显著的。</li>
</ul>
</li>
</ul>
</li>
</ol>
<p><strong>判断题 (幻灯片 12)</strong></p>
<ol>
<li><strong>题目</strong>: 在线性回归模型中，斜率的置信区间总是比截距的置信区间宽。
<ul>
<li><strong>判断</strong>: 错误。</li>
<li><strong>解析</strong>: 正如课件提示和之前的解析所述，置信区间的宽度取决于标准误。截距的标准误受 xˉ2 和样本量的影响，而斜率的标准误受 x 的散布程度 ∑(xi−xˉ)2 的影响。两者没有固定的宽度比较关系。例如，如果数据经过中心化处理使得 xˉ=0，截距的标准误会减小，其置信区间可能会比斜率的窄。</li>
</ul>
</li>
<li><strong>题目</strong>: 在一个简单线性回归模型中，均值的置信区间总是比使用零模型计算的置信区间宽。
<ul>
<li><strong>判断</strong>: 错误。</li>
<li><strong>解析</strong>: 此处“均值的置信区间”若指对特定 x0 处条件均值 E[Y∣x0] 的置信区间，其宽度与 x0 离 xˉ 的距离有关。当 x0=xˉ 时，该置信区间的宽度可能比零模型（仅估计总体均值 μY）的置信区间窄，特别是如果SLR的残差标准误 σ^ 小于零模型的残差标准误（通常如此）。如果 x0 远离 xˉ，则SLR的均值置信区间可能更宽。因此，该表述不总是成立。</li>
</ul>
</li>
<li><strong>题目</strong>: 对于两个不同置信水平的置信区间，较高置信水平的那个更宽。
<ul>
<li><strong>判断</strong>: 正确。</li>
<li><strong>解析</strong>: 为了以更高的置信度（如99% vs 95%）包含真实参数，置信区间需要覆盖更广的可能值范围，因此区间会更宽。这是因为较高置信水平对应于t分布或正态分布中更大的临界值。</li>
</ul>
</li>
</ol>
<p><strong>多项选择题 (幻灯片 14)</strong></p>
<p><strong>题目</strong>: 假设 (1.93, 2.43) 是简单线性回归斜率 β1 的95%置信区间。以下哪个陈述是正确的？ A. 我们有95%的把握确信 β1 在1.93和2.43之间。 B. β1 在1.93和2.43之间的概率是95%。 C. β1 在1.93和2.43之间的概率是0.95。 D. 以上所有。 E. 以上皆非。</p>
<ul>
<li><strong>正确选项</strong>: A</li>
<li><strong>解析</strong>:
<ul>
<li><strong>A 选项</strong>: <strong>正确</strong>。这是对置信区间的标准频率学派解释。它表达了我们对这个具体计算出的区间能够包含真实、固定但未知的参数 β1 的信心程度。</li>
<li><strong>B 和 C 选项</strong>: 错误。在频率学派统计中，真实参数 β1 是一个固定的值，它没有概率分布。概率0.95是与构造区间的方法的长期可靠性相关的，而不是与这个特定的、已经计算出来的区间相关的。</li>
</ul>
</li>
</ul>
<h3 id="来自-2024-test-sol-pdf-2024年春季测试题解析">来自 <code>2024_test_sol.pdf</code> (2024年春季测试题解析)</h3>
<p><strong>A部分：判断题 (Question 1)</strong></p>
<p><strong>(a) 题目 (3分)</strong>: 在线性回归中，μi 的置信区间可能不包含 yi，但是 Yi=β0+β1xi+ϵi 的预测区间必须包含 yi，前提是 μi=E[Yi] 且 (xi,yi) 是用于构建线性模型的观测数据点。</p>
<ul>
<li><strong>判断</strong>: 错误 (✓ FALSE)</li>
<li><strong>解析</strong>:
<ul>
<li>μi=E[Yi∣xi] 是给定 xi 时 Y 的条件均值。其置信区间是针对这个<strong>均值</strong>的，而不是针对单个观测值 yi 的。因此，单个观测值 yi 完全可能落在其对应均值的置信区间之外，因为 yi=μi+ϵi，包含了随机误差 ϵi。</li>
<li>预测区间是针对一个新的、未观测到的 Y 值的。即使 (xi,yi) 是用于建模的观测数据点，我们为这个 xi 构造的预测区间是针对“如果再来一个具有相同 xi 的新观测 Ynew”的区间。这个区间同样因为包含未来观测的随机性，不保证必须包含原始的 yi。任何一个具体的 yi 都可能因为其特定的误差项 ϵi 而落在为其对应 xi 构建的预测区间之外。预测区间描述的是新观测值可能落入的范围，具有一定的概率（如95%），而不是对已观测数据点的必然包含。</li>
</ul>
</li>
</ul>
<p><strong>(b) 题目 (3分)</strong>: 以下R输出与给定的R命令一致。 ```R &gt; predict(LM.fit, new.pred.df, interval = &quot;predict&quot;) fit      lwr      upr 1 15.19726 12.87092 17.52360</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; predict(LM.fit, new.pred.df, interval = &quot;confidence&quot;)</span><br><span class="line">fit      lwr      upr</span><br><span class="line">1 15.19726  9.67879 20.71573</span><br><span class="line">```</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>判断</strong>: 错误 (✓ FALSE)</li>
<li><strong>解析</strong>:
<ul>
<li>对于相同的拟合值 (fit = 15.19726)，<strong>预测区间 (prediction interval)</strong> 总是比<strong>置信区间 (confidence interval)</strong> 更宽。这是因为预测区间不仅要考虑对均值估计的不确定性，还要考虑单个观测值围绕其均值的随机波动。</li>
<li>在给出的输出中，第一个命令是获取预测区间，其区间为 (12.87092, 17.52360)，宽度为 17.52360−12.87092=4.65268。</li>
<li>第二个命令是获取置信区间，其区间为 (9.67879, 20.71573)，宽度为 20.71573−9.67879=11.03694。</li>
<li>这里，预测区间的宽度 (4.65268) 小于置信区间的宽度 (11.03694)，这与理论相悖。因此，该R输出与给定的R命令不一致。</li>
</ul>
</li>
</ul>
<p><strong>(c) 题目 (3分)</strong>: 在线性回归中，假设 β1 是斜率，β^1 是对应的最大似然估计 (MLE)，那么即使简单线性回归模型的等方差假设不满足，E[β^1]=β1 仍然成立，前提是所有其他常规假设都满足。</p>
<ul>
<li><strong>判断</strong>: 正确 (✓ TRUE)</li>
<li><strong>解析</strong>:
<ul>
<li>在线性回归模型中，最小二乘估计量 (OLS estimator) β^1（在高斯误差假设下也等同于最大似然估计量 MLE）的无偏性 (E[β^1]=β1) 依赖于以下核心假设：
<ol>
<li>模型线性于参数。</li>
<li>解释变量 X 是固定的（非随机的），或者与误差项 ϵ 无关 (E[Xϵ]=0)。</li>
<li>误差项的期望为零 (E[ϵi]=0)。</li>
</ol>
</li>
<li><strong>等方差假设 (homoscedasticity)</strong>，即 Var(ϵi)=σ2 对所有 i 都成立，主要影响的是 β^1 的方差表达式以及基于此方差的推断（如标准误、t检验、置信区间）的有效性和最优性（根据高斯-马尔可夫定理，OLS在同方差下是最佳线性无偏估计BLUE）。</li>
<li>如果仅仅是等方差假设不满足（即存在异方差），而其他假设（特别是 E[ϵi∣X]=0）仍然成立，那么 β^1 仍然是<strong>无偏的</strong> (E[β^1]=β1) 和一致的。只是它不再是BLUE，其标准误的常规计算公式也不再准确。</li>
</ul>
</li>
</ul>
<p><strong>B部分：多项选择题 (Question 2)</strong></p>
<p><strong>(a) 题目 (4分)</strong>: 考虑一个对数-线性回归模型 log(yi)=β0+β1xi+ϵi，其中 ϵi∼Normal(0,σ2)，并且 β^1=1。假设 x 的值增加一个单位，那么以下哪个陈述是正确的？ *</p>
<p>☐ Yi 的期望对数值不会改变。 (The log of expected Yi would not change.)</p>
<p>☐ Yi 的期望对数值会增加1个单位。 (The log of expected Yi would increase by 1 unit.) <mark>等价于log(EYi)但是要正确是得expect of log(Yi)即E(log(Yi))</mark></p>
<p>☐ Yi 的期望对数值会增加2.7个单位。 (The log of expected Yi would increase by 2.7 unit.)</p>
<p>☐ Yi 的期望值会增加2.7个单位。 (The expected Yi would increase by 2.7 unit.)</p>
<p>☐ Yi 的期望值会增加170%。 (The expected Yi would increase by 170%.)</p>
<p>✓ 以上皆非。 (None of the above.)</p>
<ul>
<li><strong>正确选项</strong>: ✓ 以上皆非。</li>
<li><strong>解析</strong>:
<ul>
<li>模型是 log(Yi)=β0+β1xi+ϵi。由于 ϵi∼Normal(0,σ2)，所以 log(Yi) 服从正态分布，其期望为 E[log(Yi)]=β0+β1xi。</li>
<li>当 xi 增加一个单位时，E[log(Yi)] 会增加 β1 个单位。题目中给出 β^1=1，所以 E[log(Yi)] 的估计值会增加1个单位。
<ul>
<li>选项“Yi 的期望对数值不会改变”是错误的。</li>
<li>选项“Yi 的期望对数值会增加1个单位”是正确的陈述，但需要注意这里说的是 E[log(Yi)] 而不是 log(E[Yi])。</li>
</ul>
</li>
<li>对于原始尺度的 Yi，由于对数正态分布的性质，E[Yi]=E[eβ0+β1xi+ϵi]=eβ0+β1xiE[eϵi]=eβ0+β1xieσ2/2。</li>
<li>当 xi 增加一个单位到 xi+1 时，新的期望值 E[Ynew]=eβ0+β1(xi+1)eσ2/2。</li>
<li>E[Ynew]/E[Yold]=eβ1。</li>
<li>如果 β^1=1，则 E[Yi] 的估计值会乘以 e1≈2.718。</li>
<li>这意味着 E[Yi] 的估计值会增加 (e1−1)×100。</li>
<li>选项“Yi 的期望值会增加2.7个单位”是错误的，因为是乘以约2.718，而不是增加2.7个单位（除非原期望为1）。</li>
<li>选项“Yi 的期望值会增加170%”接近正确答案171.8%，但题目通常要求精确。</li>
<li><strong>关键点</strong>: 题目问的是“Yi 的期望对数值” (E[log(Yi)]) 还是“对数期望 Yi” (log(E[Yi]))。对于对数线性模型，我们通常解释的是 Yi 的<strong>中位数</strong>的变化，即中位数乘以 eβ1。如果假设 log(Yi) 的中位数等于其均值（因为正态分布对称），那么 Yi 的中位数会乘以 eβ1。</li>
<li>如果将“Yi 的期望对数值”理解为 E[log(Yi)]，那么它会增加 β1=1 个单位。</li>
<li>如果题目严格要求对 E[Yi] 的影响，那么是增加约171.8%。</li>
<li>由于选项中没有一个完全精确匹配 E[log(Yi)] 增加1单位，或者 E[Yi] 增加171.8%，或者中位数乘以 e1，所以选择“以上皆非”是最稳妥的。如果选项中有“Yi 的中位数会乘以约2.718倍”或“Yi 的中位数会增加约171.8%”，那将是更好的答案。</li>
<li><strong>进一步辨析</strong>：在课程中，对于 log(Y)=β0+β1X+ϵ 模型，通常解释为 X 每增加一个单位，Y 的<strong>中位数</strong>乘以 eβ1。因为如果 log(Y) 服从正态分布，那么 Y 服从对数正态分布，其<strong>中位数</strong>是 eE[log(Y)]=eβ0+β1X。当 X 增加1时，中位数变为 eβ0+β1(X+1)=(eβ0+β1X)×eβ1。所以中位数乘以 e1≈2.718。这意味着中位数增加了约171.8%。</li>
<li><strong>结论</strong>：选项中没有一个准确描述中位数的变化，也没有准确描述均值的变化。因此“以上皆非”是最佳答案。<mark>至少出现median才好说这东西有可能正确</mark></li>
</ul>
</li>
</ul>
<p><strong>C部分：简答题 (Question 3)</strong></p>
<p><strong>背景</strong>: 一个简单线性回归模型在R中拟合，输出摘要如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&gt; summary(sim.fit) # 假设 sim.fit 是 lm(y ~ x) 的结果</span><br><span class="line">Call:</span><br><span class="line">lm(formula = y ~ x)</span><br><span class="line"></span><br><span class="line">Residuals:</span><br><span class="line">    Min      1Q  Median      3Q     Max</span><br><span class="line">-5.2822 -2.2645 -0.6545  1.7332  8.5444</span><br><span class="line"></span><br><span class="line">Coefficients:</span><br><span class="line">            Estimate Std. Error t value Pr(&gt;|t|)</span><br><span class="line">(Intercept)  8.72815    0.81354   10.73  2.15e-15 ***</span><br><span class="line">x            1.96983    0.07611   25.88   &lt;2e-16 ***</span><br><span class="line">---</span><br><span class="line">Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span><br><span class="line"></span><br><span class="line">Residual standard error: 3.07 on 58 degrees of freedom</span><br><span class="line">Multiple R-squared:  0.9203,    Adjusted R-squared:  0.9189</span><br><span class="line">F-statistic: 669.9 on 1 and 58 DF,  p-value: &lt; 2.2e-16</span><br></pre></td></tr></table></figure>
<p><strong>(a) 题目 (1分)</strong>: 数据框中有多少个数据点？</p>
<ul>
<li><strong>解析</strong>:
<ul>
<li>根据残差标准误 (Residual standard error) 那一行，自由度 (degrees of freedom) 是58。</li>
<li>对于简单线性回归模型 Y=β0+β1X+ϵ，有两个参数被估计 (β0 和 β1)。</li>
<li>残差自由度 dfresidual=n−p，其中 n 是数据点数量，p 是模型中参数的数量（包括截距）。</li>
<li>所以，58=n−2。</li>
<li>因此，n=58+2=60。</li>
<li><strong>答案</strong>: 数据框中有60个数据点。</li>
</ul>
</li>
</ul>
<p><strong>(b) 题目 (4分)</strong>: 计算原假设 H0:β1=2 的t统计量。</p>
<ul>
<li><strong>解析</strong>:
<ul>
<li>t统计量的计算公式为: T=SE(β^1)β^1−β1,0，其中 β1,0 是原假设中 β1 的值。</li>
<li>从R输出中可知：
<ul>
<li>斜率的估计值 β^1=1.96983 (x的Estimate)。</li>
<li>斜率的标准误 SE(β^1)=0.07611 (x的Std. Error)。</li>
<li>原假设中 β1,0=2。</li>
</ul>
</li>
<li>计算t统计量： T=0.076111.96983−2=0.07611−0.03017≈−0.3963999</li>
<li><strong>答案</strong>: t统计量约为 -0.396。</li>
</ul>
</li>
</ul>
<p><strong>(c) 题目 (4分)</strong>: 在5%的显著性水平下，是否有证据反对 H0:β1=2？请说明理由。</p>
<ul>
<li><strong>解析</strong>:
<ul>
<li><strong>判断</strong>: 没有足够的证据反对 H0:β1=2。</li>
<li><strong>理由1 (基于t统计量)</strong>:
<ul>
<li>我们计算得到的t统计量 T≈−0.396。</li>
<li>自由度为 df=58。</li>
<li>对于双边检验，在5%的显著性水平下，我们需要比较 ∣T∣ 与 t0.025,58 的临界值。</li>
<li><code>qt(0.975, 58)</code> 约等于 2.0017。</li>
<li>因为 ∣−0.396∣=0.396&lt;2.0017，所以t统计量的值没有落在拒绝域内。</li>
<li>因此，我们不拒绝原假设 H0:β1=2。</li>
</ul>
</li>
<li><strong>理由2 (基于置信区间，如题目解析中所示)</strong>:
<ul>
<li>首先计算 β1 的95%置信区间：β^1±t0.025,58×SE(β^1)。</li>
<li>1.96983±2.0017×0.07611=1.96983±0.15234</li>
<li>置信区间为 (1.96983−0.15234,1.96983+0.15234)=(1.81749,2.12217)。</li>
<li>(题目解析中使用了近似的1.96作为t临界值，得到区间 (1.820654, 2.119006))。</li>
<li>由于假设值 β1=2 包含在这个95%置信区间内（例如，2 在 (1.82, 2.12) 之间），我们没有足够的证据在5%的显著性水平下拒绝原假设 H0:β1=2。</li>
</ul>
</li>
<li><strong>答案</strong>: 没有足够的证据在5%的水平上反对 H0:β1=2，因为计算得到的t统计量绝对值远小于相应的t分布临界值，或者因为值2落在了斜率的95%置信区间内。</li>
</ul>
</li>
</ul>
<p><strong>Question 4 (8分) - 药物滥用治疗效果研究</strong></p>
<p><strong>背景</strong>: 一项随机试验研究了对药物使用者进行住宿治疗的效果。大量受试者被随机分配接受3个月或6个月的治疗。其中，364人复吸。对于复吸的个体，研究者有兴趣估计每种治疗结束后到复吸的典型天数，以及两种治疗在复吸时间上的差异。数据框 <code>drug.df</code> 包含以下变量：</p>
<ul>
<li><code>treat</code>: 治疗分配 (Short 或 Long，分别对应3个月和6个月的治疗)</li>
<li><code>time</code>: 治疗后到复吸的时间（天）</li>
</ul>
<p><strong>输出信息</strong>:</p>
<ul>
<li>
<p><code>drug.df$treat</code> 被转换为因子，水平为 &quot;Short&quot;, &quot;Long&quot;。</p>
</li>
<li>
<p>原始 <code>time</code> 和 <code>log(time)</code> 按 <code>treat</code> 分组的箱线图和描述性统计。</p>
<ul>
<li>原始 <code>time</code> 数据右偏明显。</li>
<li><code>log(time)</code> 数据看起来更对称，更接近正态。</li>
</ul>
</li>
<li>
<p>对 <code>log(time)</code> 拟合线性模型 <code>drug.loglm = lm(log(time) ~ treat, data=drug.df)</code> 的系数摘要：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">            Estimate Std. Error t value  Pr(&gt;|t|)</span><br><span class="line">(Intercept)   4.6823     0.06769   69.170 9.587e-211 ***</span><br><span class="line">treatLong     0.2936     0.09763    3.007  2.819e-03 **</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>反转换后的置信区间 <code>exp(confint(drug.loglm))</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">               2.5%   97.5%</span><br><span class="line">(Intercept)  94.559 123.404  (这是Short组复吸时间中位数的CI)</span><br><span class="line">treatLong     1.107   1.625  (这是Long组相对于Short组复吸时间中位数的比率的CI)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>(a) 题目 (1分)</strong>: 为什么在分析前对复吸时间进行对数转换是合理的？</p>
<ul>
<li><strong>解析</strong>:
<ul>
<li>从提供的箱线图和描述性统计可以看出，原始的复吸时间 (<code>time</code>) 数据是<strong>高度右偏的</strong> (例如，Short组均值162远大于中位数105)。对于右偏数据，中位数通常是比均值更好的典型值度量。</li>
<li>对数转换后 (<code>log(time)</code>) 的数据显示出更好的对称性，更接近正态分布的假设，这使得线性模型的假设（如误差正态性、方差齐性）更容易得到满足。</li>
<li><strong>答案</strong>: 因为原始的复吸时间数据表现出明显的右偏性，对数转换有助于使数据分布更对称，更接近线性模型所要求的正态性假设，并且在这种情况下，模型结果（反转换后）通常解释为中位数效应，这对于偏态数据更为稳健和有意义。</li>
</ul>
</li>
</ul>
<p><strong>(b) 题目 (4分)</strong>: 写两句话（如同写执行摘要一样），一句量化短期和长期治疗在复吸天数上的差异，另一句量化短期治疗的复吸天数。</p>
<ul>
<li><strong>解析</strong>:
<ul>
<li><strong>第一句 (差异)</strong>: <code>treatLong</code> 的系数估计是0.2936，其指数 e0.2936≈1.341。置信区间为 (1.107, 1.625)。这意味着长期治疗组的复吸时间中位数是短期治疗组中位数的1.107到1.625倍。换算成百分比增加是 (1.107−1)×100 到 (1.625−1)×100。
<ul>
<li><strong>答案句1</strong>: 我们估计，接受长期（6个月）治疗的个体，其复吸时间的中位数比较短（3个月）治疗的个体高出10.7%到62.5%。</li>
</ul>
</li>
<li><strong>第二句 (短期治疗)</strong>: 短期治疗是基准组 (<code>treat</code>=&quot;Short&quot;)，其复吸时间对数值的期望由截距估计。截距的估计值是4.6823。其反转换后的置信区间是 (94.559, 123.404)。
<ul>
<li><strong>答案句2</strong>: 对于接受短期治疗的个体，其复吸时间的中位数估计在95天到123天之间。</li>
</ul>
</li>
<li>(题目解析中给出的答案是：我们估计，长期（6个月）治疗的复吸时间中位数比短期（3个月）治疗高11%到63%。短期治疗的复吸时间中位数在95到123天之间。这与我们的计算基本一致。)</li>
</ul>
</li>
</ul>
<p><strong>(c) 题目 (3分)</strong>: 写出获取长期治疗后复吸时间置信区间的R命令。</p>
<ul>
<li>
<p><strong>解析</strong>:</p>
<ul>
<li>
<p>长期治疗 (<code>treat</code>=&quot;Long&quot;) 不是基准组。我们需要为 <code>treat=&quot;Long&quot;</code> 创建一个新的数据框，然后使用 <code>predict()</code> 函数在对数尺度上获得预测值和置信区间，最后进行指数反转换。</p>
</li>
<li>
<p><strong>答案</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">new.df &lt;- data.frame(treat = factor(&quot;Long&quot;, levels = c(&quot;Short&quot;, &quot;Long&quot;)))</span><br><span class="line"># 或者如果 treat 已经是因子且 &quot;Long&quot; 是其一个水平: new.df &lt;- data.frame(treat = &quot;Long&quot;)</span><br><span class="line">exp(predict(drug.loglm, newdata = new.df, interval = &quot;confidence&quot;))</span><br></pre></td></tr></table></figure>
<p>或者使用 <code>predictGLM</code> (如果这是一个线性模型且 <code>s20x</code> 包已加载，但题目中是 <code>lm</code>):</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 如果 drug.loglm 是 lm 对象，predictGLM 可能不直接适用，除非 s20x 对其有封装</span><br><span class="line"># 更标准的是手动计算或使用 predict.lm 的结果</span><br><span class="line"># 以下是基于 predict.lm 的标准做法</span><br><span class="line">pred_log_long &lt;- predict(drug.loglm, newdata = data.frame(treat = &quot;Long&quot;), interval = &quot;confidence&quot;)</span><br><span class="line">exp(pred_log_long)</span><br></pre></td></tr></table></figure>
<p>(题目解析中给出的R命令是正确的。)</p>
</li>
</ul>
</li>
</ul>
<h4 id="来自-test-sol-2-pdf-2025年春季测试题解析-即今年的测试">来自 <code>test_sol(2).pdf</code> (2025年春季测试题解析 - 即今年的测试)</h4>
<p><strong>A部分：判断题 (Question 1)</strong></p>
<p><strong>(a) 题目 (3分)</strong>: 在一个简单线性回归模型中，如果所有模型假设都满足且决定系数 R2 为0.9，那么响应变量Y和解释变量X必须有很强的线性关联。</p>
<ul>
<li><strong>判断</strong>: 正确 (✓ TRUE)</li>
<li><strong>解析</strong>:
<ul>
<li>决定系数 R2 衡量的是解释变量 X 能够解释响应变量 Y 总变异的百分比。R2=0.9 意味着 X 解释了 Y 变异的90%。</li>
<li>在简单线性回归中，R2=(corr(X,Y))2，所以如果 R2=0.9，则相关系数 r=0.9≈±0.9487。</li>
<li>相关系数的绝对值接近1（如0.9487）表明 X 和 Y 之间存在非常强的线性关联。</li>
<li>前提是“所有模型假设都满足”，这确保了 R2 和相关系数的解释是有效的。</li>
</ul>
</li>
</ul>
<p><strong>(b) 题目 (3分)</strong>: 在线性回归中，summary输出中斜率的t检验的p值是斜率为零的概率。<mark>p-value是观测到极端数据的概率，概率越小说明越有可能成立，但是不能把p-value和某某某成立的概率绑定在一起</mark></p>
<ul>
<li><strong>判断</strong>: 错误 (✓ FALSE)</li>
<li><strong>解析</strong>:
<ul>
<li>这是一个对p值的常见误解。p值是在**原假设为真（即斜率为零）**的前提下，观察到当前样本数据（或更极端数据）的概率。</li>
<li>它不是“斜率为零的概率”。在频率学派统计中，总体参数（如真实的总体斜率）被认为是固定的未知常数，它没有概率分布，因此不能说它等于某个特定值的概率是多少。</li>
</ul>
</li>
</ul>
<p><strong>(c) 题目 (3分)</strong>: 在线性回归中，μi 的置信区间可能比 Yi=β0+β1xi+ϵi 的预测区间更宽，前提是所有常规假设都满足且 (xi,yi) 是用于构建线性模型的观测数据点。</p>
<ul>
<li><strong>判断</strong>: 错误 (✓ FALSE)</li>
<li><strong>解析</strong>:
<ul>
<li>μi=E[Yi∣xi] 是给定 xi 时 Y 的条件均值。其置信区间是针对这个<strong>均值</strong>的。</li>
<li>Yi 的预测区间是针对一个<strong>新的、单个的</strong>观测值 Ynew（在给定的 xi 处）的。</li>
<li>预测区间总是<strong>等于或宽于</strong>对应 xi 处的均值置信区间。这是因为预测区间不仅包含了对均值估计的不确定性（这部分与均值置信区间相同），还额外包含了单个观测值围绕其均值的随机波动 ϵi 的不确定性。</li>
<li>因此，均值的置信区间不可能比预测区间更宽。</li>
</ul>
</li>
</ul>
<p><strong>B部分：多项选择题 (Question 2)</strong></p>
<p><strong>(a) 题目 (4分)</strong>: 考虑一个对数-对数线性模型 log(yi)=β0+β1log(xi)+ϵi，其中 ϵi∼Normal(0,σ2) 且 β^1=0.1。以下哪个陈述是正确的？</p>
<p>☐ Yi 的期望对数值如果 x 增加1个单位将不会改变。 (The log of expected Yi would not change if x was increased by 1 unit.)</p>
<p>☐ Yi 的期望对数值如果 x 增加1个单位将增加10%。 (The expected log of Yi would increase by 10% if x was increased by 1 unit.)</p>
<p>☐ Yi 的期望对数值如果 x 增加1个单位将增加0.1。 (The log of expected Yi would increase by 0.1 if x was increased by 1 unit.)</p>
<p>☐ Yi 的中位数如果 x 增加1%将增加10%。 (The median of Yi would increase by 10% if x was increased by 1%.)</p>
<p>☐ Yi 的对数中位数如果 x 增加1%将增加0.1%。 (The median of log of Yi would increase by 0.1% if x was increased by 1%.)</p>
<p>✓ 以上皆非。 (None of the above.)</p>
<ul>
<li><strong>正确选项</strong>: ✓ 以上皆非。</li>
<li><strong>解析</strong>:
<ul>
<li>模型是 log(Yi)=β0+β1log(xi)+ϵi。</li>
<li>我们通常解释的是 xi <strong>百分比变化</strong>对 Yi <strong>中位数百分比变化</strong>的影响。</li>
<li>当 xi 增加1%时，Yi 的中位数大约增加 β1。题目中 β^1=0.1，所以当 xi 增加1%时，Yi 的中位数大约增加 0.1。</li>
<li>让我们逐个分析选项：
<ul>
<li>“Yi 的期望对数值如果 x 增加1个单位将不会改变。” 错误。这里 x 是绝对变化，且模型中是 log(x)。E[log(Yi)] 会改变。</li>
<li>“Yi 的期望对数值如果 x 增加1个单位将增加10%。” 错误。E[log(Yi)] 的变化是 β1×Δ(log(x))，不是简单的百分比。</li>
<li>“Yi 的期望对数值如果 x 增加1个单位将增加0.1。” 错误。E[log(Yi)] 的变化是 β1(log(x+1)−log(x))=0.1log((x+1)/x)，这不等于0.1。</li>
<li>“Yi 的中位数如果 x 增加1%将增加10%。” 错误。应该是增加约 0.1。</li>
<li>“Yi 的对数中位数如果 x 增加1%将增加0.1%。” 错误。Yi 的对数中位数是 E[log(Yi)]。当 x 增加1% (即 x 变为 1.01x) 时，log(x) 变为 log(1.01x)=log(1.01)+log(x)。所以 E[log(Yi)] 的变化是 β1log(1.01)=0.1×log(1.01)≈0.1×0.00995≈0.000995。这不是0.1%。</li>
</ul>
</li>
<li><strong>正确的陈述应该是</strong>：“Yi 的中位数如果 x 增加1%将大约增加 0.1。” 由于选项中没有这个陈述，所以选择“以上皆非”。</li>
</ul>
</li>
</ul>
<p><strong>C部分：简答题 (Question 3)</strong></p>
<p><strong>背景</strong>: 一个二次回归模型 y∼x+I(x2) 在R中拟合，输出摘要如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&gt; summary(lm(y ~ x + I(x^2)))</span><br><span class="line">Call:</span><br><span class="line">lm(formula = y ~ x + I(x^2))</span><br><span class="line"></span><br><span class="line">Residuals:</span><br><span class="line">    Min      1Q  Median      3Q     Max</span><br><span class="line">-4.6231 -0.9615  0.0118  0.9832  3.9852</span><br><span class="line"></span><br><span class="line">Coefficients:</span><br><span class="line">            Estimate Std. Error t value Pr(&gt;|t|)</span><br><span class="line">(Intercept)  0.13947    0.05791   2.408 0.016200 *</span><br><span class="line">x            0.14603    0.04736   3.083 0.002103 **</span><br><span class="line">I(x^2)      -0.13152    0.03512  -3.744 0.000191 ***</span><br><span class="line">---</span><br><span class="line">Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span><br><span class="line"></span><br><span class="line">Residual standard error: 1.478 on 997 degrees of freedom</span><br><span class="line">Multiple R-squared:  0.02245,   Adjusted R-squared:  0.02049</span><br><span class="line">F-statistic: 11.45 on 2 and 997 DF,  p-value: 1.212e-05</span><br></pre></td></tr></table></figure>
<p><strong>(a) 题目 (1分)</strong>: 数据框中有多少个数据点？</p>
<ul>
<li><strong>解析</strong>:
<ul>
<li>根据残差标准误 (Residual standard error) 那一行，自由度 (degrees of freedom) 是997。</li>
<li>模型是 Y=β0+β1X+β2X2+ϵ，有3个参数被估计 (β0,β1,β2)。</li>
<li>残差自由度 dfresidual=n−p，其中 n 是数据点数量，p 是模型中参数的数量。</li>
<li>所以，997=n−3。</li>
<li>因此，n=997+3=1000。</li>
<li><strong>答案</strong>: 数据框中有1000个数据点。</li>
</ul>
</li>
</ul>
<p><strong>(b) 题目 (5分)</strong>: 计算 β2 (即 x2 的系数) 的95%置信区间。</p>
<ul>
<li><strong>解析</strong>:
<ul>
<li>β2 的95%置信区间公式为：β^2±tα/2,n−p×SE(β^2)。</li>
<li>从R输出中可知：
<ul>
<li>x2 的系数估计值 β^2=−0.13152 (I(x^2)的Estimate)。</li>
<li>x2 的系数标准误 SE(β^2)=0.03512 (I(x^2)的Std. Error)。</li>
<li>自由度 df=n−p=997。</li>
</ul>
</li>
<li>t0.025,997 的临界值。当自由度很大时（如大于100或200），t分布非常接近标准正态分布，所以可以使用 z0.025=1.96 作为近似。用R精确计算：<code>qt(0.975, df=997)</code> 结果约为 1.9623。题目解析中使用了1.96。</li>
<li>使用1.96：
<ul>
<li>下限: −0.13152−1.96×0.03512=−0.13152−0.0688352=−0.2003552≈−0.20<img src alt="img"></li>
<li>上限: −0.13152+1.96×0.03512=−0.13152+0.0688352=−0.0626848≈−0.06<img src alt="img"></li>
</ul>
</li>
<li>所以，β2 的95%置信区间约为 (-0.20, -0.06)。</li>
<li><strong>步骤评分点</strong>:
<ul>
<li>1分: 知道公式 β^2±tα/2×SE(β^2)。</li>
<li>1分: 正确读取 β^2=−0.13152。</li>
<li>1分: 正确读取 SE(β^2)=0.03512。</li>
<li>1分: 知道学生t分布可以被正态分布近似，因此 tα/2≈1.96。</li>
<li>1分: 最终答案 (-0.20, -0.06)。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>(c) 题目 (3分)</strong>: 在5%的显著性水平下，是否有证据反对 H0:β2=−0.1？请说明理由。</p>
<ul>
<li><strong>解析</strong>:
<ul>
<li><strong>判断</strong>: 没有足够的证据反对 H0:β2=−0.1。</li>
<li><strong>理由 (基于置信区间)</strong>:
<ul>
<li>我们在 (b) 中计算出 β2 的95%置信区间约为 (-0.20, -0.06)。</li>
<li>原假设的值 β2,0=−0.1。</li>
<li>因为 −0.1 包含在置信区间 (−0.20,−0.06) 内 (即 −0.20&lt;−0.1&lt;−0.06)。</li>
<li>当原假设的值落在参数的置信区间内时，我们没有足够的证据在相应的显著性水平下拒绝原假设。</li>
</ul>
</li>
<li><strong>步骤评分点</strong>:
<ul>
<li>1分: 正确判断“没有证据”。</li>
<li>1分: 知道使用置信区间与假设检验的对应关系。</li>
<li>1分: 知道因为 −0.1∈(−0.20,−0.06)，所以在5%水平下没有证据反对。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>Question 4 (8分) - FEV (用力呼气量) 研究</strong></p>
<p><strong>背景</strong>: 研究吸烟与用力呼气量 (FEV) 的关系。FEV是肺功能指标。数据来自654名3-19岁青少年。变量：</p>
<ul>
<li><code>fev</code>: FEV测量值。</li>
<li><code>ht</code>: 身高 (英寸)。</li>
<li><code>smoke</code>: 1为吸烟者，0为不吸烟者。</li>
</ul>
<p><strong>输出信息</strong>:</p>
<ul>
<li>三个 <code>trendscatter</code> 图：<code>fev~ht</code>, <code>log(fev)~ht</code>, <code>log(fev)~log(ht)</code>。</li>
<li>三个模型的残差对拟合值图 (<code>plot(fit, which=1)</code>)：
<ul>
<li><code>fit1 = lm(fev ~ ht*smoke, ...)</code></li>
<li><code>fit2 = lm(log(fev) ~ ht*smoke, ...)</code> (对数线性模型)</li>
<li><code>fit3 = lm(log(fev) ~ log(ht)*smoke, ...)</code> (对数-对数模型)</li>
</ul>
</li>
<li>三个模型的系数置信区间 (原始尺度和反转换后的百分比变化尺度)。</li>
</ul>
<p><strong>(a) 题目 (2分)</strong>: 根据给定的输出，选择最佳模型。请说明理由。</p>
<ul>
<li><strong>解析</strong>:
<ul>
<li><strong>选择</strong>: 对数线性模型 (<code>fit2 = lm(log(fev) ~ ht*smoke, ...)</code>) 似乎是最佳的。</li>
<li><strong>理由</strong>:
<ul>
<li>从趋势散点图来看：
<ul>
<li><code>fev~ht</code> (左图) 显示出明显的曲线关系（向上弯曲）和异方差性（随身高增加，FEV的变异性增大）。这表明简单线性模型 <code>fit1</code> 可能不合适。</li>
<li><code>log(fev)~ht</code> (中图) 使得关系看起来更接近线性，并且散点的垂直散布（方差）似乎更均匀。</li>
<li><code>log(fev)~log(ht)</code> (右图) 也显示了线性关系，但与中图相比，其改善程度可能不那么明显，或者说中图的线性关系已经足够好。</li>
</ul>
</li>
<li>从残差图来看（虽然题目中只展示了 <code>fit1</code> 的一个残差图，但假设可以参考所有）：
<ul>
<li><code>fit1</code> (线性模型) 的残差图（题目中展示的第一个残差图）显示出明显的曲线模式（可能是U型或倒U型）和扇形散布（异方差），表明线性假设和等方差假设均不满足。</li>
<li>根据题目解析的提示“对数线性模型在散点图和残差图中都略优于对数-对数模型”，我们可以推断 <code>fit2</code> (对数线性模型) 的残差图表现最好，即残差随机分布在0附近，没有明显模式，且方差较为恒定。</li>
<li><code>fit3</code> (对数-对数模型) 的残差图可能也比 <code>fit1</code> 好，但可能不如 <code>fit2</code>。</li>
</ul>
</li>
</ul>
</li>
<li><strong>答案</strong>: 对数线性模型 (<code>fit2 = lm(log(fev) ~ ht*smoke, ...)</code>) 似乎是最佳选择。理由是，原始的散点图和线性模型 (<code>fit1</code>) 的残差图都显示出曲线关系和拟合不足（或异方差）。而对数线性模型 (<code>fit2</code>) 的散点图（<code>log(fev)~ht</code>）和其对应的（未完全展示但可推断的）残差图表现出更好的线性关系和方差齐性，它在改善模型假设方面略优于对数-对数模型 (<code>fit3</code>)。</li>
</ul>
</li>
</ul>
<p><strong>(b) 题目 (3分)</strong>: 对于您选择的模型，写三句话（如同写执行摘要一样），第一句说明是否存在交互作用，第二句说明吸烟的影响，第三句量化身高的影响。</p>
<ul>
<li><strong>解析 (假设选择了 <code>fit2 = lm(log(fev) ~ ht\*smoke, ...)</code> 作为最佳模型)</strong>:
<ul>
<li>我们需要查看 <code>fit2</code> 的 <code>summary()</code> 输出（题目未直接给出，但给出了其置信区间 <code>confint(fit2)</code>）。从 <code>confint(fit2)</code> 的输出中，<code>ht:smoke</code> 项的置信区间是 <code>(-0.01409994, 0.009512541)</code>。这个区间包含了0，表明交互作用项<strong>不显著</strong>。</li>
<li>如果交互作用不显著，我们通常会移除它并拟合主效应模型 <code>lm(log(fev) ~ ht + smoke, ...)</code>。但题目要求基于“你选择的模型”，而 <code>fit2</code> 是包含交互作用的。如果严格按 <code>fit2</code> 解释：
<ul>
<li><strong>第一句 (交互作用)</strong>: FEV与身高之间的关系对于吸烟者和非吸烟者来说是相同的（或者说，没有足够的证据表明这种关系因吸烟状况而异，因为交互作用不显著）。</li>
<li><strong>第二句 (吸烟影响)</strong>: 在控制了身高后，吸烟状况对FEV的中位数没有显著影响（因为 <code>smoke</code> 主效应的置信区间 <code>(-0.63357410, 0.921653364)</code> 对应的指数减1后包含0，表明OR的CI包含1）。</li>
<li><strong>第三句 (身高影响)</strong>: 控制吸烟状况后，身高每增加一英寸，FEV的中位数预计增加5.1%到5.6%（来自 <code>ht</code> 项的置信区间 <code>(0.05014065, 0.054451541)</code>，反转换为百分比变化 100×(eCI−1)）。</li>
</ul>
</li>
<li><strong>更合理的做法 (如果允许模型简化)</strong>: 由于交互作用不显著，应简化模型为 <code>lm(log(fev) ~ ht + smoke, ...)</code>。然后根据简化模型的 <code>summary()</code> 来解释 <code>smoke</code> 和 <code>ht</code> 的主效应。
<ul>
<li>假设简化后 <code>smoke</code> 仍不显著，<code>ht</code> 显著。</li>
<li><strong>第一句 (交互作用)</strong>: FEV与身高之间的关系对于吸烟者和非吸烟者来说是相同的。</li>
<li><strong>第二句 (吸烟影响)</strong>: 在控制了身高后，我们没有发现吸烟状况对FEV有显著影响。</li>
<li><strong>第三句 (身高影响)</strong>: 我们估计，身高每额外增加一英寸，FEV的中位数会增加X%到Y% (这里的X和Y来自简化模型后 <code>ht</code> 系数的置信区间并反转换)。</li>
</ul>
</li>
<li><strong>题目解析中给出的答案似乎是基于 <code>fit1</code> (线性模型 <code>fev ~ ht\*smoke</code>) 或简化后的 <code>fit2</code> (如果交互和smoke主效应都不显著，则简化为 <code>log(fev) ~ ht</code>)，并且混合了解释：</strong>
<ul>
<li>“用力呼气量和身高之间的关系对于吸烟者和非吸烟者是相同的。” (这暗示交互作用不显著)</li>
<li>“在给定的数据中，我们没有发现吸烟对用力呼气量有任何影响。” (这暗示吸烟主效应不显著)</li>
<li>“我们估计身高每额外增加一英寸，用力呼气量的均值会增加0.12到0.14个单位。” (这是对 <code>fit1</code> 中 <code>ht</code> 系数的解释，针对均值，且假设交互和吸烟都不显著)</li>
<li>“我们估计身高每额外增加一英寸，用力呼气量的中位数会增加5.1%到5.6%。” (这是对 <code>fit2</code> 中 <code>ht</code> 系数的解释，针对中位数，且假设交互和吸烟都不显著)</li>
<li>“我们估计身高每增加1%，用力呼气量的中位数会增加3.0%到3.3%。” (这是对 <code>fit3</code> 中 <code>log(ht)</code> 系数的解释)</li>
</ul>
</li>
<li><strong>选择最佳答案句 (基于题目解析倾向于简化模型后的解释)</strong>:
<ol>
<li>FEV与身高之间的关系对于吸烟者和非吸烟者是相同的。</li>
<li>在给定的数据中，我们没有发现吸烟对FEV的中位数有显著影响。</li>
<li>我们估计，身高每额外增加一英寸，FEV的中位数会增加5.1%到5.6%。 (选择与 <code>fit2</code> 对应的解释)</li>
</ol>
</li>
</ul>
</li>
</ul>
<p><strong>(c) 题目 (3分)</strong>: 写下模型 <code>fit3</code> 的方程/公式，如同你在“方法与假设检查”部分所写的那样。</p>
<ul>
<li><strong>解析</strong>:
<ul>
<li><code>fit3</code> 是对数-对数模型，包含身高和吸烟状况的交互作用：<code>lm(log(fev) ~ log(ht)*smoke, ...)</code>。</li>
<li>模型方程可以写为： log(fevi)=β0+β1log(hti)+β2smokei+β3(log(hti)×smokei)+ϵi</li>
<li>其中：
<ul>
<li>fevi 是第 i 个个体的用力呼气量。</li>
<li>hti 是第 i 个个体的身高。</li>
<li>smokei 是一个指示变量，如果第 i 个个体吸烟则为1，否则为0。</li>
<li>ϵi∼iidNormal(0,σ2) 是误差项。</li>
<li>β0,β1,β2,β3 是固定但未知的模型参数。</li>
</ul>
</li>
<li><strong>步骤评分点</strong>:
<ul>
<li>1分: 写出模型的基本形式 log(fevi)=⋯+ϵi。</li>
<li>1分: 正确包含所有项，包括交互作用项 β3smokei⋅log(hti)，并说明误差项 ϵi∼Normal(0,σ2) 以及参数是固定但未知的。</li>
<li>1分: 正确定义指示变量 smokei (例如，吸烟为1，不吸烟为0)。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="代码总结">代码总结</h2>
<h3 id="Lecture-1">Lecture 1</h3>
<p>这个lecture主要介绍了R语言在统计分析中的一些基本操作和概念，特别是围绕<strong>简单线性回归</strong>的初步探讨。</p>
<ol>
<li>
<p><strong>数据生成与描述</strong>:</p>
<ul>
<li>
<p>使用 <code>rnorm()</code> 从正态分布中生成随机样本。</p>
</li>
<li>
<p>计算样本均值 (</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mean()</span><br></pre></td></tr></table></figure>
<p>,</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sum()/length()</span><br></pre></td></tr></table></figure>
<p>) 作为总体均值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">true.mu</span><br></pre></td></tr></table></figure>
<p>的最大似然估计 (MLE)。这与教材</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">STATS201 book SWU 2023.pdf</span><br></pre></td></tr></table></figure>
<p>第1章介绍的通过R分析数据的概念一致 。</p>
</li>
</ul>
</li>
<li>
<p><strong>单样本t检验</strong>:</p>
<ul>
<li>
<p>使用 <code>t.test(y, mu = value)</code> 进行单样本t检验，用于检验总体均值是否等于某个特定值。代码中用 <code>pi</code> 是一个占位符，实际应为数值。</p>
</li>
<li>
<p>提及了估计、假设检验和置信区间都可以通过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t.test()</span><br></pre></td></tr></table></figure>
<p>函数获得，并强调了样本量对检验效能和置信区间宽度的影响。这部分内容与教材第3章“零线性模型与单样本t检验的等价性”相关 。</p>
</li>
</ul>
</li>
<li>
<p><strong>相关性分析</strong>:</p>
<ul>
<li>使用 <code>plot(x,y)</code> 绘制散点图来可视化两个变量之间的关系。</li>
<li>使用 <code>cor(x,y)</code> 计算皮尔逊相关系数，用以衡量线性关联的强度和方向。</li>
<li>通过实例（<code>y</code>的均值依赖于<code>x</code>，或<code>y</code>的标准差依赖于<code>x</code>的绝对值）强调了相关系数<strong>仅能捕捉线性关联</strong>，对于非线性关系（如异方差引起的扇形散点图），相关系数可能很低，即使变量间存在明显模式。</li>
</ul>
</li>
<li>
<p><strong>简单线性回归 (Simple Linear Regression)</strong>:</p>
<ul>
<li>
<p>引入 <code>s20x</code> 包，这是课程特定的包。</p>
</li>
<li>
<p>使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.frame()</span><br></pre></td></tr></table></figure>
<p>创建数据框，这是R中存储表格数据的常用结构。对应教材第1章“将数据导入R - 创建数据框”部分 。</p>
</li>
<li>
<p>使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lm(y ~ x, data = data.df)</span><br></pre></td></tr></table></figure>
<p>构建简单线性模型Y=β0+β1X+ϵ。这是本课程的核心内容之一，教材第1章“如何拟合直线到您的数据 - 简单线性模型”和第2章“简单线性回归的基础”详细讨论了这一点。</p>
</li>
<li>
<pre><code>summary(fit)
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  函数提供了模型系数的估计值、标准误、t统计量、p值以及模型的R2、F统计量等重要信息。教材第1章和第2章均有详细解释 。</span><br><span class="line"></span><br><span class="line">- 手动计算 R2</span><br><span class="line"></span><br><span class="line">   (</span><br><span class="line"></span><br></pre></td></tr></table></figure>
(TSS-RSS)/TSS
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">)，并与</span><br><span class="line"></span><br></pre></td></tr></table></figure>
summary(fit)
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">     中的结果对比。教材第1章“模型对预测有多好？ - R2”部分有讲解 。</span><br><span class="line"></span><br><span class="line">5. **模型诊断 (Model Diagnostics)**:</span><br><span class="line"></span><br><span class="line">   - `plot(fit, which = 1)` 生成残差对拟合值图，用于检查模型的**线性假设**和**方差齐性 (EOV)** 假设。</span><br><span class="line">   - `normcheck(fit)` (来自`s20x`包) 或 `plot(fit, which = 2)` (标准R的Q-Q图) 用于检查残差的**正态性假设**。</span><br><span class="line">   - `plot(fit, which = 4)` 生成Cook&#x27;s距离图，用于识别**强影响点**。</span><br><span class="line">   - 这些诊断方法是评估模型适用性的关键步骤，教材第2章“模型假设的标准检查 - 独立性、EOV和正态性”以及“使用cooks20x检查不当影响点”部分有详细说明 。</span><br><span class="line"></span><br><span class="line">6. **模型解释与预测**:</span><br><span class="line"></span><br><span class="line">   - `summary(fit)` 中的系数（斜率）解释。</span><br><span class="line">   - `confint(fit)` 计算模型参数（截距和斜率）的置信区间（95%）。</span><br><span class="line">   - `predict(fit, newdata = ..., interval = &quot;confidence&quot;)` 计算给定新 x 值时，E[Y∣x] 的置信区间。</span><br><span class="line">   - `predict(fit, newdata = ..., interval = &quot;prediction&quot;)` 计算给定新 x 值时，单个 Y 值的预测区间。</span><br><span class="line">   - 这些内容对应教材第1章“如何使用拟合模型进行预测”和第2章“置信区间和预测区间”。</span><br><span class="line"></span><br><span class="line">7. **配对t检验的等价性**:</span><br><span class="line"></span><br><span class="line">   - `t.test(x, y, paired = TRUE)` 执行配对t检验。</span><br><span class="line">   - `t.test(x-y)` 对差值进行单样本t检验，其结果与配对t检验等价。</span><br><span class="line">   - `summary(lm(x-y ~ 1, data = data.df))` 表明对差值拟合一个只有截距的模型（零模型），其截距的检验也与单样本t检验等价。这部分内容与教材第3章“零线性模型与单样本t检验的等价性”紧密相关 。</span><br><span class="line"></span><br><span class="line">```R</span><br><span class="line"># 真实参数未知但固定</span><br><span class="line">true.mu = 3</span><br><span class="line"># 从正态分布生成一个样本</span><br><span class="line">y = rnorm(100, mean = true.mu, sd = 1)</span><br><span class="line"># true.mu 的最大似然估计 (MLE)</span><br><span class="line">mean(y)</span><br><span class="line">sum(y) / length(y)</span><br><span class="line"># 假设检验 H_0: mu_y = pi (这里的pi应理解为一个特定的常数值，例如3.14159...，但在t检验中通常用于表示总体均值假设值)</span><br><span class="line"># 注意：实际代码中 t.test(y, mu = pi) 会引发错误，因为pi是内置常量。通常会用一个数值，如 t.test(y, mu = 3)</span><br><span class="line">t.test(y, mu = pi) # 概念上是检验均值是否等于某个值，但pi的使用在此处不标准，除非pi被重新赋值</span><br><span class="line"></span><br><span class="line"># 估计/假设检验/置信区间</span><br><span class="line"># 上述函数 (t.test) 均可提供</span><br><span class="line"># 注意检验的效能 (power)</span><br><span class="line"># 以及置信区间的宽度</span><br><span class="line"># 会随着样本量的改变而改变</span><br><span class="line"></span><br><span class="line"># 生成两个独立的变量用于展示关系</span><br><span class="line">y = rnorm(100, mean = 3, sd = 1)</span><br><span class="line">x = rnorm(100, mean = 0, sd = 1)</span><br><span class="line">plot(x,y) # 绘制散点图</span><br><span class="line"># 皮尔逊相关系数</span><br><span class="line">cor(x,y)</span><br><span class="line"># 创建一些依赖关系</span><br><span class="line">y = rnorm(100, mean = x, sd = 1) # y 的均值依赖于 x</span><br><span class="line">plot(x,y)</span><br><span class="line">cor(x,y)</span><br><span class="line"># 注意相关性仅能</span><br><span class="line"># 捕捉线性关联</span><br><span class="line">x = rnorm(1000, mean = 0, sd = 1)</span><br><span class="line">y = rnorm(1000, mean = 0, sd = abs(x)) # y 的标准差依赖于 x 的绝对值，创建了非线性关联 (异方差性)</span><br><span class="line">plot(x,y)</span><br><span class="line">cor(x,y) # 尽管存在明显模式，但线性相关系数可能接近0</span><br><span class="line"></span><br><span class="line">library(s20x) # 本课程需要此包</span><br><span class="line">y = rnorm(100, mean = 3, sd = 1)</span><br><span class="line">x = rnorm(100, mean = 0, sd = 1)</span><br><span class="line">data.df = data.frame(y=y,x=x) # 创建数据框</span><br><span class="line">fit = lm(y~x, data = data.df) # 构建线性模型 y = beta0 + beta1*x</span><br><span class="line">summary(fit) # 给出参数估计等信息</span><br><span class="line"># R^2 (决定系数)</span><br><span class="line">TSS = sum((y - mean(y))^2) # 总平方和 (Total Sum of Squares)</span><br><span class="line">RSS = sum((y-fitted.values(fit))^2) # 残差平方和 (Residual Sum of Squares)</span><br><span class="line">(TSS- RSS)/TSS # 计算 R^2，应与 summary(fit) 中的 R-squared 一致</span><br><span class="line"></span><br><span class="line"># 残差图</span><br><span class="line">plot(fit,which = 1) # 1. 残差 vs. 拟合值图，用于检查线性性和方差齐性 (EOV)</span><br><span class="line">normcheck(fit) # 3. 正态性检验图 (通常是Q-Q图和残差直方图)</span><br><span class="line"># plot(fit,which = 2) # 理论上 which=2 是 Q-Q plot，但 s20x 的 normcheck 更常用</span><br><span class="line">plot(fit,which = 4) # 4. Cook&#x27;s距离图，用于识别强影响点</span><br><span class="line"># 如何解释斜率</span><br><span class="line">summary(fit) # 回归系数的估计值、标准误、t值、p值</span><br><span class="line"># 置信区间</span><br><span class="line">confint(fit) # 参数的置信区间及其解释</span><br><span class="line"># 预测区间</span><br><span class="line">new.df = data.frame(x=pi) # 创建新的x值用于预测，同样pi的使用需注意</span><br><span class="line">predict(fit, newdata = new.df, # 对给定x值的均值y的置信区间</span><br><span class="line">        interval = &quot;confidence&quot;)</span><br><span class="line">predict(fit, newdata = new.df, # 对给定x值的单个y的预测区间</span><br><span class="line">        interval = &quot;prediction&quot;)</span><br><span class="line"></span><br><span class="line"># t.test 中的参数</span><br><span class="line">t.test(x,y,paired = TRUE) # 配对t检验</span><br><span class="line">t.test(x-y) # 这等同于对差值进行单样本t检验 (检验差值的均值是否为0)</span><br><span class="line"># 与零模型相同</span><br><span class="line">summary(lm(x-y~1, data = data.df)) # 对差值拟合截距模型，其截距的t检验与单样本t检验等价</span><br></pre></td></tr></table></figure>

</code></pre>
</li>
</ul>
</li>
</ol>
<h3 id="Lecture-2">Lecture 2</h3>
<p>这个lecture深入探讨了<strong>简单线性回归的基础 (The basics of simple linear regression)</strong>，重点在于理解模型参数的估计、推断（置信区间和预测区间）以及模型诊断。这与教材 <code>STATS201 book SWU 2023.pdf</code> 第2章  的内容高度吻合。</p>
<ol>
<li>
<p><strong>参数估计与标准误</strong>:</p>
<ul>
<li>
<p>首先通过模拟生成已知真实参数 (<code>beta0</code>, <code>beta1</code>, <code>sd</code>) 的数据。</p>
</li>
<li>
<p>使用 <code>lm(y~x)</code> 拟合模型。</p>
</li>
<li>
<p>手动从公式计算残差标准误 (</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sigmahat</span><br></pre></td></tr></table></figure>
<p>) 和斜率的标准误 (</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sigma1hat</span><br></pre></td></tr></table></figure>
<p>)，并与</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">summary(fit)$sigma</span><br></pre></td></tr></table></figure>
<p>和</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">summary(fit)$coeff[2,2]</span><br></pre></td></tr></table></figure>
<p>的输出进行比较，帮助理解这些估计量是如何得到的。这对应教材第2章中关于最小二乘法拟合模型后，如何得到参数估计及其标准误差的讨论 。</p>
</li>
</ul>
</li>
<li>
<p><strong>参数的置信区间</strong>:</p>
<ul>
<li>
<p>手动计算斜率 <code>beta1hat</code> 的95%置信区间，使用公式 $β^1±tα/2,n−p×SE(β^1)$。</p>
</li>
<li>
<p>将其与</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">confint(fit)</span><br></pre></td></tr></table></figure>
<p>函数的结果进行比较，验证手动计算的正确性。这在教材第2章“参数和拟合值的置信区间，以及个体预测的预测区间”部分有详细描述 。</p>
</li>
<li>
<p>通过模拟 (<code>for</code>循环) 展示了置信区间的<strong>覆盖率</strong> (coverage probability) 概念：在多次重复抽样和构建置信区间的过程中，大约有95%的95%置信区间会包含真实的参数值。</p>
</li>
</ul>
</li>
<li>
<p><strong>预测区间与均值置信区间</strong>:</p>
<ul>
<li>
<p>区分对条件均值 E[Y∣x] 的置信区间 (</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">interval = &quot;confidence&quot;</span><br></pre></td></tr></table></figure>
<p>) 和对单个新观测值 Ynew 的预测区间</p>
<p>(</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">interval = &quot;prediction&quot;</span><br></pre></td></tr></table></figure>
<p>)。教材第2章对此有详细解释 。</p>
</li>
<li>
<p>预测区间总是比均值置信区间更宽，因为它额外考虑了单个观测的随机波动 ϵ。</p>
</li>
<li>
<p>通过模拟展示了预测区间的覆盖率，即大约95%的95%预测区间会包含真实的未来观测值。</p>
</li>
</ul>
</li>
<li>
<p><strong>拟合值与残差</strong>:</p>
<ul>
<li><code>fitted.values(simple.fit)</code> 或 <code>coef(simple.fit)[1] + coef(simple.fit)[2] * sim_data$x</code> 用于获取拟合值 y^。</li>
<li><code>sim_data$y - yhat</code> 计算残差 e=y−y^。</li>
<li>这些概念是模型诊断的基础，教材第2章“拟合值和残差”部分有所提及 。</li>
</ul>
</li>
<li>
<p><strong>模型诊断图</strong>:</p>
<ul>
<li>
<pre><code>plot(simple.fit, which = 1)
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  ：残差对拟合值图，用于检查线性性和方差齐性 (EOV)。教材第2章“检查模型假设 - 独立性、EOV和正态性” 。</span><br><span class="line"></span><br><span class="line">- `trendscatter(res ~ yhat)` (来自 `s20x` 包)：提供了另一种检查线性性和EOV的方法。</span><br><span class="line"></span><br><span class="line">- ```</span><br><span class="line">  normcheck(simple.fit)</span><br></pre></td></tr></table></figure>

 (来自 

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s20x</span><br></pre></td></tr></table></figure>

 包)：用于检查残差的正态性。教材第2章 。

</code></pre>
</li>
<li>
<pre><code>cooks20x(simple.fit)
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">(来自 </span><br><span class="line"></span><br></pre></td></tr></table></figure>
s20x
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">      包)：用于检查强影响点。教材第2章“使用cooks20x检查不当影响点” 。</span><br><span class="line"></span><br><span class="line">   - 强调了样本量对诊断工具敏感性的影响：小样本时诊断图可能过于敏感。</span><br><span class="line"></span><br><span class="line">6. **违反模型假设的情况**:</span><br><span class="line"></span><br><span class="line">   - 模拟了违反方差齐性 (`sd = x`) 和违反残差正态性 (`error = error^2`) 的情况，并观察了这些违反对模型诊断图和回归线的影响。</span><br><span class="line">   - 指出在违反EOV时，回归线可能仍接近真实情况，但违反正态性（特别是当它导致均值结构改变时）可能会使回归线偏离真实情况。</span><br><span class="line"></span><br><span class="line">```r</span><br><span class="line"># 真实且未知的参数</span><br><span class="line">beta0 = 100</span><br><span class="line">beta1 = 0.05</span><br><span class="line"># 解释变量</span><br><span class="line">x = 1:200</span><br><span class="line"># 真实均值</span><br><span class="line">mu = beta0 + beta1*x</span><br><span class="line"># 响应变量 (带有随机误差)</span><br><span class="line">y = rnorm(200, mean = mu, sd = 10)</span><br><span class="line"># 构建模型</span><br><span class="line">fit = lm(y~x)</span><br><span class="line">summary(fit)</span><br><span class="line"># 从公式计算估计的标准差 sigma_hat (残差标准误)</span><br><span class="line">sqrt(sum((y - fitted.values(fit))^2)/(200-2)) # (n-p)，这里 p=2 (beta0, beta1)</span><br><span class="line"># 从summary对象中提取估计的标准差 sigma_hat</span><br><span class="line">sigmahat = summary(fit)$sigma</span><br><span class="line"># 从公式计算斜率估计的标准误 sigma1_hat</span><br><span class="line">sqrt(sigmahat^2/sum((x-mean(x))^2))</span><br><span class="line">sigma1hat = summary(fit)$coeff[2,2] # summary(fit)$coefficients 是系数矩阵，[2,2]是斜率的标准误</span><br><span class="line"># 提取斜率的估计值 beta1_hat</span><br><span class="line">beta1hat = summary(fit)$coeff[2,1] # [2,1]是斜率的估计值</span><br><span class="line"># 手动计算 beta1_hat 的95%置信区间下限和上限</span><br><span class="line">beta1hat + qt(0.025, df = 198) * sigma1hat # df = n-p = 200-2 = 198</span><br><span class="line">beta1hat + qt(0.975, df = 198) * sigma1hat</span><br><span class="line"># 与R内置函数结果比较</span><br><span class="line">confint(fit)</span><br><span class="line"></span><br><span class="line">rm(list=ls()) # 清除工作空间中的所有对象</span><br><span class="line"># 置信区间的覆盖率模拟</span><br><span class="line">count = 0</span><br><span class="line">N = 10000 # 模拟次数</span><br><span class="line">for (i in 1:N)&#123;</span><br><span class="line">  # 观测数量</span><br><span class="line">  sample.size = 30</span><br><span class="line">  # 预测变量</span><br><span class="line">  x = 1:sample.size;</span><br><span class="line">  # 真实截距和斜率</span><br><span class="line">  beta0 = 5; beta1 = 2;</span><br><span class="line">  # 真实误差项</span><br><span class="line">  error = rnorm(n = sample.size, mean = 0, sd = 3)</span><br><span class="line">  # 响应变量</span><br><span class="line">  y = beta0 + beta1 * x + error;</span><br><span class="line">  # 存入数据框</span><br><span class="line">  sim_data = data.frame(x=x, y=y);</span><br><span class="line">  # 拟合简单线性模型</span><br><span class="line">  simple.fit = lm(formula = y~x, data = sim_data)</span><br><span class="line">  # 获取斜率beta1的置信区间</span><br><span class="line">  beta1.CI = confint(simple.fit)[2, ] # 提取斜率的置信区间</span><br><span class="line">  # 如果真实beta1包含在计算得到的置信区间内，则计数</span><br><span class="line">  count = count + as.numeric((beta1.CI[1] &lt;= beta1) &amp; (beta1&lt;=beta1.CI[2]))</span><br><span class="line">&#125;</span><br><span class="line">count / N # 计算覆盖率，应接近0.95</span><br><span class="line"></span><br><span class="line"># 预测区间</span><br><span class="line">new.df = data.frame(x = 7) # 给定新的x值</span><br><span class="line"># 点预测值</span><br><span class="line">predict(simple.fit, newdata = new.df, interval = &quot;none&quot;) # 或者不指定 interval</span><br><span class="line"># 对 E[y|x=7] = beta0 + beta1 * 7 的置信区间</span><br><span class="line">predict(simple.fit, newdata = new.df, interval = &quot;confidence&quot;)</span><br><span class="line"># 对单个y (当x=7时) 的预测区间</span><br><span class="line">predict(simple.fit, newdata = new.df, interval = &quot;prediction&quot;)</span><br><span class="line"># y的条件均值 (真实值)</span><br><span class="line">beta0 + beta1 * 7</span><br><span class="line"># 某个随机误差</span><br><span class="line">(error = rnorm(n = 1, mean = 0, sd = 3))</span><br><span class="line"># 某个真实的y值</span><br><span class="line">beta0 + beta1 * 7 + error</span><br><span class="line"></span><br><span class="line"># 95%预测区间的思想类似于95%置信区间</span><br><span class="line">count = 0</span><br><span class="line">N = 1000 # 模拟次数</span><br><span class="line">sample.size = 30</span><br><span class="line">x = 1:sample.size;</span><br><span class="line">beta0 = 5; beta1 = 2;</span><br><span class="line">new.df = data.frame(x = 7) # 新的x值</span><br><span class="line">for (i in 1:N)&#123;</span><br><span class="line">  error = rnorm(n = sample.size, mean = 0, sd = 3) # 生成样本误差</span><br><span class="line">  y = beta0 + beta1 * x + error; # 生成样本y</span><br><span class="line">  sim_data = data.frame(x=x, y=y);</span><br><span class="line">  simple.fit = lm(formula = y~x, data = sim_data) # 拟合模型</span><br><span class="line">  x7.PI = predict(simple.fit, newdata = new.df, interval = &quot;prediction&quot;)[2:3] # 获取预测区间的下限和上限</span><br><span class="line">  error = rnorm(n = 1, mean = 0, sd = 3) # 为新的观测值生成一个随机误差</span><br><span class="line">  true.Y = beta0 + beta1 * 7 + error # 真实的新的Y值</span><br><span class="line">  # 如果真实的Y值包含在预测区间内，则计数</span><br><span class="line">  count = count + as.numeric((x7.PI[1] &lt;= true.Y) &amp; (true.Y&lt;=x7.PI[2]))</span><br><span class="line">&#125;</span><br><span class="line">count / N # 计算覆盖率，应接近0.95</span><br><span class="line"></span><br><span class="line">rm(list=ls()) # 清除工作空间</span><br><span class="line">library(s20x) # 加载s20x包</span><br><span class="line"># 观测数量 20</span><br><span class="line">sample.size = 20</span><br><span class="line"># 预测变量</span><br><span class="line">x = 1:sample.size;</span><br><span class="line"># 真实截距 5 和斜率 2</span><br><span class="line">beta0 = 5; beta1 = 2;</span><br><span class="line"># 真实误差 Normal(0, sigma = 3)</span><br><span class="line">error = rnorm(n = sample.size, mean = 0, sd = 3)</span><br><span class="line"># 响应变量</span><br><span class="line">y = beta0 + beta1 * x + error;</span><br><span class="line"># 存入数据框</span><br><span class="line">sim_data = data.frame(x=x, y=y);</span><br><span class="line"># 拟合简单线性模型</span><br><span class="line">simple.fit = lm(formula = y~x, data = sim_data)</span><br><span class="line"># 提取估计的截距和斜率</span><br><span class="line">coef(simple.fit)</span><br><span class="line"># 拟合值，即给定x的条件y值，</span><br><span class="line"># 其中x值是原始数据中观测到的</span><br><span class="line">coef(simple.fit)[1] + coef(simple.fit)[2] * sim_data$x</span><br><span class="line"># R中的内置函数</span><br><span class="line">yhat = fitted.values(simple.fit)</span><br><span class="line"># 残差</span><br><span class="line">res = sim_data$y - yhat</span><br><span class="line"># 将所有内容放入同一个数据框</span><br><span class="line">sim_data$yhat = yhat</span><br><span class="line">sim_data$res = res</span><br><span class="line">head(sim_data) # 显示数据框前几行</span><br><span class="line"># 绘制两个变量的散点图</span><br><span class="line">plot(y~x, data = sim_data)</span><br><span class="line"># 绘制估计的回归线</span><br><span class="line">abline(coef(simple.fit), col = &quot;red&quot;)</span><br><span class="line"># 绘制真实的双变量关系线</span><br><span class="line">abline(c(5, 2), col = &quot;blue&quot;, lty = 2) # c(intercept, slope)</span><br><span class="line"># 检查线性性和方差齐性 (EOV)</span><br><span class="line">plot(simple.fit, which = 1)</span><br><span class="line"># 更多用于线性性和EOV的可视化辅助</span><br><span class="line">trendscatter(res ~ yhat) # s20x包的函数，残差对拟合值的趋势散点图</span><br><span class="line"># 正态性检查</span><br><span class="line">normcheck(simple.fit) # s20x包的函数</span><br><span class="line"># 强影响点检查</span><br><span class="line">cooks20x(simple.fit) # s20x包的函数</span><br><span class="line"></span><br><span class="line"># 样本量 200</span><br><span class="line">sample.size = 200</span><br><span class="line"># 当样本量较小时，我们用于</span><br><span class="line"># 线性性、EOV和正态性的诊断工具可能过于敏感 (假阳性)</span><br><span class="line"># 当样本量足够大时，它们更可靠</span><br><span class="line"></span><br><span class="line"># 违反EOV (方差齐性) 的情况</span><br><span class="line">error = rnorm(n = sample.size, mean = 0, sd = x) # 误差标准差随x变化</span><br><span class="line"># 非恒定的散点，Q-Q图也可能偏离</span><br><span class="line"># 注意回归线仍然离真实情况不远</span><br><span class="line"># eovcheck中的误差带是不正确的 (可能是指s20x包中eovcheck函数的特定行为)</span><br><span class="line"></span><br><span class="line"># 违反正态性的情况</span><br><span class="line">error = error^2 # 使误差项非正态 (卡方分布)</span><br><span class="line"># 非恒定的散点，Q-Q图和直方图都表明有问题</span><br><span class="line"># 回归线不再接近真实情况</span><br></pre></td></tr></table></figure>

</code></pre>
</li>
</ul>
</li>
</ol>
<h3 id="Lecture-3：曲线拟合与分类解释变量-Fitting-Curves-and-Categorical-Explanatory-Variables">Lecture 3：曲线拟合与分类解释变量 (Fitting Curves and Categorical Explanatory Variables)</h3>
<p>这个lecture主要涵盖了两个重要主题：1) <strong>使用线性模型拟合曲线关系</strong>，特别是二次多项式回归；2) <strong>处理双水平分类解释变量</strong>。</p>
<ol>
<li>
<p><strong>拟合曲线关系 (Fitting Curves)</strong>:</p>
<ul>
<li>
<p>识别曲线关系</p>
<p>：通过散点图 (</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plot()</span><br></pre></td></tr></table></figure>
<p>,</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trendscatter()</span><br></pre></td></tr></table></figure>
<p>) 和简单线性回归的残差对拟合值图 (</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plot(fit, which=1)</span><br></pre></td></tr></table></figure>
<p>) 来识别数据中是否存在非线性（曲线）趋势。如果残差图显示出系统性模式（如U形或倒U形），则表明简单线性模型可能不适用。这部分对应教材</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">STATS201 book SWU 2023.pdf</span><br></pre></td></tr></table></figure>
<p>第4章“使用线性模型拟合曲线”的引言部分 。</p>
</li>
<li>
<p>二次模型：当检测到曲线关系时，可以尝试添加解释变量的二次项 (如X2) 到模型中，即</p>
<p>Y=β0+β1X+β2X2+ϵ。在R中，这通过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">I(Assign^2)</span><br></pre></td></tr></table></figure>
<p>实现，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">I()</span><br></pre></td></tr></table></figure>
<p>函数确保</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^2</span><br></pre></td></tr></table></figure>
<p>按数学上的平方运算执行，而不是R公式中的特殊含义。教材第4章对此有详细讨论。</p>
</li>
<li>
<p><strong>模型比较与可视化</strong>：比较简单线性模型和二次模型的残差图，看后者是否更好地消除了系统性模式。通过 <code>lines()</code> 和 <code>predict()</code> 函数在原始散点图上绘制两个模型的拟合线，直观比较拟合效果。</p>
</li>
<li>
<p><strong>模型外推风险</strong>：强调了将模型用于解释变量范围之外的数据进行预测（外推）是非常危险的，因为模型的形式在数据范围之外可能完全不适用。</p>
</li>
</ul>
</li>
<li>
<p><strong>处理双水平分类解释变量 (2-level Categorical Explanatory Variable)</strong>:</p>
<ul>
<li>
<p>数据类型转换：分类数据在R中应为因子 (factor)</p>
<p>类型。如果原始数据是字符型，需要使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">as.factor()</span><br></pre></td></tr></table></figure>
<p>进行转换。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str()</span><br></pre></td></tr></table></figure>
<p>和</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">summary()</span><br></pre></td></tr></table></figure>
<p>函数可以帮助查看和理解因子变量的结构和水平。这部分内容与教材第5章“具有2级分类（因子）解释变量的线性模型”的开始部分以及第1章中处理数据框的部分相关 。</p>
</li>
<li>
<p><strong>因子水平顺序</strong>：可以使用 <code>factor(variable, levels = c(&quot;level_preferred_as_baseline&quot;, &quot;other_level&quot;))</code> 来改变因子水平的顺序，这将影响 <code>lm()</code> 函数中选择哪个水平作为<strong>基准水平 (baseline level)</strong>。</p>
</li>
<li>
<p><strong>可视化</strong>：对于一个数值响应变量和一个二元分类解释变量，<code>plot(Y ~ X_factor)</code> 会自动生成并排的<strong>箱线图 (boxplots)</strong>，这是比较两组分布的有效方式。<code>summaryStats(Y, X_factor)</code> (来自<code>s20x</code>包) 可提供按组的描述性统计。</p>
</li>
<li>
<p>模型拟合与解释：</p>
<ul>
<li>可以直接在 <code>lm()</code> 中使用因子型解释变量，如 <code>lm(Exam ~ Attend, data = Stats20x.df)</code>。R会自动为因子变量创建<strong>指示变量 (indicator variables, or dummy variables)</strong>。如果因子有k个水平，通常会创建k-1个指示变量，其中一个水平作为基准。</li>
<li>对于双水平因子（如&quot;No&quot;, &quot;Yes&quot;），如果&quot;No&quot;是基准，则模型是 E[Exam]=β0+β1×IAttend=Yes。β0是&quot;No&quot;组的均值Exam，β1是&quot;Yes&quot;组相对于&quot;No&quot;组的均值Exam的差异。教材第5章详细解释了这一点。</li>
<li>也可以手动创建数值指示变量 (0/1)，然后用其进行回归，结果是等价的，但这通常不如直接使用因子方便。</li>
</ul>
</li>
<li>
<p><strong>模型诊断</strong>：对于这类模型，线性性假设通常不是主要关注点（因为解释变量只有两个有效值）。但<strong>方差齐性 (EOV)</strong> 和残差的<strong>正态性</strong>仍然需要通过 <code>plot(fit, which=1)</code> 和 <code>normcheck(fit)</code> 进行检查。</p>
</li>
<li>
<p><strong>置信区间与预测区间</strong>：<code>predict()</code> 函数可以用于获取各组的均值置信区间和个体预测区间。</p>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">rm<span class="punctuation">(</span><span class="built_in">list</span><span class="operator">=</span>ls<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># 清除工作空间</span></span><br><span class="line">library<span class="punctuation">(</span>s20x<span class="punctuation">)</span> <span class="comment"># 加载s20x包</span></span><br><span class="line">getwd<span class="punctuation">(</span><span class="punctuation">)</span> <span class="comment"># 获取当前工作目录</span></span><br><span class="line"><span class="comment"># setwd() # 设置工作目录 (如果需要)</span></span><br><span class="line">Stats20x.df <span class="operator">=</span> read.table<span class="punctuation">(</span> <span class="comment"># 加载数据</span></span><br><span class="line">  <span class="string">&quot;STATS20x.txt&quot;</span><span class="punctuation">,</span> header <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 第一步是做探索性分析</span></span><br><span class="line">plot<span class="punctuation">(</span>Exam<span class="operator">~</span>Assign<span class="punctuation">,</span> data <span class="operator">=</span> Stats20x.df<span class="punctuation">)</span> <span class="comment"># Exam对Assign的散点图</span></span><br><span class="line"><span class="comment"># 有用的s20x绘图函数</span></span><br><span class="line">trendscatter<span class="punctuation">(</span>Exam<span class="operator">~</span>Assign<span class="punctuation">,</span> data <span class="operator">=</span> Stats20x.df<span class="punctuation">)</span> <span class="comment"># 带趋势线的散点图</span></span><br><span class="line"><span class="comment"># 第一个模型 (简单线性回归)</span></span><br><span class="line">examassign.fit <span class="operator">=</span> lm<span class="punctuation">(</span>Exam<span class="operator">~</span>Assign<span class="punctuation">,</span> data <span class="operator">=</span> Stats20x.df<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 检查线性性 + 方差齐性 (EOV)</span></span><br><span class="line">plot<span class="punctuation">(</span>examassign.fit<span class="punctuation">,</span> which <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 有一些曲率的迹象</span></span><br><span class="line"><span class="comment"># 添加一个二次项</span></span><br><span class="line">examassign.fit2 <span class="operator">=</span> lm<span class="punctuation">(</span>Exam<span class="operator">~</span>Assign<span class="operator">+</span>I<span class="punctuation">(</span>Assign<span class="operator">^</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> data <span class="operator">=</span> Stats20x.df<span class="punctuation">)</span> <span class="comment"># I()确保^按数学运算处理</span></span><br><span class="line"><span class="comment"># 再次检查线性性 + EOV</span></span><br><span class="line">plot<span class="punctuation">(</span>examassign.fit2<span class="punctuation">,</span> which <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 看起来好一些了</span></span><br><span class="line"><span class="comment"># 图片通常是模型的一个很好的展示</span></span><br><span class="line">plot<span class="punctuation">(</span>Exam<span class="operator">~</span>Assign<span class="punctuation">,</span> data <span class="operator">=</span> Stats20x.df<span class="punctuation">)</span></span><br><span class="line">x <span class="operator">=</span> <span class="number">0</span><span class="operator">:</span><span class="number">20</span> <span class="comment"># 用于评估 beta1_hat + beta2_hat * x 的x取值范围</span></span><br><span class="line">lines<span class="punctuation">(</span>x<span class="punctuation">,</span> predict<span class="punctuation">(</span>examassign.fit<span class="punctuation">,</span></span><br><span class="line">                 data.frame<span class="punctuation">(</span>Assign<span class="operator">=</span>x<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;red&quot;</span><span class="punctuation">)</span> <span class="comment"># 绘制简单线性模型拟合线</span></span><br><span class="line">lines<span class="punctuation">(</span>x<span class="punctuation">,</span> predict<span class="punctuation">(</span>examassign.fit2<span class="punctuation">,</span></span><br><span class="line">                 data.frame<span class="punctuation">(</span>Assign<span class="operator">=</span>x<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;blue&quot;</span><span class="punctuation">)</span> <span class="comment"># 绘制二次模型拟合线</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 理解模型在数据范围之外的行为</span></span><br><span class="line">x <span class="operator">=</span> seq<span class="punctuation">(</span><span class="operator">-</span><span class="number">15</span><span class="punctuation">,</span> <span class="number">25</span><span class="punctuation">,</span> by <span class="operator">=</span> <span class="number">0.1</span><span class="punctuation">)</span> <span class="comment"># 更宽的x取值范围</span></span><br><span class="line">y <span class="operator">=</span> predict<span class="punctuation">(</span>examassign.fit2<span class="punctuation">,</span> data.frame<span class="punctuation">(</span>Assign<span class="operator">=</span>x<span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># 使用二次模型预测</span></span><br><span class="line">plot<span class="punctuation">(</span>y<span class="operator">~</span>x<span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&quot;l&quot;</span><span class="punctuation">,</span> lty <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span> <span class="comment"># 绘制整个预测曲线</span></span><br><span class="line">lines<span class="punctuation">(</span>x<span class="punctuation">[</span>x<span class="operator">&gt;</span><span class="number">0</span> <span class="operator">&amp;</span> x<span class="operator">&lt;</span><span class="number">20</span><span class="punctuation">]</span><span class="punctuation">,</span> y<span class="punctuation">[</span>x<span class="operator">&gt;</span><span class="number">0</span> <span class="operator">&amp;</span> x<span class="operator">&lt;</span><span class="number">20</span><span class="punctuation">]</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;blue&quot;</span><span class="punctuation">)</span> <span class="comment"># 突出显示原始数据范围内的拟合</span></span><br><span class="line">abline<span class="punctuation">(</span>v<span class="operator">=</span><span class="built_in">range</span><span class="punctuation">(</span>Stats20x.df<span class="operator">$</span>Assign<span class="punctuation">)</span><span class="punctuation">,</span> lty <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;grey&quot;</span><span class="punctuation">)</span> <span class="comment"># 标记原始数据x的范围</span></span><br><span class="line">abline<span class="punctuation">(</span>h<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">100</span><span class="punctuation">)</span><span class="punctuation">,</span> lty <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;grey&quot;</span><span class="punctuation">)</span> <span class="comment"># 标记y的合理范围 (如考试分数0-100)</span></span><br><span class="line"><span class="comment"># 在数据范围之外使用模型总是存在风险的</span></span><br><span class="line"></span><br><span class="line">rm<span class="punctuation">(</span><span class="built_in">list</span><span class="operator">=</span>ls<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># 清除工作空间</span></span><br><span class="line">library<span class="punctuation">(</span>s20x<span class="punctuation">)</span> <span class="comment"># 加载s20x包</span></span><br><span class="line">Stats20x.df <span class="operator">=</span> read.table<span class="punctuation">(</span></span><br><span class="line">  <span class="string">&quot;STATS20x.txt&quot;</span><span class="punctuation">,</span> header <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 二元分类变量</span></span><br><span class="line">head<span class="punctuation">(</span>Stats20x.df<span class="operator">$</span>Attend<span class="punctuation">)</span> <span class="comment"># 查看Attend变量的前几行</span></span><br><span class="line"><span class="comment"># 字符型</span></span><br><span class="line">summary<span class="punctuation">(</span>Stats20x.df<span class="operator">$</span>Attend<span class="punctuation">)</span> <span class="comment"># 字符型变量的summary给出长度、类别、模式</span></span><br><span class="line"><span class="comment"># 将字符型转换为因子型</span></span><br><span class="line">Stats20x.df<span class="operator">$</span>Attend <span class="operator">=</span> as.factor<span class="punctuation">(</span></span><br><span class="line">  Stats20x.df<span class="operator">$</span>Attend<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 存储方式不同</span></span><br><span class="line">str<span class="punctuation">(</span>Stats20x.df<span class="operator">$</span>Attend<span class="punctuation">)</span> <span class="comment"># 查看因子型变量的结构，会显示levels</span></span><br><span class="line">head<span class="punctuation">(</span>Stats20x.df<span class="operator">$</span>Attend<span class="punctuation">)</span></span><br><span class="line">summary<span class="punctuation">(</span>Stats20x.df<span class="operator">$</span>Attend<span class="punctuation">)</span> <span class="comment"># 因子型变量的summary给出各level的频数</span></span><br><span class="line"><span class="comment"># 我们可以改变level的顺序</span></span><br><span class="line">Stats20x.df<span class="operator">$</span>Attend <span class="operator">=</span> factor<span class="punctuation">(</span></span><br><span class="line"> Stats20x.df<span class="operator">$</span>Attend<span class="punctuation">,</span> level <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Yes&quot;</span><span class="punctuation">,</span> <span class="string">&quot;No&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># 将&quot;Yes&quot;设为第一个level (基准level会改变)</span></span><br><span class="line">summary<span class="punctuation">(</span>Stats20x.df<span class="operator">$</span>Attend<span class="punctuation">)</span> <span class="comment"># &quot;Yes&quot;在前，&quot;No&quot;在后</span></span><br><span class="line">head<span class="punctuation">(</span>Stats20x.df<span class="operator">$</span>Attend<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># Summary已经能提供很多信息了</span></span><br><span class="line">summaryStats<span class="punctuation">(</span>Stats20x.df<span class="operator">$</span>Exam<span class="punctuation">,</span></span><br><span class="line">             Stats20x.df<span class="operator">$</span>Attend<span class="punctuation">)</span> <span class="comment"># s20x包函数，按Attend分组计算Exam的描述统计</span></span><br><span class="line"><span class="comment"># 绘图更直观</span></span><br><span class="line">plot<span class="punctuation">(</span>Exam<span class="operator">~</span>Attend<span class="punctuation">,</span> data <span class="operator">=</span> Stats20x.df<span class="punctuation">)</span> <span class="comment"># 自动生成箱线图</span></span><br><span class="line"><span class="comment"># Hack数据格式以便使用trendscatter</span></span><br><span class="line">Stats20x.df<span class="operator">$</span>Attend2 <span class="operator">=</span> <span class="built_in">as.numeric</span><span class="punctuation">(</span></span><br><span class="line">  Stats20x.df<span class="operator">$</span>Attend <span class="operator">==</span> <span class="string">&quot;Yes&quot;</span><span class="punctuation">)</span> <span class="comment"># 创建数值型指示变量 (Yes=1, No通常为0，但这里取决于因子顺序)</span></span><br><span class="line"><span class="comment"># 上面代码取决于Attend的因子水平顺序。如果&quot;Yes&quot;是第一水平，则Yes为1，No为2。</span></span><br><span class="line"><span class="comment"># 如果要Yes=1, No=0，且原始因子水平是c(&quot;No&quot;, &quot;Yes&quot;)，则应为 as.numeric(Stats20x.df$Attend == &quot;Yes&quot;)</span></span><br><span class="line"><span class="comment"># 或者更稳妥的是: Stats20x.df$Attend2 = ifelse(Stats20x.df$Attend == &quot;Yes&quot;, 1, 0)</span></span><br><span class="line">with<span class="punctuation">(</span>Stats20x.df<span class="punctuation">,</span> table<span class="punctuation">(</span>Attend<span class="punctuation">,</span>Attend2<span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># 交叉表验证转换</span></span><br><span class="line">trendscatter<span class="punctuation">(</span>Exam<span class="operator">~</span>Attend2<span class="punctuation">,</span> data <span class="operator">=</span> Stats20x.df<span class="punctuation">)</span> <span class="comment"># 使用数值化的Attend2绘图</span></span><br><span class="line"><span class="comment"># 简单地对关系建模</span></span><br><span class="line">examattend2.fit <span class="operator">=</span> lm<span class="punctuation">(</span>Exam<span class="operator">~</span>Attend2<span class="punctuation">,</span> data <span class="operator">=</span> Stats20x.df<span class="punctuation">)</span> <span class="comment"># 使用数值型指示变量建模</span></span><br><span class="line">summary<span class="punctuation">(</span>examattend2.fit<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 注意相似之处和不同之处</span></span><br><span class="line">examattend.fit <span class="operator">=</span> lm<span class="punctuation">(</span>Exam<span class="operator">~</span>Attend<span class="punctuation">,</span> data <span class="operator">=</span> Stats20x.df<span class="punctuation">)</span> <span class="comment"># 直接使用因子型变量建模</span></span><br><span class="line">summary<span class="punctuation">(</span>examattend.fit<span class="punctuation">)</span> <span class="comment"># R会自动处理因子变量的哑变量编码</span></span><br><span class="line"><span class="comment"># 在这种情况下不需要线性性检查 (因为解释变量只有两个点)</span></span><br><span class="line">plot<span class="punctuation">(</span>examattend.fit<span class="punctuation">,</span> which <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span> <span class="comment"># 残差图仍然可以看方差齐性</span></span><br><span class="line"><span class="comment"># EOV (方差齐性)</span></span><br><span class="line">summaryStats<span class="punctuation">(</span>Stats20x.df<span class="operator">$</span>Exam<span class="punctuation">,</span> Stats20x.df<span class="operator">$</span>Attend<span class="punctuation">)</span> <span class="comment"># 按组查看标准差</span></span><br><span class="line"><span class="comment"># 正态性</span></span><br><span class="line">normcheck<span class="punctuation">(</span>examattend.fit<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 强影响点</span></span><br><span class="line">cooks20x<span class="punctuation">(</span>examattend.fit<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 解释</span></span><br><span class="line">coef<span class="punctuation">(</span>summary<span class="punctuation">(</span>examattend.fit<span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># 系数解释</span></span><br><span class="line">confint<span class="punctuation">(</span>examattend.fit<span class="punctuation">)</span> <span class="comment"># 置信区间</span></span><br><span class="line"><span class="comment"># 在这种情况下，两种类型的CI密切相关</span></span><br><span class="line">preds.df <span class="operator">=</span> data.frame<span class="punctuation">(</span>Attend <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;No&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Yes&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># 注意level顺序</span></span><br><span class="line">predict<span class="punctuation">(</span>examattend.fit<span class="punctuation">,</span> preds.df<span class="punctuation">,</span> interval <span class="operator">=</span> <span class="string">&quot;confidence&quot;</span><span class="punctuation">)</span> <span class="comment"># 对均值的置信区间</span></span><br><span class="line">predict<span class="punctuation">(</span>examattend.fit<span class="punctuation">,</span> preds.df<span class="punctuation">,</span> interval <span class="operator">=</span> <span class="string">&quot;prediction&quot;</span><span class="punctuation">)</span> <span class="comment"># 对个体的预测区间</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="Lecture-4：数据转换-Data-Transformations-特别是Log转换">Lecture 4：数据转换 (Data Transformations) - 特别是Log转换</h3>
<p>这个lecture的核心是<strong>数据转换 (Data Transformations)</strong>，特别是<strong>对数转换 (log transformation)</strong> 在处理右偏数据、非线性关系以及解释模型时的应用。这与教材 <code>STATS201 book SWU 2023.pdf</code> 第6章“乘法线性模型 (Multiplicative linear models)”  紧密相关。</p>
<ol>
<li>
<p><strong>处理右偏数据与正态性</strong>:</p>
<ul>
<li>
<p>许多现实世界的数据（尤其是涉及金额、计数的数据，如房价 <code>Houses.df$price</code>、理发花费 <code>hair.df$hair</code>）是<strong>右偏 (right-skewed)</strong> 的。</p>
</li>
<li>
<p>直接对这类数据拟合线性模型可能会违反<strong>正态性假设</strong>和<strong>方差齐性假设</strong>。</p>
</li>
<li>
<p>对数转换 <code>log()</code>通常可以使右偏数据更对称，更接近正态分布，从而满足线性模型的假设。如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lm(log(price)~1, data=Houses.df)</span><br></pre></td></tr></table></figure>
<p>后</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">normcheck()</span><br></pre></td></tr></table></figure>
<p>显示改善。教材第6章 (第13页) 展示了对数转换如何使房价数据更接近正态。</p>
</li>
</ul>
</li>
<li>
<p><strong>均值 vs. 中位数</strong>:</p>
<ul>
<li>
<p>对于高度偏斜的数据，<strong>中位数 (median)</strong> 通常比均值 (mean) 更能代表数据的“典型”或中心趋势。</p>
</li>
<li>
<p>当对响应变量 Y 进行对数转换拟合模型 log(Y)=β0+β1X+ϵ 时，反转换 exp(β^0+β^1X) 得到的是 Y 的<strong>中位数估计</strong>，而不是均值估计。</p>
</li>
<li>
<p>因此，通过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exp(confint(LoggedPriceNull.fit))</span><br></pre></td></tr></table></figure>
<p>得到的置信区间是针对总体中位数的。教材第6章 (第14-17页) 详细解释了为何对数转换后的推断是关于中位数的。</p>
</li>
<li>
<p>代码中还演示了使用<strong>自助法 (bootstrap)</strong> 来估计均值的置信区间，并与基于CLT的<code>confint(HousesNull.fit)</code>结果比较。</p>
</li>
</ul>
</li>
<li>
<p><strong>处理非线性关系 (对数线性模型)</strong>:</p>
<ul>
<li>
<p>当响应变量与解释变量之间的关系不是直线，而是曲线（特别是指数增长或衰减型，如马自达汽车价格随车龄 <code>price ~ age</code> 的关系），对响应变量取对数 (<code>log(price) ~ age</code>) 可能使关系线性化。</p>
</li>
<li>
<p>这种模型 log(Y)=β0+β1X+ϵ 称为<strong>对数-线性模型 (log-linear model)</strong>。</p>
</li>
<li>
<p>拟合后，需要检查残差图 (</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plot(LogPriceAge.fit, which = 1)</span><br></pre></td></tr></table></figure>
<p>) 和正态性 (</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">normcheck(LogPriceAge.fit)</span><br></pre></td></tr></table></figure>
<p>) 是否在新尺度上满足假设。教材第6章 (第35-37页) 展示了马自达数据的这个过程。</p>
</li>
</ul>
</li>
<li>
<p><strong>解释对数转换后的模型系数</strong>:</p>
<ul>
<li>
<p>对于对数-线性模型</p>
<p>log(Y)=β0+β1X:</p>
<ul>
<li>β^1 表示当 X 改变一个单位时，log(Y) 的平均变化。</li>
<li>exp(β^1) 表示当 X 改变一个单位时，Y 的中位数的<strong>乘性因子</strong>。</li>
<li>(exp(β^1)−1)×100% 表示当 X 改变一个单位时，Y 的中位数的<strong>百分比变化</strong>。</li>
</ul>
</li>
<li>
<p>代码中演示了如何计算和解释车龄每增加一年，马自达汽车价格中位数的百分比下降 (</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">100 * (exp(confint(LogPriceAge.fit)[2,])-1)</span><br></pre></td></tr></table></figure>
<p>)。教材第6章 (第44页) 有详细的解释。</p>
</li>
<li>
<p>对于多年变化，如5年折旧，可以通过 (exp(β^1))5</p>
<p>或exp(5×β^1)来估计累积的乘性效应。教材第6章 (第47-49页)讨论了多年折旧。</p>
</li>
</ul>
</li>
<li>
<p><strong>对数转换与分类解释变量</strong>:</p>
<ul>
<li>当解释变量是分类变量时（如性别 <code>sex</code>），对数转换同样适用。</li>
<li>模型 log(Y)=β0+β1Isex=male 中，exp(β^1) 表示男性相对于女性（基准组）Y 中位数的比率。</li>
<li>(exp(β^1)−1)×100% 是男性相对于女性 Y 中位数的百分比差异。</li>
<li>代码中分析了理发花费 <code>log(hair)</code> 与性别 <code>sex</code> 的关系。</li>
</ul>
</li>
</ol>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>s20x<span class="punctuation">)</span> <span class="comment"># 加载s20x包</span></span><br><span class="line">Houses.df <span class="operator">=</span> read.table<span class="punctuation">(</span><span class="string">&quot;AkldHousePrices.txt&quot;</span><span class="punctuation">,</span> header <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span> <span class="comment"># 读取奥克兰房价数据</span></span><br><span class="line">head<span class="punctuation">(</span>Houses.df<span class="operator">$</span>price<span class="punctuation">)</span> <span class="comment"># 查看房价数据前几行 (单位：千美元)</span></span><br><span class="line"><span class="comment"># 正态性存疑</span></span><br><span class="line">hist<span class="punctuation">(</span>Houses.df<span class="operator">$</span>price<span class="punctuation">,</span> breaks<span class="operator">=</span><span class="number">20</span><span class="punctuation">,</span>main<span class="operator">=</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span>xlab<span class="operator">=</span><span class="string">&quot;Price ($1000)&quot;</span><span class="punctuation">)</span> <span class="comment"># 绘制房价直方图</span></span><br><span class="line">abline<span class="punctuation">(</span>v <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>mean<span class="punctuation">(</span>Houses.df<span class="operator">$</span>price<span class="punctuation">)</span><span class="punctuation">,</span> median<span class="punctuation">(</span>Houses.df<span class="operator">$</span>price<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">       col <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;blue&quot;</span><span class="punctuation">,</span> <span class="string">&quot;green&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span> <span class="comment"># 添加均值和中位数线</span></span><br><span class="line">summary<span class="punctuation">(</span>Houses.df<span class="operator">$</span>price<span class="punctuation">)</span> <span class="comment"># 房价的描述统计</span></span><br><span class="line">HousesNull.fit<span class="operator">=</span>lm<span class="punctuation">(</span>price<span class="operator">~</span><span class="number">1</span><span class="punctuation">,</span> data<span class="operator">=</span>Houses.df<span class="punctuation">)</span> <span class="comment"># 拟合空模型 (仅截距)</span></span><br><span class="line">normcheck<span class="punctuation">(</span>HousesNull.fit<span class="punctuation">)</span> <span class="comment"># 对原始房价数据的残差进行正态性检验 (等同于对数据本身)</span></span><br><span class="line">nrow<span class="punctuation">(</span>Houses.df<span class="punctuation">)</span> <span class="comment"># 样本量是合理的 (94)</span></span><br><span class="line"><span class="comment"># 模拟样本均值 (自助法 Bootstrap)</span></span><br><span class="line"><span class="comment"># 注意：代码中 House.df$price 应该是 Houses.df$price (笔误)</span></span><br><span class="line">bootstrappedMeanPrices <span class="operator">=</span> double<span class="punctuation">(</span><span class="number">10000</span><span class="punctuation">)</span> <span class="comment"># 初始化一个长度为10000的向量</span></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>i <span class="keyword">in</span> <span class="number">1</span><span class="operator">:</span><span class="number">10000</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  tmp.vec <span class="operator">=</span> sample<span class="punctuation">(</span>Houses.df<span class="operator">$</span>price<span class="punctuation">,</span> <span class="comment"># 此处修正了变量名</span></span><br><span class="line">                   size <span class="operator">=</span> nrow<span class="punctuation">(</span>Houses.df<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                   replace <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span> <span class="comment"># 有放回抽样</span></span><br><span class="line">  y.bar <span class="operator">=</span> mean<span class="punctuation">(</span>tmp.vec<span class="punctuation">)</span> <span class="comment"># 计算重抽样样本的均值</span></span><br><span class="line">  bootstrappedMeanPrices<span class="punctuation">[</span>i<span class="punctuation">]</span> <span class="operator">=</span> y.bar</span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">hist<span class="punctuation">(</span>bootstrappedMeanPrices<span class="punctuation">)</span> <span class="comment"># 根据中心极限定理 (CLT)，样本均值的分布应接近正态</span></span><br><span class="line">quantile<span class="punctuation">(</span>bootstrappedMeanPrices<span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">.025</span><span class="punctuation">,</span> <span class="number">.975</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># Bootstrap置信区间</span></span><br><span class="line">confint<span class="punctuation">(</span>HousesNull.fit<span class="punctuation">)</span> <span class="comment"># 基于正态假设的均值置信区间 (与t检验结果一致)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Log转换</span></span><br><span class="line">LoggedPriceNull.fit<span class="operator">=</span>lm<span class="punctuation">(</span><span class="built_in">log</span><span class="punctuation">(</span>price<span class="punctuation">)</span><span class="operator">~</span><span class="number">1</span><span class="punctuation">,</span> data<span class="operator">=</span>Houses.df<span class="punctuation">)</span> <span class="comment"># 对log(price)拟合空模型</span></span><br><span class="line">normcheck<span class="punctuation">(</span>LoggedPriceNull.fit<span class="punctuation">)</span> <span class="comment"># 检查log(price)的正态性</span></span><br><span class="line">confint<span class="punctuation">(</span>LoggedPriceNull.fit<span class="punctuation">)</span> <span class="comment"># log尺度上均值(也是中位数)的置信区间</span></span><br><span class="line"><span class="built_in">exp</span><span class="punctuation">(</span>confint<span class="punctuation">(</span>LoggedPriceNull.fit<span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># 反转换回原始尺度，得到中位数的置信区间</span></span><br><span class="line"></span><br><span class="line">Mazda.df <span class="operator">=</span> read.table<span class="punctuation">(</span><span class="string">&quot;mazda.txt&quot;</span><span class="punctuation">,</span> header <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">)</span> <span class="comment"># 读取马自达汽车数据</span></span><br><span class="line">head<span class="punctuation">(</span>Mazda.df<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 我们需要自己创建一个名为age的新变量</span></span><br><span class="line">Mazda.df<span class="operator">$</span>age <span class="operator">=</span> <span class="number">91</span> <span class="operator">-</span> Mazda.df<span class="operator">$</span>year <span class="comment"># 数据收集于1991年</span></span><br><span class="line">head<span class="punctuation">(</span>Mazda.df<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 绘制数据散点图</span></span><br><span class="line">trendscatter<span class="punctuation">(</span>price <span class="operator">~</span> age<span class="punctuation">,</span> data <span class="operator">=</span> Mazda.df<span class="punctuation">)</span> <span class="comment"># s20x包函数，价格对车龄的趋势散点图</span></span><br><span class="line"><span class="comment"># 简单线性模型</span></span><br><span class="line">PriceAge.fit <span class="operator">=</span> lm<span class="punctuation">(</span>price <span class="operator">~</span> age<span class="punctuation">,</span> data <span class="operator">=</span> Mazda.df<span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>PriceAge.fit<span class="punctuation">,</span> which <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span> <span class="comment"># 残差图，违反线性性假设</span></span><br><span class="line">normcheck<span class="punctuation">(</span>PriceAge.fit<span class="punctuation">)</span> <span class="comment"># 同时伴有正态性问题</span></span><br><span class="line"><span class="comment"># 尝试二次模型</span></span><br><span class="line">PriceAge.quad.fit <span class="operator">=</span> lm<span class="punctuation">(</span>price <span class="operator">~</span> age<span class="operator">+</span>I<span class="punctuation">(</span>age<span class="operator">^</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> data <span class="operator">=</span> Mazda.df<span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>PriceAge.quad.fit<span class="punctuation">,</span> which <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span> <span class="comment"># 线性性可以了，但是...</span></span><br><span class="line">normcheck<span class="punctuation">(</span>PriceAge.quad.fit<span class="punctuation">)</span> <span class="comment"># 并没有解决正态性问题 (通常是异方差)</span></span><br><span class="line"><span class="comment"># 对price取log可以移除非线性趋势</span></span><br><span class="line">trendscatter<span class="punctuation">(</span>price <span class="operator">~</span> age<span class="punctuation">,</span> data <span class="operator">=</span> Mazda.df<span class="punctuation">)</span> <span class="comment"># 原始数据</span></span><br><span class="line">trendscatter<span class="punctuation">(</span><span class="built_in">log</span><span class="punctuation">(</span>price<span class="punctuation">)</span> <span class="operator">~</span> age<span class="punctuation">,</span> data <span class="operator">=</span> Mazda.df<span class="punctuation">)</span> <span class="comment"># log(price) vs age</span></span><br><span class="line">LogPriceAge.fit <span class="operator">=</span> lm<span class="punctuation">(</span><span class="built_in">log</span><span class="punctuation">(</span>price<span class="punctuation">)</span> <span class="operator">~</span> age<span class="punctuation">,</span> data <span class="operator">=</span> Mazda.df<span class="punctuation">)</span> <span class="comment"># 对数线性模型</span></span><br><span class="line">plot<span class="punctuation">(</span>LogPriceAge.fit<span class="punctuation">,</span> which <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span> <span class="comment"># 线性性和EOV看起来都不错了</span></span><br><span class="line">normcheck<span class="punctuation">(</span>LogPriceAge.fit<span class="punctuation">)</span> <span class="comment"># 正态性也可以了</span></span><br><span class="line">cooks20x<span class="punctuation">(</span>LogPriceAge.fit<span class="punctuation">)</span> <span class="comment"># 没有过分影响的点</span></span><br><span class="line">summary<span class="punctuation">(</span>LogPriceAge.fit<span class="punctuation">)</span> <span class="comment"># 现在如何解释斜率？</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 反转换 (Backtransform)</span></span><br><span class="line"><span class="built_in">exp</span><span class="punctuation">(</span>confint<span class="punctuation">(</span>LogPriceAge.fit<span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># 获取截距和斜率(的指数)的置信区间</span></span><br><span class="line"><span class="comment"># 反转换为百分比差异</span></span><br><span class="line"><span class="number">100</span> <span class="operator">*</span> <span class="punctuation">(</span><span class="built_in">exp</span><span class="punctuation">(</span>confint<span class="punctuation">(</span>LogPriceAge.fit<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="operator">-</span><span class="number">1</span><span class="punctuation">)</span> <span class="comment"># 对斜率的解释：车龄每增加1年，价格中位数变化的百分比</span></span><br><span class="line"><span class="comment"># 对斜率的解释: exp(beta1_hat) 是车龄增加1年时，价格中位数的乘性因子。</span></span><br><span class="line"><span class="comment"># (exp(beta1_hat) - 1) * 100% 是百分比变化。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5年内</span></span><br><span class="line"><span class="comment"># exp(confint(LogPriceAge.fit)[2,])^5 # 这是 (exp(beta1))^5 的置信区间，表示5年后的乘性因子</span></span><br><span class="line"><span class="comment"># 100 * (exp(confint(LogPriceAge.fit)[2,])^5 - 1) # 5年后价格中位数的总百分比变化</span></span><br><span class="line"><span class="comment"># 应该是 100 * (exp(5 * confint(LogPriceAge.fit)[2,]) - 1)</span></span><br><span class="line"><span class="comment"># 或者解释为：5年车龄的马自达汽车的中位数价格</span></span><br><span class="line"><span class="comment"># 预计比原始价值低52.76%到58.9%。(这里原文解释的是5年内的总折旧率)</span></span><br><span class="line"><span class="comment"># 更准确的说法: 5年车龄的马自达汽车的价值是新车价值的 exp(5*beta1_hat) 倍。</span></span><br><span class="line"><span class="comment"># 其置信区间是 exp(5 * lower_beta1) 到 exp(5 * upper_beta1)。</span></span><br><span class="line"><span class="comment"># 或者说，相比于车龄X的车，车龄X+5的车的价格中位数会变为原来的 exp(5*beta1) 倍。</span></span><br><span class="line"><span class="comment"># 所以这里原文的注释可能指 (exp(beta1_CI_lower))^5 和 (exp(beta1_CI_upper))^5</span></span><br><span class="line"><span class="comment"># 表示5年折旧的累积效应。</span></span><br><span class="line"><span class="comment"># 如教材P48所示，解释为 &quot;the median price of Mazdas drops between 52.8% and 58.9% over 5 years&quot;</span></span><br><span class="line"><span class="comment"># 计算方式是 100 * (exp(confint(LogPriceAge.fit)[2,])^5 - 1) 或 100 * (exp(5 * confint(LogPriceAge.fit)[2,]) -1)</span></span><br><span class="line"><span class="comment"># 后者更常见于直接解释5年总变化。前者是每年变化率的5次累积。</span></span><br><span class="line"><span class="comment"># 在教材P49， Case Study 6.1 中使用的是 exp(5 * confint(LogPriceAge.fit)[2,]) - 1</span></span><br><span class="line"><span class="comment"># 而代码中是 exp(confint(LogPriceAge.fit)[2,])^5 - 1。这两个在数值上可能略有差异但概念相似。</span></span><br><span class="line"></span><br><span class="line">survey.df <span class="operator">=</span> read.table<span class="punctuation">(</span><span class="string">&quot;survey.txt&quot;</span><span class="punctuation">,</span> header <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">)</span> <span class="comment"># 读取调查数据</span></span><br><span class="line"><span class="comment"># 为了使事情稍微不那么混乱，我们将数据放入其自己的数据框中</span></span><br><span class="line">hair.df <span class="operator">=</span> with<span class="punctuation">(</span>survey.df<span class="punctuation">,</span> data.frame<span class="punctuation">(</span>hair <span class="operator">=</span> hair<span class="punctuation">,</span> sex <span class="operator">=</span> sex<span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># 提取理发花费和性别</span></span><br><span class="line">plot<span class="punctuation">(</span>hair <span class="operator">~</span> sex<span class="punctuation">,</span> data <span class="operator">=</span> hair.df<span class="punctuation">)</span> <span class="comment"># 理发花费对性别的箱线图</span></span><br><span class="line"><span class="comment"># 女性在理发上的花费似乎比男性多。</span></span><br><span class="line"><span class="comment"># 我们可以看到数据是相当右偏的。方差齐性似乎也有问题。</span></span><br><span class="line"><span class="comment"># 也许取对数会有帮助。</span></span><br><span class="line">plot<span class="punctuation">(</span><span class="built_in">log</span><span class="punctuation">(</span>hair<span class="punctuation">)</span> <span class="operator">~</span> sex<span class="punctuation">,</span> data <span class="operator">=</span> hair.df<span class="punctuation">)</span> <span class="comment"># log(理发花费) 对 性别的箱线图</span></span><br><span class="line"><span class="comment"># 对数尺度/对数线性模型</span></span><br><span class="line">hair.fit <span class="operator">=</span> lm<span class="punctuation">(</span><span class="built_in">log</span><span class="punctuation">(</span>hair<span class="punctuation">)</span> <span class="operator">~</span> sex<span class="punctuation">,</span> data <span class="operator">=</span> hair.df<span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>hair.fit<span class="punctuation">,</span> which <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span> <span class="comment"># 残差图</span></span><br><span class="line">normcheck<span class="punctuation">(</span>hair.fit<span class="punctuation">)</span> <span class="comment"># 正态性检查</span></span><br><span class="line">cooks20x<span class="punctuation">(</span>hair.fit<span class="punctuation">)</span> <span class="comment"># 强影响点检查</span></span><br><span class="line">summary<span class="punctuation">(</span>hair.fit<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 将反转换后的输出列绑定在一起</span></span><br><span class="line">cbind<span class="punctuation">(</span><span class="built_in">exp</span><span class="punctuation">(</span>coef<span class="punctuation">(</span>hair.fit<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">exp</span><span class="punctuation">(</span>confint<span class="punctuation">(</span>hair.fit<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># 估计值和置信区间 (中位数尺度)</span></span><br><span class="line"><span class="number">100</span><span class="operator">*</span><span class="punctuation">(</span><span class="built_in">exp</span><span class="punctuation">(</span>confint<span class="punctuation">(</span>hair.fit<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">-</span> <span class="number">1</span><span class="punctuation">)</span> <span class="comment"># 百分比差异解释</span></span><br><span class="line">pred.df <span class="operator">=</span> data.frame<span class="punctuation">(</span>sex <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;female&quot;</span><span class="punctuation">,</span> <span class="string">&quot;male&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># 注意因子水平顺序</span></span><br><span class="line"><span class="built_in">exp</span><span class="punctuation">(</span>predict<span class="punctuation">(</span>hair.fit<span class="punctuation">,</span> pred.df<span class="punctuation">,</span> interval <span class="operator">=</span> <span class="string">&quot;confidence&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># 预测各性别理发花费中位数的置信区间</span></span><br></pre></td></tr></table></figure>
<h3 id="Lecture-5：幂律模型-Power-Law-Models">Lecture 5：幂律模型 (Power Law Models)</h3>
<p>这个lecture主要讲解<strong>幂律模型 (Power law linear models)</strong>，通常通过对响应变量和解释变量都进行<strong>对数转换</strong>来实现。这与教材 <code>STATS201 book SWU 2023.pdf</code> 第7章“幂律线性模型”  的内容一致。</p>
<ol>
<li><strong>幂律关系</strong>:
<ul>
<li>当变量之间的关系被假设为 Y=αXβ1 形式时，称为幂律关系。这种关系在生物学（如体重与长度）、物理学等领域很常见。</li>
<li>对这个等式两边取对数，得到 log(Y)=log(α)+β1log(X)。令β0=log(α)，则模型变为log(Y)=β0+β1log(X)。这正是关于log(Y)和 log(X)的一个简单线性模型，也称为对数-对数模型 (log-log model)。教材第7章 (第9-10页) 推导了这个过程。</li>
<li>代码中以鲷鱼的重量 (<code>wgt</code>) 与长度 (<code>len</code>) 为例，展示了原始尺度上非线性的关系，而在双对数尺度上 (<code>log(wgt) ~ log(len)</code>) 呈现线性关系。</li>
</ul>
</li>
<li><strong>模型拟合与诊断</strong>:
<ul>
<li>使用 <code>lm(log(wgt) ~ log(len), data=Snap.df)</code> 拟合模型。</li>
<li>与简单线性回归一样，需要进行模型诊断：
<ul>
<li><code>plot(Snap.lm, which=1)</code>：检查残差图的线性性和方差齐性。</li>
<li><code>normcheck(Snap.lm)</code>：检查残差的正态性。</li>
<li><code>cooks20x(Snap.lm)</code>：检查强影响点。</li>
</ul>
</li>
<li>教材第7章 (第12-14页) 展示了这些诊断步骤。</li>
</ul>
</li>
<li><strong>模型解释</strong>:
<ul>
<li>在对数-对数模型log(Y)=β0+β1log(X)中，斜率β1有特殊的解释：
<ul>
<li>β1 表示 X 每改变1%，Y 的中位数大约改变 β1% (这是一个近似，仅在 β1 较小且百分比变化较小时较准确)。</li>
<li>更精确地，如果 X 变为 kX（即 X 乘以因子 k），则 Y 的中位数变为 kβ1Ymedian。也就是说，Y 的中位数被乘以 kβ1。</li>
<li>代码中演示了当长度增加1% (即 k=1.01) 时，重量中位数乘以 1.01β1。以及当长度增加50% (即 k=1.5) 时，重量中位数乘以 1.5β1。教材第7章 (第24-26页) 详细解释了这种解释方法。</li>
</ul>
</li>
</ul>
</li>
<li><strong>预测</strong>:
<ul>
<li>在对数尺度上进行预测，然后使用 <code>exp()</code> 函数反转换回原始尺度，得到的是响应变量 Y 的<strong>中位数</strong>的点估计和区间估计。</li>
<li><code>predict(Snap.lm, newdata, interval=&quot;confidence&quot;)</code> 后取指数，得到的是给定 log(X) 时 E[log(Y)] (即 log(Median(Y))) 的置信区间。</li>
<li><code>predict(Snap.lm, newdata, interval=&quot;prediction&quot;)</code> 后取指数，得到的是给定 log(X) 时单个新 log(Y) 值的预测区间，反转换后是单个新 Y 值的预测区间（通常解释为中位数的预测）。</li>
<li>教材第7章 (第19页) 演示了如何预测30cm鲷鱼的重量中位数。</li>
</ul>
</li>
<li><strong>特定假设检验</strong>:
<ul>
<li>可以对斜率 β1 进行特定值的假设检验，例如，在生物学中，重量通常与长度的立方成正比（如果形状保持不变），这意味着在对数-对数模型中，β1 可能接近3。</li>
<li>代码中演示了如何手动计算t统计量和p值来检验H0:β1=3。这在教材第7章 (第20-21页) 也有提及。</li>
</ul>
</li>
</ol>
<p>总而言之，Lecture 5 介绍了如何通过双对数转换来处理幂律关系，将其转化为线性模型进行分析，并重点讲解了这种模型下系数的独特解释方式。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">Snap.df<span class="operator">=</span>read.table<span class="punctuation">(</span><span class="string">&quot;SnapWgt.txt&quot;</span><span class="punctuation">,</span>header<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">)</span> <span class="comment"># 读取鲷鱼(Snapper)重量数据</span></span><br><span class="line">str<span class="punctuation">(</span>Snap.df<span class="punctuation">)</span> <span class="comment"># 查看数据结构 (len: 长度, wgt: 重量)</span></span><br><span class="line">plot<span class="punctuation">(</span>wgt<span class="operator">~</span>len<span class="punctuation">,</span> data <span class="operator">=</span> Snap.df<span class="punctuation">)</span> <span class="comment"># 绘制重量对长度的散点图</span></span><br><span class="line">plot<span class="punctuation">(</span><span class="built_in">log</span><span class="punctuation">(</span>wgt<span class="punctuation">)</span><span class="operator">~</span><span class="built_in">log</span><span class="punctuation">(</span>len<span class="punctuation">)</span><span class="punctuation">,</span> <span class="comment"># 绘制 log(重量) 对 log(长度) 的散点图</span></span><br><span class="line">     data<span class="operator">=</span>Snap.df<span class="punctuation">,</span></span><br><span class="line">     xlab<span class="operator">=</span><span class="string">&quot;log(Length)&quot;</span><span class="punctuation">,</span></span><br><span class="line">     ylab<span class="operator">=</span><span class="string">&quot;log(Weight)&quot;</span><span class="punctuation">)</span></span><br><span class="line">Snap.lm<span class="operator">=</span>lm<span class="punctuation">(</span><span class="built_in">log</span><span class="punctuation">(</span>wgt<span class="punctuation">)</span><span class="operator">~</span><span class="built_in">log</span><span class="punctuation">(</span>len<span class="punctuation">)</span><span class="punctuation">,</span>data<span class="operator">=</span>Snap.df<span class="punctuation">)</span> <span class="comment"># 拟合对数-对数模型 (幂律模型)</span></span><br><span class="line">plot<span class="punctuation">(</span>Snap.lm<span class="punctuation">,</span>which<span class="operator">=</span><span class="number">1</span><span class="punctuation">)</span> <span class="comment"># 残差对拟合值图，检查线性性和EOV</span></span><br><span class="line">normcheck<span class="punctuation">(</span>Snap.lm<span class="punctuation">)</span> <span class="comment"># 正态性检查</span></span><br><span class="line">cooks20x<span class="punctuation">(</span>Snap.lm<span class="punctuation">)</span> <span class="comment"># 强影响点检查</span></span><br><span class="line">summary<span class="punctuation">(</span>Snap.lm<span class="punctuation">)</span> <span class="comment"># 查看模型摘要</span></span><br><span class="line"><span class="comment"># 在对数尺度上绘图</span></span><br><span class="line">plot<span class="punctuation">(</span><span class="built_in">log</span><span class="punctuation">(</span>wgt<span class="punctuation">)</span><span class="operator">~</span><span class="built_in">log</span><span class="punctuation">(</span>len<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">     data<span class="operator">=</span>Snap.df<span class="punctuation">,</span></span><br><span class="line">     xlab<span class="operator">=</span><span class="string">&quot;log(Length)&quot;</span><span class="punctuation">,</span></span><br><span class="line">     ylab<span class="operator">=</span><span class="string">&quot;log(Weight)&quot;</span><span class="punctuation">)</span></span><br><span class="line">abline<span class="punctuation">(</span>coef<span class="punctuation">(</span>Snap.lm<span class="punctuation">)</span><span class="punctuation">,</span>lty<span class="operator">=</span><span class="number">5</span><span class="punctuation">,</span> col<span class="operator">=</span><span class="string">&quot;red&quot;</span><span class="punctuation">)</span> <span class="comment"># 添加拟合线</span></span><br><span class="line"><span class="comment"># 在原始尺度上绘图</span></span><br><span class="line">plot<span class="punctuation">(</span>wgt<span class="operator">~</span>len<span class="punctuation">,</span> data <span class="operator">=</span> Snap.df<span class="punctuation">)</span></span><br><span class="line">pred.df <span class="operator">=</span> data.frame<span class="punctuation">(</span>len <span class="operator">=</span> <span class="number">20</span><span class="operator">:</span><span class="number">90</span><span class="punctuation">)</span> <span class="comment"># 创建用于预测的长度序列</span></span><br><span class="line">Snap.pred <span class="operator">=</span> <span class="built_in">exp</span><span class="punctuation">(</span>predict<span class="punctuation">(</span>Snap.lm<span class="punctuation">,</span> pred.df<span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># 预测log(wgt)并反转换回wgt (中位数)</span></span><br><span class="line">lines<span class="punctuation">(</span>pred.df<span class="operator">$</span>len<span class="punctuation">,</span> Snap.pred<span class="punctuation">,</span> col<span class="operator">=</span><span class="string">&quot;red&quot;</span><span class="punctuation">)</span> <span class="comment"># 在原始尺度图上添加拟合曲线</span></span><br><span class="line"><span class="comment"># 预测</span></span><br><span class="line">Pred.df<span class="operator">=</span>data.frame<span class="punctuation">(</span>len<span class="operator">=</span><span class="number">30</span><span class="punctuation">)</span> <span class="comment"># 预测长度为30cm的鲷鱼</span></span><br><span class="line"><span class="comment"># 长度为30cm的鲷鱼的重量中位数</span></span><br><span class="line"><span class="built_in">exp</span><span class="punctuation">(</span>predict<span class="punctuation">(</span></span><br><span class="line">  Snap.lm<span class="punctuation">,</span>Pred.df<span class="punctuation">,</span></span><br><span class="line">  interval<span class="operator">=</span><span class="string">&quot;confidence&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># 对log(wgt)的均值(即log(中位数))进行区间估计，然后反转换</span></span><br><span class="line"><span class="comment"># 一条长度为30cm的鲷鱼的重量 (个体预测)</span></span><br><span class="line"><span class="built_in">exp</span><span class="punctuation">(</span>predict<span class="punctuation">(</span></span><br><span class="line">  Snap.lm<span class="punctuation">,</span>Pred.df<span class="punctuation">,</span></span><br><span class="line">  interval<span class="operator">=</span><span class="string">&quot;prediction&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># 对单个log(wgt)进行区间预测，然后反转换</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重量和长度的关系是立方的吗？ (即检验 log(len) 的系数是否为3)</span></span><br><span class="line">summary<span class="punctuation">(</span>Snap.lm<span class="punctuation">)</span> <span class="comment"># 查看 log(len) 的系数估计值和标准误</span></span><br><span class="line">confint<span class="punctuation">(</span>Snap.lm<span class="punctuation">)</span> <span class="comment"># 查看 log(len) 系数的置信区间，看是否包含3</span></span><br><span class="line"><span class="comment"># 对应的p值是多少？(用于检验 H0: beta1 = 3)</span></span><br><span class="line">beta1 <span class="operator">=</span> coef<span class="punctuation">(</span>Snap.lm<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span> <span class="comment"># 提取 log(len) 的系数估计值</span></span><br><span class="line">seBeta1 <span class="operator">=</span> summary<span class="punctuation">(</span>Snap.lm<span class="punctuation">)</span><span class="operator">$</span>coefficients<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span> <span class="comment"># 提取 log(len) 系数的标准误</span></span><br><span class="line">hyp <span class="operator">=</span> <span class="number">3</span> <span class="comment"># 假设的系数值</span></span><br><span class="line">tstat <span class="operator">=</span> <span class="punctuation">(</span>beta1 <span class="operator">-</span> hyp<span class="punctuation">)</span><span class="operator">/</span>seBeta1 <span class="comment"># 计算t统计量</span></span><br><span class="line">tstat</span><br><span class="line">pval <span class="operator">=</span> <span class="number">2</span> <span class="operator">*</span> <span class="punctuation">(</span><span class="number">1</span> <span class="operator">-</span> pt<span class="punctuation">(</span> <span class="comment"># 计算双边p值</span></span><br><span class="line">  <span class="built_in">abs</span><span class="punctuation">(</span>tstat<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">  df <span class="operator">=</span> nrow<span class="punctuation">(</span>Snap.df<span class="punctuation">)</span> <span class="operator">-</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># df = n - p (p=2, 截距和斜率)</span></span><br><span class="line">pval</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如何解释beta1 (log(len)的系数)</span></span><br><span class="line">confint<span class="punctuation">(</span>Snap.lm<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="punctuation">]</span> <span class="comment"># log(len)系数的置信区间</span></span><br><span class="line"><span class="comment"># 如果x增加1%，那么y的中位数大约增加beta1%。</span></span><br><span class="line"><span class="comment"># (1+0.01)^beta1_hat approx 1 + beta1_hat*0.01</span></span><br><span class="line"><span class="comment"># 所以y的中位数乘以 (1+0.01)^beta1_hat，即增加了 ((1+0.01)^beta1_hat - 1)*100%</span></span><br><span class="line"><span class="number">1.01</span><span class="operator">^</span>confint<span class="punctuation">(</span>Snap.lm<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="punctuation">]</span> <span class="comment"># x增加1% (乘以1.01)，y的中位数乘以的因子范围</span></span><br><span class="line"><span class="comment"># 对于大的百分比变化不适用这种近似解释</span></span><br><span class="line"><span class="comment"># 如果x增加50% (乘以1.5)</span></span><br><span class="line"><span class="number">1.5</span><span class="operator">^</span>confint<span class="punctuation">(</span>Snap.lm<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="punctuation">]</span> <span class="comment"># y的中位数乘以的因子范围</span></span><br><span class="line"><span class="comment"># (1.5^confint(Snap.lm)[2,] - 1) * 100% 是y的中位数增加的百分比范围</span></span><br></pre></td></tr></table></figure>
<h3 id="Lecture-6：包含数值和因子解释变量的线性模型-Linear-Models-with-Numeric-and-Factor-Explanatory-Variables-交互作用模型">Lecture 6：包含数值和因子解释变量的线性模型 (Linear Models with Numeric and Factor Explanatory Variables) - 交互作用模型</h3>
<p>这个lecture主要讨论了<strong>包含一个数值解释变量和一个因子（分类）解释变量的线性模型</strong>，特别是<strong>交互作用模型 (interaction model)</strong>。这与教材 <code>STATS201 book SWU 2023.pdf</code> 第8章“包含数值和因子解释变量的线性模型 第1部分：交互作用模型”  的内容相对应。</p>
<ol>
<li>
<p><strong>交互作用的概念与可视化</strong>:</p>
<ul>
<li>
<p>当一个数值解释变量（如 <code>Test</code> 分数）对响应变量（如 <code>Exam</code> 分数）的影响<strong>取决于</strong>另一个因子解释变量（如 <code>Attend</code> 是否出勤）的水平时，就存在交互作用。</p>
</li>
<li>
<p>通过绘制不同因子水平下的散点图和拟合线来可视化交互作用。例如，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plot(Exam ~ Test, pch = substr(Attend, 1, 1), col = ...)</span><br></pre></td></tr></table></figure>
<p>后，分别为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Attend=&quot;Yes&quot;</span><br></pre></td></tr></table></figure>
<p>和</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Attend=&quot;No&quot;</span><br></pre></td></tr></table></figure>
<p>的学生群体绘制拟合的回归线。如果这两条线不平行，则暗示可能存在交互作用。教材第8章 (第4-9页)展示了类似的可视化。</p>
</li>
</ul>
</li>
<li>
<p><strong>构建交互作用模型</strong>:</p>
<ul>
<li>
<p>在R的 <code>lm()</code> 函数中，交互作用可以通过 <code>X1 * X2</code> 的形式指定，这等价于 <code>X1 + X2 + X1:X2</code>。其中 <code>X1</code> 是数值变量，<code>X2</code> 是因子变量，<code>X1:X2</code> 是交互作用项。</p>
</li>
<li>
<p>模型形式为</p>
<p>Y=β0+β1X1+β2IX2=level2+β3(X1×IX2=level2)+ϵ</p>
<p>(以</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X2</span><br></pre></td></tr></table></figure>
<p>为双水平因子为例)。</p>
<ul>
<li>对于基准水平 (如 <code>Attend=&quot;No&quot;</code>，IAttend=Yes=0)：Y=β0+β1X1+ϵ。</li>
<li>对于另一水平 (如 <code>Attend=&quot;Yes&quot;</code>，IAttend=Yes=1)：Y=(β0+β2)+(β1+β3)X1+ϵ。</li>
<li>β3 代表了因子不同水平下，数值变量 X1 的<strong>斜率差异</strong>。如果 β3 显著不为零，则表明存在交互作用。</li>
</ul>
</li>
<li>
<p>教材第8章 (第11-17页) 详细解释了模型的构建和参数含义。</p>
</li>
</ul>
</li>
<li>
<p><strong>模型诊断</strong>:</p>
<ul>
<li>
<p>与之前的线性模型一样，需要检查残差图 (</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plot(fit, which=1)</span><br></pre></td></tr></table></figure>
<p>for EOV and linearity for each group's fit), 正态性 (</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">normcheck(fit)</span><br></pre></td></tr></table></figure>
<p>), 和强影响点 (</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cooks20x(fit)</span><br></pre></td></tr></table></figure>
<p>). 教材第8章 (第18-20页)也强调了这些步骤。</p>
</li>
</ul>
</li>
<li>
<p><strong>解释交互作用模型</strong>:</p>
<ul>
<li>
<p><code>summary(fit)</code> 会给出交互作用项 (<code>Test:AttendYes</code>) 的系数、标准误、t值和p值。</p>
</li>
<li>
<p>如果交互作用项显著 (p值较小)，则表明数值变量的效应确实因因子变量的水平而异。此时，不能孤立地解释主效应（如<code>Test</code>或<code>Attend</code>的系数），而应分别描述在因子各水平下数值变量的效应。</p>
</li>
<li>
<p>例如，对于<code>Attend=&quot;No&quot;</code>的学生，<code>Test</code>每增加1分，<code>Exam</code>平均增加 β^Test 分。对于<code>Attend=&quot;Yes&quot;</code>的学生，<code>Test</code>每增加1分，<code>Exam</code>平均增加 β^Test+β^Test:AttendYes 分。</p>
</li>
<li>
<pre><code>confint(fit)
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">      可以给出所有参数（包括交互作用项）的置信区间。教材第8章 (第21-28页及32-35页) 提供了详细的解释和置信区间计算。</span><br><span class="line"></span><br><span class="line">5. **不显著的交互作用 (Simpson&#x27;s Paradox 类似情景)**:</span><br><span class="line"></span><br><span class="line">   - 第二个例子（甲状腺重量 `thyroid` vs. 体重 `body` 和处理方式 `trt`）展示了一个重要情况：初始观察 `plot(thyroid ~ trt)` 可能显示因子效应，但在调整了数值协变量 (`body`) 后，并且考虑到交互作用不显著时 (`summary(thyroid.fit)` 显示 `body:trt` 不显著)，主效应模型 (`lm(thyroid ~ body + trt)`) 可能显示因子不再显著。</span><br><span class="line">   - 这是因为因子不同水平间的响应差异可能完全由协变量的差异引起。例如，药物组的老鼠甲状腺较重，可能仅仅因为药物组的老鼠本身就比较重 (`plot(body ~ trt)` 显示药物组老鼠体重较大)。这种情况提示我们在解释因子效应时需要小心控制混淆变量。这部分内容实际上预示了第9章“不含交互作用的模型”的重要性。</span><br><span class="line"></span><br><span class="line">总结来说，Lecture 6 教授了如何在包含数值和因子解释变量时考虑和建模它们之间的交互作用，如何解释这种模型，以及在解释时需注意潜在的混淆效应。</span><br><span class="line"></span><br><span class="line">```r</span><br><span class="line">library(s20x) # 加载s20x包</span><br><span class="line">Stats20x.df = read.table(&quot;STATS20x.txt&quot;, header = T) # 读取数据</span><br><span class="line">Stats20x.df$Attend = as.factor(Stats20x.df$Attend) # 将Attend转换为因子</span><br><span class="line">plot(Exam ~ Test, data = Stats20x.df,</span><br><span class="line">     pch = substr(Attend, 1, 1), cex = 0.7, # 点的形状根据Attend的第一个字母 (&quot;Y&quot;或&quot;N&quot;)</span><br><span class="line">     col = ifelse(Attend == &quot;Yes&quot;, &quot;blue&quot;, &quot;red&quot;)) # 点的颜色根据Attend的值</span><br><span class="line"># Test分数与Exam分数的散点图，</span><br><span class="line"># 表明在每个出勤组（“Yes”或“No”）内，Test和Exam之间的正相关关系是合理线性的，</span><br><span class="line"># 但两组的斜率可能不同。</span><br><span class="line"></span><br><span class="line">## 模型构建和假设检查</span><br><span class="line">examTestAttend.fit = lm(Exam ~ Test * Attend, data = Stats20x.df) # 构建带交互作用的模型</span><br><span class="line"># Test * Attend 等价于 Test + Attend + Test:Attend</span><br><span class="line">plot(examTestAttend.fit, which = 1) # 残差对拟合值图</span><br><span class="line">normcheck(examTestAttend.fit) # 正态性检查</span><br><span class="line">cooks20x(examTestAttend.fit) # 强影响点检查</span><br><span class="line">summary(examTestAttend.fit) # 查看模型摘要</span><br><span class="line">confint(examTestAttend.fit) # 查看系数的置信区间</span><br><span class="line"></span><br><span class="line">## 可视化最终模型</span><br><span class="line">predAttend.df = data.frame(Test = 1:21, Attend = &quot;Yes&quot;) # 为&quot;Yes&quot;组创建预测数据</span><br><span class="line">predSlackers.df = data.frame(Test = 1:21, Attend = &quot;No&quot;) # 为&quot;No&quot;组创建预测数据</span><br><span class="line">plot(Exam ~ Test, data = Stats20x.df,pch = substr(Attend, 1, 1), cex = 0.7,</span><br><span class="line">     col = ifelse(Attend == &quot;Yes&quot;, &quot;blue&quot;, &quot;red&quot;)) # 重新绘制原始散点图</span><br><span class="line">lines(1:21, predict(examTestAttend.fit, predAttend.df), col = &quot;blue&quot;, lty = 2) # 绘制&quot;Yes&quot;组的拟合线</span><br><span class="line">lines(1:21, predict(examTestAttend.fit, predSlackers.df), col = &quot;red&quot;, lty = 2) # 绘制&quot;No&quot;组的拟合线</span><br><span class="line"></span><br><span class="line">thyroid.df = read.table(&quot;Thyroid.txt&quot;, header = TRUE) # 读取甲状腺数据</span><br><span class="line">head(thyroid.df) # 查看数据前几行</span><br><span class="line">str(thyroid.df) # 查看数据结构</span><br><span class="line"># 为药物组vs对照组创建一个因子变量</span><br><span class="line">thyroid.df$trt = with(</span><br><span class="line">  thyroid.df, factor(</span><br><span class="line">    ifelse(group == 1, &quot;control&quot;, &quot;drug&quot;))) # group=1为对照组，否则为药物组</span><br><span class="line"># 这似乎表明药物有用</span><br><span class="line">plot(thyroid ~ trt, data = thyroid.df, xlab = &quot;Treatment&quot;, ylab = &quot;Thyroid weights&quot;) # 甲状腺重量对处理方式的箱线图</span><br><span class="line"># 当以体重为条件时，效果不明显</span><br><span class="line">plot(thyroid ~ body, type = &quot;n&quot;, data = thyroid.df) # 空白散点图框架</span><br><span class="line">text(thyroid.df$body, thyroid.df$thyroid, thyroid.df$group) # 用组别标签绘制点</span><br><span class="line"># 我们应该调整体重差异</span><br><span class="line">thyroid.fit = lm(thyroid ~ body * trt, data = thyroid.df) # 拟合带交互作用的模型</span><br><span class="line">plot(thyroid.fit, which = 1) # 线性性和EOV似乎都还好</span><br><span class="line">normcheck(thyroid.fit) # 正态性可能有问题，可能需要使用模拟</span><br><span class="line">cooks20x(thyroid.fit) # 观测点12是否影响过大？</span><br><span class="line">cooks.distance(thyroid.fit)[12] # 非常接近0.4的阈值</span><br><span class="line">plot(thyroid ~ body, type = &quot;n&quot;, data = thyroid.df) # 重新绘制框架</span><br><span class="line">text(thyroid.df$body, thyroid.df$thyroid, 1:16) # 用观测序号绘制点，以识别影响点</span><br><span class="line"></span><br><span class="line"># 模型构建和假设检查</span><br><span class="line">summary(thyroid.fit) # 交互作用项不显著</span><br><span class="line">thyroid.fit2 = lm(thyroid ~ body + trt, data = thyroid.df) # 拟合无交互作用（加性）模型</span><br><span class="line">summary(thyroid.fit2) # 调整后的R平方证实了这一点</span><br><span class="line"># 处理(trt)似乎不显著</span><br><span class="line">thyroid.fit3 = lm(thyroid ~ body, data = thyroid.df) # 仅用body拟合模型</span><br><span class="line">summary(thyroid.fit3)</span><br><span class="line"># 为什么`trt`不显著？</span><br><span class="line">plot(body ~ trt, data = thyroid.df, main = &quot;&quot;, xlab = &quot;Treatment&quot;, ylab = &quot;Mouse weight&quot;) # 小鼠体重对处理方式的箱线图</span><br><span class="line"># 图中的差异是由于较重的小鼠甲状腺较重，</span><br><span class="line"># 而药物组的小鼠较重。</span><br></pre></td></tr></table></figure>

</code></pre>
</li>
</ul>
</li>
</ol>
<h3 id="Lecture-7">Lecture 7</h3>
<p>这个lecture继续探讨包含一个数值变量 (<code>IQ</code>) 和一个因子变量 (<code>method</code>) 的线性模型，重点关注当<strong>交互作用不显著</strong>时的模型简化和解释。这直接对应教材 <code>STATS201 book SWU 2023.pdf</code> 第9章“包含数值和因子解释变量的线性模型 第2部分：不含交互作用的模型”。</p>
<ol>
<li>
<p><strong>从交互作用模型到主效应模型</strong>:</p>
<ul>
<li>
<p>首先，如Lecture 6所示，拟合一个包含交互作用的模型 (</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lm(lang ~ IQ * method, data = teach.df)</span><br></pre></td></tr></table></figure>
<p>)。</p>
</li>
<li>
<p>使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">anova(teach.fit)</span><br></pre></td></tr></table></figure>
<p>来检验交互作用项的显著性。如果交互作用不显著 (P值较大)，则根据奥卡姆剃刀原则 (Occam's Razor)或KISS原则 (Keep It Simple, Statistician)，应移除交互作用项，简化模型。教材第9章 (第14-18页) 详细讨论了模型选择和奥卡姆剃刀。</p>
</li>
<li>
<p>简化后的模型称为主效应模型或加性模型，形式为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lm(lang ~ IQ + method, data = teach.df)</span><br></pre></td></tr></table></figure>
<p>。在这个模型中，数值变量 (</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IQ</span><br></pre></td></tr></table></figure>
<p>) 的效应（斜率）对于因子变量 (</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">method</span><br></pre></td></tr></table></figure>
<p>) 的所有水平都是相同的，但因子变量的不同水平有不同的截距。在图形上表现为一组平行线。</p>
</li>
</ul>
</li>
<li>
<p><strong>解释主效应模型</strong>:</p>
<ul>
<li>
<pre><code>summary(teach.fit2)
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">会给出主效应模型中 </span><br><span class="line"></span><br></pre></td></tr></table></figure>
IQ
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">的系数 (共同斜率) 和 </span><br><span class="line"></span><br></pre></td></tr></table></figure>
method
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   各水平相对于基准水平的截距差异。 </span><br><span class="line"></span><br><span class="line">- 例如，如果基准是 </span><br><span class="line"></span><br></pre></td></tr></table></figure>
method1
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">     ，模型为E[lang]=β0+β1IQ+β2Imethod=2+β3Imethod=3。</span><br><span class="line"></span><br><span class="line">     - β1 是IQ对语言分数的共同效应。</span><br><span class="line">     - β0 是 `method1` 组在IQ为0时的期望语言分数 (通常IQ为0无实际意义，所以截距的绝对值解释需谨慎，但差异是有意义的)。</span><br><span class="line">     - β2 是 `method2` 组相对于 `method1` 组的平均语言分数差异 (控制IQ后)。</span><br><span class="line">     - β3 是 `method3` 组相对于 `method1` 组的平均语言分数差异 (控制IQ后)。</span><br><span class="line"></span><br><span class="line">   - 教材第9章 (第21页) 描述了这种模型的公式和参数解释。</span><br><span class="line"></span><br><span class="line">3. **更改基准水平 (Releveling)**:</span><br><span class="line"></span><br><span class="line">   - `summary()` 和 `confint()` 的输出是相对于当前基准水平的。为了得到所有因子水平之间的两两比较的置信区间（例如，`method2` vs `method3`），需要更改基准水平并重新拟合模型。</span><br><span class="line"></span><br><span class="line">   - 使用 </span><br><span class="line"></span><br></pre></td></tr></table></figure>
relevel(factor_variable, ref = &quot;new_baseline_level&quot;)
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">来更改基准。例如，</span><br><span class="line"></span><br></pre></td></tr></table></figure>
teach.df$method = relevel(teach.df$method, ref = &quot;2&quot;)
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">将 </span><br><span class="line"></span><br></pre></td></tr></table></figure>
method2
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">      设为新的基准。 </span><br><span class="line"></span><br><span class="line">   - 通过这种方式，可以获得所有配对比较的估计和置信区间。教材第9章 (第28-31页) 演示了如何更改基准水平并解释结果。</span><br><span class="line"></span><br><span class="line">4. **比较包含与不包含协变量的模型**:</span><br><span class="line"></span><br><span class="line">   - 代码中还比较了包含协变量 `IQ` 的模型 (`teach.fit2`) 和不包含 `IQ`、仅有 `method` 的模型 (`teach.fit5`，即单因素方差分析模型)。</span><br><span class="line">   - 通过比较 R2 或调整后的 R2 (`summary(model)$r.squared`, `summary(model)$adj.r.squared`)，可以看出加入协变量 `IQ` 后模型解释变异的百分比是否提高。</span><br><span class="line">   - 通常，如果协变量与响应变量相关，调整它会使得对因子效应的估计更精确（标准误更小），置信区间更窄。</span><br><span class="line"></span><br><span class="line">5. **模型诊断**:</span><br><span class="line"></span><br><span class="line">   - 对于最终选择的主效应模型，仍需进行标准的模型诊断，如检查残差图 (`plot(teach.fit2, which = 1)`), 正态性 (`normcheck(teach.fit2)`), 和强影响点 (`cooks20x(teach.fit2)`).</span><br><span class="line"></span><br><span class="line">总结：Lecture 7 侧重于在多解释变量（一个数值，一个因子）模型中，当交互作用不显著时，如何简化到主效应模型，并如何通过更改因子基准水平来全面解释因子各水平间的差异。同时，也展示了控制协变量的重要性。</span><br><span class="line"></span><br><span class="line">```r</span><br><span class="line">library(s20x) # 加载s20x包</span><br><span class="line">data(teach.df) # 加载s20x包中的teach.df数据集 (教学方法、IQ对语言分数的影响)</span><br><span class="line">head(teach.df) # 查看数据前几行</span><br><span class="line">str(teach.df) # 查看数据结构</span><br><span class="line"># 我们需要将method转换为因子变量</span><br><span class="line">teach.df$method = factor(teach.df$method)</span><br><span class="line">plot(lang ~ IQ, main = &quot;Language Score versus IQ (by method)&quot;, # 语言分数对IQ的散点图，按教学方法分组</span><br><span class="line">     pch = as.character(teach.df$method), data = teach.df) # 点的形状根据方法 (1,2,3)</span><br><span class="line"># 看起来有三条平行线。</span><br><span class="line"># 分数随着IQ的增加而增加，方法2的</span><br><span class="line">#得分最高，方法3得分最低。</span><br><span class="line"># 这些单独线条周围的变异性远低于</span><br><span class="line"># 在分开的图中看到的变异性。</span><br><span class="line"># 这里有方差分析 (Anova) 的思想!!!</span><br><span class="line">teach.fit = lm(lang ~ IQ * method, data = teach.df) # 拟合带交互作用的模型</span><br><span class="line">plot(teach.fit, which = 1) # 残差对拟合值图</span><br><span class="line">normcheck(teach.fit) # 正态性检查</span><br><span class="line">cooks20x(teach.fit) # 强影响点检查</span><br><span class="line">anova(teach.fit) # 方差分析表，用于检验交互作用的显著性</span><br><span class="line">teach.fit2 = lm(lang ~ IQ + method, data = teach.df) # 拟合无交互作用 (加性/主效应) 模型</span><br><span class="line">plot(teach.fit2, which = 1) # 新模型的残差图</span><br><span class="line">normcheck(teach.fit2) # 新模型的正态性检查</span><br><span class="line">cooks20x(teach.fit2) # 新模型的强影响点检查</span><br><span class="line">anova(teach.fit2) # 新模型的方差分析表</span><br><span class="line">summary(teach.fit2) # 查看模型摘要</span><br><span class="line">confint(teach.fit2) # 系数的置信区间</span><br><span class="line"># 无交互作用但截距不同</span><br><span class="line">plot(lang ~ IQ, main = &quot;Language Score versus IQ (by method)&quot;,</span><br><span class="line">     pch = as.character(teach.df$method), data = teach.df) # 重新绘制散点图</span><br><span class="line">abline(teach.fit2$coef[1], teach.fit2$coef[2], lty = 1) # 为基准方法绘制拟合线 (平行线)</span><br><span class="line">abline(teach.fit2$coef[1] + teach.fit2$coef[3], teach.fit2$coef[2], lty = 2) # 为第二个方法绘制拟合线</span><br><span class="line">abline(teach.fit2$coef[1] + teach.fit2$coef[4], teach.fit2$coef[2], lty = 4) # 为第三个方法绘制拟合线</span><br><span class="line"># 更改基准水平以获得方法1的置信区间 (相对于方法2)</span><br><span class="line">teach.df$method = relevel(teach.df$method, ref = &quot;2&quot;) # 将方法2设为基准</span><br><span class="line">teach.fit3 = lm(lang ~ IQ + method, data = teach.df) # 重新拟合模型</span><br><span class="line"># 为什么查看这些模型的截距是有意义的</span><br><span class="line">confint(teach.fit2) # 原基准 (方法1) 下的置信区间</span><br><span class="line">confint(teach.fit3) # 新基准 (方法2) 下的置信区间 (可以得到方法1和方法3相对于方法2的比较)</span><br><span class="line"># 如果不调整IQ会发生什么？(即只用method作为解释变量 - 单因素方差分析)</span><br><span class="line">teach.fit4 = lm(lang ~ method, data = teach.df) # 注意，此时method的基准是&quot;2&quot;</span><br><span class="line">teach.df$method = relevel(teach.df$method, ref = &quot;1&quot;) # 将基准改回方法1</span><br><span class="line">teach.fit5 = lm(lang ~ method, data = teach.df)</span><br><span class="line">teach.df$method = relevel(teach.df$method, ref = &quot;3&quot;) # 将基准改为方法3</span><br><span class="line">teach.fit6 = lm(lang ~ method, data = teach.df)</span><br><span class="line">confint(teach.fit5) # 仅包含method时，各水平与方法1的比较</span><br><span class="line">confint(teach.fit6) # 仅包含method时，各水平与方法3的比较</span><br><span class="line">summary(teach.fit2)$r.squared # 包含IQ和method的模型的R方</span><br><span class="line">summary(teach.fit5)$r.squared # 仅包含method的模型的R方 (比较R方大小)</span><br><span class="line"></span><br><span class="line">summary(teach.fit2)$adj.r.squared # 调整后的R方</span><br><span class="line">summary(teach.fit5)$adj.r.squared # 调整后的R方</span><br></pre></td></tr></table></figure>

</code></pre>
</li>
</ul>
</li>
</ol>
<h3 id="Lecture-8：多重线性回归与共线性问题-Multiple-Linear-Regression-and-Multicollinearity">Lecture 8：多重线性回归与共线性问题 (Multiple Linear Regression and Multicollinearity)</h3>
<p>这个lecture主要涉及<strong>多重线性回归 (Multiple Linear Regression)</strong>，即模型中包含多个解释变量（可以是数值型或因子型），并初步探讨了<strong>多重共线性 (Multicollinearity)</strong> 问题。这与教材 <code>STATS201 book SWU 2023.pdf</code> 第10章 “多重线性回归模型” 的内容一致。代码后半部分还涉及了单因素方差分析 (One-way ANOVA) 和 <code>emmeans</code> 包的使用，这与第11章内容相关。</p>
<p>这个lecture主要涵盖<strong>多重线性回归 (Multiple Linear Regression)</strong> 的模型构建策略、<strong>多重共线性 (Multicollinearity)</strong> 问题，以及<strong>单因素方差分析 (One-way ANOVA)</strong> 中的<strong>多重比较 (Multiple Comparisons)</strong> 问题。</p>
<ol>
<li>
<p><strong>多重线性回归与模型构建策略 (婴儿出生体重案例)</strong>:</p>
<ul>
<li>
<p>初始模型与变量筛选</p>
<p>：当有多个潜在解释变量时，一种策略是先拟合一个包含所有变量的“完整模型” (</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lm(bwt ~ ., data = Babies.df)</span><br></pre></td></tr></table></figure>
<p>)，然后逐步剔除不显著的变量。但这种方法可能因多重共线性而出问题。</p>
</li>
<li>
<p>创建新变量</p>
<p>：有时需要根据理论或数据洞察创建新的解释变量，如从母亲的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">weight</span><br></pre></td></tr></table></figure>
<p>和</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">height</span><br></pre></td></tr></table></figure>
<p>计算出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bmi</span><br></pre></td></tr></table></figure>
<p>。</p>
</li>
<li>
<p>探索性数据分析 (EDA)</p>
<p>：在构建复杂模型前，使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pairs20x()</span><br></pre></td></tr></table></figure>
<p>(或标准</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pairs()</span><br></pre></td></tr></table></figure>
<p>) 和单独的散点图 (</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plot()</span><br></pre></td></tr></table></figure>
<p>,</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lowess()</span><br></pre></td></tr></table></figure>
<p>) 来检查变量间的关系、识别非线性、异常值和潜在的交互作用。</p>
</li>
<li>
<p><strong>处理特殊关系</strong>：婴儿出生体重与孕龄(<code>gestation</code>)的关系呈现“曲棍球棒”形状（先增加后平缓或略降）。代码通过创建一个指示变量 <code>OD</code> (是否逾期，以294天为界) 并拟合交互作用模型 <code>lm(bwt ~ gestation * OD, ...)</code> 来尝试捕捉这种分段线性关系。这在教材第10章 (第17-21页) 有案例说明。</p>
</li>
<li>
<p><strong>逐步回归思想</strong>：代码中通过一系列模型 (<code>bwt.fit</code> 到 <code>bwt.fit9</code>) 展示了逐步添加变量并检查其显著性的过程，这是一种模型选择的方法。移除异常影响点 (<code>Babies.df[-c(239, 820), ]</code>) 也是模型构建的重要一步。教材第10章 (第22-43页) 详细演示了婴儿出生体重数据的逐步建模过程。</p>
</li>
<li>
<p>模型诊断</p>
<p>：对最终选择的模型 (</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bwt.fit9</span><br></pre></td></tr></table></figure>
<p>) 进行了残差图、正态性和影响点检查。</p>
</li>
</ul>
</li>
<li>
<p><strong>多重共线性 (Multicollinearity)</strong>:</p>
<ul>
<li>
<p>当模型中包含高度相关的解释变量时（如同时包含</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">weight</span><br></pre></td></tr></table></figure>
<p>、</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">height</span><br></pre></td></tr></table></figure>
<p>和由它们计算出的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bmi</span><br></pre></td></tr></table></figure>
<p>），会导致参数估计的标准误增大，使得原本可能显著的变量变得不显著。这就是多重共线性问题。</p>
</li>
<li>
<p>代码中 <code>bwt.fit6</code> 的 <code>summary</code> 显示 <code>weight</code>, <code>height</code>, <code>bmi</code> 可能都不显著，而 <code>bwt.fit7</code> (移除了<code>weight</code>) 中 <code>height</code> 和 <code>bmi</code> 变得显著。这是共线性的一个典型表现。教材第10章 (第38-41页) 讨论了这个问题。</p>
</li>
<li>
<p>解决方法通常是移除导致共线性的变量之一，或使用其他降维技术（本课程未深入）。</p>
</li>
</ul>
</li>
<li>
<p><strong>单因素方差分析 (One-way ANOVA) (果蝇寿命案例)</strong>:</p>
<ul>
<li>
<p>当解释变量是一个有多于两个水平的因子时 (如 <code>group</code>)，我们实际上是在进行单因素方差分析。</p>
</li>
<li>
<p><code>lm(days ~ group, data = Fruitfly.df)</code> 拟合模型。</p>
</li>
<li>
<pre><code>anova(ff.fit)
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">给出总的F检验，判断因子 </span><br><span class="line"></span><br></pre></td></tr></table></figure>
group
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">是否显著影响响应变量 </span><br><span class="line"></span><br></pre></td></tr></table></figure>
days
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">     。 </span><br><span class="line"></span><br><span class="line">   - `summary(ff.fit)` 显示各因子水平与基准水平的差异。</span><br><span class="line"></span><br><span class="line">   - 这部分内容与教材第11章 “具有单个多于两个水平的因子解释变量的线性模型（单因素方差分析）” 相关。</span><br><span class="line"></span><br><span class="line">4. **多重比较问题与 `emmeans` (果蝇寿命案例)**:</span><br><span class="line"></span><br><span class="line">   - 当一个因子有多个水平，并且我们想比较所有水平两两之间的均值差异时，会遇到多重比较问题：进行多次假设检验会增加至少犯一次第一类错误（错误地拒绝真实的原假设）的概率。 </span><br><span class="line"></span><br><span class="line">   - 模拟代码部分（`for (i in 1:1000)&#123;...&#125;`) 试图通过模拟演示在原假设为真（即所有组均值相同）的情况下，随机选择的两个组（特别是均值差异最大的两个组）进行比较时，仍有可能观察到“显著”差异的现象，这突显了多重比较校正的必要性。第二个模拟（关于二次模型参数的置信区间覆盖率）说明了单个参数CI的覆盖率约为95%，但所有参数同时被其CI覆盖的概率会更低。</span><br><span class="line"></span><br><span class="line">   - `emmeans` 包 (`library(emmeans)`) 提供了进行多重比较校正的工具。</span><br><span class="line"></span><br><span class="line">   - `emmeans(ff.fit, ~group)` 计算各组的估计边际均值。</span><br><span class="line"></span><br><span class="line">   - ```</span><br><span class="line">     pairs(emmeans_object, infer=TRUE)</span><br></pre></td></tr></table></figure>

 进行所有两两比较，并默认使用Tukey方法调整p值和置信区间，以控制总体错误率。 

</code></pre>
</li>
<li>
<p>教材第11章 (第18-24页) 详细介绍了多重比较问题和使用 <code>emmeans</code> 进行Tukey调整的方法。</p>
</li>
</ul>
</li>
</ol>
<p>总结：Lecture 8 覆盖了多重回归中的实际建模步骤、共线性这一重要问题，并引入了 ANOVA 后进行多重比较的概念和工具，这些都是统计建模中非常核心和实用的技能。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>s20x<span class="punctuation">)</span> <span class="comment"># 加载s20x包</span></span><br><span class="line">Babies.df <span class="operator">=</span> read.table<span class="punctuation">(</span><span class="string">&quot;babies_data.txt&quot;</span><span class="punctuation">,</span> header <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">)</span> <span class="comment"># 读取婴儿出生体重数据</span></span><br><span class="line"><span class="comment"># 拟合完整模型 (包含所有变量)</span></span><br><span class="line">bwt.all.fit <span class="operator">=</span> lm<span class="punctuation">(</span>bwt <span class="operator">~</span> .<span class="punctuation">,</span> data <span class="operator">=</span> Babies.df<span class="punctuation">)</span> <span class="comment"># &quot;.&quot;代表数据框中除响应变量外的所有其他变量</span></span><br><span class="line">summary<span class="punctuation">(</span>bwt.all.fit<span class="punctuation">)</span></span><br><span class="line">bwt.no.age.fit <span class="operator">=</span> lm<span class="punctuation">(</span>bwt <span class="operator">~</span> .<span class="operator">-</span>age<span class="punctuation">,</span> data <span class="operator">=</span> Babies.df<span class="punctuation">)</span> <span class="comment"># 从模型中移除age变量</span></span><br><span class="line">summary<span class="punctuation">(</span>bwt.no.age.fit<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 母亲体重过轻或严重超重</span></span><br><span class="line"><span class="comment"># 会对婴儿健康产生负面影响，</span></span><br><span class="line"><span class="comment"># 但身高或体重都不能直接衡量这一点。</span></span><br><span class="line"><span class="comment"># 让我们从这两个测量值创建BMI (身体质量指数)</span></span><br><span class="line">Babies.df<span class="operator">$</span>bmi <span class="operator">=</span> with<span class="punctuation">(</span>Babies.df<span class="punctuation">,</span> weight<span class="operator">/</span><span class="punctuation">(</span>height<span class="operator">^</span><span class="number">2</span><span class="punctuation">)</span> <span class="operator">*</span> <span class="number">703</span><span class="punctuation">)</span> <span class="comment"># 注意单位转换因子703 (磅/英寸^2)</span></span><br><span class="line"><span class="comment"># 重新拟合新的完整模型 (包含BMI)</span></span><br><span class="line">bwt.all.fit <span class="operator">=</span> lm<span class="punctuation">(</span>bwt <span class="operator">~</span> .<span class="punctuation">,</span> data <span class="operator">=</span> Babies.df<span class="punctuation">)</span> <span class="comment"># 再次拟合所有变量，现在包括了bmi</span></span><br><span class="line">summary<span class="punctuation">(</span>bwt.all.fit<span class="punctuation">)</span></span><br><span class="line">bwt.no.age.fit <span class="operator">=</span> lm<span class="punctuation">(</span>bwt <span class="operator">~</span> .<span class="operator">-</span>age<span class="punctuation">,</span> data <span class="operator">=</span> Babies.df<span class="punctuation">)</span> <span class="comment"># 再次移除age</span></span><br><span class="line">summary<span class="punctuation">(</span>bwt.no.age.fit<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 多重共线性 (当解释变量高度相关时出现的问题)</span></span><br><span class="line"><span class="comment"># 比从完整模型开始更好的方法</span></span><br><span class="line"><span class="comment"># 进行一些探索性分析</span></span><br><span class="line">pairs20x<span class="punctuation">(</span>Babies.df<span class="punctuation">[</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">,</span> <span class="number">5</span><span class="punctuation">,</span> <span class="number">6</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="comment"># 绘制数值变量间的成对关系图 (bwt, gestation, age, height, weight)</span></span><br><span class="line"><span class="comment"># 查看成对关系图，</span></span><br><span class="line"><span class="comment"># 我们发现`bwt`与母亲的`height`和`weight`之间关系较弱。</span></span><br><span class="line"><span class="comment"># 婴儿的孕龄(`gestation`)与其出生体重`bwt`之间有更强的关系，</span></span><br><span class="line"><span class="comment"># 这不足为奇，因为孩子在母亲子宫里的时间越长，</span></span><br><span class="line"><span class="comment"># 孩子就有越多的时间获得营养并成长——直到某个点，</span></span><br><span class="line"><span class="comment"># 然后关系某种程度上“变平”。42周 = 42 * 7 = 294天。</span></span><br><span class="line"><span class="comment"># 母亲的`age`与其孩子的`bwt`之间似乎没有任何关系。</span></span><br><span class="line"><span class="comment"># 让我们更深入地研究`bwt`和`gestation`之间的关系。</span></span><br><span class="line">plot<span class="punctuation">(</span>bwt <span class="operator">~</span> gestation<span class="punctuation">,</span> data <span class="operator">=</span> Babies.df<span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;gray60&quot;</span><span class="punctuation">)</span> <span class="comment"># bwt对gestation的散点图</span></span><br><span class="line">lines<span class="punctuation">(</span>lowess<span class="punctuation">(</span>Babies.df<span class="operator">$</span>gestation<span class="punctuation">,</span>Babies.df<span class="operator">$</span>bwt<span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;tomato&quot;</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span> <span class="comment"># 添加loess平滑曲线</span></span><br><span class="line">text<span class="punctuation">(</span><span class="number">152</span><span class="punctuation">,</span> <span class="number">120</span><span class="punctuation">,</span> <span class="string">&quot;?&quot;</span><span class="punctuation">)</span> <span class="comment"># 标记可能的异常点</span></span><br><span class="line">text<span class="punctuation">(</span><span class="number">185</span><span class="punctuation">,</span> <span class="number">115</span><span class="punctuation">,</span> <span class="string">&quot;?&quot;</span><span class="punctuation">)</span> <span class="comment"># 标记可能的异常点</span></span><br><span class="line">abline<span class="punctuation">(</span>v <span class="operator">=</span> <span class="number">294</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;steelblue&quot;</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span> <span class="comment"># 在294天处画一条垂直线 (孕期转折点)</span></span><br><span class="line"><span class="comment"># 注意，这些图中似乎也有一些“奇怪”的数据点。</span></span><br><span class="line">which<span class="punctuation">(</span>Babies.df<span class="operator">$</span>gestation<span class="operator">&lt;</span><span class="number">200</span><span class="punctuation">)</span> <span class="comment"># 找出孕期小于200天的观测</span></span><br><span class="line"><span class="comment"># 分类(因子)数据变量与婴儿出生体重(`bwt`)之间关系不大。</span></span><br><span class="line">pairs20x<span class="punctuation">(</span>Babies.df<span class="punctuation">[</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">,</span> <span class="number">7</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="comment"># bwt, not.first.born, smokes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 像之前提到的那样创建OD (Overdue Days，是否逾期)</span></span><br><span class="line">Babies.df<span class="operator">$</span>OD <span class="operator">=</span> <span class="built_in">as.numeric</span><span class="punctuation">(</span><span class="punctuation">(</span>Babies.df<span class="operator">$</span>gestation <span class="operator">&gt;</span> <span class="number">294</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># 如果gestation &gt; 294则为1，否则为0</span></span><br><span class="line"><span class="built_in">range</span><span class="punctuation">(</span>Babies.df<span class="operator">$</span>gestation<span class="punctuation">[</span>Babies.df<span class="operator">$</span>OD <span class="operator">==</span> <span class="number">0</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="comment"># 检查OD=0时的孕期范围</span></span><br><span class="line"><span class="built_in">range</span><span class="punctuation">(</span>Babies.df<span class="operator">$</span>gestation<span class="punctuation">[</span>Babies.df<span class="operator">$</span>OD <span class="operator">==</span> <span class="number">1</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="comment"># 检查OD=1时的孕期范围</span></span><br><span class="line">bwt.fit <span class="operator">=</span> lm<span class="punctuation">(</span>bwt <span class="operator">~</span> gestation <span class="operator">*</span> OD<span class="punctuation">,</span> data <span class="operator">=</span> Babies.df<span class="punctuation">)</span> <span class="comment"># 拟合孕龄和是否逾期的交互作用模型 (分段线性)</span></span><br><span class="line">plot<span class="punctuation">(</span>bwt.fit<span class="punctuation">,</span> which <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span> <span class="comment"># 线性性和EOV检查</span></span><br><span class="line">normcheck<span class="punctuation">(</span>bwt.fit<span class="punctuation">)</span> <span class="comment"># 正态性检查</span></span><br><span class="line">cooks20x<span class="punctuation">(</span>bwt.fit<span class="punctuation">)</span> <span class="comment"># 影响点检查 (此时会发现239, 820号点影响大)</span></span><br><span class="line">bwt.fit2 <span class="operator">=</span> lm<span class="punctuation">(</span>bwt <span class="operator">~</span> gestation <span class="operator">*</span> OD<span class="punctuation">,</span> data <span class="operator">=</span> Babies.df<span class="punctuation">[</span><span class="operator">-</span><span class="number">239</span><span class="punctuation">,</span> <span class="punctuation">]</span><span class="punctuation">)</span> <span class="comment"># 移除239号点后重新拟合</span></span><br><span class="line">cooks20x<span class="punctuation">(</span>bwt.fit2<span class="punctuation">)</span> <span class="comment"># 再次检查影响点 (此时会发现原820号点，现819号点影响大)</span></span><br><span class="line">bwt.fit3 <span class="operator">=</span> lm<span class="punctuation">(</span>bwt <span class="operator">~</span> gestation <span class="operator">*</span> OD<span class="punctuation">,</span> data <span class="operator">=</span> Babies.df<span class="punctuation">[</span><span class="operator">-</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">239</span><span class="punctuation">,</span> <span class="number">820</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">]</span><span class="punctuation">)</span> <span class="comment"># 移除239和820号点后重新拟合</span></span><br><span class="line">cooks20x<span class="punctuation">(</span>bwt.fit3<span class="punctuation">)</span> <span class="comment"># 最终影响点检查</span></span><br><span class="line">summary<span class="punctuation">(</span>bwt.fit3<span class="punctuation">)</span> <span class="comment"># 交互作用是显著的</span></span><br><span class="line"></span><br><span class="line">gestation.seq<span class="operator">=</span><span class="number">201</span><span class="operator">:</span><span class="number">360</span> <span class="comment"># 用于预测的孕期序列</span></span><br><span class="line">ODdays.seq<span class="operator">=</span>ifelse<span class="punctuation">(</span>gestation.seq<span class="operator">&lt;=</span><span class="number">294</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">)</span> <span class="comment"># 对应的OD序列 (注意：这里应该是OD，而不是ODdays)</span></span><br><span class="line"><span class="comment"># 代码中ODdays.seq的定义与前面OD的0/1定义一致，用于指示是否进入第二段。</span></span><br><span class="line"><span class="comment"># 但模型bwt.fit3是用 gestation*OD 拟合的。如果想实现分段斜率，</span></span><br><span class="line"><span class="comment"># 需要创建类似 gestation_after_294 = ifelse(gestation &gt; 294, gestation - 294, 0) 的变量。</span></span><br><span class="line"><span class="comment"># 或者如教材P20所示的 (gestation-294)*OD。</span></span><br><span class="line"><span class="comment"># 当前的 gestation*OD 会产生不同的截距和斜率，但不是典型的分段点斜率突变模型。</span></span><br><span class="line"><span class="comment"># 假设这里的目的是可视化两个不同阶段的线性关系（如果OD是0或1）</span></span><br><span class="line">fit.seq<span class="operator">=</span>predict<span class="punctuation">(</span>bwt.fit3<span class="punctuation">,</span>new<span class="operator">=</span>data.frame<span class="punctuation">(</span>gestation<span class="operator">=</span>gestation.seq<span class="punctuation">,</span> OD<span class="operator">=</span>ODdays.seq<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>bwt<span class="operator">~</span>gestation<span class="punctuation">,</span>data<span class="operator">=</span>Babies.df<span class="punctuation">[</span><span class="operator">-</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">239</span><span class="punctuation">,</span> <span class="number">820</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="punctuation">]</span><span class="punctuation">,</span>ylab<span class="operator">=</span><span class="string">&quot;Birth weight (oz)&quot;</span><span class="punctuation">)</span> <span class="comment"># 修正笔误，使用清洗后的数据绘图</span></span><br><span class="line">lines<span class="punctuation">(</span>gestation.seq<span class="punctuation">,</span>fit.seq<span class="punctuation">,</span>col<span class="operator">=</span><span class="string">&quot;red&quot;</span><span class="punctuation">)</span>; abline<span class="punctuation">(</span>v<span class="operator">=</span><span class="number">294</span><span class="punctuation">,</span>lty<span class="operator">=</span><span class="number">2</span><span class="punctuation">,</span>col<span class="operator">=</span><span class="string">&quot;blue&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 当前模型是什么？逐步添加变量</span></span><br><span class="line">bwt.fit4 <span class="operator">=</span> lm<span class="punctuation">(</span>bwt <span class="operator">~</span> gestation <span class="operator">*</span> OD <span class="operator">+</span> weight<span class="punctuation">,</span> data <span class="operator">=</span> Babies.df<span class="punctuation">[</span><span class="operator">-</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">239</span><span class="punctuation">,</span> <span class="number">820</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">summary<span class="punctuation">(</span>bwt.fit4<span class="punctuation">)</span></span><br><span class="line">bwt.fit5 <span class="operator">=</span> lm<span class="punctuation">(</span>bwt <span class="operator">~</span> gestation <span class="operator">*</span> OD <span class="operator">+</span> weight <span class="operator">+</span> height<span class="punctuation">,</span> data <span class="operator">=</span> Babies.df<span class="punctuation">[</span><span class="operator">-</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">239</span><span class="punctuation">,</span> <span class="number">820</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">summary<span class="punctuation">(</span>bwt.fit5<span class="punctuation">)</span></span><br><span class="line">bwt.fit6 <span class="operator">=</span> lm<span class="punctuation">(</span>bwt <span class="operator">~</span> gestation <span class="operator">*</span> OD <span class="operator">+</span> weight <span class="operator">+</span> height <span class="operator">+</span> bmi<span class="punctuation">,</span></span><br><span class="line">              data <span class="operator">=</span> Babies.df<span class="punctuation">[</span><span class="operator">-</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">239</span><span class="punctuation">,</span> <span class="number">820</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">]</span><span class="punctuation">)</span> <span class="comment"># weight和height与bmi同时在模型中，可能导致共线性</span></span><br><span class="line">summary<span class="punctuation">(</span>bwt.fit6<span class="punctuation">)</span> <span class="comment"># 注意weight, height, bmi的显著性可能下降</span></span><br><span class="line">bwt.fit7 <span class="operator">=</span> lm<span class="punctuation">(</span>bwt <span class="operator">~</span> gestation <span class="operator">*</span> OD <span class="operator">+</span> height <span class="operator">+</span> bmi<span class="punctuation">,</span> <span class="comment"># 移除weight，保留height和bmi</span></span><br><span class="line">              data <span class="operator">=</span> Babies.df<span class="punctuation">[</span><span class="operator">-</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">239</span><span class="punctuation">,</span> <span class="number">820</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">summary<span class="punctuation">(</span>bwt.fit7<span class="punctuation">)</span></span><br><span class="line">bwt.fit8 <span class="operator">=</span> lm<span class="punctuation">(</span>bwt <span class="operator">~</span> gestation <span class="operator">*</span> OD <span class="operator">+</span> height <span class="operator">+</span> bmi <span class="operator">+</span> not.first.born<span class="punctuation">,</span></span><br><span class="line">              data <span class="operator">=</span> Babies.df<span class="punctuation">[</span><span class="operator">-</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">239</span><span class="punctuation">,</span> <span class="number">820</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">summary<span class="punctuation">(</span>bwt.fit8<span class="punctuation">)</span></span><br><span class="line">bwt.fit9 <span class="operator">=</span> lm<span class="punctuation">(</span>bwt <span class="operator">~</span> gestation <span class="operator">*</span> OD <span class="operator">+</span> height <span class="operator">+</span> bmi <span class="operator">+</span> not.first.born <span class="operator">+</span> smokes<span class="punctuation">,</span></span><br><span class="line">              data <span class="operator">=</span> Babies.df<span class="punctuation">[</span><span class="operator">-</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">239</span><span class="punctuation">,</span> <span class="number">820</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">]</span><span class="punctuation">)</span> <span class="comment"># 最终模型</span></span><br><span class="line">summary<span class="punctuation">(</span>bwt.fit9<span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>bwt.fit9<span class="punctuation">,</span> which <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span> <span class="comment"># 最终模型的诊断</span></span><br><span class="line">cooks20x<span class="punctuation">(</span>bwt.fit9<span class="punctuation">)</span></span><br><span class="line">normcheck<span class="punctuation">(</span>bwt.fit9<span class="punctuation">)</span></span><br><span class="line">confint<span class="punctuation">(</span>bwt.fit9<span class="punctuation">)</span> <span class="comment"># 最终模型参数的置信区间</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 这部分代码切换到果蝇数据，与前面的婴儿体重数据无关 ---</span></span><br><span class="line"><span class="comment"># 在这项研究中，我们观察雄性果蝇的寿命与其</span></span><br><span class="line"><span class="comment"># 生殖活动的关系。</span></span><br><span class="line">Fruitfly.df <span class="operator">=</span> read.csv<span class="punctuation">(</span><span class="string">&quot;Fruitfly.csv&quot;</span><span class="punctuation">,</span> stringsAsFactors<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">)</span> <span class="comment"># 读取果蝇数据</span></span><br><span class="line">plot<span class="punctuation">(</span>days <span class="operator">~</span> group<span class="punctuation">,</span> data <span class="operator">=</span> Fruitfly.df<span class="punctuation">)</span> <span class="comment"># 寿命对分组的箱线图</span></span><br><span class="line"><span class="comment"># + &quot;G1&quot;: 独居雄性,</span></span><br><span class="line"><span class="comment"># + &quot;G2&quot;: 与1只感兴趣的雌性同住的雄性,</span></span><br><span class="line"><span class="comment"># + &quot;G3&quot;: 与8只感兴趣的雌性同住的雄性,</span></span><br><span class="line"><span class="comment"># + &quot;G4&quot;: 与1只不感兴趣的雌性同住的雄性,</span></span><br><span class="line"><span class="comment"># + &quot;G5&quot;: 与8只不感兴趣的雌性同住的雄性,</span></span><br><span class="line">summaryStats<span class="punctuation">(</span>days <span class="operator">~</span> group<span class="punctuation">,</span> Fruitfly.df<span class="punctuation">)</span> <span class="comment"># 按组计算描述统计</span></span><br><span class="line">ff.fit <span class="operator">=</span> lm<span class="punctuation">(</span>days <span class="operator">~</span> group<span class="punctuation">,</span> data <span class="operator">=</span> Fruitfly.df<span class="punctuation">)</span> <span class="comment"># 单因素方差分析模型</span></span><br><span class="line">summary<span class="punctuation">(</span>ff.fit<span class="punctuation">)</span> <span class="comment"># 查看模型摘要</span></span><br><span class="line">anova<span class="punctuation">(</span>ff.fit<span class="punctuation">)</span> <span class="comment"># 查看方差分析表</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 这部分是关于多重比较问题的模拟，与前面的具体数据集分析目的不同 ---</span></span><br><span class="line">m <span class="operator">=</span> <span class="number">6</span> <span class="comment"># 类别数量</span></span><br><span class="line">n <span class="operator">=</span> <span class="number">30</span> <span class="comment"># 每个类别中的样本量</span></span><br><span class="line">count1 <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>i <span class="keyword">in</span> <span class="number">1</span><span class="operator">:</span><span class="number">1000</span><span class="punctuation">)</span><span class="punctuation">&#123;</span> <span class="comment"># 模拟1000次</span></span><br><span class="line">  y <span class="operator">=</span> rnorm<span class="punctuation">(</span>m<span class="operator">*</span>n<span class="punctuation">,</span> mean <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> sd <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span> <span class="comment"># 生成数据 (所有组均值都为0)</span></span><br><span class="line">  w <span class="operator">=</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="built_in">LETTERS</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span>m<span class="punctuation">]</span><span class="punctuation">,</span> each <span class="operator">=</span> n<span class="punctuation">)</span> <span class="comment"># 创建分组变量</span></span><br><span class="line">  table <span class="operator">=</span> aggregate<span class="punctuation">(</span>y<span class="punctuation">,</span> <span class="built_in">list</span><span class="punctuation">(</span>w<span class="punctuation">)</span><span class="punctuation">,</span> FUN<span class="operator">=</span>mean<span class="punctuation">)</span> <span class="comment"># 计算各组均值</span></span><br><span class="line">  min.index <span class="operator">=</span> which.min<span class="punctuation">(</span>table<span class="operator">$</span>x<span class="punctuation">)</span> <span class="comment"># 找到均值最小的组</span></span><br><span class="line">  max.index <span class="operator">=</span> which.max<span class="punctuation">(</span>table<span class="operator">$</span>x<span class="punctuation">)</span> <span class="comment"># 找到均值最大的组</span></span><br><span class="line">  sim_data <span class="operator">=</span> data.frame<span class="punctuation">(</span>y<span class="operator">=</span>y<span class="punctuation">,</span> w <span class="operator">=</span> w<span class="punctuation">)</span></span><br><span class="line">  <span class="comment"># model = lm(formula = y~w, data = sim_data)</span></span><br><span class="line">  <span class="comment"># 将均值最小和最大的组作为对比的基准 (这是一种特定的比较策略，可能用于放大差异)</span></span><br><span class="line">  w <span class="operator">=</span> factor<span class="punctuation">(</span>w<span class="punctuation">,</span> levels <span class="operator">=</span> unique<span class="punctuation">(</span><span class="built_in">LETTERS</span><span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span>min.index<span class="punctuation">,</span>max.index<span class="punctuation">,</span> <span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span>m<span class="punctuation">)</span><span class="punctuation">[</span><span class="operator">-</span><span class="built_in">c</span><span class="punctuation">(</span>min.index<span class="punctuation">,</span> max.index<span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># 重新定义因子水平顺序</span></span><br><span class="line">  sim_data <span class="operator">=</span> data.frame<span class="punctuation">(</span>y<span class="operator">=</span>y<span class="punctuation">,</span> w <span class="operator">=</span> w<span class="punctuation">)</span></span><br><span class="line">  model <span class="operator">=</span> lm<span class="punctuation">(</span>formula <span class="operator">=</span> y<span class="operator">~</span>w<span class="punctuation">,</span> data <span class="operator">=</span> sim_data<span class="punctuation">)</span></span><br><span class="line">  summary<span class="punctuation">(</span>model<span class="punctuation">)</span></span><br><span class="line">  <span class="comment"># model = lm(formula = y~w, data = sim_data,</span></span><br><span class="line">  <span class="comment">#           subset = (w==(LETTERS[min.index])|w==(LETTERS[max.index]))) # 这行被注释掉了</span></span><br><span class="line">  <span class="comment"># 检查第二个系数（通常是与基准组的第一个比较）的置信区间是否包含0</span></span><br><span class="line">  <span class="comment"># 这里可能是想看在真实均值无差异的情况下，随机抽样有多少次会“发现”显著差异</span></span><br><span class="line">  <span class="comment"># 注意：这里count1的逻辑比较复杂，它是在测试第二个系数的置信区间是否覆盖0</span></span><br><span class="line">  <span class="comment"># 如果真实情况是所有组均值相同，那么任何比较的真实差异都是0。</span></span><br><span class="line">  <span class="comment"># 如果置信区间包含0，则表示未拒绝H0: diff=0。</span></span><br><span class="line">  <span class="comment"># 所以这里count1如果统计的是 (confint(model)[2,1] &lt; 0 &amp; confint(model)[2,2] &gt; 0)，即区间包含0，</span></span><br><span class="line">  <span class="comment"># 那么 count1/1000 应该是对 &quot;在H0为真时，未能拒绝H0的比例&quot;，但这不直接是alpha或beta。</span></span><br><span class="line">  <span class="comment"># 如果是 !as.numeric(...) 则是在统计第一类错误的发生率。</span></span><br><span class="line">  <span class="comment"># 原始代码 as.numeric(...) 表示CI包含0的次数。</span></span><br><span class="line">  count1 <span class="operator">=</span> count1 <span class="operator">+</span> <span class="built_in">as.numeric</span><span class="punctuation">(</span>confint<span class="punctuation">(</span>model<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">&lt;</span> <span class="number">0</span> <span class="operator">&amp;</span> confint<span class="punctuation">(</span>model<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span> <span class="operator">&gt;</span> <span class="number">0</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">count1<span class="operator">/</span><span class="number">1000</span> <span class="comment"># 结果应接近0.95，如果count1是统计“CI包含0的次数”</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 另一段模拟代码，关于置信区间覆盖真实参数的比例 ---</span></span><br><span class="line">sample.size <span class="operator">=</span> <span class="number">20</span></span><br><span class="line">x <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span>sample.size;</span><br><span class="line">beta0 <span class="operator">=</span> <span class="number">3</span>; beta1 <span class="operator">=</span> <span class="number">0.2</span>; beta2 <span class="operator">=</span> <span class="number">0.1</span> <span class="comment"># 真实参数</span></span><br><span class="line">m <span class="operator">=</span> <span class="number">10000</span> <span class="comment"># 模拟次数</span></span><br><span class="line">count0 <span class="operator">=</span> <span class="number">0</span> <span class="comment"># 记录beta0的CI覆盖真实值的次数</span></span><br><span class="line">count1 <span class="operator">=</span> <span class="number">0</span> <span class="comment"># 记录beta1的CI覆盖真实值的次数</span></span><br><span class="line">count2 <span class="operator">=</span> <span class="number">0</span> <span class="comment"># 记录beta2的CI覆盖真实值的次数</span></span><br><span class="line">count <span class="operator">=</span> <span class="number">0</span> <span class="comment"># 记录所有参数的CI同时覆盖真实值的次数</span></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>i <span class="keyword">in</span> <span class="number">1</span><span class="operator">:</span>m<span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  error <span class="operator">=</span> rnorm<span class="punctuation">(</span>n <span class="operator">=</span> sample.size<span class="punctuation">,</span> mean <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> sd <span class="operator">=</span> <span class="number">3</span><span class="punctuation">)</span></span><br><span class="line">  y <span class="operator">=</span> beta0 <span class="operator">+</span> beta1 <span class="operator">*</span> x <span class="operator">+</span> beta2 <span class="operator">*</span> x<span class="operator">^</span><span class="number">2</span> <span class="operator">+</span> error <span class="comment"># 二次模型</span></span><br><span class="line">  sim_data <span class="operator">=</span> data.frame<span class="punctuation">(</span>x<span class="operator">=</span>x<span class="punctuation">,</span> y<span class="operator">=</span>y<span class="punctuation">)</span></span><br><span class="line">  model <span class="operator">=</span> lm<span class="punctuation">(</span>formula <span class="operator">=</span> y<span class="operator">~</span>x<span class="operator">+</span>I<span class="punctuation">(</span>x<span class="operator">^</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> data <span class="operator">=</span> sim_data<span class="punctuation">)</span> <span class="comment"># 拟合二次模型</span></span><br><span class="line">  <span class="comment"># confint(model) # 这里不需要打印</span></span><br><span class="line">  count0 <span class="operator">=</span> count0 <span class="operator">+</span> <span class="built_in">as.numeric</span><span class="punctuation">(</span>confint<span class="punctuation">(</span>model<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">&lt;</span> beta0 <span class="operator">&amp;</span> confint<span class="punctuation">(</span>model<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span> <span class="operator">&gt;</span> beta0<span class="punctuation">)</span></span><br><span class="line">  count1 <span class="operator">=</span> count1 <span class="operator">+</span> <span class="built_in">as.numeric</span><span class="punctuation">(</span>confint<span class="punctuation">(</span>model<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">&lt;</span> beta1 <span class="operator">&amp;</span> confint<span class="punctuation">(</span>model<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span> <span class="operator">&gt;</span> beta1<span class="punctuation">)</span></span><br><span class="line">  count2 <span class="operator">=</span> count2 <span class="operator">+</span> <span class="built_in">as.numeric</span><span class="punctuation">(</span>confint<span class="punctuation">(</span>model<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">3</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">&lt;</span> beta2 <span class="operator">&amp;</span> confint<span class="punctuation">(</span>model<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">3</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span> <span class="operator">&gt;</span> beta2<span class="punctuation">)</span></span><br><span class="line">  count <span class="operator">=</span> count <span class="operator">+</span> <span class="built_in">as.numeric</span><span class="punctuation">(</span> <span class="comment"># 同时覆盖</span></span><br><span class="line">    confint<span class="punctuation">(</span>model<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">&lt;</span> beta0 <span class="operator">&amp;</span> confint<span class="punctuation">(</span>model<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span> <span class="operator">&gt;</span> beta0</span><br><span class="line">    <span class="operator">&amp;</span></span><br><span class="line">      confint<span class="punctuation">(</span>model<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">&lt;</span> beta1 <span class="operator">&amp;</span> confint<span class="punctuation">(</span>model<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span> <span class="operator">&gt;</span> beta1</span><br><span class="line">    <span class="operator">&amp;</span></span><br><span class="line">      confint<span class="punctuation">(</span>model<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">3</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">&lt;</span> beta2 <span class="operator">&amp;</span> confint<span class="punctuation">(</span>model<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">3</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span> <span class="operator">&gt;</span> beta2</span><br><span class="line">  <span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">count0<span class="operator">/</span>m <span class="comment"># beta0的CI覆盖率，应接近0.95</span></span><br><span class="line">count1<span class="operator">/</span>m <span class="comment"># beta1的CI覆盖率，应接近0.95</span></span><br><span class="line">count2<span class="operator">/</span>m <span class="comment"># beta2的CI覆盖率，应接近0.95</span></span><br><span class="line">count<span class="operator">/</span>m <span class="comment"># 所有参数联合CI覆盖率，会低于0.95 (Bonferroni不等式相关概念)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 回到果蝇数据，使用emmeans进行多重比较 ---</span></span><br><span class="line">library<span class="punctuation">(</span>emmeans<span class="punctuation">)</span> <span class="comment"># 加载emmeans包</span></span><br><span class="line">Fruitfly.emm <span class="operator">=</span> emmeans<span class="punctuation">(</span>ff.fit<span class="punctuation">,</span> <span class="operator">~</span>group<span class="punctuation">)</span> <span class="comment"># 计算各组的边际均值</span></span><br><span class="line"><span class="comment"># 查看所有成对比较：</span></span><br><span class="line">pairs<span class="punctuation">(</span>Fruitfly.emm<span class="punctuation">,</span> infer<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">)</span> <span class="comment"># infer=T 会给出调整后的p值和置信区间 (默认Tukey)</span></span><br><span class="line"><span class="comment"># 仅查看在5%水平下显著的比较：</span></span><br><span class="line">Fruitfly.pairs <span class="operator">=</span> data.frame<span class="punctuation">(</span>pairs<span class="punctuation">(</span>Fruitfly.emm<span class="punctuation">,</span> infer<span class="operator">=</span><span class="built_in">T</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># 转换为数据框以便筛选</span></span><br><span class="line">subset<span class="punctuation">(</span>Fruitfly.pairs<span class="punctuation">,</span> p.value<span class="operator">&lt;</span><span class="number">0.05</span><span class="punctuation">)</span> <span class="comment"># 筛选p值小于0.05的比较</span></span><br></pre></td></tr></table></figure>
<h3 id="Lecture-9：双因子方差分析-Two-way-ANOVA">Lecture 9：双因子方差分析 (Two-way ANOVA)</h3>
<p>这个lecture深入探讨了包含<strong>两个因子（分类）解释变量的线性模型</strong>，即<strong>双因素方差分析 (Two-way ANOVA)</strong>。核心内容包括交互作用的识别、建模、解释以及不同参数化方式的理解。这与教材 <code>STATS201 book SWU 2023.pdf</code> 第12章“包含两个解释因子变量的线性模型（双因素方差分析）”的内容完全对应。</p>
<ol>
<li>
<p><strong>交互作用图 (Interaction Plots)</strong>:</p>
<ul>
<li>
<p>使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">interactionPlots(Response ~ FactorA + FactorB, data = df)</span><br></pre></td></tr></table></figure>
<p>(来自</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s20x</span><br></pre></td></tr></table></figure>
<p>包) 来可视化两个因子变量对一个数值响应变量的联合影响。</p>
</li>
<li>
<p>图中的线条代表一个因子的不同水平，x轴是另一个因子的水平，y轴是响应变量的均值。</p>
</li>
<li>
<p>如果线条不平行，则暗示两个因子之间可能存在交互作用，意味着一个因子对响应变量的影响方式取决于另一个因子的水平。 如果线条大致平行，则交互作用可能不显著。</p>
</li>
<li>
<p>教材第12章 (第9-11页) 展示并解释了这种图。</p>
</li>
</ul>
</li>
<li>
<p><strong>双因素ANOVA模型的拟合与检验</strong>:</p>
<ul>
<li>
<p>交互作用模型</p>
<p>：首先拟合包含交互作用项的模型：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lm(Exam ~ Attend * Pass.test, data = Stats20x.df)</span><br></pre></td></tr></table></figure>
<p>，这等价于</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lm(Exam ~ Attend + Pass.test + Attend:Pass.test, ...)</span><br></pre></td></tr></table></figure>
<p>。</p>
</li>
<li>
<p>检验交互作用</p>
<p>：使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">anova(Exam.fit)</span><br></pre></td></tr></table></figure>
<p>查看方差分析表。交互作用项 (如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Attend:Pass.test</span><br></pre></td></tr></table></figure>
<p>) 的F检验的P值用于判断交互作用是否显著。</p>
</li>
<li>
<p>模型简化</p>
<p>：如果交互作用不显著 (P值较大)，则根据奥卡姆剃刀原则，移除交互作用项，拟合</p>
<p>主效应模型(或称加性模型)：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lm(Exam ~ Attend + Pass.test, data = Stats20x.df)</span><br></pre></td></tr></table></figure>
<p>。然后进一步检查各主效应的显著性。</p>
</li>
<li>
<p>代码中首先分析了 <code>Attend</code> 和 <code>Gender</code> 的模型，发现交互作用不显著，然后逐步简化。之后分析了 <code>Attend</code> 和 <code>Pass.test</code>，发现交互作用显著。</p>
</li>
<li>
<p>教材第12章 (第16页，第33-34页) 讨论了交互作用的检验和模型简化。</p>
</li>
</ul>
</li>
<li>
<p><strong>模型参数化与解释</strong>:</p>
<ul>
<li>
<p><strong>参考水平模型 (哑变量编码)</strong>：<code>summary(Exam.fit)</code> 显示的系数是相对于各因子的基准水平的。交互作用项的系数表示当两个因子都处于非基准水平时，相对于仅考虑主效应的额外效应或协同效应。教材第12章 (第18页，第40页) 有详细解释。</p>
</li>
<li>
<p>单元格均值模型 (Group Means Model)：通过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lm(Exam ~ Attend:Pass.test - 1, ...)</span><br></pre></td></tr></table></figure>
<p>可以直接估计每个因子组合（单元格）的均值。代码中演示了这种模型的系数 (</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mu_ij</span><br></pre></td></tr></table></figure>
<p>) 与参考水平模型系数 (</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">beta_k</span><br></pre></td></tr></table></figure>
<p>) 之间的关系。教材第12章 (第19页) 提到了这种模型。</p>
</li>
<li>
<p><strong>效应模型 (Effects Model)</strong>：另一种参数化是将各效应表示为与总体均值的偏差 (主效应 αi,πj) 和交互效应 (alphapiij)。代码中手动计算了这些效应，并与 <code>emmeans</code> 的输出进行了概念上的联系。教材第12章 (第46-48页) 讨论了这种参数化。</p>
</li>
</ul>
</li>
<li>
<p><strong>多重比较 (Pairwise Comparisons)</strong>:</p>
<ul>
<li>
<p>当交互作用显著时，通常我们关心的是在某个因子的特定水平下，另一个因子不同水平之间的差异；或者比较特定的因子组合。</p>
</li>
<li>
<p><code>emmeans</code> 包用于计算调整后的边际均值 (Estimated Marginal Means) 并进行两两比较。</p>
</li>
<li>
<pre><code>pairs(emmeans(Exam.fit, ~Attend*Pass.test), infer=T)
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">      会给出所有因子组合的两两比较，并使用Tukey等方法调整P值和置信区间以控制族错误率 (family-wise error rate)。</span><br><span class="line"></span><br><span class="line">   - `displayPairs()` (来自 `s20x` 包) 可以更清晰地展示特定条件下的两两比较。</span><br><span class="line"></span><br><span class="line">   - 教材第12章 (第22-25页) 详细介绍了如何使用 `emmeans` 和 `displayPairs`。</span><br><span class="line"></span><br><span class="line">总结：Lecture 9 详细介绍了双因素方差分析的完整流程，从可视化交互作用、拟合模型、检验交互作用的显著性，到不同模型参数化的理解和使用 `emmeans` 进行多重比较，这些都是分析具有多个分类预测变量数据的重要方法。</span><br><span class="line"></span><br><span class="line">```r</span><br><span class="line"># 我们希望确定规律上课</span><br><span class="line"># 并且通过测试是否与考试成绩相关。</span><br><span class="line"># 我们已经分别看到</span><br><span class="line"># 通过测试和规律上课</span><br><span class="line"># 会增加取得好考试成绩的机会</span><br><span class="line">library(s20x) # 加载s20x包</span><br><span class="line">Stats20x.df = read.table(&quot;STATS20x.txt&quot;, header = T) # 读取学生数据</span><br><span class="line">head(Stats20x.df) # 查看数据前几行</span><br><span class="line">interactionPlots(Exam ~ Attend + Gender, data = Stats20x.df) # 绘制 Exam 对 Attend 和 Gender 的交互作用图</span><br><span class="line"># 平行线表明没有交互作用</span><br><span class="line">Exam.gender.fit = lm(Exam ~ Attend*Gender, data = Stats20x.df) # 拟合 Attend 和 Gender 的交互作用模型</span><br><span class="line">plot(Exam.gender.fit, which = 1) # 残差图</span><br><span class="line">normcheck(Exam.gender.fit) # 正态性检查</span><br><span class="line">cooks20x(Exam.gender.fit) # 影响点检查</span><br><span class="line">anova(Exam.gender.fit) # 方差分析表，检查交互作用项 Attend:Gender 的显著性</span><br><span class="line">summary(Exam.gender.fit) # 注意这里的p值与anova表中交互作用项的p值应一致</span><br><span class="line">Exam.gender.no.intact.fit = lm(Exam ~ Attend+Gender, data = Stats20x.df) # 如果交互作用不显著，拟合主效应模型</span><br><span class="line">anova(Exam.gender.no.intact.fit) # 主效应模型的方差分析表</span><br><span class="line">summary(Exam.gender.no.intact.fit) # 主效应模型的摘要</span><br><span class="line">Exam.attend.fit = lm(Exam ~ Attend, data = Stats20x.df) # 如果Gender也不显著，进一步简化模型</span><br><span class="line">summary(Exam.attend.fit)</span><br><span class="line"></span><br><span class="line"># 现在考虑二元的test结果和出勤情况</span><br><span class="line"># 所以，我们需要使用`Test`变量</span><br><span class="line"># 创建变量`Pass.test`</span><br><span class="line">Stats20x.df$Pass.test = factor(</span><br><span class="line">  ifelse(Stats20x.df$Test &gt;= 10, &quot;pass&quot;, &quot;nopass&quot;)) # Test&gt;=10为pass，否则为nopass</span><br><span class="line"># 检查新变量`Pass.test`是否正确生成</span><br><span class="line">min(Stats20x.df$Test[Stats20x.df$Pass.test == &quot;pass&quot;])</span><br><span class="line">max(Stats20x.df$Test[Stats20x.df$Pass.test == &quot;nopass&quot;])</span><br><span class="line">interactionPlots(Exam ~ Pass.test + Attend, data = Stats20x.df) # Exam 对 Pass.test 和 Attend 的交互作用图</span><br><span class="line"># 也反过来看交互作用图：</span><br><span class="line">interactionPlots(Exam ~ Attend + Pass.test, data = Stats20x.df) # Exam 对 Attend 和 Pass.test 的交互作用图</span><br><span class="line"># 通过测试的学生的考试分数</span><br><span class="line"># 比未通过测试的学生的分数要高。</span><br><span class="line"># 然而，这种差异对于那些</span><br><span class="line"># 规律上课的学生来说似乎更大，</span><br><span class="line"># 这可以从交互图中不平行的彩色线条看出。</span><br><span class="line"># 换句话说，通过测试的影响似乎</span><br><span class="line"># 因出勤组而异，这表明</span><br><span class="line"># 两个预测变量之间可能存在交互作用。</span><br><span class="line">Exam.fit = lm(Exam ~ Attend * Pass.test, data = Stats20x.df) # 拟合Attend和Pass.test的交互作用模型</span><br><span class="line"># 模型公式也可以是 `Exam ~ Attend + Pass.test + Attend:Pass.test`</span><br><span class="line">plot(Exam.fit,1) # 残差图</span><br><span class="line">normcheck(Exam.fit) # 正态性检查</span><br><span class="line">cooks20x(Exam.fit) # 影响点检查</span><br><span class="line">anova(Exam.fit) # 查看交互作用 Attend:Pass.test 是否显著</span><br><span class="line">1-30968.4/(7630.8+11076.9+909.7+30968.4) # 手动计算R^2 ( (TSS-RSS)/TSS )</span><br><span class="line">summary(Exam.fit) # 模型摘要</span><br><span class="line"># 组均值模型 (无整体截距，为每个组合估计一个均值)</span><br><span class="line">Exam.fitNoBaseline=lm(</span><br><span class="line">  Exam~Attend:Pass.test-1,data=Stats20x.df) # Attend:Pass.test-1 表示所有组合的均值</span><br><span class="line">summary(Exam.fitNoBaseline)</span><br><span class="line"># 参数化：beta (效应编码/哑变量编码) 和 mu_ij (单元格均值编码) 之间的关系 (参考水平)</span><br><span class="line">beta0 = coef(Exam.fit)[1] # 基准组(AttendNo, TestNopass)的均值</span><br><span class="line">beta1 = coef(Exam.fit)[2] # AttendYes相对于AttendNo的效应 (当TestNopass时)</span><br><span class="line">beta2 = coef(Exam.fit)[3] # TestPass相对于TestNopass的效应 (当AttendNo时)</span><br><span class="line">beta3 = coef(Exam.fit)[4] # 交互作用效应</span><br><span class="line">mu11 = coef(Exam.fitNoBaseline)[1] # AttendNo,TestNopass 的均值</span><br><span class="line">print(c(mu11,beta0)) # mu11 应该等于 beta0</span><br><span class="line">mu21 = coef(Exam.fitNoBaseline)[2] # AttendYes, TestNopass 的均值</span><br><span class="line">print(c(mu21,beta1+beta0)) # mu21 应该等于 beta0+beta1</span><br><span class="line">mu12 = coef(Exam.fitNoBaseline)[3] # AttendNo, TestPass 的均值</span><br><span class="line">print(c(mu12,beta2+beta0)) # mu12 应该等于 beta0+beta2</span><br><span class="line">mu22 = coef(Exam.fitNoBaseline)[4] # AttendYes, TestPass 的均值</span><br><span class="line">print(c(mu22,beta3+beta2+beta1+beta0)) # mu22 应该等于 beta0+beta1+beta2+beta3</span><br><span class="line"># 多重比较</span><br><span class="line">library(emmeans) # 加载emmeans包</span><br><span class="line">Exam.pairs = pairs(</span><br><span class="line">  emmeans(Exam.fit, ~Attend*Pass.test), infer=T) # 计算所有处理组合的边际均值并进行两两比较</span><br><span class="line">Exam.pairs</span><br><span class="line"># 效应参数化 (与整体均值的偏差)</span><br><span class="line">mu = mean(Stats20x.df$Exam) # 总体均值</span><br><span class="line">mu1dot = mean(c(mu11,mu12)) # AttendNo的边际均值 (平均了Pass.test的水平)</span><br><span class="line">mu2dot = mean(c(mu21,mu22)) # AttendYes的边际均值</span><br><span class="line">emmeans(Exam.fit,~Attend) # 使用emmeans计算Attend的边际均值</span><br><span class="line">mudot1 = mean(c(mu11,mu21)) # TestNopass的边际均值 (平均了Attend的水平)</span><br><span class="line">mudot2 = mean(c(mu12,mu22)) # TestPass的边际均值</span><br><span class="line">emmeans(Exam.fit,~Pass.test) # 使用emmeans计算Pass.test的边际均值</span><br><span class="line"></span><br><span class="line"># 行效应 (Attend的效应)</span><br><span class="line">alpha1 = mu1dot - mu # AttendNo的效应 = AttendNo的边际均值 - 总体均值</span><br><span class="line">alpha2 = mu2dot - mu # AttendYes的效应</span><br><span class="line"># 列效应 (Pass.test的效应)</span><br><span class="line">pi1 = mudot1 - mu # TestNopass的效应</span><br><span class="line">pi2 = mudot2 - mu # TestPass的效应</span><br><span class="line"># 交互作用效应</span><br><span class="line">alphapi11 = mu11 - mu - alpha1 - pi1 # AttendNo &amp; TestNopass 的交互效应</span><br><span class="line">alphapi21 = mu21 - mu - alpha2 - pi1 # AttendYes &amp; TestNopass 的交互效应</span><br><span class="line">alphapi12 = mu12 - mu - alpha1 - pi2 # AttendNo &amp; TestPass 的交互效应</span><br><span class="line">alphapi22 = mu22 - mu - alpha2 - pi2 # AttendYes &amp; TestPass 的交互效应</span><br></pre></td></tr></table></figure>

</code></pre>
</li>
</ul>
</li>
</ol>
<h3 id="Lecture-10：广义线性模型-Generalized-Linear-Models-Poisson-和-Binomial-回归">Lecture 10：广义线性模型 (Generalized Linear Models) - Poisson 和 Binomial 回归</h3>
<p>这个lecture主要介绍<strong>广义线性模型 (Generalized Linear Models, GLMs)</strong>，特别是用于处理<strong>计数数据 (count data)</strong> 的 <strong>Poisson回归</strong>和用于处理<strong>比例/二元数据 (proportion/binary data)</strong> 的 <strong>Binomial回归 (Logistic回归)</strong>。它强调了在响应变量不满足正态分布和方差齐性假设时，直接使用普通线性模型（LM）的局限性，并引入了GLM作为更合适的工具。这与教材 <code>STATS201 book SWU 2023.pdf</code> 第13章“使用泊松分布建模计数数据”和第15章“使用二项分布建模比例数据”的内容一致。</p>
<ol>
<li>
<p><strong>计数数据的特点与分布</strong>:</p>
<ul>
<li>
<p>Poisson 分布</p>
<p>: 介绍Poisson分布是描述在一定时间或空间内随机独立事件发生次数的经典概率分布，其特点是均值等于方差 (</p>
<p>μ=σ2</p>
<p>)。代码通过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpois()</span><br></pre></td></tr></table></figure>
<p>和</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpois()</span><br></pre></td></tr></table></figure>
<p>展示了Poisson分布的形状如何随均值μ变化，并与正态分布进行比较，说明当μ较小时，Poisson分布是右偏的，当μ较大时，它近似于正态分布。这对应教材第13章“泊松分布” (第20-27页)。</p>
</li>
<li>
<p><strong>Binomial 分布</strong>: 简要提及了二项分布（<code>dbinom()</code>），并与正态分布比较，为后续的Logistic回归做铺垫。</p>
</li>
</ul>
</li>
<li>
<p><strong>传统线性模型 (LM) 处理计数数据的局限性</strong>:</p>
<ul>
<li>
<p>直接用LM拟合计数数据（如 <code>y ~ x</code>，其中y是计数）通常不合适，因为计数数据往往存在异方差（方差随均值变化）且响应变量非负整数。残差图会显示问题。</p>
</li>
<li>
<p>对响应变量取对数后用LM拟合 (<code>lm(log(Number) ~ Year, ...)</code>），即对数-线性模型，是一种常用技巧。这种模型解释的是响应变量的<strong>中位数</strong>的乘性变化。教材第6章已详细讨论。</p>
</li>
<li>
<p>代码通过CRAN R包提交数量的例子，展示了先使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lm(log(Number) ~ Year)</span><br></pre></td></tr></table></figure>
<p>的方法，并解释了其系数和预测。</p>
</li>
<li>
<p>但这种方法也有缺点：log(0)无定义；对数转换可能无法完全解决异方差和正态性问题；影响点在对数尺度上可能与原始尺度不同。教材第13章 (第48页) 讨论了LM处理计数数据的局限性。</p>
</li>
</ul>
</li>
<li>
<p><strong>Poisson 回归 (GLM)</strong>:</p>
<ul>
<li>
<p>模型形式</p>
<p>: 假设响应变量Y服从Poisson分布，其均值μ=E[Y∣X]与解释变量X的关系通过连接函数 (link function)建立。对于Poisson回归，默认的连接函数是对数连接 (log link): log(μ)=β0+β1X。这意味着μ=exp(β0+β1X)，因此解释变量对均值μ的影响是乘性的。这与教材第13章 (第30页) 的描述一致。</p>
</li>
<li>
<p>R实现</p>
<p>: 使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">glm(Number ~ Year, family = poisson, data = ...)</span><br></pre></td></tr></table></figure>
<p>。</p>
</li>
<li>
<p>解释: 系数β1的指数exp(β1)表示当X增加一个单位时，响应变量均值μ的乘性变化因子。(exp(β1)−1)×100%是均值的百分比变化。</p>
</li>
<li>
<p>模型诊断 - 过离散 (Overdispersion): Poisson分布假设均值等于方差。如果实际数据中方差远大于均值，则存在过离散。这可以通过比较模型的残差离散度 (Residual Deviance)与其自由度 (Residual df)来初步判断。如果 残差离散度 / 自由度 &gt;&gt; 1，或者</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 - pchisq(deviance, df.residual)</span><br></pre></td></tr></table></figure>
<p>的p值很小，则可能存在过离散。教材第13章 (第35页) 讨论了此检验。</p>
</li>
<li>
<p>处理过离散 - Quasi-Poisson</p>
<p>: 如果存在过离散，可以使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">family = quasipoisson</span><br></pre></td></tr></table></figure>
<p>重新拟合模型。这会调整参数估计的标准误，从而影响p值和置信区间，但系数估计本身不变。教材第13章 (第36-39页) 详细说明了Quasi-Poisson。</p>
</li>
</ul>
</li>
<li>
<p><strong>GLM的预测</strong>:</p>
<ul>
<li>
<p><code>predict(glm_fit, newdata, type = &quot;link&quot;)</code> 给出线性预测子 log(μ^) 的值。</p>
</li>
<li>
<pre><code>predict(glm_fit, newdata, type = &quot;response&quot;)
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">      给出响应尺度上μ^的值 (exp(log(μ^)))。 </span><br><span class="line"></span><br><span class="line">   - `predictGLM()` (来自 `s20x` 包) 可以方便地给出响应尺度上的预测值及其置信区间。</span><br><span class="line"></span><br><span class="line">5. **GLM应用于多解释变量**:</span><br><span class="line"></span><br><span class="line">   - 数值与因子变量的交互作用 (地震数据)</span><br><span class="line"></span><br><span class="line">     : 与LM类似，可以在GLM中包含数值和因子变量及其交互作用，如 </span><br><span class="line"></span><br></pre></td></tr></table></figure>
glm(Freq ~ Locn * Magnitude, family = poisson, ...)
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  。解释方式也类似，但关注的是对均值的乘性效应和log-odds（对于二项）的线性效应。教材第14章 (第5-11页) 用地震数据为例。 </span><br><span class="line"></span><br><span class="line">- 双因子模型 (鲷鱼数据)</span><br><span class="line"></span><br><span class="line">  : 类似于双因素ANOVA，但使用 </span><br><span class="line"></span><br></pre></td></tr></table></figure>
family = poisson
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  。首先检查交互作用，如果不显著则简化为主效应模型。解释时，关注各因子水平对响应变量均值的乘性影响。教材第14章 (第17-22页) 用鲷鱼数据为例。 </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">- ```</span><br><span class="line">  anova(glm_fit, test=&quot;Chisq&quot;)</span><br></pre></td></tr></table></figure>

 (或 &quot;F&quot; for quasipoisson) 用于检验GLM中各项的显著性，特别是因子变量或交互作用。

</code></pre>
</li>
</ul>
</li>
</ol>
<p>总结：Lecture 10 是从传统线性模型向广义线性模型过渡的关键一课，重点介绍了Poisson回归作为分析计数数据的标准方法，包括其模型设定、参数解释、过离散问题的识别与处理，以及如何将其应用于包含多种类型解释变量的场景。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>s20x<span class="punctuation">)</span> <span class="comment"># 加载s20x包</span></span><br><span class="line"><span class="comment"># 二项分布 (Binomial Distribution)</span></span><br><span class="line">p <span class="operator">=</span> <span class="number">0.75</span> <span class="comment"># 成功的概率</span></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>i <span class="keyword">in</span> seq<span class="punctuation">(</span><span class="number">10</span><span class="punctuation">,</span> <span class="number">100</span><span class="punctuation">,</span> by <span class="operator">=</span><span class="number">5</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#123;</span> <span class="comment"># 试验次数n从10到100，步长为5</span></span><br><span class="line">  n <span class="operator">=</span> i; y <span class="operator">=</span> <span class="number">0</span><span class="operator">:</span>n <span class="comment"># 可能的成功次数</span></span><br><span class="line">  fy <span class="operator">=</span> dbinom<span class="punctuation">(</span>y<span class="punctuation">,</span>size <span class="operator">=</span> n<span class="punctuation">,</span>prob <span class="operator">=</span> p<span class="punctuation">)</span> <span class="comment"># 计算二项分布的概率质量函数</span></span><br><span class="line">  plot<span class="punctuation">(</span>y<span class="punctuation">,</span>fy<span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&quot;h&quot;</span><span class="punctuation">,</span> main <span class="operator">=</span> paste0<span class="punctuation">(</span><span class="string">&quot;n=&quot;</span><span class="punctuation">,</span>n<span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># 绘制概率分布图</span></span><br><span class="line">  <span class="comment"># 正态分布曲线比较 (二项分布的正态近似)</span></span><br><span class="line">  lines<span class="punctuation">(</span>y<span class="punctuation">,</span>dnorm<span class="punctuation">(</span>y<span class="punctuation">,</span> mean <span class="operator">=</span> n<span class="operator">*</span>p<span class="punctuation">,</span> sd <span class="operator">=</span> <span class="built_in">sqrt</span><span class="punctuation">(</span>n<span class="operator">*</span>p<span class="operator">*</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">-</span>p<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;red&quot;</span><span class="punctuation">)</span> <span class="comment"># 均值=np, 标准差=sqrt(np(1-p))</span></span><br><span class="line">  points<span class="punctuation">(</span>y<span class="punctuation">,</span> fy<span class="punctuation">,</span> pch <span class="operator">=</span> <span class="number">19</span><span class="punctuation">,</span> cex <span class="operator">=</span> <span class="number">0.25</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;blue&quot;</span><span class="punctuation">)</span></span><br><span class="line">  legend<span class="punctuation">(</span><span class="string">&quot;topleft&quot;</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Normal&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Binomial&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">         col <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;red&quot;</span><span class="punctuation">,</span><span class="string">&quot;blue&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> pch <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">19</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="comment"># 泊松分布 (Poisson Distribution)</span></span><br><span class="line">y <span class="operator">=</span> seq<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">100</span><span class="punctuation">,</span> by <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span> <span class="comment"># 可能的计数值</span></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>mu <span class="keyword">in</span> seq<span class="punctuation">(</span><span class="number">0.5</span><span class="punctuation">,</span> <span class="number">60</span><span class="punctuation">,</span> by <span class="operator">=</span> <span class="number">5</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#123;</span> <span class="comment"># 均值mu从0.5到60</span></span><br><span class="line">  fy <span class="operator">=</span> dpois<span class="punctuation">(</span>y<span class="punctuation">,</span>lambda <span class="operator">=</span> mu<span class="punctuation">)</span> <span class="comment"># 计算泊松分布的概率质量函数</span></span><br><span class="line">  plot<span class="punctuation">(</span>y<span class="punctuation">,</span>fy<span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&quot;h&quot;</span><span class="punctuation">,</span> main <span class="operator">=</span> paste0<span class="punctuation">(</span><span class="string">&quot;mu=&quot;</span><span class="punctuation">,</span>mu<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">  <span class="comment"># 正态分布曲线比较 (泊松分布的正态近似，当mu较大时)</span></span><br><span class="line">  lines<span class="punctuation">(</span>y<span class="punctuation">,</span>dnorm<span class="punctuation">(</span>y<span class="punctuation">,</span> mean <span class="operator">=</span> mu<span class="punctuation">,</span> sd <span class="operator">=</span> <span class="built_in">sqrt</span><span class="punctuation">(</span>mu<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;red&quot;</span><span class="punctuation">)</span> <span class="comment"># 均值=mu, 标准差=sqrt(mu)</span></span><br><span class="line">  points<span class="punctuation">(</span>y<span class="punctuation">,</span> fy<span class="punctuation">,</span> pch <span class="operator">=</span> <span class="number">19</span><span class="punctuation">,</span> cex <span class="operator">=</span> <span class="number">0.25</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;blue&quot;</span><span class="punctuation">)</span></span><br><span class="line">  legend<span class="punctuation">(</span><span class="string">&quot;topright&quot;</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Normal&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Poisson&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">         col <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;red&quot;</span><span class="punctuation">,</span><span class="string">&quot;blue&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> pch <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">19</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="comment"># 正态分布并非万能</span></span><br><span class="line"><span class="comment"># 当mu很小时，泊松分布与正态分布差异明显</span></span><br><span class="line">mu <span class="operator">=</span> <span class="number">0.5</span></span><br><span class="line">y <span class="operator">=</span> seq<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">6</span><span class="punctuation">,</span> by <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">fy <span class="operator">=</span> dpois<span class="punctuation">(</span>y<span class="punctuation">,</span>lambda <span class="operator">=</span> mu<span class="punctuation">)</span></span><br><span class="line">ny <span class="operator">=</span> dnorm<span class="punctuation">(</span>y<span class="punctuation">,</span> mean <span class="operator">=</span> mu<span class="punctuation">,</span> sd <span class="operator">=</span> <span class="built_in">sqrt</span><span class="punctuation">(</span>mu<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>y<span class="punctuation">,</span> ny<span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&quot;b&quot;</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;red&quot;</span><span class="punctuation">,</span> ylab <span class="operator">=</span> <span class="string">&quot;fy&quot;</span><span class="punctuation">,</span></span><br><span class="line">     main <span class="operator">=</span> <span class="string">&quot;Normal Vs Poisson (mu=0.5)&quot;</span><span class="punctuation">,</span> ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0.6</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">points<span class="punctuation">(</span>y<span class="punctuation">,</span> fy<span class="punctuation">,</span> pch <span class="operator">=</span> <span class="number">19</span><span class="punctuation">,</span> cex <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;blue&quot;</span><span class="punctuation">)</span></span><br><span class="line">segments<span class="punctuation">(</span>y<span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span>y<span class="punctuation">,</span>fy<span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;blue&quot;</span><span class="punctuation">)</span></span><br><span class="line">legend<span class="punctuation">(</span><span class="string">&quot;topright&quot;</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Normal&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Poisson&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">       col <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;red&quot;</span><span class="punctuation">,</span><span class="string">&quot;blue&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> pch <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">19</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 当n很小或p接近0或1时，二项分布与正态分布差异明显</span></span><br><span class="line">p <span class="operator">=</span> <span class="number">0.75</span></span><br><span class="line">n <span class="operator">=</span> <span class="number">6</span>; y <span class="operator">=</span> <span class="number">0</span><span class="operator">:</span>n</span><br><span class="line">fy <span class="operator">=</span> dbinom<span class="punctuation">(</span>y<span class="punctuation">,</span>size <span class="operator">=</span> n<span class="punctuation">,</span>prob <span class="operator">=</span> p<span class="punctuation">)</span></span><br><span class="line">ny <span class="operator">=</span> dnorm<span class="punctuation">(</span>y<span class="punctuation">,</span> mean <span class="operator">=</span> n<span class="operator">*</span>p<span class="punctuation">,</span> sd <span class="operator">=</span> <span class="built_in">sqrt</span><span class="punctuation">(</span>n<span class="operator">*</span>p<span class="operator">*</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">-</span>p<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>y<span class="punctuation">,</span>ny<span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&quot;b&quot;</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;red&quot;</span><span class="punctuation">,</span>ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0.4</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">     main <span class="operator">=</span> <span class="string">&quot;Normal Vs Binomial (n=6,p=0.75)&quot;</span><span class="punctuation">)</span></span><br><span class="line">points<span class="punctuation">(</span>y<span class="punctuation">,</span> fy<span class="punctuation">,</span> pch <span class="operator">=</span> <span class="number">19</span><span class="punctuation">,</span> cex <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;blue&quot;</span><span class="punctuation">)</span></span><br><span class="line">segments<span class="punctuation">(</span>y<span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span>y<span class="punctuation">,</span>fy<span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;blue&quot;</span><span class="punctuation">)</span></span><br><span class="line">legend<span class="punctuation">(</span><span class="string">&quot;topleft&quot;</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Normal&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Binomial&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">       col <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;red&quot;</span><span class="punctuation">,</span><span class="string">&quot;blue&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> pch <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">19</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在回归中差异更大</span></span><br><span class="line">x <span class="operator">=</span> <span class="operator">-</span><span class="number">30</span><span class="operator">:</span><span class="number">30</span></span><br><span class="line">beta0 <span class="operator">=</span> <span class="number">0.3</span></span><br><span class="line">beta1 <span class="operator">=</span> <span class="number">0.1</span></span><br><span class="line">mu <span class="operator">=</span> <span class="built_in">exp</span><span class="punctuation">(</span>beta0 <span class="operator">+</span> beta1<span class="operator">*</span> x<span class="punctuation">)</span> <span class="comment"># 泊松回归的均值通常通过指数连接函数建模</span></span><br><span class="line">y <span class="operator">=</span> rpois<span class="punctuation">(</span><span class="built_in">length</span><span class="punctuation">(</span>mu<span class="punctuation">)</span><span class="punctuation">,</span>lambda <span class="operator">=</span> mu<span class="punctuation">)</span> <span class="comment"># 生成泊松分布的响应变量</span></span><br><span class="line">sim.df <span class="operator">=</span> data.frame<span class="punctuation">(</span>x<span class="operator">=</span>x<span class="punctuation">,</span> y<span class="operator">=</span>y<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 必须使用灵活的线性模型 (如果用普通LM)</span></span><br><span class="line">fit.normal <span class="operator">=</span> lm<span class="punctuation">(</span>y<span class="operator">~</span>x<span class="punctuation">,</span> data <span class="operator">=</span> sim.df<span class="punctuation">)</span> <span class="comment"># 普通线性模型</span></span><br><span class="line">plot<span class="punctuation">(</span>fit.normal<span class="punctuation">,</span> which <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span> <span class="comment"># 残差图可能显示异方差和非线性</span></span><br><span class="line">fit.quadratic.normal <span class="operator">=</span> lm<span class="punctuation">(</span>y<span class="operator">~</span>x<span class="operator">+</span>I<span class="punctuation">(</span>x<span class="operator">^</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> data <span class="operator">=</span> sim.df<span class="punctuation">)</span> <span class="comment"># 二次模型</span></span><br><span class="line">plot<span class="punctuation">(</span>fit.quadratic.normal<span class="punctuation">,</span> which <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">fit.cubic.normal <span class="operator">=</span> lm<span class="punctuation">(</span>y<span class="operator">~</span>x<span class="operator">+</span>I<span class="punctuation">(</span>x<span class="operator">^</span><span class="number">2</span><span class="punctuation">)</span><span class="operator">+</span>I<span class="punctuation">(</span>x<span class="operator">^</span><span class="number">3</span><span class="punctuation">)</span><span class="punctuation">,</span> data <span class="operator">=</span> sim.df<span class="punctuation">)</span> <span class="comment"># 三次模型</span></span><br><span class="line">plot<span class="punctuation">(</span>fit.cubic.normal<span class="punctuation">,</span> which <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">fit.quartic.normal <span class="operator">=</span> lm<span class="punctuation">(</span>y<span class="operator">~</span>x<span class="operator">+</span>I<span class="punctuation">(</span>x<span class="operator">^</span><span class="number">2</span><span class="punctuation">)</span><span class="operator">+</span>I<span class="punctuation">(</span>x<span class="operator">^</span><span class="number">3</span><span class="punctuation">)</span><span class="operator">+</span>I<span class="punctuation">(</span>x<span class="operator">^</span><span class="number">4</span><span class="punctuation">)</span><span class="punctuation">,</span> data <span class="operator">=</span> sim.df<span class="punctuation">)</span> <span class="comment"># 四次模型</span></span><br><span class="line">plot<span class="punctuation">(</span>fit.quartic.normal<span class="punctuation">,</span> which <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 通常拟合线会弯弯曲曲</span></span><br><span class="line">plot<span class="punctuation">(</span>x<span class="punctuation">,</span>y<span class="punctuation">)</span></span><br><span class="line">lines<span class="punctuation">(</span>x<span class="punctuation">,</span> fitted.values<span class="punctuation">(</span>fit.quadratic.normal<span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;red&quot;</span><span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>x<span class="punctuation">,</span>y<span class="punctuation">)</span></span><br><span class="line">lines<span class="punctuation">(</span>x<span class="punctuation">,</span> fitted.values<span class="punctuation">(</span>fit.cubic.normal<span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;red&quot;</span><span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>x<span class="punctuation">,</span>y<span class="punctuation">)</span></span><br><span class="line">lines<span class="punctuation">(</span>x<span class="punctuation">,</span> fitted.values<span class="punctuation">(</span>fit.quartic.normal<span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;red&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 正确的泊松假设</span></span><br><span class="line">fit.poisson <span class="operator">=</span> glm<span class="punctuation">(</span>y<span class="operator">~</span>x<span class="punctuation">,</span> family <span class="operator">=</span> poisson<span class="punctuation">,</span> data <span class="operator">=</span> sim.df<span class="punctuation">)</span> <span class="comment"># 使用glm和poisson族</span></span><br><span class="line">summary<span class="punctuation">(</span>fit.poisson<span class="punctuation">)</span></span><br><span class="line">beta0;beta1 <span class="comment"># 真实参数值</span></span><br><span class="line">plot<span class="punctuation">(</span>x<span class="punctuation">,</span>y<span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;Poisson data&quot;</span><span class="punctuation">)</span></span><br><span class="line">lines<span class="punctuation">(</span>x<span class="punctuation">,</span>predict<span class="punctuation">(</span>fit.poisson<span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&quot;response&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;blue&quot;</span><span class="punctuation">)</span> <span class="comment"># 泊松回归拟合线 (响应尺度)</span></span><br><span class="line">lines<span class="punctuation">(</span>x<span class="punctuation">,</span> fitted.values<span class="punctuation">(</span>fit.quartic.normal<span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;red&quot;</span><span class="punctuation">)</span> <span class="comment"># 普通LM(四次)拟合线</span></span><br><span class="line">legend<span class="punctuation">(</span><span class="string">&quot;topleft&quot;</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Normal&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Poisson&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">       col <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;red&quot;</span><span class="punctuation">,</span><span class="string">&quot;blue&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> lty <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 不仔细看差别不大</span></span><br><span class="line">summaryStats<span class="punctuation">(</span>fitted.values<span class="punctuation">(</span>fit.quartic.normal<span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># 普通LM的拟合值可能为负</span></span><br><span class="line"><span class="comment"># 当扩展到给定数据范围之外时，问题更大</span></span><br><span class="line">x.plot <span class="operator">=</span> <span class="operator">-</span><span class="number">60</span><span class="operator">:</span><span class="number">60</span> <span class="comment"># 更宽的x范围用于外推</span></span><br><span class="line">mu.plot <span class="operator">=</span> <span class="built_in">exp</span><span class="punctuation">(</span><span class="number">0.3</span> <span class="operator">+</span> <span class="number">0.1</span><span class="operator">*</span> x.plot<span class="punctuation">)</span></span><br><span class="line">y.plot <span class="operator">=</span> rpois<span class="punctuation">(</span><span class="built_in">length</span><span class="punctuation">(</span>mu.plot<span class="punctuation">)</span><span class="punctuation">,</span>lambda <span class="operator">=</span> mu.plot<span class="punctuation">)</span></span><br><span class="line">y.pois <span class="operator">=</span> predict<span class="punctuation">(</span>fit.poisson<span class="punctuation">,</span> newdata <span class="operator">=</span> data.frame<span class="punctuation">(</span>x<span class="operator">=</span>x.plot<span class="punctuation">)</span><span class="punctuation">,</span>type <span class="operator">=</span> <span class="string">&quot;response&quot;</span><span class="punctuation">)</span></span><br><span class="line">y.norm <span class="operator">=</span> predict<span class="punctuation">(</span>fit.quartic.normal<span class="punctuation">,</span> newdata <span class="operator">=</span> data.frame<span class="punctuation">(</span>x<span class="operator">=</span>x.plot<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 普通LM外推非常不可靠</span></span><br><span class="line">plot<span class="punctuation">(</span>x.plot<span class="punctuation">,</span> y.plot<span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;Beyond Observed Poisson data&quot;</span><span class="punctuation">)</span></span><br><span class="line">lines<span class="punctuation">(</span>x.plot<span class="punctuation">,</span> y.pois<span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;blue&quot;</span><span class="punctuation">)</span> <span class="comment"># 泊松回归外推</span></span><br><span class="line">lines<span class="punctuation">(</span>x.plot<span class="punctuation">,</span> y.norm<span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;red&quot;</span><span class="punctuation">)</span> <span class="comment"># 普通LM外推</span></span><br><span class="line">legend<span class="punctuation">(</span><span class="string">&quot;topleft&quot;</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Normal&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Poisson&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">       col <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;red&quot;</span><span class="punctuation">,</span><span class="string">&quot;blue&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> lty <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># setwd(&quot;~/Desktop&quot;) # 设置工作目录 (根据用户实际情况)</span></span><br><span class="line">CRAN.df <span class="operator">=</span> read.table<span class="punctuation">(</span><span class="string">&quot;CRAN.txt&quot;</span><span class="punctuation">,</span> header<span class="operator">=</span><span class="built_in">T</span><span class="punctuation">)</span> <span class="comment"># 读取CRAN R包提交数据</span></span><br><span class="line">CRAN.df</span><br><span class="line"><span class="comment">## 原始y的散点图</span></span><br><span class="line">plot<span class="punctuation">(</span>Number <span class="operator">~</span> Year<span class="punctuation">,</span> data <span class="operator">=</span> CRAN.df<span class="punctuation">)</span></span><br><span class="line"><span class="comment">## log(y)的散点图</span></span><br><span class="line">plot<span class="punctuation">(</span><span class="built_in">log</span><span class="punctuation">(</span>Number<span class="punctuation">)</span> <span class="operator">~</span> Year<span class="punctuation">,</span> data <span class="operator">=</span> CRAN.df<span class="punctuation">)</span></span><br><span class="line">CRAN.fit <span class="operator">=</span> lm<span class="punctuation">(</span><span class="built_in">log</span><span class="punctuation">(</span>Number<span class="punctuation">)</span> <span class="operator">~</span> Year<span class="punctuation">,</span> data <span class="operator">=</span> CRAN.df<span class="punctuation">)</span> <span class="comment"># 对log(Number)拟合线性模型</span></span><br><span class="line">plot<span class="punctuation">(</span>CRAN.fit<span class="punctuation">,</span>which<span class="operator">=</span><span class="number">1</span><span class="punctuation">)</span> <span class="comment"># 残差图</span></span><br><span class="line">normcheck<span class="punctuation">(</span>CRAN.fit<span class="punctuation">)</span> <span class="comment"># 正态性检查</span></span><br><span class="line">cooks20x<span class="punctuation">(</span>CRAN.fit<span class="punctuation">)</span> <span class="comment"># 影响点检查</span></span><br><span class="line">summary<span class="punctuation">(</span>CRAN.fit<span class="punctuation">)</span></span><br><span class="line"><span class="built_in">exp</span><span class="punctuation">(</span>CRAN.fit<span class="operator">$</span>coef<span class="punctuation">[</span><span class="string">&quot;Year&quot;</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="comment"># 年份的乘性效应因子 (中位数)</span></span><br><span class="line"><span class="comment">## 置信区间</span></span><br><span class="line"><span class="number">100</span><span class="operator">*</span><span class="punctuation">(</span><span class="built_in">exp</span><span class="punctuation">(</span>confint<span class="punctuation">(</span>CRAN.fit<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">-</span> <span class="number">1</span><span class="punctuation">)</span> <span class="comment"># 年份效应的百分比变化 (中位数)</span></span><br><span class="line">predCRAN.df <span class="operator">=</span> data.frame<span class="punctuation">(</span>Year <span class="operator">=</span> <span class="number">2017</span><span class="punctuation">)</span> <span class="comment"># 预测2017年</span></span><br><span class="line">pred2017 <span class="operator">=</span> predict<span class="punctuation">(</span>CRAN.fit<span class="punctuation">,</span> predCRAN.df<span class="punctuation">,</span> interval <span class="operator">=</span> <span class="string">&quot;confidence&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">## 对数尺度上的预测</span></span><br><span class="line">pred2017</span><br><span class="line"><span class="comment">## 反转换得到2017年提交数量的中位数预测</span></span><br><span class="line"><span class="built_in">exp</span><span class="punctuation">(</span>pred2017<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 泊松拟合</span></span><br><span class="line">CRAN.pois.fit <span class="operator">=</span> glm<span class="punctuation">(</span>Number <span class="operator">~</span> Year<span class="punctuation">,</span> family <span class="operator">=</span> poisson<span class="punctuation">,</span> data <span class="operator">=</span> CRAN.df<span class="punctuation">)</span> <span class="comment"># 使用glm进行泊松回归</span></span><br><span class="line">summary<span class="punctuation">(</span>CRAN.pois.fit<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 如果泊松假设为真，残差应近似标准正态</span></span><br><span class="line">plot<span class="punctuation">(</span>CRAN.pois.fit<span class="punctuation">,</span> which <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span> <span class="comment"># 查看残差图 (注意glm的残差类型与lm不同)</span></span><br><span class="line"><span class="comment"># 离散度检验：原假设是模型充分（即泊松假设适合，特别是均值=方差）</span></span><br><span class="line"><span class="comment"># 通常查看残差离散度 (Residual Deviance) 与自由度的比值</span></span><br><span class="line"><span class="number">1</span> <span class="operator">-</span> pchisq<span class="punctuation">(</span><span class="number">402.61</span><span class="punctuation">,</span><span class="number">10</span><span class="punctuation">)</span> <span class="comment"># summary(CRAN.pois.fit)$deviance, summary(CRAN.pois.fit)$df.residual</span></span><br><span class="line"><span class="comment"># p值非常小，表明模型不充分，可能存在过离散 (overdispersion)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 补救措施：使用类泊松 (quasipoisson)</span></span><br><span class="line">CRAN.quasi.pois.fit <span class="operator">=</span> glm<span class="punctuation">(</span></span><br><span class="line">  Number <span class="operator">~</span> Year<span class="punctuation">,</span> family <span class="operator">=</span> quasipoisson<span class="punctuation">,</span> data <span class="operator">=</span> CRAN.df<span class="punctuation">)</span></span><br><span class="line">summary<span class="punctuation">(</span>CRAN.quasi.pois.fit<span class="punctuation">)</span> <span class="comment"># 注意此时会估计一个离散参数 (Dispersion parameter)</span></span><br><span class="line"><span class="comment"># 解释</span></span><br><span class="line"><span class="built_in">exp</span><span class="punctuation">(</span>CRAN.quasi.pois.fit<span class="operator">$</span>coef<span class="punctuation">[</span><span class="string">&quot;Year&quot;</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="comment"># 年份的乘性效应因子 (均值)</span></span><br><span class="line"><span class="number">100</span><span class="operator">*</span><span class="punctuation">(</span><span class="built_in">exp</span><span class="punctuation">(</span>confint<span class="punctuation">(</span>CRAN.quasi.pois.fit<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="punctuation">]</span> <span class="operator">-</span> <span class="number">1</span><span class="punctuation">)</span> <span class="comment"># 年份效应的百分比变化 (均值)</span></span><br><span class="line"><span class="number">100</span><span class="operator">*</span><span class="punctuation">(</span><span class="built_in">exp</span><span class="punctuation">(</span>confint<span class="punctuation">(</span>CRAN.fit<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="punctuation">]</span> <span class="operator">-</span> <span class="number">1</span><span class="punctuation">)</span> <span class="comment"># 与之前log(LM)的结果比较 (解释的是中位数)</span></span><br><span class="line"><span class="comment"># 预测</span></span><br><span class="line">new.CRAN.df <span class="operator">=</span> data.frame<span class="punctuation">(</span>Year <span class="operator">=</span> <span class="number">2017</span><span class="punctuation">)</span></span><br><span class="line">predictGLM<span class="punctuation">(</span>CRAN.quasi.pois.fit<span class="punctuation">,</span> new.CRAN.df<span class="punctuation">)</span> <span class="comment"># 预测 (默认link尺度，即log(均值))</span></span><br><span class="line">pred2017.quasi<span class="operator">=</span>predict<span class="punctuation">(</span>CRAN.quasi.pois.fit<span class="punctuation">,</span> new.CRAN.df<span class="punctuation">,</span> se.fit<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">)</span> <span class="comment"># 获取预测值和标准误</span></span><br><span class="line"><span class="comment"># log(均值)的置信区间</span></span><br><span class="line">lower <span class="operator">=</span> pred2017.quasi<span class="operator">$</span>fit<span class="operator">-</span><span class="number">1.96</span><span class="operator">*</span>pred2017.quasi<span class="operator">$</span>se.fit</span><br><span class="line">upper <span class="operator">=</span> pred2017.quasi<span class="operator">$</span>fit<span class="operator">+</span><span class="number">1.96</span><span class="operator">*</span>pred2017.quasi<span class="operator">$</span>se.fit</span><br><span class="line"><span class="comment"># 均值的置信区间</span></span><br><span class="line">pred2017.ci.mean<span class="operator">=</span><span class="built_in">exp</span><span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span>lower<span class="punctuation">,</span> upper<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">pred2017.ci.mean</span><br><span class="line"><span class="comment"># exp(predictGLM(CRAN.quasi.pois.fit, new.CRAN.df)) # 等价于上面的手动计算</span></span><br><span class="line">predictGLM<span class="punctuation">(</span>CRAN.quasi.pois.fit<span class="punctuation">,</span> new.CRAN.df<span class="punctuation">,</span> type<span class="operator">=</span><span class="string">&quot;response&quot;</span><span class="punctuation">)</span> <span class="comment"># 直接在响应尺度上预测和获取CI</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 泊松回归的预测区间不作考核</span></span><br><span class="line"><span class="comment"># --- 处理数值和分类变量 (地震数据) ---</span></span><br><span class="line">Quakes.df<span class="operator">=</span>read.table<span class="punctuation">(</span><span class="string">&quot;EarthquakeMagnitudes.txt&quot;</span><span class="punctuation">,</span>header<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">)</span> <span class="comment"># 读取地震数据</span></span><br><span class="line">Quakes.df<span class="operator">$</span>Locn<span class="operator">=</span>as.factor<span class="punctuation">(</span>Quakes.df<span class="operator">$</span>Locn<span class="punctuation">)</span> <span class="comment"># 将地点转换为因子</span></span><br><span class="line">subset<span class="punctuation">(</span>Quakes.df<span class="punctuation">,</span>subset<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span>Locn<span class="operator">==</span><span class="string">&quot;SC&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">4</span><span class="punctuation">,</span><span class="punctuation">]</span> <span class="comment"># 打印南加州前4行</span></span><br><span class="line">subset<span class="punctuation">(</span>Quakes.df<span class="punctuation">,</span>subset<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span>Locn<span class="operator">==</span><span class="string">&quot;WA&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">4</span><span class="punctuation">,</span><span class="punctuation">]</span> <span class="comment"># 打印华盛顿州前4行</span></span><br><span class="line">plot<span class="punctuation">(</span>Freq<span class="operator">~</span>Magnitude<span class="punctuation">,</span>data<span class="operator">=</span>Quakes.df<span class="punctuation">,</span>pch<span class="operator">=</span>substr<span class="punctuation">(</span>Locn<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># 频数对震级的散点图，按地点区分</span></span><br><span class="line">Quake.fit <span class="operator">=</span> glm<span class="punctuation">(</span>Freq <span class="operator">~</span> Locn <span class="operator">*</span> Magnitude<span class="punctuation">,</span> <span class="comment"># 拟合带交互作用的泊松回归</span></span><br><span class="line">                 family <span class="operator">=</span> poisson<span class="punctuation">,</span> data <span class="operator">=</span> Quakes.df<span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>Quake.fit<span class="punctuation">,</span> which <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span> <span class="comment"># 残差图</span></span><br><span class="line">plot<span class="punctuation">(</span>Quake.fit<span class="punctuation">,</span> which <span class="operator">=</span> <span class="number">4</span><span class="punctuation">)</span> <span class="comment"># Cook&#x27;s距离图</span></span><br><span class="line"><span class="number">1</span> <span class="operator">-</span> pchisq<span class="punctuation">(</span>summary<span class="punctuation">(</span>Quake.fit<span class="punctuation">)</span><span class="operator">$</span>deviance<span class="punctuation">,</span> summary<span class="punctuation">(</span>Quake.fit<span class="punctuation">)</span><span class="operator">$</span>df.residual<span class="punctuation">)</span> <span class="comment"># 离散度检验 (p值大，模型可接受)</span></span><br><span class="line">summary<span class="punctuation">(</span>Quake.fit<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 南加州的震级效应</span></span><br><span class="line">Quake.cis <span class="operator">=</span> confint<span class="punctuation">(</span>Quake.fit<span class="punctuation">)</span></span><br><span class="line"><span class="number">100</span><span class="operator">*</span><span class="punctuation">(</span><span class="built_in">exp</span><span class="punctuation">(</span>Quake.cis<span class="punctuation">[</span><span class="number">3</span><span class="punctuation">,</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="operator">-</span> <span class="number">1</span><span class="punctuation">)</span> <span class="comment"># 震级每增加1，频数均值变化的百分比 (SC)</span></span><br><span class="line"><span class="comment"># 更改基准到华盛顿州</span></span><br><span class="line">Quakes.df<span class="operator">$</span>Locn2<span class="operator">=</span>factor<span class="punctuation">(</span>Quakes.df<span class="operator">$</span>Locn<span class="punctuation">,</span>levels<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;WA&quot;</span><span class="punctuation">,</span><span class="string">&quot;SC&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">Quake2.fit<span class="operator">=</span>glm<span class="punctuation">(</span>Freq<span class="operator">~</span>Locn2<span class="operator">*</span>Magnitude<span class="punctuation">,</span>family<span class="operator">=</span>poisson<span class="punctuation">,</span>data<span class="operator">=</span>Quakes.df<span class="punctuation">)</span></span><br><span class="line">Quake.WA.ci <span class="operator">=</span> confint<span class="punctuation">(</span>Quake2.fit<span class="punctuation">)</span></span><br><span class="line"><span class="number">100</span><span class="operator">*</span><span class="punctuation">(</span><span class="built_in">exp</span><span class="punctuation">(</span>Quake.WA.ci<span class="punctuation">[</span><span class="number">3</span><span class="punctuation">,</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="operator">-</span> <span class="number">1</span><span class="punctuation">)</span> <span class="comment"># 震级每增加1，频数均值变化的百分比 (WA)</span></span><br><span class="line"><span class="comment"># 展示结果的最佳方式</span></span><br><span class="line">no.sc <span class="operator">=</span> predictGLM<span class="punctuation">(</span>Quake.fit<span class="punctuation">,</span> subset<span class="punctuation">(</span>Quakes.df<span class="punctuation">,</span>subset<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span>Locn<span class="operator">==</span><span class="string">&quot;SC&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                   type<span class="operator">=</span><span class="string">&quot;response&quot;</span><span class="punctuation">)</span> <span class="comment"># 预测SC的频数均值</span></span><br><span class="line">mag.sc <span class="operator">=</span> subset<span class="punctuation">(</span>Quakes.df<span class="punctuation">,</span>subset<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span>Locn<span class="operator">==</span><span class="string">&quot;SC&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">$</span>Magnitude</span><br><span class="line">no.was <span class="operator">=</span> predictGLM<span class="punctuation">(</span>Quake.fit<span class="punctuation">,</span> subset<span class="punctuation">(</span>Quakes.df<span class="punctuation">,</span>subset<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span>Locn<span class="operator">==</span><span class="string">&quot;WA&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                   type<span class="operator">=</span><span class="string">&quot;response&quot;</span><span class="punctuation">)</span> <span class="comment"># 预测WA的频数均值</span></span><br><span class="line">mag.was <span class="operator">=</span> subset<span class="punctuation">(</span>Quakes.df<span class="punctuation">,</span>subset<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span>Locn<span class="operator">==</span><span class="string">&quot;WA&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">$</span>Magnitude</span><br><span class="line">plot<span class="punctuation">(</span>Freq<span class="operator">~</span>Magnitude<span class="punctuation">,</span>data<span class="operator">=</span>Quakes.df<span class="punctuation">,</span>pch<span class="operator">=</span>substr<span class="punctuation">(</span>Locn<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">lines<span class="punctuation">(</span>mag.sc<span class="punctuation">,</span> no.sc<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;blue&quot;</span><span class="punctuation">)</span> <span class="comment"># 绘制SC的拟合线</span></span><br><span class="line">lines<span class="punctuation">(</span>mag.was<span class="punctuation">,</span> no.was<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;red&quot;</span><span class="punctuation">)</span> <span class="comment"># 绘制WA的拟合线</span></span><br><span class="line">legend<span class="punctuation">(</span><span class="string">&quot;topright&quot;</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Southern California&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Washington&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">       lty <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;blue&quot;</span><span class="punctuation">,</span> <span class="string">&quot;red&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 鲷鱼数据 (两个分类变量)，类似于双因素方差分析 ---</span></span><br><span class="line">Snap.df <span class="operator">=</span> read.table<span class="punctuation">(</span><span class="string">&quot;SnapperCROPvsHAHEI.txt&quot;</span><span class="punctuation">,</span> header <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span> <span class="comment"># 读取鲷鱼数据</span></span><br><span class="line">interactionPlots<span class="punctuation">(</span>Freq <span class="operator">~</span> Locn <span class="operator">*</span> Reserve<span class="punctuation">,</span> data <span class="operator">=</span> Snap.df<span class="punctuation">)</span> <span class="comment"># 交互作用图 (注意是原始频数)</span></span><br><span class="line"><span class="comment"># 从交互作用模型开始</span></span><br><span class="line">Snap.glm <span class="operator">=</span> glm<span class="punctuation">(</span>Freq <span class="operator">~</span> Locn <span class="operator">*</span> Reserve<span class="punctuation">,</span> family <span class="operator">=</span> poisson<span class="punctuation">,</span> data <span class="operator">=</span> Snap.df<span class="punctuation">)</span></span><br><span class="line">summary<span class="punctuation">(</span>Snap.glm<span class="punctuation">)</span></span><br><span class="line"><span class="number">1</span> <span class="operator">-</span> pchisq<span class="punctuation">(</span>summary<span class="punctuation">(</span>Snap.glm<span class="punctuation">)</span><span class="operator">$</span>deviance<span class="punctuation">,</span> summary<span class="punctuation">(</span>Snap.glm<span class="punctuation">)</span><span class="operator">$</span>df.residual<span class="punctuation">)</span> <span class="comment"># 离散度检验 (p值大，模型可接受)</span></span><br><span class="line">anova<span class="punctuation">(</span>Snap.glm<span class="punctuation">,</span> test<span class="operator">=</span><span class="string">&quot;Chisq&quot;</span><span class="punctuation">)</span> <span class="comment"># 检验交互作用的显著性 (Chisq检验用于GLM)</span></span><br><span class="line">Snap2.glm <span class="operator">=</span> glm<span class="punctuation">(</span>Freq <span class="operator">~</span> Locn <span class="operator">+</span> Reserve<span class="punctuation">,</span> family <span class="operator">=</span> poisson<span class="punctuation">,</span> data <span class="operator">=</span> Snap.df<span class="punctuation">)</span> <span class="comment"># 如果交互不显著，拟合主效应模型</span></span><br><span class="line">anova<span class="punctuation">(</span>Snap2.glm<span class="punctuation">,</span> test<span class="operator">=</span><span class="string">&quot;Chisq&quot;</span><span class="punctuation">)</span> <span class="comment"># 主效应模型的ANOVA表</span></span><br><span class="line"><span class="number">1</span> <span class="operator">-</span> pchisq<span class="punctuation">(</span>summary<span class="punctuation">(</span>Snap2.glm<span class="punctuation">)</span><span class="operator">$</span>deviance<span class="punctuation">,</span> summary<span class="punctuation">(</span>Snap2.glm<span class="punctuation">)</span><span class="operator">$</span>df.residual<span class="punctuation">)</span> <span class="comment"># 再次检查离散度</span></span><br><span class="line">summary<span class="punctuation">(</span>Snap2.glm<span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>Snap2.glm<span class="punctuation">,</span> which <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span> <span class="comment"># 残差图</span></span><br><span class="line"><span class="number">100</span><span class="operator">*</span><span class="punctuation">(</span><span class="built_in">exp</span><span class="punctuation">(</span>confint<span class="punctuation">(</span>Snap2.glm<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">-</span> <span class="number">1</span><span class="punctuation">)</span> <span class="comment"># 解释主效应 (均值的百分比变化)</span></span><br></pre></td></tr></table></figure>
<h3 id="Lecture-11">Lecture 11</h3>
<p>这个lecture主要讲解<strong>Logistic回归</strong>，它是广义线性模型的一种，专门用于处理<strong>二元（是/否，0/1）响应变量</strong>或<strong>比例数据</strong>（成功次数/总试验次数）。核心概念包括odds、log-odds以及如何解释模型系数。这与教材 <code>STATS201 book SWU 2023.pdf</code> 第15章“使用二项分布建模比例数据”和第16章“列联表分析” 的内容相关。</p>
<p>这个lecture全面介绍了<strong>广义线性模型 (GLM)</strong> 的另一个重要分支：<strong>Logistic回归</strong>，用于分析二元响应变量或比例数据。同时，它也开始引入<strong>列联表分析</strong>的概念，并展示了Poisson回归和Logistic回归在特定情况下（饱和模型分析关联性）的等价性。</p>
<ol>
<li>
<p><strong>二元数据与Binomial/Bernoulli分布</strong>:</p>
<ul>
<li>当响应变量只有两个可能的结果（如成功/失败，是/否，0/1）时，称为二元数据 (binary data)。单次试验服从Bernoulli分布。多次独立重复的Bernoulli试验中成功次数服从Binomial分布。 教材第15章 (第4-5页) 对此有介绍。</li>
<li>代码中篮球投篮数据 (<code>bb.df</code>) 的 <code>basket</code> 变量 (0或1) 是典型的二元数据。</li>
</ul>
</li>
<li>
<p><strong>Odds 和 Log-Odds (Logit)</strong>:</p>
<ul>
<li>Odds (几率)：事件发生的概率与不发生的概率之比，即Odds=p/(1−p)。</li>
<li>Log-Odds (对数几率，logit)：logit(p)=log(Odds)=log(p/(1−p))。Log-odds的取值范围是(−∞,+∞)，这使得它适合作为线性模型的响应部分。</li>
<li>从log-odds反推概率p的函数是logistic函数：p=exp(log-odds)/(1+exp(log-odds))=plogis(log-odds)。</li>
<li>教材第15章 (第7-9页) 详细解释了odds和log-odds。</li>
</ul>
</li>
<li>
<p><strong>Logistic回归模型</strong>:</p>
<ul>
<li>
<p>模型形式：logit(pi)=β0+β1Xi1+...+βkXik。这意味着解释变量与成功概率pi的对数几率呈线性关系。</p>
</li>
<li>
<p>R实现：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">glm(response ~ predictors, family = binomial, data = df)</span><br></pre></td></tr></table></figure>
<p>。</p>
<ul>
<li>
<p>对于<strong>未分组的二元数据</strong> (如 <code>bb.df</code>): <code>response</code> 是0/1变量。</p>
</li>
<li>
<p>对于分组数据</p>
<p>(如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bb.grouped.df</span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Space.df</span><br></pre></td></tr></table></figure>
<p>):</p>
<ul>
<li>
<pre><code>response
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">可以是 </span><br><span class="line"></span><br></pre></td></tr></table></figure>
cbind(success_count, failure_count)
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  。 </span><br><span class="line"></span><br><span class="line">- 或者 </span><br><span class="line"></span><br></pre></td></tr></table></figure>
response
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">是成功比例，并使用 </span><br><span class="line"></span><br></pre></td></tr></table></figure>
weights = total_count
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">       参数。 </span><br><span class="line"></span><br><span class="line">- 系数解释:</span><br><span class="line"></span><br><span class="line">  - βj 表示当其他变量不变时，Xj 每增加一个单位，log(Odds) 的变化量。</span><br><span class="line"></span><br><span class="line">  - exp(βj) 表示当其他变量不变时，Xj 每增加一个单位，Odds 的**乘性变化因子 (Odds Ratio, OR)**。</span><br><span class="line"></span><br><span class="line">  - (exp(βj)−1)×100% 是 Odds 的百分比变化。</span><br><span class="line"></span><br><span class="line">  - 代码中 </span><br><span class="line"></span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
<p>100*(exp(coef(bb.fit2)[2])-1)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">和 </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>100*(exp(bb.ci2[2,])-1)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">        就是这种解释。教材第15章 (第27-28页)。</span><br><span class="line"></span><br><span class="line">4. **模型诊断与过离散 (针对分组数据)**:</span><br><span class="line"></span><br><span class="line">   - 对于分组的二项数据，可以像Poisson回归一样使用残差离散度来检查模型拟合优度。如果 </span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>1 - pchisq(deviance, df.residual)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   的p值很小，可能表明存在过离散(或欠离散)。 </span><br><span class="line"></span><br><span class="line">- 处理过离散：使用 </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>family = quasibinomial</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">     。这会调整标准误和p值，但不改变系数估计。 </span><br><span class="line"></span><br><span class="line">   - 对于未分组的二元数据，残差图和离散度检验的解释性有限。 </span><br><span class="line"></span><br><span class="line">5. **预测**:</span><br><span class="line"></span><br><span class="line">   - `predict(glm_fit, newdata, type = &quot;link&quot;)` 给出log-odds尺度的预测。</span><br><span class="line"></span><br><span class="line">   - ```</span><br><span class="line">     predict(glm_fit, newdata, type = &quot;response&quot;)</span><br></pre></td></tr></table></figure>
<p>给出概率尺度的预测。</p>
</li>
<li>
<p><code>predictGLM()</code> (来自 <code>s20x</code> 包) 可以方便地给出这两个尺度上的预测值及其置信区间。</p>
</li>
</ul>
</li>
<li>
<p><strong>挑战者号航天飞机灾难案例</strong>:</p>
<ul>
<li>
<p>这是一个著名的错误应用线性模型分析比例数据导致灾难性后果的案例。直接对比例数据 (O环损坏数/总数) 用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lm()</span><br></pre></td></tr></table></figure>
<p>拟合是错误的，因为它可能预测出小于0或大于1的概率，且未考虑二项分布的特性。</p>
</li>
<li>
<p>正确的做法是使用Logistic回归 (</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">glm(cbind(Failure, 6-Failure) ~ Temp, family = binomial, ...)</span><br></pre></td></tr></table></figure>
<p>)。 教材第15章 (第45-52页) 详细描述了此案例。</p>
</li>
</ul>
</li>
<li>
<p><strong>列联表分析初探</strong>:</p>
<ul>
<li>
<p>当所有变量都是分类变量时，数据可以总结为列联表 (contingency table)。</p>
</li>
<li>
<p>可以使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xtabs()</span><br></pre></td></tr></table></figure>
<p>创建列联表，并用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plot()</span><br></pre></td></tr></table></figure>
<p>(马赛克图) 或</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">barplot()</span><br></pre></td></tr></table></figure>
<p>可视化。</p>
</li>
<li>
<p>关联性研究:</p>
<ul>
<li>
<p>Poisson回归方法</p>
<p>: 可以将列联表中的频数作为响应变量，用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">glm(Freq ~ FactorA * FactorB, family = poisson, ...)</span><br></pre></td></tr></table></figure>
<p>拟合。交互作用项的系数exp(βinteraction)即为Odds Ratio (OR)，表示一个因子水平下，另一个因子不同水平间的odds比率。</p>
</li>
<li>
<p>Logistic回归方法 (等价性)</p>
<p>: 如果将其中一个因子视为响应（如Pass/Fail），另一个因子视为解释变量，用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">glm(cbind(Pass_counts, Fail_counts) ~ Factor_predictor, family=binomial, ...)</span><br></pre></td></tr></table></figure>
<p>拟合，其解释变量的系数exp(βpredictor)也解释为Odds Ratio，且与Poisson模型交互作用项的OR在饱和模型中是等价的。</p>
</li>
<li>
<p>代码中演示了对 <code>AttendPass</code> 数据分别用这两种GLM方法以及直接计算OR，结果相似。</p>
</li>
<li>
<p>教材第16章 (第18-29页) 详细讨论了这种等价性。</p>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>总结：Lecture 11 是 GLM 的重要组成部分，系统介绍了 Logistic 回归的原理、实现、解释和预测，并通过实例（包括著名的挑战者号案例）强调了其在处理二元/比例数据时的正确性和重要性。同时，也开始将 GLM 应用于列联表的关联性分析，为更复杂的分类数据分析打下基础。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Logistic 回归 - 篮球数据示例</span></span><br><span class="line">library<span class="punctuation">(</span>s20x<span class="punctuation">)</span> <span class="comment"># 加载s20x包</span></span><br><span class="line">bb.df <span class="operator">=</span> read.csv<span class="punctuation">(</span><span class="string">&quot;basketball.csv&quot;</span><span class="punctuation">)</span> <span class="comment"># 读取篮球投篮数据</span></span><br><span class="line">head<span class="punctuation">(</span>bb.df<span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">)</span> <span class="comment"># 查看数据前10行</span></span><br><span class="line">bb.fit <span class="operator">=</span> glm<span class="punctuation">(</span>basket <span class="operator">~</span> distance <span class="operator">*</span> gender<span class="punctuation">,</span> <span class="comment"># basket(0或1) 对 距离和性别的交互作用模型</span></span><br><span class="line">             family <span class="operator">=</span> binomial<span class="punctuation">,</span> data <span class="operator">=</span> bb.df<span class="punctuation">)</span> <span class="comment"># 使用二项分布族 (logistic连接函数是默认)</span></span><br><span class="line">plot<span class="punctuation">(</span>bb.fit<span class="punctuation">,</span> which <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> lty<span class="operator">=</span><span class="number">2</span><span class="punctuation">)</span> <span class="comment"># 残差图 (对于未分组二元数据，解释性有限)</span></span><br><span class="line">summary<span class="punctuation">(</span>bb.fit<span class="punctuation">)</span> <span class="comment"># 查看模型摘要</span></span><br><span class="line"><span class="number">1</span><span class="operator">-</span>pchisq<span class="punctuation">(</span><span class="number">46.202</span><span class="punctuation">,</span> <span class="number">56</span><span class="punctuation">)</span> <span class="comment"># 离散度检验的近似 (对于未分组数据，解释需谨慎)</span></span><br><span class="line">bb.fit1 <span class="operator">=</span> glm<span class="punctuation">(</span>basket <span class="operator">~</span> distance <span class="operator">+</span> gender<span class="punctuation">,</span> family <span class="operator">=</span> binomial<span class="punctuation">,</span> data <span class="operator">=</span> bb.df<span class="punctuation">)</span> <span class="comment"># 移除交互作用</span></span><br><span class="line">summary<span class="punctuation">(</span>bb.fit1<span class="punctuation">)</span></span><br><span class="line">bb.fit2 <span class="operator">=</span> glm<span class="punctuation">(</span>basket <span class="operator">~</span> distance<span class="punctuation">,</span> family <span class="operator">=</span> binomial<span class="punctuation">,</span> data <span class="operator">=</span> bb.df<span class="punctuation">)</span> <span class="comment"># 仅保留距离作为预测变量</span></span><br><span class="line">summary<span class="punctuation">(</span>bb.fit2<span class="punctuation">)</span></span><br><span class="line"><span class="number">100</span><span class="operator">*</span><span class="punctuation">(</span><span class="built_in">exp</span><span class="punctuation">(</span>coef<span class="punctuation">(</span>bb.fit2<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="operator">-</span><span class="number">1</span><span class="punctuation">)</span> <span class="comment"># 距离每增加1单位，odds变化的百分比</span></span><br><span class="line"><span class="punctuation">(</span>bb.ci2 <span class="operator">=</span> confint<span class="punctuation">(</span>bb.fit2<span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># 系数的置信区间 (log-odds尺度)</span></span><br><span class="line"><span class="number">100</span><span class="operator">*</span><span class="punctuation">(</span><span class="built_in">exp</span><span class="punctuation">(</span>bb.ci2<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="operator">-</span><span class="number">1</span><span class="punctuation">)</span> <span class="comment"># 距离每增加1单位，odds变化百分比的置信区间</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 预测</span></span><br><span class="line">predn.df<span class="operator">=</span>data.frame<span class="punctuation">(</span>distance <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span><span class="number">3</span><span class="punctuation">)</span> <span class="comment"># 创建新的距离值用于预测</span></span><br><span class="line">bb.logit.pred <span class="operator">=</span> predict<span class="punctuation">(</span>bb.fit2<span class="punctuation">,</span> newdata <span class="operator">=</span> predn.df<span class="punctuation">)</span> <span class="comment"># 预测 (默认在log-odds尺度，即线性预测子)</span></span><br><span class="line">bb.logit.pred <span class="comment"># 这是在log-odds尺度上</span></span><br><span class="line"><span class="built_in">exp</span><span class="punctuation">(</span>bb.logit.pred<span class="punctuation">)</span> <span class="comment"># 转换到odds尺度</span></span><br><span class="line"><span class="built_in">exp</span><span class="punctuation">(</span>bb.logit.pred<span class="punctuation">)</span> <span class="operator">/</span> <span class="punctuation">(</span><span class="number">1</span><span class="operator">+</span><span class="built_in">exp</span><span class="punctuation">(</span>bb.logit.pred<span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># 从odds转换到概率尺度 p = odds/(1+odds)</span></span><br><span class="line">plogis<span class="punctuation">(</span>bb.logit.pred<span class="punctuation">)</span> <span class="comment"># 内置函数，从log-odds转换到概率尺度 (logistic函数)</span></span><br><span class="line">predict<span class="punctuation">(</span>bb.fit2<span class="punctuation">,</span> newdata <span class="operator">=</span> predn.df<span class="punctuation">,</span> type<span class="operator">=</span><span class="string">&quot;response&quot;</span><span class="punctuation">)</span> <span class="comment"># 直接在概率尺度上预测</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 概率的置信区间</span></span><br><span class="line">bb.logit.predses <span class="operator">=</span> predict<span class="punctuation">(</span> <span class="comment"># 获取log-odds尺度预测的标准误</span></span><br><span class="line">  bb.fit2<span class="punctuation">,</span> newdata <span class="operator">=</span> predn.df<span class="punctuation">,</span> se.fit <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span><span class="operator">$</span>se.fit</span><br><span class="line"><span class="comment"># log-odds的置信区间上下限</span></span><br><span class="line">lower <span class="operator">=</span> bb.logit.pred <span class="operator">-</span> <span class="number">1.96</span><span class="operator">*</span>bb.logit.predses</span><br><span class="line">upper <span class="operator">=</span> bb.logit.pred <span class="operator">+</span> <span class="number">1.96</span><span class="operator">*</span>bb.logit.predses</span><br><span class="line">ci.logit <span class="operator">=</span> cbind<span class="punctuation">(</span>lower<span class="punctuation">,</span> upper<span class="punctuation">)</span> <span class="comment"># log-odds的置信区间</span></span><br><span class="line"><span class="comment"># 转换为概率的置信区间</span></span><br><span class="line">ci.prob <span class="operator">=</span> plogis<span class="punctuation">(</span>ci.logit<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 或者使用s20x包中的predictGLM</span></span><br><span class="line">predictGLM<span class="punctuation">(</span>bb.fit2<span class="punctuation">,</span> newdata <span class="operator">=</span> predn.df<span class="punctuation">,</span> type<span class="operator">=</span><span class="string">&quot;link&quot;</span><span class="punctuation">)</span> <span class="comment"># log-odds尺度的CI</span></span><br><span class="line">predictGLM<span class="punctuation">(</span>bb.fit2<span class="punctuation">,</span> newdata <span class="operator">=</span> predn.df<span class="punctuation">,</span> type<span class="operator">=</span><span class="string">&quot;response&quot;</span><span class="punctuation">)</span> <span class="comment"># 概率尺度的CI</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 展示模型</span></span><br><span class="line">plot<span class="punctuation">(</span>basket <span class="operator">~</span> distance<span class="punctuation">,</span> xlim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">5</span><span class="punctuation">)</span><span class="punctuation">,</span> ylim<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="comment"># 绘制原始0/1数据点</span></span><br><span class="line">     ylab <span class="operator">=</span> <span class="string">&quot;fitted values (Est prob)&quot;</span><span class="punctuation">,</span> data <span class="operator">=</span> bb.df<span class="punctuation">)</span></span><br><span class="line">distance.plot <span class="operator">=</span> seq<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">5</span><span class="punctuation">,</span> by <span class="operator">=</span> <span class="number">0.1</span><span class="punctuation">)</span> <span class="comment"># 创建平滑的距离序列</span></span><br><span class="line">phat <span class="operator">=</span> predict<span class="punctuation">(</span>bb.fit2<span class="punctuation">,</span> newdata <span class="operator">=</span> data.frame<span class="punctuation">(</span> <span class="comment"># 预测概率</span></span><br><span class="line">  distance<span class="operator">=</span>distance.plot<span class="punctuation">)</span><span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&quot;response&quot;</span><span class="punctuation">)</span></span><br><span class="line">lines<span class="punctuation">(</span>distance.plot<span class="punctuation">,</span> phat<span class="punctuation">)</span> <span class="comment"># 绘制拟合的S形曲线</span></span><br><span class="line">ci.plot <span class="operator">=</span> predictGLM<span class="punctuation">(</span>bb.fit2<span class="punctuation">,</span> newdata <span class="operator">=</span> data.frame<span class="punctuation">(</span> <span class="comment"># 获取概率的置信带</span></span><br><span class="line">  distance<span class="operator">=</span>distance.plot<span class="punctuation">)</span><span class="punctuation">,</span> type<span class="operator">=</span><span class="string">&quot;response&quot;</span><span class="punctuation">)</span></span><br><span class="line">lines<span class="punctuation">(</span>distance.plot<span class="punctuation">,</span> ci.plot<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">,</span> lty <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span> <span class="comment"># 置信带下限</span></span><br><span class="line">lines<span class="punctuation">(</span>distance.plot<span class="punctuation">,</span> ci.plot<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">]</span><span class="punctuation">,</span> lty <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span> <span class="comment"># 置信带上限</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 未分组 vs 分组数据</span></span><br><span class="line">head<span class="punctuation">(</span>bb.df<span class="punctuation">)</span> <span class="comment"># 未分组数据</span></span><br><span class="line">success.tbl <span class="operator">=</span> xtabs<span class="punctuation">(</span>basket<span class="operator">~</span>distance<span class="operator">+</span>gender<span class="punctuation">,</span> data <span class="operator">=</span> bb.df<span class="punctuation">)</span> <span class="comment"># 创建成功次数的列联表</span></span><br><span class="line">success.tbl <span class="comment"># 成功次数表</span></span><br><span class="line"><span class="built_in">sum</span><span class="punctuation">(</span>success.tbl<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">6</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="comment"># 总成功次数</span></span><br><span class="line"><span class="built_in">sum</span><span class="punctuation">(</span>bb.df<span class="operator">$</span>basket<span class="punctuation">)</span> <span class="comment"># 与上面应一致</span></span><br><span class="line">str<span class="punctuation">(</span>success.tbl<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">(</span>dist.unique <span class="operator">=</span> <span class="built_in">attr</span><span class="punctuation">(</span>success.tbl<span class="punctuation">,</span> <span class="string">&quot;dimnames&quot;</span><span class="punctuation">)</span><span class="operator">$</span>distance<span class="punctuation">)</span> <span class="comment"># 获取距离的唯一值</span></span><br><span class="line"><span class="punctuation">(</span>distance <span class="operator">=</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="built_in">as.numeric</span><span class="punctuation">(</span>dist.unique<span class="punctuation">)</span><span class="punctuation">,</span> times <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># 重复以匹配性别</span></span><br><span class="line"><span class="punctuation">(</span>gender.unique <span class="operator">=</span> <span class="built_in">attr</span><span class="punctuation">(</span>success.tbl<span class="punctuation">,</span> <span class="string">&quot;dimnames&quot;</span><span class="punctuation">)</span><span class="operator">$</span>gender<span class="punctuation">)</span> <span class="comment"># 获取性别的唯一值</span></span><br><span class="line"><span class="punctuation">(</span>gender <span class="operator">=</span> <span class="built_in">rep</span><span class="punctuation">(</span>gender.unique<span class="punctuation">,</span> each <span class="operator">=</span> <span class="number">3</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># 重复以匹配距离</span></span><br><span class="line">fail.tbl <span class="operator">=</span> xtabs<span class="punctuation">(</span><span class="number">1</span><span class="operator">-</span>basket<span class="operator">~</span>distance<span class="operator">+</span>gender<span class="punctuation">,</span> data <span class="operator">=</span> bb.df<span class="punctuation">)</span> <span class="comment"># 创建失败次数的列联表</span></span><br><span class="line">bb.grouped.df <span class="operator">=</span> data.frame<span class="punctuation">(</span> <span class="comment"># 创建分组后的数据框</span></span><br><span class="line">  success <span class="operator">=</span> success.tbl<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">6</span><span class="punctuation">]</span><span class="punctuation">,</span> fail <span class="operator">=</span> fail.tbl<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">6</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  distance <span class="operator">=</span> distance<span class="punctuation">,</span> gender <span class="operator">=</span> gender<span class="punctuation">)</span></span><br><span class="line">bb.grouped.fit <span class="operator">=</span> glm<span class="punctuation">(</span> <span class="comment"># 使用 cbind(success, fail) 作为响应变量</span></span><br><span class="line">  cbind<span class="punctuation">(</span>success<span class="punctuation">,</span> fail<span class="punctuation">)</span> <span class="operator">~</span> distance <span class="operator">*</span> gender<span class="punctuation">,</span></span><br><span class="line">  family <span class="operator">=</span> binomial<span class="punctuation">,</span>data <span class="operator">=</span> bb.grouped.df<span class="punctuation">)</span></span><br><span class="line">summary<span class="punctuation">(</span>bb.grouped.fit<span class="punctuation">)</span> <span class="comment"># 分组数据拟合结果</span></span><br><span class="line">summary<span class="punctuation">(</span>bb.fit<span class="punctuation">)</span> <span class="comment"># 未分组数据拟合结果 (应相同)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第三种拟合logistic回归的方式 (使用比例和权重)</span></span><br><span class="line">bb.grouped.df<span class="operator">$</span>n <span class="operator">=</span> bb.grouped.df<span class="operator">$</span>success <span class="operator">+</span> bb.grouped.df<span class="operator">$</span>fail <span class="comment"># 总试验次数</span></span><br><span class="line">bb.grouped.df<span class="operator">$</span>prop <span class="operator">=</span> bb.grouped.df<span class="operator">$</span>success<span class="operator">/</span>bb.grouped.df<span class="operator">$</span>n <span class="comment"># 成功比例</span></span><br><span class="line">bb.grouped.prop.fit <span class="operator">=</span> glm<span class="punctuation">(</span></span><br><span class="line">  prop <span class="operator">~</span> distance <span class="operator">*</span> gender<span class="punctuation">,</span> weights <span class="operator">=</span> n<span class="punctuation">,</span> <span class="comment"># 使用成功比例作为响应，总次数作为权重</span></span><br><span class="line">  family <span class="operator">=</span> binomial<span class="punctuation">,</span>data <span class="operator">=</span> bb.grouped.df<span class="punctuation">)</span></span><br><span class="line">summary<span class="punctuation">(</span>bb.grouped.prop.fit<span class="punctuation">)</span> <span class="comment"># 结果应与前两种方式一致</span></span><br><span class="line">summary<span class="punctuation">(</span>bb.grouped.fit<span class="punctuation">)</span></span><br><span class="line">summary<span class="punctuation">(</span>bb.fit<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 不使用logistic回归的真正危险 (挑战者号航天飞机案例)</span></span><br><span class="line">Space.df <span class="operator">=</span> read.table<span class="punctuation">(</span><span class="string">&quot;ChallengerShuttle.txt&quot;</span><span class="punctuation">,</span> head <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span> <span class="comment"># 读取挑战者号数据</span></span><br><span class="line">Space.df <span class="comment"># 已知有6个O型环</span></span><br><span class="line">Space.df<span class="operator">$</span>prop <span class="operator">=</span> Space.df<span class="operator">$</span>Failure<span class="operator">/</span><span class="number">6</span> <span class="comment"># 计算失败比例</span></span><br><span class="line"><span class="comment"># 错误方法1: 移除0失败的数据点后用普通线性模型拟合</span></span><br><span class="line">Space.no.zero.fit <span class="operator">=</span> lm<span class="punctuation">(</span>prop<span class="operator">~</span>Temp<span class="punctuation">,</span> data <span class="operator">=</span> subset<span class="punctuation">(</span>Space.df<span class="punctuation">,</span> Failure<span class="operator">&gt;</span><span class="number">0</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">summary<span class="punctuation">(</span>Space.no.zero.fit<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 错误方法2: 直接用普通线性模型拟合比例</span></span><br><span class="line">Space.fit <span class="operator">=</span> lm<span class="punctuation">(</span>prop<span class="operator">~</span>Temp<span class="punctuation">,</span> data <span class="operator">=</span> Space.df<span class="punctuation">)</span></span><br><span class="line">summary<span class="punctuation">(</span>Space.fit<span class="punctuation">)</span> <span class="comment"># 这个模型的预测可能超出[0,1]范围</span></span><br><span class="line">plot<span class="punctuation">(</span>Space.fit<span class="punctuation">,</span> which <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span> <span class="comment"># 残差图可能显示问题</span></span><br><span class="line">normcheck<span class="punctuation">(</span>Space.fit<span class="punctuation">)</span> <span class="comment"># 正态性假设不成立</span></span><br><span class="line">cooks20x<span class="punctuation">(</span>Space.fit<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 正确方法: logistic回归</span></span><br><span class="line">Space.logistic.fit<span class="operator">=</span>glm<span class="punctuation">(</span></span><br><span class="line">  cbind<span class="punctuation">(</span>Failure<span class="punctuation">,</span> <span class="number">6</span><span class="operator">-</span>Failure<span class="punctuation">)</span><span class="operator">~</span>Temp<span class="punctuation">,</span> family <span class="operator">=</span> binomial<span class="punctuation">,</span> data <span class="operator">=</span> Space.df<span class="punctuation">)</span> <span class="comment"># Failure是成功(这里指O环损坏)次数, 6-Failure是未损坏次数</span></span><br><span class="line">summary<span class="punctuation">(</span>Space.logistic.fit<span class="punctuation">)</span></span><br><span class="line">predictGLM<span class="punctuation">(</span>Space.logistic.fit<span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&quot;response&quot;</span><span class="punctuation">,</span> <span class="comment"># 预测在31华氏度时O环损坏的概率</span></span><br><span class="line">           newdata <span class="operator">=</span> data.frame<span class="punctuation">(</span>Temp<span class="operator">=</span><span class="number">31</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>prop<span class="operator">~</span>Temp<span class="punctuation">,</span> ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span> xlim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">20</span><span class="punctuation">,</span><span class="number">100</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">     data <span class="operator">=</span> Space.df<span class="punctuation">)</span> <span class="comment"># 绘制原始比例数据</span></span><br><span class="line">Temp.plot <span class="operator">=</span> seq<span class="punctuation">(</span><span class="number">20</span><span class="punctuation">,</span> <span class="number">100</span><span class="punctuation">,</span> by <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span> <span class="comment"># 创建温度序列</span></span><br><span class="line">FV <span class="operator">=</span> predictGLM<span class="punctuation">(</span>Space.logistic.fit<span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&quot;response&quot;</span><span class="punctuation">,</span></span><br><span class="line">                newdata <span class="operator">=</span> data.frame<span class="punctuation">(</span>Temp<span class="operator">=</span>Temp.plot<span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># 预测损坏概率</span></span><br><span class="line">lines<span class="punctuation">(</span>Temp.plot<span class="punctuation">,</span> FV<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> lty <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span> <span class="comment"># 绘制拟合的logistic曲线</span></span><br><span class="line">abline<span class="punctuation">(</span>v <span class="operator">=</span> <span class="number">31</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;red&quot;</span><span class="punctuation">)</span> <span class="comment"># 标记挑战者号发射时的温度</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 类二项 (Quasibinomial) - 处理过离散 (当响应是比例时)</span></span><br><span class="line">Haddock.df <span class="operator">=</span> read.table<span class="punctuation">(</span><span class="string">&quot;Haddock.dat&quot;</span><span class="punctuation">,</span> head <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span> <span class="comment"># 读取黑线鳕数据 (已分组)</span></span><br><span class="line">Haddock.glm <span class="operator">=</span> glm<span class="punctuation">(</span>cbind<span class="punctuation">(</span>codend<span class="punctuation">,</span>cover<span class="punctuation">)</span> <span class="operator">~</span> forklen<span class="punctuation">,</span> family <span class="operator">=</span> binomial<span class="punctuation">,</span> <span class="comment"># codend是网到的，cover是逃逸的</span></span><br><span class="line">                  data <span class="operator">=</span> Haddock.df<span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>Haddock.glm<span class="punctuation">,</span> which <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">cooks20x<span class="punctuation">(</span>Haddock.glm<span class="punctuation">)</span></span><br><span class="line">Haddock.df<span class="punctuation">[</span><span class="number">6</span><span class="punctuation">,</span><span class="punctuation">]</span> <span class="comment"># 查看某个可能有影响的点</span></span><br><span class="line"><span class="comment"># summary(Haddock.glm) # 查看初始模型</span></span><br><span class="line"><span class="comment"># Haddock.glm = glm(cbind(codend,cover) ~ forklen, family = binomial, # 尝试移除影响点</span></span><br><span class="line"><span class="comment">#                   data = Haddock.df[-6,])</span></span><br><span class="line"><span class="comment"># cooks20x(Haddock.glm) # 再次检查</span></span><br><span class="line"><span class="comment"># 检查离散度：如果p值小，则存在过离散或欠离散</span></span><br><span class="line"><span class="number">1</span> <span class="operator">-</span> pchisq<span class="punctuation">(</span>summary<span class="punctuation">(</span>Haddock.glm<span class="punctuation">)</span><span class="operator">$</span>deviance<span class="punctuation">,</span></span><br><span class="line">           summary<span class="punctuation">(</span>Haddock.glm<span class="punctuation">)</span><span class="operator">$</span>df.residual<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 如果p值小，我们可以尝试 family = quasibinomial</span></span><br><span class="line">Haddock.quasi.glm <span class="operator">=</span> glm<span class="punctuation">(</span></span><br><span class="line">  cbind<span class="punctuation">(</span>codend<span class="punctuation">,</span>cover<span class="punctuation">)</span> <span class="operator">~</span> forklen<span class="punctuation">,</span></span><br><span class="line">  family <span class="operator">=</span> quasibinomial<span class="punctuation">,</span> <span class="comment"># 使用类二项分布族</span></span><br><span class="line">  data <span class="operator">=</span> Haddock.df<span class="punctuation">)</span> <span class="comment"># 教材中使用的是 data = Haddock.df[-6,]</span></span><br><span class="line">summary<span class="punctuation">(</span>Haddock.quasi.glm<span class="punctuation">)</span> <span class="comment"># 类二项模型摘要</span></span><br><span class="line">summary<span class="punctuation">(</span>Haddock.glm<span class="punctuation">)</span> <span class="comment"># 与二项模型比较 (系数估计相同，标准误不同)</span></span><br><span class="line"><span class="number">100</span><span class="operator">*</span><span class="punctuation">(</span><span class="built_in">exp</span><span class="punctuation">(</span>confint<span class="punctuation">(</span>Haddock.glm<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">-</span> <span class="number">1</span><span class="punctuation">)</span> <span class="comment"># 解释系数 (odds百分比变化)</span></span><br><span class="line">forklen.plot <span class="operator">=</span> seq<span class="punctuation">(</span><span class="number">10</span><span class="punctuation">,</span> <span class="number">60</span><span class="punctuation">,</span> by <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span> <span class="comment"># 创建鱼叉长度序列</span></span><br><span class="line">FV <span class="operator">=</span> predictGLM<span class="punctuation">(</span>Haddock.glm<span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&quot;response&quot;</span><span class="punctuation">,</span> <span class="comment"># 预测捕获概率</span></span><br><span class="line">                newdata <span class="operator">=</span> data.frame<span class="punctuation">(</span>forklen<span class="operator">=</span>forklen.plot<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>forklen.plot<span class="punctuation">,</span> FV<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&quot;l&quot;</span><span class="punctuation">,</span></span><br><span class="line">     xlab <span class="operator">=</span> <span class="string">&quot;Fork Length (cm)&quot;</span><span class="punctuation">,</span> ylab <span class="operator">=</span> <span class="string">&quot;Prob&quot;</span><span class="punctuation">)</span> <span class="comment"># 绘制拟合的logistic曲线</span></span><br><span class="line">prop <span class="operator">=</span> Haddock.df<span class="operator">$</span>codend<span class="operator">/</span><span class="punctuation">(</span>Haddock.df<span class="operator">$</span>codend<span class="operator">+</span>Haddock.df<span class="operator">$</span>cover<span class="punctuation">)</span> <span class="comment"># 计算原始数据中的比例</span></span><br><span class="line">points<span class="punctuation">(</span>Haddock.df<span class="operator">$</span>forklen<span class="punctuation">,</span> prop<span class="punctuation">)</span> <span class="comment"># 添加原始数据点</span></span><br><span class="line">rm<span class="punctuation">(</span><span class="built_in">list</span><span class="operator">=</span>ls<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># 清除工作空间</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 列联表 (关联性研究)</span></span><br><span class="line"><span class="comment"># 例如：眼睛和头发颜色</span></span><br><span class="line">Genetics<span class="operator">=</span>matrix<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">284</span><span class="punctuation">,</span> <span class="number">577</span><span class="punctuation">,</span> <span class="number">613</span><span class="punctuation">,</span> <span class="number">2002</span><span class="punctuation">)</span><span class="punctuation">,</span>ncol<span class="operator">=</span><span class="number">2</span><span class="punctuation">)</span> <span class="comment"># 创建矩阵</span></span><br><span class="line">rownames<span class="punctuation">(</span>Genetics<span class="punctuation">)</span> <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Hair brown&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Hair other&quot;</span><span class="punctuation">)</span></span><br><span class="line">colnames<span class="punctuation">(</span>Genetics<span class="punctuation">)</span> <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Eyes brown&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Eyes other&quot;</span><span class="punctuation">)</span></span><br><span class="line">gen.tbl<span class="operator">=</span>as.table<span class="punctuation">(</span>Genetics<span class="punctuation">)</span> <span class="comment"># 转换为表格对象</span></span><br><span class="line">gen.tbl</span><br><span class="line">plot<span class="punctuation">(</span>gen.tbl<span class="punctuation">)</span> <span class="comment"># 绘制马赛克图</span></span><br><span class="line">barplot<span class="punctuation">(</span>gen.tbl<span class="punctuation">)</span> <span class="comment"># 绘制条形图</span></span><br><span class="line">legend<span class="punctuation">(</span><span class="string">&quot;topleft&quot;</span><span class="punctuation">,</span> legend<span class="operator">=</span>rownames<span class="punctuation">(</span>gen.tbl<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">       fill<span class="operator">=</span>grey<span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">2</span><span class="operator">/</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 疫苗和压痛程度</span></span><br><span class="line">vaccines<span class="operator">=</span>matrix<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">21</span><span class="punctuation">,</span><span class="number">16</span><span class="punctuation">,</span><span class="number">11</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">22</span><span class="punctuation">,</span><span class="number">19</span><span class="punctuation">,</span><span class="number">9</span><span class="punctuation">)</span><span class="punctuation">,</span>nrow<span class="operator">=</span><span class="number">2</span><span class="punctuation">,</span>byrow<span class="operator">=</span><span class="built_in">T</span><span class="punctuation">)</span></span><br><span class="line">rownames<span class="punctuation">(</span>vaccines<span class="punctuation">)</span><span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Trmt A&quot;</span><span class="punctuation">,</span><span class="string">&quot;Trmt B&quot;</span><span class="punctuation">)</span></span><br><span class="line">colnames<span class="punctuation">(</span>vaccines<span class="punctuation">)</span><span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;none&quot;</span><span class="punctuation">,</span><span class="string">&quot;mild&quot;</span><span class="punctuation">,</span><span class="string">&quot;moderate&quot;</span><span class="punctuation">,</span><span class="string">&quot;severe&quot;</span><span class="punctuation">)</span></span><br><span class="line">vax.tbl<span class="operator">=</span>as.table<span class="punctuation">(</span>vaccines<span class="punctuation">)</span></span><br><span class="line">vax.tbl</span><br><span class="line">plot<span class="punctuation">(</span>vax.tbl<span class="punctuation">)</span> <span class="comment"># 马赛克图</span></span><br><span class="line">n.levels <span class="operator">=</span> ncol<span class="punctuation">(</span>vax.tbl<span class="punctuation">)</span></span><br><span class="line">barplot<span class="punctuation">(</span>t<span class="punctuation">(</span>vax.tbl<span class="punctuation">)</span><span class="punctuation">,</span> col<span class="operator">=</span>grey<span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span>n.levels<span class="operator">/</span>n.levels<span class="punctuation">)</span><span class="punctuation">,</span> ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">60</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># 转置后绘制堆叠条形图</span></span><br><span class="line">legend<span class="punctuation">(</span><span class="string">&quot;top&quot;</span><span class="punctuation">,</span> legend<span class="operator">=</span>colnames<span class="punctuation">(</span>vax.tbl<span class="punctuation">)</span><span class="punctuation">,</span> horiz <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span></span><br><span class="line">       fill<span class="operator">=</span>grey<span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span>n.levels<span class="operator">/</span>n.levels<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 课程通过与否和出勤情况</span></span><br><span class="line">AP.df <span class="operator">=</span> read.table<span class="punctuation">(</span><span class="string">&quot;AttendPass.txt&quot;</span><span class="punctuation">,</span>header<span class="operator">=</span><span class="built_in">T</span><span class="punctuation">)</span> <span class="comment"># 读取出勤与通过数据</span></span><br><span class="line">head<span class="punctuation">(</span>AP.df<span class="punctuation">,</span> <span class="number">8</span><span class="punctuation">)</span></span><br><span class="line">AP.tbl <span class="operator">=</span> xtabs<span class="punctuation">(</span><span class="operator">~</span>Attend<span class="operator">+</span>Pass<span class="punctuation">,</span> data <span class="operator">=</span> AP.df<span class="punctuation">)</span> <span class="comment"># 创建列联表</span></span><br><span class="line">barplot<span class="punctuation">(</span>t<span class="punctuation">(</span>AP.tbl<span class="punctuation">)</span><span class="punctuation">,</span>legend<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">)</span> <span class="comment"># 绘制条形图</span></span><br><span class="line">plot<span class="punctuation">(</span>AP.tbl<span class="punctuation">)</span> <span class="comment"># 绘制马赛克图</span></span><br><span class="line">prop.table<span class="punctuation">(</span>AP.tbl<span class="punctuation">)</span> <span class="comment"># 计算比例表</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 多维列联表</span></span><br><span class="line"><span class="comment"># 2. 响应变量和解释变量可能清晰也可能不清晰</span></span><br><span class="line"><span class="comment"># 3. 试验次数n是否固定可能清晰也可能不清晰</span></span><br><span class="line"><span class="comment"># 4. 在研究关联性时这些不一定重要</span></span><br><span class="line"><span class="comment"># 泊松回归和二项回归在关联性研究中的等价性</span></span><br><span class="line">freq.df <span class="operator">=</span> data.frame<span class="punctuation">(</span> <span class="comment"># 将列联表转换为长格式数据框</span></span><br><span class="line">  Y<span class="operator">=</span>AP.tbl<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">4</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="comment"># 频数</span></span><br><span class="line">  Attend<span class="operator">=</span><span class="built_in">rep</span><span class="punctuation">(</span><span class="built_in">attr</span><span class="punctuation">(</span>AP.tbl<span class="punctuation">,</span> <span class="string">&quot;dimnames&quot;</span><span class="punctuation">)</span><span class="operator">$</span>Attend<span class="punctuation">,</span> times <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">  Pass<span class="operator">=</span><span class="built_in">rep</span><span class="punctuation">(</span><span class="built_in">attr</span><span class="punctuation">(</span>AP.tbl<span class="punctuation">,</span> <span class="string">&quot;dimnames&quot;</span><span class="punctuation">)</span><span class="operator">$</span>Pass<span class="punctuation">,</span> each <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">AP.tbl</span><br><span class="line">freq.df<span class="operator">$</span>Attend <span class="operator">=</span> factor<span class="punctuation">(</span>freq.df<span class="operator">$</span>Attend<span class="punctuation">,</span> levels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;not.attend&quot;</span><span class="punctuation">,</span> <span class="string">&quot;attend&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># 设置因子水平</span></span><br><span class="line">freq.df<span class="operator">$</span>Pass <span class="operator">=</span> factor<span class="punctuation">(</span>freq.df<span class="operator">$</span>Pass<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># AP.tbl = AP.tbl[2:1,] # 这行会改变AP.tbl的行顺序，影响下面AP.grouped.df的创建，可能导致与freq.df不一致</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拟合泊松模型 (响应变量是频数Y)</span></span><br><span class="line">AP.pois<span class="operator">=</span>glm<span class="punctuation">(</span>Y<span class="operator">~</span>Attend<span class="operator">*</span>Pass<span class="punctuation">,</span>family<span class="operator">=</span>poisson<span class="punctuation">,</span>data<span class="operator">=</span>freq.df<span class="punctuation">)</span> <span class="comment"># 注意这里freq.df的Attend顺序</span></span><br><span class="line">summary<span class="punctuation">(</span>AP.pois<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拟合Logistic回归 (未分组数据)</span></span><br><span class="line">AP.logistic <span class="operator">=</span> glm<span class="punctuation">(</span></span><br><span class="line">  <span class="built_in">as.numeric</span><span class="punctuation">(</span>Pass<span class="operator">==</span><span class="string">&quot;pass&quot;</span><span class="punctuation">)</span><span class="operator">~</span>Attend<span class="punctuation">,</span> <span class="comment"># Pass==&quot;pass&quot;会产生0/1响应</span></span><br><span class="line">  family <span class="operator">=</span> binomial<span class="punctuation">,</span>data <span class="operator">=</span> AP.df<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拟合Logistic回归 (分组数据)</span></span><br><span class="line"><span class="comment"># AP.tbl的行顺序可能因上一条注释掉的命令而与freq.df不同，需要注意</span></span><br><span class="line">AP.grouped.df <span class="operator">=</span> data.frame<span class="punctuation">(</span> <span class="comment"># 从原始AP.tbl创建分组数据</span></span><br><span class="line">  pass <span class="operator">=</span> AP.tbl<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">,</span> fail <span class="operator">=</span> AP.tbl<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="comment"># 假设AP.tbl的列是 fail, pass</span></span><br><span class="line">  Attend <span class="operator">=</span> rownames<span class="punctuation">(</span>AP.tbl<span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># Attend是行名</span></span><br><span class="line">AP.grouped.df<span class="operator">$</span>Attend <span class="operator">&lt;-</span> factor<span class="punctuation">(</span>AP.grouped.df<span class="operator">$</span>Attend<span class="punctuation">,</span> levels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;not.attend&quot;</span><span class="punctuation">,</span> <span class="string">&quot;attend&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># 确保因子水平一致</span></span><br><span class="line"></span><br><span class="line">AP.grouped.logistic <span class="operator">=</span> glm<span class="punctuation">(</span>cbind<span class="punctuation">(</span>pass<span class="punctuation">,</span>fail<span class="punctuation">)</span><span class="operator">~</span>Attend<span class="punctuation">,</span></span><br><span class="line">                  family <span class="operator">=</span> binomial<span class="punctuation">,</span>data <span class="operator">=</span> AP.grouped.df<span class="punctuation">)</span> <span class="comment"># 使用成功/失败次数</span></span><br><span class="line"></span><br><span class="line">summary<span class="punctuation">(</span>AP.logistic<span class="punctuation">)</span></span><br><span class="line">summary<span class="punctuation">(</span>AP.grouped.logistic<span class="punctuation">)</span></span><br><span class="line">summary<span class="punctuation">(</span>AP.pois<span class="punctuation">)</span> <span class="comment"># 比较三个模型的系数</span></span><br><span class="line">confint<span class="punctuation">(</span>AP.logistic<span class="punctuation">)</span></span><br><span class="line">confint<span class="punctuation">(</span>AP.grouped.logistic<span class="punctuation">)</span></span><br><span class="line">confint<span class="punctuation">(</span>AP.pois<span class="punctuation">)</span> <span class="comment"># 交互作用项的系数 (log-odds ratio) 应与logistic中Attend的系数相似</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 不用模型计算Odds Ratio</span></span><br><span class="line">coef<span class="punctuation">(</span>AP.pois<span class="punctuation">)</span></span><br><span class="line">coef<span class="punctuation">(</span>AP.pois<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">4</span><span class="punctuation">]</span> <span class="comment"># Poisson模型中交互作用项的系数 (log odds ratio)</span></span><br><span class="line"><span class="built_in">exp</span><span class="punctuation">(</span>coef<span class="punctuation">(</span>AP.pois<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">4</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="comment"># Odds Ratio</span></span><br><span class="line">AP.tbl <span class="comment"># 原始列联表 (注意行顺序)</span></span><br><span class="line"><span class="comment"># (OR=(27*83)/(17*19)) # 手动计算OR ( (n00*n11)/(n01*n10) )，需确保AP.tbl顺序正确</span></span><br><span class="line"><span class="comment"># 例如，如果AP.tbl是:</span></span><br><span class="line"><span class="comment">#            Pass</span></span><br><span class="line"><span class="comment"># Attend     fail pass</span></span><br><span class="line"><span class="comment"># not.attend   27   19</span></span><br><span class="line"><span class="comment"># attend       17   83</span></span><br><span class="line"><span class="comment"># OR = (n_attend_pass * n_not.attend_fail) / (n_attend_fail * n_not.attend_pass)</span></span><br><span class="line"><span class="comment"># OR = (83 * 27) / (17 * 19)</span></span><br><span class="line"><span class="punctuation">(</span>OR <span class="operator">=</span> <span class="punctuation">(</span>AP.tbl<span class="punctuation">[</span><span class="string">&quot;attend&quot;</span><span class="punctuation">,</span><span class="string">&quot;pass&quot;</span><span class="punctuation">]</span> <span class="operator">*</span> AP.tbl<span class="punctuation">[</span><span class="string">&quot;not.attend&quot;</span><span class="punctuation">,</span><span class="string">&quot;fail&quot;</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="operator">/</span> <span class="punctuation">(</span>AP.tbl<span class="punctuation">[</span><span class="string">&quot;attend&quot;</span><span class="punctuation">,</span><span class="string">&quot;fail&quot;</span><span class="punctuation">]</span> <span class="operator">*</span> AP.tbl<span class="punctuation">[</span><span class="string">&quot;not.attend&quot;</span><span class="punctuation">,</span><span class="string">&quot;pass&quot;</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">logOR.se<span class="operator">=</span><span class="built_in">sqrt</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">/</span><span class="number">17</span><span class="operator">+</span><span class="number">1</span><span class="operator">/</span><span class="number">83</span><span class="operator">+</span><span class="number">1</span><span class="operator">/</span><span class="number">27</span><span class="operator">+</span><span class="number">1</span><span class="operator">/</span><span class="number">19</span><span class="punctuation">)</span> <span class="comment"># log(OR)的标准误近似公式</span></span><br><span class="line">logOR.CI<span class="operator">=</span><span class="built_in">log</span><span class="punctuation">(</span>OR<span class="punctuation">)</span> <span class="operator">+</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">1</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">)</span><span class="operator">*</span><span class="number">1.96</span><span class="operator">*</span>logOR.se <span class="comment"># log(OR)的置信区间</span></span><br><span class="line"><span class="built_in">exp</span><span class="punctuation">(</span>logOR.CI<span class="punctuation">)</span> <span class="comment"># OR的置信区间，应与模型结果相似</span></span><br><span class="line"><span class="built_in">exp</span><span class="punctuation">(</span>confint.default<span class="punctuation">(</span>AP.pois<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">4</span><span class="punctuation">,</span><span class="punctuation">]</span> <span class="punctuation">)</span> <span class="comment"># 从Poisson模型得到的OR置信区间</span></span><br></pre></td></tr></table></figure>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>请我一杯咖啡吧！</div>
  <button>
    赞赏
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.png" alt="Viny Yang 微信">
        <span>微信</span>
      </div>
      <div>
        <img src="/images/alipay.png" alt="Viny Yang 支付宝">
        <span>支付宝</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>Viny Yang
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://vinyyang.github.io/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E6%96%B9%E6%B3%95%EF%BC%88%E5%A4%96%E6%95%99%E7%89%88%EF%BC%89/" title="数据分析方法（外教版）">https://vinyyang.github.io/数据分析方法（外教版）/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


        
  <div class="social-like a2a_kit a2a_kit_size_32 a2a_default_style">
    <a class="a2a_dd" target="_blank" rel="noopener" href="https://www.addtoany.com/share"></a>
      <a class="a2a_button_wechat"></a>
  </div>

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8%EF%BC%88%E5%A4%96%E6%95%99%E7%89%88%EF%BC%89/" rel="prev" title="数据库原理与应用（外教版）">
                  <i class="fa fa-angle-left"></i> 数据库原理与应用（外教版）
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






    
  
  <div class="comments giscus-container">
  </div>
  
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Viny Yang</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">340k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">10:19</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

<!-- 网站运行时间的设置 -->
<span id="timeDate">载入天数...</span>
<span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("03/01/2023 10:00:00"); //此处修改你的建站时间或者网站上线时间
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒.";
    }
setInterval("createtime()",250);
</script>
    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/VinyYang" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.umd.js" integrity="sha256-a+H7FYzJv6oU2hfsfDGM2Ohw/cR9v+hPfxHCLdmCrE8=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.3.0/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="/js/third-party/tags/pdf.js"></script>

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.4.0/mermaid.min.js","integrity":"sha256-G8ouPAnw4zzMbnAenHnVz6h9XpKbNdOkrqTh7AadyHs="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>


  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>

  <script src="/js/third-party/addtoany.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"all","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="giscus" type="application/json">{"enable":true,"repo":"VinyYang/VinyYang.github.io","repo_id":"R_kgDON5FgxA","category":"Announcements","category_id":"DIC_kwDON5FgxM4Cm-MG","mapping":"pathname","strict":0,"reactions_enabled":1,"emit_metadata":0,"theme":"light","lang":"zh-CN","crossorigin":"anonymous","input_position":"bottom","loading":"lazy"}</script>

<script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.page.comments) return;

  NexT.utils.loadComments('.giscus-container')
    .then(() => NexT.utils.getScript('https://giscus.app/client.js', {
      attributes: {
        async                   : true,
        crossOrigin             : 'anonymous',
        'data-repo'             : CONFIG.giscus.repo,
        'data-repo-id'          : CONFIG.giscus.repo_id,
        'data-category'         : CONFIG.giscus.category,
        'data-category-id'      : CONFIG.giscus.category_id,
        'data-mapping'          : CONFIG.giscus.mapping,
        'data-strict'           : CONFIG.giscus.strict,
        'data-reactions-enabled': CONFIG.giscus.reactions_enabled,
        'data-emit-metadata'    : CONFIG.giscus.emit_metadata,
        'data-theme'            : CONFIG.giscus.theme,
        'data-lang'             : CONFIG.giscus.lang,
        'data-input-position'   : CONFIG.giscus.input_position,
        'data-loading'          : CONFIG.giscus.loading
      },
      parentNode: document.querySelector('.giscus-container')
    }));
});
</script>

<div class="contact-modal-overlay" style="display: none;">
  <div class="contact-modal-box">
    <div class="contact-modal-header">
      <span class="contact-modal-title"></span>
      <div class="header-actions">
        <button class="copy-button" data-email="yhy520@email.swu.edu.cn">
          <i class="fa fa-copy"></i>
        </button>
        <button class="contact-modal-close">&times;</button>
      </div>
    </div>
    <div class="contact-modal-body">
      <div class="image-wrapper">
        <img class="contact-qrcode" src="" alt="联系方式">
      </div>
    </div>
  </div>
</div>

<style>
/* 模态框基础样式 */
.contact-modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.6);
  z-index: 9999;
  display: flex;
  justify-content: center;
  align-items: center;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.contact-modal-box {
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.3);
  max-width: 80%;
  min-width: 300px;
  transform: scale(0.8);
  transition: all 0.3s ease;
}

.contact-modal-overlay.active {
  opacity: 1;
}

.contact-modal-overlay.active .contact-modal-box {
  transform: scale(1);
}

.contact-modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 15px 20px;
  border-bottom: 1px solid #eee;
}

.header-actions {
  display: flex;
  align-items: center;
  gap: 15px;
}

.contact-modal-title {
  font-size: 1.2em;
  color: #333;
  font-weight: bold;
}

.contact-modal-close {
  background: none;
  border: none;
  font-size: 24px;
  cursor: pointer;
  color: #666;
  transition: color 0.2s;
}

.contact-modal-close:hover {
  color: #333;
}

/* 图片容器 */
.image-wrapper {
  padding: 20px;
}

.contact-qrcode {
  max-width: 280px;
  max-height: 60vh;
  display: block;
  margin: 0 auto;
}

/* 复制按钮样式 */
.copy-button {
  background: rgba(255,255,255,0.9);
  border: 1px solid #eee;
  border-radius: 4px;
  padding: 6px 12px;
  cursor: pointer;
  transition: all 0.3s;
  display: none;
  color: #666;
}

.copy-button:hover {
  background: #fff;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

/* 邮箱按钮颜色保护 */
a[href*="/images/email.png"] {
  color: #fff !important;
}

a[href*="/images/email.png"] i {
  color: inherit !important;
}

@media (max-width: 767px) {
  .contact-modal-box {
    max-width: 90%;
  }
  
  .contact-qrcode {
    max-width: 200px;
  }
  
  .header-actions {
    gap: 10px;
  }
  
  .copy-button {
    padding: 4px 8px;
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // 绑定所有按钮事件
  const contactButtons = document.querySelectorAll(
    'a[href*="/images/wechat.png"], ' +
    'a[href*="/images/qq.png"], ' +
    'a[href*="/images/email.png"]'
  );

  // 通用展示函数
  const showContactModal = (type, path) => {
    const overlay = document.querySelector('.contact-modal-overlay');
    const title = document.querySelector('.contact-modal-title');
    const img = document.querySelector('.contact-qrcode');
    const copyBtn = document.querySelector('.copy-button');

    // 设置内容
    title.textContent = type;
    img.src = path;
    
    // 邮箱特殊处理
    if (type === '邮箱') {
      copyBtn.style.display = 'flex';
      copyBtn.querySelector('i').className = 'fa fa-copy'; // 重置图标状态
    } else {
      copyBtn.style.display = 'none';
    }

    // 显示模态框
    overlay.style.display = 'flex';
    setTimeout(() => overlay.classList.add('active'), 10);
  };

  // 绑定按钮点击事件
  contactButtons.forEach(btn => {
    btn.addEventListener('click', function(e) {
      e.preventDefault();
      const typeMap = {
        weixin: '微信',
        qq: 'QQ',
        envelope: '邮箱'
      };
      const iconClass = this.querySelector('i').className;
      const type = Object.keys(typeMap).find(key => iconClass.includes(key)) || '联系方式';
      showContactModal(typeMap[type], this.href);
    });
  });

  // 复制功能（防爬虫版）
  document.querySelector('.copy-button').addEventListener('click', function() {
    try {
      // 混淆邮箱地址（反转+Base64）
      const reversedEmail = 'yhy520@email.swu.edu.cn'.split('').reverse().join('');
      const realEmail = atob('eWh5NTIwQGVtYWlsLnN3dS5lZHUuY24='); // Base64解码
      
      navigator.clipboard.writeText(realEmail).then(() => {
        this.innerHTML = '<i class="fa fa-check"></i>';
        setTimeout(() => {
          this.innerHTML = '<i class="fa fa-copy"></i>';
        }, 2000);
      });
    } catch (error) {
      console.error('复制失败:', error);
      this.innerHTML = '<i class="fa fa-times"></i>';
      setTimeout(() => {
        this.innerHTML = '<i class="fa fa-copy"></i>';
      }, 2000);
    }
  });

  // 关闭逻辑
  const closeModal = () => {
    const overlay = document.querySelector('.contact-modal-overlay');
    overlay.classList.remove('active');
    setTimeout(() => {
      overlay.style.display = 'none';
    }, 300);
  };

  document.querySelector('.contact-modal-close').addEventListener('click', closeModal);
  document.querySelector('.contact-modal-overlay').addEventListener('click', (e) => {
    if(e.target === e.currentTarget) closeModal();
  });
});
</script>
</body>
</html>
