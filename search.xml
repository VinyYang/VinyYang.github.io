<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>ç®—æ³•åŸºç¡€è¯¾(æŒç»­æ›´æ–°ä¸­)</title>
    <url>/algorithm_learning/</url>
    <content><![CDATA[<h2 id="åŸºç¡€ç®—æ³•ï¼ˆä¸€ï¼‰"><a href="#åŸºç¡€ç®—æ³•ï¼ˆä¸€ï¼‰" class="headerlink" title="åŸºç¡€ç®—æ³•ï¼ˆä¸€ï¼‰"></a>åŸºç¡€ç®—æ³•ï¼ˆä¸€ï¼‰</h2><h3 id="å¿«é€Ÿæ’åº"><a href="#å¿«é€Ÿæ’åº" class="headerlink" title="å¿«é€Ÿæ’åº"></a>å¿«é€Ÿæ’åº</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">quick_sort</span><span class="params">(<span class="type">int</span> q[],<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l&gt;=r)<span class="keyword">return</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> i=l<span class="number">-1</span>,j=r<span class="number">+1</span>,x=q[l+r&gt;&gt;<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">while</span>(i&lt;j)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">do</span> i++;<span class="keyword">while</span>(q[i]&lt;x);</span><br><span class="line">        <span class="keyword">do</span> j--;<span class="keyword">while</span>(q[j]&gt;x);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">quick_sort</span>(q,l,j);</span><br><span class="line">    <span class="built_in">quick_sort</span>(q,j<span class="number">+1</span>,r);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å½’å¹¶æ’åº"><a href="#å½’å¹¶æ’åº" class="headerlink" title="å½’å¹¶æ’åº"></a>å½’å¹¶æ’åº</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">merge_sort</span><span class="params">(<span class="type">int</span> q[],<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l&gt;=r)<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">merge_sort</span>(q,l,mid),<span class="built_in">merge_sort</span>(q,mid<span class="number">+1</span>,r)ï¼›</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> k=<span class="number">0</span>,i=l,j=mid<span class="number">+1</span>;</span><br><span class="line">    <span class="keyword">while</span>(i&lt;=mid&amp;&amp;j&lt;=r)</span><br><span class="line">        <span class="keyword">if</span>(q[i]&lt;=q[j])tmp[k++]=q[i++];</span><br><span class="line">    <span class="keyword">else</span> tmp[k++]=q[j++];</span><br><span class="line">    <span class="keyword">while</span>(i&lt;=mid)tmp[k++]=q[i++];</span><br><span class="line">    <span class="keyword">while</span>(j&lt;=r)tmp[k++]=q[j++];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(i=l,j=<span class="number">0</span>;i&lt;=r;i++,j++)q[i]=tmp[j];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="äºŒåˆ†"><a href="#äºŒåˆ†" class="headerlink" title="äºŒåˆ†"></a>äºŒåˆ†</h3><h4 id="æ•´æ•°äºŒåˆ†"><a href="#æ•´æ•°äºŒåˆ†" class="headerlink" title="æ•´æ•°äºŒåˆ†"></a>æ•´æ•°äºŒåˆ†</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">check</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;<span class="comment">/* ... */</span>&#125; <span class="comment">// æ£€æŸ¥xæ˜¯å¦æ»¡è¶³æŸç§æ€§è´¨</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">// åŒºé—´[l, r]è¢«åˆ’åˆ†æˆ[l, mid]å’Œ[mid + 1, r]æ—¶ä½¿ç”¨ï¼š</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">bsearch_1</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (l &lt; r)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">check</span>(mid)) r = mid;    <span class="comment">// check()åˆ¤æ–­midæ˜¯å¦æ»¡è¶³æ€§è´¨</span></span><br><span class="line">        <span class="keyword">else</span> l = mid + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> l;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åŒºé—´[l, r]è¢«åˆ’åˆ†æˆ[l, mid - 1]å’Œ[mid, r]æ—¶ä½¿ç”¨ï¼š</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">bsearch_2</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (l &lt; r)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> mid = l + r + <span class="number">1</span> &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">check</span>(mid)) l = mid;</span><br><span class="line">        <span class="keyword">else</span> r = mid - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> l;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æµ®ç‚¹æ•°äºŒåˆ†"><a href="#æµ®ç‚¹æ•°äºŒåˆ†" class="headerlink" title="æµ®ç‚¹æ•°äºŒåˆ†"></a>æµ®ç‚¹æ•°äºŒåˆ†</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">check</span><span class="params">(<span class="type">double</span> x)</span> </span>&#123;<span class="comment">/* ... */</span>&#125; <span class="comment">// æ£€æŸ¥xæ˜¯å¦æ»¡è¶³æŸç§æ€§è´¨</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">bsearch_3</span><span class="params">(<span class="type">double</span> l, <span class="type">double</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">double</span> eps = <span class="number">1e-6</span>;   <span class="comment">// eps è¡¨ç¤ºç²¾åº¦ï¼Œå–å†³äºé¢˜ç›®å¯¹ç²¾åº¦çš„è¦æ±‚</span></span><br><span class="line">    <span class="keyword">while</span> (r - l &gt; eps)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">double</span> mid = (l + r) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">check</span>(mid)) r = mid;</span><br><span class="line">        <span class="keyword">else</span> l = mid;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> l;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="åŸºç¡€ç®—æ³•ï¼ˆäºŒï¼‰"><a href="#åŸºç¡€ç®—æ³•ï¼ˆäºŒï¼‰" class="headerlink" title="åŸºç¡€ç®—æ³•ï¼ˆäºŒï¼‰"></a>åŸºç¡€ç®—æ³•ï¼ˆäºŒï¼‰</h2><h3 id="é«˜ç²¾åº¦"><a href="#é«˜ç²¾åº¦" class="headerlink" title="é«˜ç²¾åº¦"></a>é«˜ç²¾åº¦</h3><h4 id="é«˜ç²¾åº¦åŠ æ³•"><a href="#é«˜ç²¾åº¦åŠ æ³•" class="headerlink" title="é«˜ç²¾åº¦åŠ æ³•"></a>é«˜ç²¾åº¦åŠ æ³•</h4><p>æœ¬è´¨ä¸Šæ˜¯æ¨¡æ‹Ÿäººè¿›è¡Œåˆ—ç«–å¼åŠ æ³•çš„è¿‡ç¨‹ï¼Œå³$a_1$+â€¦+$a_n$+tï¼Œå…¶ä¸­å½“$a$çš„é€€ä¸€ä½åŠ èµ·æ¥ä¸è¶…è¿‡10åˆ™$t&#x3D;0$å¦åˆ™$t&#x3D;1$ï¼Œä»¥æ­¤ç±»æ¨</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line">vector&lt;<span class="type">int</span>&gt;<span class="built_in">add</span>(vector&lt;<span class="type">int</span>&gt;&amp;A,vector&lt;<span class="type">int</span>&gt;&amp;B)</span><br><span class="line">&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt;C;</span><br><span class="line">    <span class="type">int</span> t=<span class="number">0</span>;<span class="comment">//å­˜å‚¨æ¯ä¸€ä½ç›¸åŠ åçš„æ•°ï¼ŒåŒæ—¶å®Œæˆæ˜¯å¦éœ€è¦è¿›ä½çš„è€ƒé‡</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;A.<span class="built_in">size</span>()||i&lt;B.<span class="built_in">size</span>();i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(i&lt;A.<span class="built_in">size</span>())t+=A[i];</span><br><span class="line">        <span class="keyword">if</span>(i&lt;B.<span class="built_in">size</span>())t+=B[i];</span><br><span class="line">        C.<span class="built_in">push_back</span>(t%<span class="number">10</span>);</span><br><span class="line">        t/=<span class="number">10</span>;</span><br><span class="line">	&#125;    </span><br><span class="line">    <span class="keyword">if</span>(t)C.<span class="built_in">push_back</span>(<span class="number">1</span>);<span class="comment">//æœ€åä¸€ä¸ªtä»£è¡¨æœ€é«˜ä½ï¼Œå› æ­¤ç­‰forå¾ªç¯è¿è¡Œå®Œåå†ç”¨åˆ¤æ–­çœ‹çœ‹è¿›ä½æƒ…å†µï¼Œæ˜¯çš„è¯å°±åœ¨vectoråé¢å†åŠ ä¸€ä¸ª1</span></span><br><span class="line">    <span class="keyword">return</span> C;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    string a,b;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt;A,B;</span><br><span class="line">    cin&gt;&gt;a&gt;&gt;b;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=a.<span class="built_in">size</span>()<span class="number">-1</span>;i&gt;=<span class="number">0</span>;i--)A.<span class="built_in">push_back</span>(a[i]-<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=b.<span class="built_in">size</span>()<span class="number">-1</span>;i&gt;=<span class="number">0</span>;i--)B.<span class="built_in">push_back</span>(b[i]-<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"><span class="comment">//Aã€Bå…ƒç´ è¿›æ ˆéƒ½æ˜¯é€†åºè¿›æ ˆï¼Œæ¯”å¦‚a=&#x27;123456&#x27;,é‚£A=[6.5,4,3,2,1],ç›®çš„æ˜¯æ–¹ä¾¿è¿›ä½å¤šäº†1çš„æ—¶å€™æ•´ä½“æ•°ç»„æŒªåŠ¨ç©ºé—´ä¸å¤§ï¼Œå¦åˆ™è¦æ˜¯æœ€é«˜ä½åœ¨å‰è¾¹taè¿›ä½åé¢æ•°ç»„æ‰€æœ‰æ•°å­—éƒ½è¦å¾€åæŒª</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">auto</span> C=<span class="built_in">add</span>(A,B);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=C.<span class="built_in">size</span>()<span class="number">-1</span>;i&gt;=<span class="number">0</span>;i--)cout&lt;&lt;C[i];</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="vectorç›¸å…³çŸ¥è¯†ç‚¹"><a href="#vectorç›¸å…³çŸ¥è¯†ç‚¹" class="headerlink" title="vectorç›¸å…³çŸ¥è¯†ç‚¹"></a>vectorç›¸å…³çŸ¥è¯†ç‚¹</h5><ul>
<li><p><strong>vectorå®šä¹‰</strong> <code>vector</code> æ˜¯ C++ æ ‡å‡†æ¨¡æ¿åº“ï¼ˆSTLï¼‰ä¸­çš„ä¸€ä¸ªå®¹å™¨ï¼Œå®ƒå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªåŠ¨æ€æ•°ç»„ã€‚å®ƒèƒ½å­˜å‚¨ä¸€ç³»åˆ—ç›¸åŒç±»å‹çš„å…ƒç´ ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®éœ€è¦è‡ªåŠ¨è°ƒæ•´å¤§å°ã€‚ä½¿ç”¨ <code>vector</code> éœ€è¦åŒ…å« <code>&lt;vector&gt;</code> å¤´æ–‡ä»¶ã€‚</p>
</li>
<li><p><strong>vectoræ•°ç»„ç›¸å…³æ“ä½œ</strong>ï¼ˆæœ€åé¢ï¼‰å¢åŠ ç”¨<code>.push_back(ä¸€ä¸ªæ•°)</code>ï¼Œï¼ˆæœ€åé¢ï¼‰åˆ é™¤<code>.pop_back(ä¸€ä¸ªæ•°)</code>ï¼ŒæŒ‡å®šä½ç½®æ’å…¥<code>.insert(å‘é‡,æŒ‡å®šä½ç½®)</code>ï¼ŒæŒ‡å®šä½ç½®åˆ é™¤<code>.erase(å‘é‡ï¼ŒæŒ‡å®šä½ç½®)</code>ï¼Œæ¸…ç©º<code>.clear()</code>ï¼ŒæŸ¥çœ‹å¤§å°<code>.size()</code></p>
</li>
<li><p><strong>vectorå…ƒç´ çš„ç´¢å¼•å’Œæ•°ç»„ä¸€æ ·ï¼Œä¹Ÿæ˜¯ä» 0 å¼€å§‹å­˜å‚¨çš„</strong></p>
</li>
<li><p><strong>vectorå’Œæ™®é€šæ•°ç»„åŒºåˆ«</strong></p>
<p>1.å¤§å°çµæ´»æ€§</p>
<ul>
<li><strong>æ™®é€šæ•°ç»„</strong>ï¼šå¤§å°åœ¨å®šä¹‰æ—¶å°±å¿…é¡»ç¡®å®šï¼Œä¸”åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ä¸èƒ½æ”¹å˜ã€‚ä¾‹å¦‚ <code>int arr[10];</code> å®šä¹‰äº†ä¸€ä¸ªå¤§å°ä¸º 10 çš„æ•´æ•°æ•°ç»„ï¼Œä¹‹åæ— æ³•å†æ”¹å˜å…¶å¤§å°ã€‚</li>
<li><strong>vector</strong>ï¼šå¯ä»¥åŠ¨æ€è°ƒæ•´å¤§å°ã€‚å¯ä»¥ä½¿ç”¨ <code>push_back()</code> æ–¹æ³•åœ¨æœ«å°¾æ·»åŠ å…ƒç´ ï¼Œå½“ç©ºé—´ä¸è¶³æ—¶ï¼Œ<code>vector</code> ä¼šè‡ªåŠ¨åˆ†é…æ›´å¤§çš„å†…å­˜ç©ºé—´æ¥å­˜å‚¨å…ƒç´ ã€‚</li>
</ul>
<p>2.å†…å­˜ç®¡ç†</p>
<ul>
<li><strong>æ™®é€šæ•°ç»„</strong>ï¼šç”±ç¨‹åºå‘˜æ‰‹åŠ¨ç®¡ç†å†…å­˜ã€‚å¦‚æœæ•°ç»„åœ¨æ ˆä¸Šåˆ†é…ï¼Œå…¶ç”Ÿå‘½å‘¨æœŸå—é™äºæ‰€åœ¨çš„ä»£ç å—ï¼›å¦‚æœåœ¨å †ä¸Šåˆ†é…ï¼ˆä½¿ç”¨ <code>new</code>ï¼‰ï¼Œåˆ™éœ€è¦æ‰‹åŠ¨ä½¿ç”¨ <code>delete</code> é‡Šæ”¾å†…å­˜ï¼Œå¦åˆ™ä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚</li>
<li><strong>vector</strong>ï¼šè‡ªåŠ¨ç®¡ç†å†…å­˜ã€‚å½“ <code>vector</code> ä¸å†ä½¿ç”¨æ—¶ï¼Œå…¶å ç”¨çš„å†…å­˜ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œæ— éœ€ç¨‹åºå‘˜æ‰‹åŠ¨å¹²é¢„ã€‚</li>
</ul>
<p>3.åŠŸèƒ½ä¸°å¯Œåº¦</p>
<ul>
<li><strong>æ™®é€šæ•°ç»„</strong>ï¼šåªæä¾›åŸºæœ¬çš„å…ƒç´ è®¿é—®åŠŸèƒ½ï¼Œæ“ä½œç›¸å¯¹æœ‰é™ã€‚</li>
<li><strong>vector</strong>ï¼šæä¾›äº†ä¸°å¯Œçš„æˆå‘˜å‡½æ•°ï¼Œå¦‚ <code>size()</code> è·å–å…ƒç´ æ•°é‡ã€<code>empty()</code> åˆ¤æ–­æ˜¯å¦ä¸ºç©ºã€<code>clear()</code> æ¸…ç©ºå…ƒç´ ç­‰ï¼Œä½¿ç”¨èµ·æ¥æ›´åŠ æ–¹ä¾¿ã€‚</li>
</ul>
</li>
<li><p><strong>ä½¿ç”¨ vector è€Œä¸ç”¨æ•°ç»„çš„åŸå› </strong></p>
<p>åœ¨å¤§æ•´æ•°ç›¸åŠ çš„åœºæ™¯ä¸­ï¼Œè¾“å…¥çš„æ•°å­—é•¿åº¦æ˜¯ä¸ç¡®å®šçš„ã€‚å¦‚æœä½¿ç”¨æ™®é€šæ•°ç»„ï¼Œéœ€è¦é¢„å…ˆå®šä¹‰ä¸€ä¸ªè¶³å¤Ÿå¤§çš„æ•°ç»„æ¥å­˜å‚¨æ•°å­—çš„æ¯ä¸€ä½ï¼Œä½†è¿™æ ·å¯èƒ½ä¼šæµªè´¹å¤§é‡çš„å†…å­˜ç©ºé—´ã€‚è€Œ <code>vector</code> å¯ä»¥æ ¹æ®è¾“å…¥æ•°å­—çš„å®é™…é•¿åº¦åŠ¨æ€è°ƒæ•´å¤§å°ï¼Œé¿å…äº†å†…å­˜çš„æµªè´¹ï¼Œå¹¶ä¸”å…¶æä¾›çš„ <code>push_back()</code> æ–¹æ³•å¯ä»¥æ–¹ä¾¿åœ°å°†æ•°å­—çš„æ¯ä¸€ä½æ·»åŠ åˆ°å®¹å™¨ä¸­ï¼ŒåŒæ—¶åœ¨å¤„ç†è¿›ä½æ—¶ä¹Ÿæ›´åŠ æ–¹ä¾¿ã€‚å› æ­¤ï¼Œä½¿ç”¨ <code>vector</code> èƒ½æ›´å¥½åœ°é€‚åº”è¿™ç§åŠ¨æ€é•¿åº¦çš„éœ€æ±‚ã€‚</p>
</li>
</ul>
<h5 id="addå‡½æ•°è¿è¡Œç¤ºä¾‹"><a href="#addå‡½æ•°è¿è¡Œç¤ºä¾‹" class="headerlink" title="addå‡½æ•°è¿è¡Œç¤ºä¾‹"></a>addå‡½æ•°è¿è¡Œç¤ºä¾‹</h5><p>å‡è®¾æˆ‘ä»¬è¦è®¡ç®—ä¸¤ä¸ªå››ä½æ•° <code>a = 1234</code> å’Œ <code>b = 5678</code> çš„å’Œã€‚</p>
<p>åœ¨ä»£ç ä¸­ï¼Œè¾“å…¥çš„æ•°å­—ä»¥å­—ç¬¦ä¸²å½¢å¼å­˜å‚¨ï¼Œç„¶åå°†å…¶é€†åºå­˜å‚¨åˆ° <code>vector&lt;int&gt;</code> ä¸­ï¼Œè¿™æ ·åšæ˜¯ä¸ºäº†æ–¹ä¾¿å¤„ç†è¿›ä½ã€‚å¯¹äº <code>a = 1234</code>ï¼Œå­˜å‚¨åœ¨ <code>vector&lt;int&gt;</code> ä¸­ä¸º <code>A = &#123;4, 3, 2, 1&#125;</code>ï¼›å¯¹äº <code>b = 5678</code>ï¼Œå­˜å‚¨åœ¨ <code>vector&lt;int&gt;</code> ä¸­ä¸º <code>B = &#123;8, 7, 6, 5&#125;</code>ã€‚</p>
<p>å…·ä½“æ­¥éª¤ï¼š</p>
<ul>
<li><p><input checked="" disabled="" type="checkbox"> 
åˆå§‹åŒ–</p>
</li>
<li><p><code>vector&lt;int&gt; C;</code>ï¼šç”¨äºå­˜å‚¨ç›¸åŠ ç»“æœçš„å‘é‡ï¼Œåˆå§‹ä¸ºç©ºã€‚</p>
</li>
<li><p><code>int t = 0;</code>ï¼šç”¨äºå­˜å‚¨æ¯ä¸€ä½ç›¸åŠ åçš„ç»“æœä»¥åŠè¿›ä½ä¿¡æ¯ï¼Œåˆå§‹å€¼ä¸º 0ã€‚</p>
</li>
<li><p><input checked="" disabled="" type="checkbox"> 
å¾ªç¯å¤„ç†æ¯ä¸€ä½</p>
</li>
</ul>
<p>å¾ªç¯æ¡ä»¶ä¸º <code>i &lt; A.size() || i &lt; B.size()</code>ï¼Œè¿™æ„å‘³ç€åªè¦ <code>A</code> æˆ– <code>B</code> è¿˜æœ‰æœªå¤„ç†çš„ä½ï¼Œå°±ä¼šç»§ç»­å¾ªç¯ã€‚</p>
<ul>
<li><p><input disabled="" type="checkbox"> 
ç¬¬ä¸€æ¬¡å¾ªç¯ï¼ˆ<code>i = 0</code>ï¼‰</p>
</li>
<li><p><code>if(i &lt; A.size()) t += A[i];</code>ï¼šå› ä¸º <code>i = 0</code> å°äº <code>A.size()</code>ï¼ˆ4ï¼‰ï¼Œæ‰€ä»¥ <code>t = t + A[0] = 0 + 4 = 4</code>ã€‚</p>
</li>
<li><p><code>if(i &lt; B.size()) t += B[i];</code>ï¼šå› ä¸º <code>i = 0</code> å°äº <code>B.size()</code>ï¼ˆ4ï¼‰ï¼Œæ‰€ä»¥ <code>t = t + B[0] = 4 + 8 = 12</code>ã€‚</p>
</li>
<li><p><code>C.push_back(t % 10);</code>ï¼šå°† <code>t % 10</code>ï¼ˆå³ 2ï¼‰æ·»åŠ åˆ° <code>C</code> ä¸­ï¼Œæ­¤æ—¶ <code>C = &#123;2&#125;</code>ã€‚</p>
</li>
<li><p><code>t /= 10;</code>ï¼š<code>t</code> é™¤ä»¥ 10ï¼Œå¾—åˆ°è¿›ä½ 1ï¼Œå³ <code>t = 1</code>ã€‚</p>
</li>
<li><p><input disabled="" type="checkbox"> 
ç¬¬äºŒæ¬¡å¾ªç¯ï¼ˆ<code>i = 1</code>ï¼‰</p>
</li>
<li><p><code>if(i &lt; A.size()) t += A[i];</code>ï¼š<code>t = t + A[1] = 1 + 3 = 4</code>ã€‚</p>
</li>
<li><p><code>if(i &lt; B.size()) t += B[i];</code>ï¼š<code>t = t + B[1] = 4 + 7 = 11</code>ã€‚</p>
</li>
<li><p><code>C.push_back(t % 10);</code>ï¼šå°† <code>t % 10</code>ï¼ˆå³ 1ï¼‰æ·»åŠ åˆ° <code>C</code> ä¸­ï¼Œæ­¤æ—¶ <code>C = &#123;2, 1&#125;</code>ã€‚</p>
</li>
<li><p><code>t /= 10;</code>ï¼š<code>t</code> é™¤ä»¥ 10ï¼Œå¾—åˆ°è¿›ä½ 1ï¼Œå³ <code>t = 1</code>ã€‚</p>
</li>
<li><p><input disabled="" type="checkbox"> 
ç¬¬ä¸‰æ¬¡å¾ªç¯ï¼ˆ<code>i = 2</code>ï¼‰</p>
</li>
<li><p><code>if(i &lt; A.size()) t += A[i];</code>ï¼š<code>t = t + A[2] = 1 + 2 = 3</code>ã€‚</p>
</li>
<li><p><code>if(i &lt; B.size()) t += B[i];</code>ï¼š<code>t = t + B[2] = 3 + 6 = 9</code>ã€‚</p>
</li>
<li><p><code>C.push_back(t % 10);</code>ï¼šå°† <code>t % 10</code>ï¼ˆå³ 9ï¼‰æ·»åŠ åˆ° <code>C</code> ä¸­ï¼Œæ­¤æ—¶ <code>C = &#123;2, 1, 9&#125;</code>ã€‚</p>
</li>
<li><p><code>t /= 10;</code>ï¼š<code>t</code> é™¤ä»¥ 10ï¼Œå¾—åˆ°è¿›ä½ 0ï¼Œå³ <code>t = 0</code>ã€‚</p>
</li>
<li><p><input disabled="" type="checkbox"> 
ç¬¬å››æ¬¡å¾ªç¯ï¼ˆ<code>i = 3</code>ï¼‰</p>
</li>
<li><p><code>if(i &lt; A.size()) t += A[i];</code>ï¼š<code>t = t + A[3] = 0 + 1 = 1</code>ã€‚</p>
</li>
<li><p><code>if(i &lt; B.size()) t += B[i];</code>ï¼š<code>t = t + B[3] = 1 + 5 = 6</code>ã€‚</p>
</li>
<li><p><code>C.push_back(t % 10);</code>ï¼šå°† <code>t % 10</code>ï¼ˆå³ 6ï¼‰æ·»åŠ åˆ° <code>C</code> ä¸­ï¼Œæ­¤æ—¶ <code>C = &#123;2, 1, 9, 6&#125;</code>ã€‚</p>
</li>
<li><p><code>t /= 10;</code>ï¼š<code>t</code> é™¤ä»¥ 10ï¼Œå¾—åˆ°è¿›ä½ 0ï¼Œå³ <code>t = 0</code>ã€‚</p>
</li>
<li><p><input checked="" disabled="" type="checkbox"> 
å¤„ç†æœ€åå¯èƒ½çš„è¿›ä½</p>
</li>
</ul>
<p><code>if(t) C.push_back(1);</code></p>
<p>å› ä¸ºæ­¤æ—¶ <code>t = 0</code>ï¼Œæ‰€ä»¥ä¸éœ€è¦æ·»åŠ é¢å¤–çš„è¿›ä½ï¼Œ<code>C</code> ä»ç„¶ä¸º <code>&#123;2, 1, 9, 6&#125;</code>ã€‚</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> è¿”å›ç»“æœ</li>
</ul>
<p><code>return C;</code>ï¼šè¿”å›å­˜å‚¨ç›¸åŠ ç»“æœçš„å‘é‡ <code>C</code>ã€‚</p>
<p>åœ¨ <code>main</code> å‡½æ•°ä¸­ï¼Œå°† <code>C</code> é€†åºè¾“å‡ºï¼Œå¾—åˆ°æœ€ç»ˆç»“æœ <code>6912</code>ï¼Œå³ <code>1234 + 5678 = 6912</code>ã€‚</p>
<h5 id="autoçš„ç”¨æ³•"><a href="#autoçš„ç”¨æ³•" class="headerlink" title="autoçš„ç”¨æ³•"></a>autoçš„ç”¨æ³•</h5><p><code>auto</code>æ˜¯C++11çš„æ–°ç‰¹æ€§ï¼Œå¯ä»¥è‡ªåŠ¨è¯†åˆ«å˜é‡å±æ€§ã€‚æ¯”å¦‚<code>auto C=add(A,B);</code>å°±è‡ªåŠ¨è¯†åˆ«äº†addè¿”å›çš„ç±»å‹ï¼Œå› æ­¤<code>auto C &lt;=&gt; vector&lt;int&gt;c</code></p>
<h5 id="a-i-0-çš„ä½œç”¨ï¼šå°†å­—ç¬¦ä¸²æ¯ä¸€ä½ç”±ASCIIç è½¬ä¸ºæ•´æ•°"><a href="#a-i-0-çš„ä½œç”¨ï¼šå°†å­—ç¬¦ä¸²æ¯ä¸€ä½ç”±ASCIIç è½¬ä¸ºæ•´æ•°" class="headerlink" title="a[i] - &#39;0&#39; çš„ä½œç”¨ï¼šå°†å­—ç¬¦ä¸²æ¯ä¸€ä½ç”±ASCIIç è½¬ä¸ºæ•´æ•°"></a><code>a[i] - &#39;0&#39;</code> çš„ä½œç”¨ï¼šå°†å­—ç¬¦ä¸²æ¯ä¸€ä½ç”±ASCIIç è½¬ä¸ºæ•´æ•°</h5><p>åœ¨ C++ ä¸­ï¼Œå½“ä½ ä»è¾“å…¥è¯»å–ä¸€ä¸ªæ•°å­—å­—ç¬¦ä¸²æ—¶ï¼Œæ¯”å¦‚ <code>&quot;123&quot;</code>ï¼Œå­—ç¬¦ä¸²ä¸­çš„æ¯ä¸ªå­—ç¬¦ï¼ˆå¦‚ <code>&#39;1&#39;</code>ã€<code>&#39;2&#39;</code>ã€<code>&#39;3&#39;</code>ï¼‰å®é™…ä¸Šå­˜å‚¨çš„æ˜¯å­—ç¬¦çš„ ASCII ç å€¼ï¼Œè€Œä¸æ˜¯å¯¹åº”çš„æ•°å€¼ã€‚å­—ç¬¦ <code>&#39;0&#39;</code> åˆ° <code>&#39;9&#39;</code> çš„ ASCII ç æ˜¯è¿ç»­çš„ï¼Œ<code>&#39;0&#39;</code> çš„ ASCII ç å€¼æ˜¯ 48ï¼Œ<code>&#39;1&#39;</code> æ˜¯ 49ï¼Œä»¥æ­¤ç±»æ¨ï¼Œ<code>&#39;9&#39;</code> æ˜¯ 57ã€‚</p>
<p><code>b[i] - &#39;0&#39;</code> çš„ä½œç”¨å°±æ˜¯å°†å­—ç¬¦å½¢å¼çš„æ•°å­—è½¬æ¢ä¸ºå¯¹åº”çš„æ•´æ•°å€¼ã€‚ä¾‹å¦‚ï¼Œå½“ <code>b[i]</code> ä¸º <code>&#39;1&#39;</code> æ—¶ï¼Œ<code>&#39;1&#39;</code> çš„ ASCII ç å€¼æ˜¯ 49ï¼Œ<code>&#39;0&#39;</code> çš„ ASCII ç å€¼æ˜¯ 48ï¼Œé‚£ä¹ˆ <code>&#39;1&#39; - &#39;0&#39;</code> å°±ç­‰äº <code>49 - 48 = 1</code>ï¼Œè¿™æ ·å°±æŠŠå­—ç¬¦ <code>&#39;1&#39;</code> è½¬æ¢ä¸ºäº†æ•´æ•° 1ã€‚</p>
<p>å¦‚æœæ²¡æœ‰ <code>b[i] - &#39;0&#39;</code> è¿™ä¸ªæ“ä½œï¼Œç›´æ¥å°†å­—ç¬¦å­˜å‚¨åˆ° <code>vector&lt;int&gt;</code> ä¸­ï¼Œé‚£ä¹ˆå­˜å‚¨çš„æ˜¯å­—ç¬¦çš„ ASCII ç å€¼ï¼Œè€Œä¸æ˜¯å¯¹åº”çš„æ•°å€¼ï¼Œè¿™ä¼šå¯¼è‡´åç»­çš„è®¡ç®—å‡ºç°é”™è¯¯ã€‚</p>
<h4 id="é«˜ç²¾åº¦å‡æ³•"><a href="#é«˜ç²¾åº¦å‡æ³•" class="headerlink" title="é«˜ç²¾åº¦å‡æ³•"></a>é«˜ç²¾åº¦å‡æ³•</h4><h4 id="é«˜ç²¾åº¦ä¹˜æ³•"><a href="#é«˜ç²¾åº¦ä¹˜æ³•" class="headerlink" title="é«˜ç²¾åº¦ä¹˜æ³•"></a>é«˜ç²¾åº¦ä¹˜æ³•</h4><h4 id="é«˜ç²¾åº¦é™¤æ³•"><a href="#é«˜ç²¾åº¦é™¤æ³•" class="headerlink" title="é«˜ç²¾åº¦é™¤æ³•"></a>é«˜ç²¾åº¦é™¤æ³•</h4>]]></content>
      <categories>
        <category>ç®—æ³•é¢˜</category>
      </categories>
      <tags>
        <tag>ACWing</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•ç”¨hexoæ–°å»ºæ–‡ä»¶å¹¶ä¸Šä¼ /å¦‚ä½•ç”¨hexoæ’å…¥å›¾ç‰‡ï¼ˆnextä¸»é¢˜ï¼‰</title>
    <url>/hexo_maintanance/</url>
    <content><![CDATA[<p>hexoï¼ˆåšä¸»é‡‡ç”¨nextä¸»é¢˜ï¼‰æ—¥å¸¸ç»´æŠ¤æ•™ç¨‹</p>
<h1 id="ä¿®æ”¹scaffolds-post-mdï¼ˆé»˜è®¤æ ‡é¢˜æ–‡ä»¶ï¼‰"><a href="#ä¿®æ”¹scaffolds-post-mdï¼ˆé»˜è®¤æ ‡é¢˜æ–‡ä»¶ï¼‰" class="headerlink" title="ä¿®æ”¹scaffolds&#x2F;post.mdï¼ˆé»˜è®¤æ ‡é¢˜æ–‡ä»¶ï¼‰"></a>ä¿®æ”¹scaffolds&#x2F;post.mdï¼ˆé»˜è®¤æ ‡é¢˜æ–‡ä»¶ï¼‰</h1><p>æ³¨æ„ä¿®æ”¹æ—¶ä¸è¦æŠŠä¸­æ–‡åŠ è¿›å»ï¼Œåœ¨æ­¤åªèµ·åˆ°æ³¨é‡Šä½œç”¨</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">title: &#123;&#123; title &#125;&#125;</span><br><span class="line">date: &#123;&#123; date &#125;&#125;</span><br><span class="line">tags:([1,2]è®¾ç½®åŒæ—¶å±äºä¸åŒç±»åˆ«å¯ä»¥è¿™æ ·)</span><br><span class="line">categories:</span><br><span class="line">top:(è¡¨ç¤ºç½®é¡¶æƒ…å†µï¼Œä¸ç½®é¡¶ä¸å¡«å³å¯æ•°å­—å¤§å°ä»£è¡¨ç½®é¡¶é¡ºåºï¼Œæ•°å­—è¶Šå¤§æ’åºè¶Šå‰)</span><br></pre></td></tr></table></figure>



<h1 id="æ–°å»ºmdæ–‡ä»¶"><a href="#æ–°å»ºmdæ–‡ä»¶" class="headerlink" title="æ–°å»ºmdæ–‡ä»¶"></a>æ–°å»ºmdæ–‡ä»¶</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hexo new/hexo n &quot;æ–‡ä»¶å&quot;</span><br></pre></td></tr></table></figure>

<h1 id="æŸ¥çœ‹æ–°å»ºæ–‡ä»¶"><a href="#æŸ¥çœ‹æ–°å»ºæ–‡ä»¶" class="headerlink" title="æŸ¥çœ‹æ–°å»ºæ–‡ä»¶"></a>æŸ¥çœ‹æ–°å»ºæ–‡ä»¶</h1><p>è¿›å…¥ç›®å½•æ˜¯source&#x2F;_posts</p>
<h1 id="å®Œå–„æ ‡é¢˜å¯¹åº”ä¿¡æ¯ï¼Œå¡«å†™md"><a href="#å®Œå–„æ ‡é¢˜å¯¹åº”ä¿¡æ¯ï¼Œå¡«å†™md" class="headerlink" title="å®Œå–„æ ‡é¢˜å¯¹åº”ä¿¡æ¯ï¼Œå¡«å†™md"></a>å®Œå–„æ ‡é¢˜å¯¹åº”ä¿¡æ¯ï¼Œå¡«å†™md</h1><p>ä¹Ÿå°±æ˜¯åˆšæ‰ä¸Šé¢é‚£å †ä¸œè¥¿</p>
<h1 id="åœ¨blogç›®å½•ä¸‹ï¼ˆå› äººè€Œå¼‚ï¼‰æ‰“å¼€git-bash"><a href="#åœ¨blogç›®å½•ä¸‹ï¼ˆå› äººè€Œå¼‚ï¼‰æ‰“å¼€git-bash" class="headerlink" title="åœ¨blogç›®å½•ä¸‹ï¼ˆå› äººè€Œå¼‚ï¼‰æ‰“å¼€git bash"></a>åœ¨blogç›®å½•ä¸‹ï¼ˆå› äººè€Œå¼‚ï¼‰æ‰“å¼€git bash</h1><p>è¾“å…¥</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo g -d</span><br></pre></td></tr></table></figure>

<p>å³å¯ä¸Šä¼ </p>
<p>è¾“å…¥</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hexo s</span><br></pre></td></tr></table></figure>

<p>å³å¯å®æ—¶æŸ¥çœ‹ç½‘é¡µ</p>
<h1 id="æ’å…¥å›¾ç‰‡æ“ä½œï¼ˆå›¾ç‰‡å’Œmdæ–‡ä»¶æœ€å¥½å‡ä¸ºè‹±æ–‡åï¼‰"><a href="#æ’å…¥å›¾ç‰‡æ“ä½œï¼ˆå›¾ç‰‡å’Œmdæ–‡ä»¶æœ€å¥½å‡ä¸ºè‹±æ–‡åï¼‰" class="headerlink" title="æ’å…¥å›¾ç‰‡æ“ä½œï¼ˆå›¾ç‰‡å’Œmdæ–‡ä»¶æœ€å¥½å‡ä¸ºè‹±æ–‡åï¼‰"></a>æ’å…¥å›¾ç‰‡æ“ä½œï¼ˆå›¾ç‰‡å’Œmdæ–‡ä»¶æœ€å¥½å‡ä¸ºè‹±æ–‡åï¼‰</h1><h2 id="ä¸‹æ’ä»¶"><a href="#ä¸‹æ’ä»¶" class="headerlink" title="ä¸‹æ’ä»¶"></a>ä¸‹æ’ä»¶</h2><p>è§<a href="https://github.com/yiyungent/hexo-asset-img">yiyungent&#x2F;hexo-asset-imgï¼šğŸ° Hexo æœ¬åœ°å›¾ç‰‡æ’ä»¶ã€‚|Hexo æœ¬åœ°å›¾ç‰‡æ’ä»¶ï¼šè½¬æ¢å›¾ç‰‡ç›¸å¯¹è·¯å¾„ä¸ºasset_img</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install hexo-asset-img --save</span><br><span class="line">æˆ–è€…</span><br><span class="line">npm install git://github.com/yiyungent/hexo-asset-img.git#main</span><br></pre></td></tr></table></figure>

<h2 id="ä¿®æ”¹host-config-yml"><a href="#ä¿®æ”¹host-config-yml" class="headerlink" title="ä¿®æ”¹host&#x2F;_config.yml"></a>ä¿®æ”¹host&#x2F;_config.yml</h2><p>permalinkæ§åˆ¶äº†æ°¸ä¹…åŸŸåçš„æ ·å¼</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1.post_asset_folder: true</span><br><span class="line">2.permalink: :title/ï¼ˆæˆ‘çš„è‡ªå¸¦äº†æ—¥æœŸå¯¼è‡´å›¾ç‰‡ä¸€ç›´ä¸è¡Œ:year/:month/:date/:title/ï¼‰</span><br></pre></td></tr></table></figure>

<h2 id="ç›´æ¥ç²˜è´´å›¾ç‰‡"><a href="#ç›´æ¥ç²˜è´´å›¾ç‰‡" class="headerlink" title="ç›´æ¥ç²˜è´´å›¾ç‰‡"></a>ç›´æ¥ç²˜è´´å›¾ç‰‡</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">![1](./hexo_maintanance/1.png)</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢æ˜¯ä¸‹é¢å›¾ç‰‡çš„è·¯å¾„ã€‚èƒ½çœ‹åˆ°ä¸‹é¢çš„å›¾ç‰‡å°±èƒ½è¯´æ˜è¿™ä¸ªæ–¹æ³•å°±æ˜¯æˆåŠŸçš„ã€‚</p>
<p><img src="/./hexo_maintanance/1.png" alt="1"></p>
<h1 id="å®ç°ä¾§è¾¹æ æ ‡é¢˜å…¨å±•å¼€"><a href="#å®ç°ä¾§è¾¹æ æ ‡é¢˜å…¨å±•å¼€" class="headerlink" title="å®ç°ä¾§è¾¹æ æ ‡é¢˜å…¨å±•å¼€"></a>å®ç°ä¾§è¾¹æ æ ‡é¢˜å…¨å±•å¼€</h1><p>æœ‰äº›æ–‡ä»¶ç›®å½•å¾ˆé•¿ï¼Œä¸å…¨å±•å¼€ä¸æ–¹ä¾¿çœ‹ã€‚å¯ä»¥ä¿®æ”¹<code>blog\themes\next\source\css\_common\outline\sidebar\sidebar-toc.styl</code></p>
<p>æ–‡ä»¶ï¼ŒæŸ¥æ‰¾ä¿®æ”¹<code>.nav-child</code>å¯¹åº”ä»£ç ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">.<span class="property">nav</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (not hexo-<span class="title function_">config</span>(<span class="string">&#x27;toc.expand_all&#x27;</span>)) &#123;</span><br><span class="line">    .<span class="property">nav</span>-child &#123;</span><br><span class="line">      --<span class="attr">height</span>: auto;          <span class="comment">/* å–æ¶ˆé«˜åº¦é™åˆ¶ */</span></span><br><span class="line">      <span class="attr">height</span>: auto;            <span class="comment">/* å¯ç”¨è‡ªåŠ¨é«˜åº¦é€‚åº”å†…å®¹ */</span></span><br><span class="line">      <span class="attr">opacity</span>: <span class="number">1</span>;              <span class="comment">/* å–æ¶ˆé€æ˜åº¦éšè— */</span></span><br><span class="line">      <span class="attr">overflow</span>: visible;       <span class="comment">/* å…è®¸å†…å®¹æº¢å‡ºæ˜¾ç¤º */</span></span><br><span class="line">      transition-<span class="attr">property</span>: opacity;  <span class="comment">/* ä»…ä¿ç•™é€æ˜åº¦è¿‡æ¸¡ */</span></span><br><span class="line">      <span class="attr">visibility</span>: visible;     <span class="comment">/* ç¡®ä¿å…ƒç´ å¯è§ */</span></span><br><span class="line">      <span class="attr">transition</span>: $transition-ease;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>åŸé…ç½®ä¸ºï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">åŸé…ç½®--<span class="attr">height</span>: <span class="number">0</span>;</span><br><span class="line"><span class="attr">height</span>: <span class="number">0</span>;</span><br><span class="line"><span class="attr">opacity</span>: <span class="number">0</span>;</span><br><span class="line"><span class="attr">overflow</span>: hidden;</span><br><span class="line">transition-<span class="attr">property</span>: height, opacity, visibility;</span><br><span class="line"><span class="attr">transition</span>: $transition-ease;</span><br><span class="line"><span class="attr">visibility</span>: hidden;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>åšå®¢ç»´æŠ¤</category>
      </categories>
      <tags>
        <tag>åšå®¢ç»´æŠ¤</tag>
      </tags>
  </entry>
  <entry>
    <title>æ‰‹æ’•OCC-NeRF:Occlusion-Free Scene Recovery via Neural Radiance Fields</title>
    <url>/%E6%89%8B%E6%92%95nerfmm/</url>
    <content><![CDATA[<p>é“¾æ¥ï¼š<a href="https://freebutuselesssoul.github.io/occnerf/">OCC-NeRF: Occlusion-Free Scene Recovery via Neural Radiance Fields</a></p>
<h2 id="æ–‡ä»¶å¤¹ç›®å½•"><a href="#æ–‡ä»¶å¤¹ç›®å½•" class="headerlink" title="æ–‡ä»¶å¤¹ç›®å½•"></a>æ–‡ä»¶å¤¹ç›®å½•</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">occ-nerf/</span><br><span class="line">â”œâ”€â”€ .gitignore</span><br><span class="line">â”œâ”€â”€ LICENSE</span><br><span class="line">â”œâ”€â”€ README.md</span><br><span class="line">â”œâ”€â”€ environment.yml</span><br><span class="line">â”œâ”€â”€ local1.txt</span><br><span class="line">â”œâ”€â”€ dataloader/</span><br><span class="line">â”‚   â”œâ”€â”€ any_folder.py</span><br><span class="line">â”‚   â”œâ”€â”€ local_save.py</span><br><span class="line">â”‚   â”œâ”€â”€ with_colmap.py</span><br><span class="line">â”‚   â”œâ”€â”€ with_feature.py</span><br><span class="line">â”‚   â”œâ”€â”€ with_feature_colmap.py</span><br><span class="line">â”‚   â””â”€â”€ with_mask.py</span><br><span class="line">â”œâ”€â”€ models/</span><br><span class="line">â”‚   â”œâ”€â”€ depth_decoder.py</span><br><span class="line">â”‚   â”œâ”€â”€ intrinsics.py</span><br><span class="line">â”‚   â”œâ”€â”€ layers.py</span><br><span class="line">â”‚   â”œâ”€â”€ nerf_feature.py</span><br><span class="line">â”‚   â”œâ”€â”€ nerf_mask.py</span><br><span class="line">â”‚   â”œâ”€â”€ nerf_models.py</span><br><span class="line">â”‚   â””â”€â”€ poses.py</span><br><span class="line">â”œâ”€â”€ utils/</span><br><span class="line">â”‚   â”œâ”€â”€ align_traj.py</span><br><span class="line">â”‚   â”œâ”€â”€ comp_ate.py</span><br><span class="line">â”‚   â”œâ”€â”€ comp_ray_dir.py</span><br><span class="line">â”‚   â”œâ”€â”€ lie_group_helper.py</span><br><span class="line">â”‚   â”œâ”€â”€ pos_enc.py</span><br><span class="line">â”‚   â”œâ”€â”€ pose_utils.py</span><br><span class="line">â”‚   â”œâ”€â”€ split_dataset.py</span><br><span class="line">â”‚   â”œâ”€â”€ training_utils.py</span><br><span class="line">â”‚   â”œâ”€â”€ vgg.py</span><br><span class="line">â”‚   â”œâ”€â”€ vis_cam_traj.py</span><br><span class="line">â”‚   â””â”€â”€ volume_op.py</span><br><span class="line">â”œâ”€â”€ tasks/</span><br><span class="line">â”‚   â””â”€â”€ ...</span><br><span class="line">â””â”€â”€ third_party/</span><br><span class="line">    â”œâ”€â”€ ATE/</span><br><span class="line">    â”‚   â””â”€â”€ README.md</span><br><span class="line">    â””â”€â”€ pytorch_ssim/</span><br></pre></td></tr></table></figure>

<h2 id="DEBUG-ä»£ç "><a href="#DEBUG-ä»£ç " class="headerlink" title="DEBUG ä»£ç "></a>DEBUG ä»£ç </h2><h3 id="dataloader"><a href="#dataloader" class="headerlink" title="dataloader"></a>dataloader</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">â”œâ”€â”€ dataloader/</span><br><span class="line">â”‚   â”œâ”€â”€ any_folder.py</span><br><span class="line">â”‚   â”œâ”€â”€ local_save.py</span><br><span class="line">â”‚   â”œâ”€â”€ with_colmap.py</span><br><span class="line">â”‚   â”œâ”€â”€ with_feature.py</span><br><span class="line">â”‚   â”œâ”€â”€ with_feature_colmap.py</span><br><span class="line">â”‚   â””â”€â”€ with_mask.py</span><br></pre></td></tr></table></figure>

<h4 id="any-folder-py"><a href="#any-folder-py" class="headerlink" title="any_folder.py"></a>any_folder.py</h4><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os                                       <span class="comment"># æ“ä½œç³»ç»Ÿæ¥å£æ¨¡å—</span></span><br><span class="line"><span class="keyword">import</span> torch                                    <span class="comment"># PyTorch æ·±åº¦å­¦ä¹ æ¡†æ¶</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np                              <span class="comment"># ç§‘å­¦è®¡ç®—åº“</span></span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm                           <span class="comment"># è¿›åº¦æ¡æ˜¾ç¤ºæ¨¡å—</span></span><br><span class="line"><span class="keyword">import</span> imageio                                  <span class="comment"># å›¾åƒ IO å¤„ç†åº“</span></span><br><span class="line"><span class="keyword">from</span> dataloader.with_colmap <span class="keyword">import</span> resize_imgs  <span class="comment"># è‡ªå®šä¹‰å›¾åƒç¼©æ”¾å‡½æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_imgs</span>(<span class="params">image_dir, num_img_to_load, start, end, skip, load_sorted, load_img</span>):</span><br><span class="line">    img_names = np.array(<span class="built_in">sorted</span>(os.listdir(image_dir)))  <span class="comment"># è·å–å¹¶æ’åºç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶å</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> end == -<span class="number">1</span>:                                 <span class="comment"># ä» start å¼€å§‹æŒ‰é—´éš” skip å–å›¾</span></span><br><span class="line">        img_names = img_names[start::skip]</span><br><span class="line">    <span class="keyword">else</span>:                                         <span class="comment"># å– start åˆ° end åŒºé—´æŒ‰é—´éš” skip å–å›¾</span></span><br><span class="line">        img_names = img_names[start:end:skip]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> load_sorted:                           <span class="comment"># æ˜¯å¦æ‰“ä¹±å›¾åƒé¡ºåº</span></span><br><span class="line">        np.random.shuffle(img_names)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> num_img_to_load &gt; <span class="built_in">len</span>(img_names):          <span class="comment"># æ£€æŸ¥è¯·æ±‚æ•°é‡æ˜¯å¦è¶…å‡ºèŒƒå›´</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;å›¾åƒè¯·æ±‚æ•°<span class="subst">&#123;num_img_to_load&#125;</span>è¶…è¿‡å¯ç”¨æ•°<span class="subst">&#123;<span class="built_in">len</span>(img_names)&#125;</span>&#x27;</span>)</span><br><span class="line">        exit()</span><br><span class="line">    <span class="keyword">elif</span> num_img_to_load == -<span class="number">1</span>:                   <span class="comment"># åŠ è½½å…¨éƒ¨å¯ç”¨å›¾åƒ</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;åŠ è½½å…¨éƒ¨<span class="subst">&#123;<span class="built_in">len</span>(img_names)&#125;</span>å¼ å›¾åƒ&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:                                         <span class="comment"># æˆªå–æŒ‡å®šæ•°é‡çš„å›¾åƒ</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;ä»<span class="subst">&#123;<span class="built_in">len</span>(img_names)&#125;</span>å¼ ä¸­åŠ è½½<span class="subst">&#123;num_img_to_load&#125;</span>å¼ &#x27;</span>)</span><br><span class="line">        img_names = img_names[:num_img_to_load]</span><br><span class="line">    </span><br><span class="line">    img_paths = [os.path.join(image_dir, n) <span class="keyword">for</span> n <span class="keyword">in</span> img_names]  <span class="comment"># æ„å»ºå®Œæ•´æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">    N_imgs = <span class="built_in">len</span>(img_paths)                         <span class="comment"># è®¡ç®—å®é™…åŠ è½½æ•°é‡</span></span><br><span class="line">    </span><br><span class="line">    img_list = []</span><br><span class="line">    <span class="keyword">if</span> load_img:                                     <span class="comment"># å®é™…åŠ è½½å›¾åƒæ•°æ®</span></span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> tqdm(img_paths):</span><br><span class="line">            img = imageio.imread(p)[:, :, :<span class="number">3</span>]        <span class="comment"># è¯»å– RGB ä¸‰é€šé“å›¾åƒ</span></span><br><span class="line">            img_list.append(img)</span><br><span class="line">        img_list = np.stack(img_list)                <span class="comment"># å †å ä¸º 4D æ•°ç»„</span></span><br><span class="line">        img_list = torch.from_numpy(img_list).<span class="built_in">float</span>() / <span class="number">255</span>  <span class="comment"># è½¬æ¢ä¸ºæµ®ç‚¹å¼ é‡å¹¶å½’ä¸€åŒ–</span></span><br><span class="line">        H, W = img_list.shape[<span class="number">1</span>], img_list.shape[<span class="number">2</span>]  <span class="comment"># è·å–å›¾åƒå°ºå¯¸</span></span><br><span class="line">    <span class="keyword">else</span>:                                            <span class="comment"># ä»…è·å–å›¾åƒå°ºå¯¸</span></span><br><span class="line">        tmp_img = imageio.imread(img_paths[<span class="number">0</span>])</span><br><span class="line">        H, W = tmp_img.shape[<span class="number">0</span>], tmp_img.shape[<span class="number">1</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123;                                         <span class="comment"># è¿”å›ç»“æ„åŒ–æ•°æ®</span></span><br><span class="line">        <span class="string">&#x27;imgs&#x27;</span>: img_list,        <span class="comment"># å›¾åƒå¼ é‡ (N, H, W, 3)</span></span><br><span class="line">        <span class="string">&#x27;img_names&#x27;</span>: img_names,  <span class="comment"># å›¾åƒæ–‡ä»¶åæ•°ç»„</span></span><br><span class="line">        <span class="string">&#x27;N_imgs&#x27;</span>: N_imgs,        <span class="comment"># æ€»å›¾åƒæ•°</span></span><br><span class="line">        <span class="string">&#x27;H&#x27;</span>: H,                  <span class="comment"># å›¾åƒé«˜åº¦</span></span><br><span class="line">        <span class="string">&#x27;W&#x27;</span>: W,                  <span class="comment"># å›¾åƒå®½åº¦</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DataLoaderAnyFolder</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, base_dir, scene_name, res_ratio, num_img_to_load, </span></span><br><span class="line"><span class="params">                 start, end, skip, load_sorted, load_img=<span class="literal">True</span></span>):  <span class="comment"># åˆå§‹åŒ–å‚æ•°</span></span><br><span class="line">        <span class="variable language_">self</span>.base_dir = base_dir                  <span class="comment"># æ•°æ®æ ¹ç›®å½•</span></span><br><span class="line">        <span class="variable language_">self</span>.scene_name = scene_name              <span class="comment"># åœºæ™¯åç§°</span></span><br><span class="line">        <span class="variable language_">self</span>.res_ratio = res_ratio                <span class="comment"># åˆ†è¾¨ç‡ç¼©æ”¾æ¯”ä¾‹</span></span><br><span class="line">        <span class="variable language_">self</span>.num_img_to_load = num_img_to_load    <span class="comment"># æœ€å¤§åŠ è½½æ•°é‡</span></span><br><span class="line">        <span class="variable language_">self</span>.start = start                        <span class="comment"># èµ·å§‹ç´¢å¼•</span></span><br><span class="line">        <span class="variable language_">self</span>.end = end                            <span class="comment"># ç»“æŸç´¢å¼•</span></span><br><span class="line">        <span class="variable language_">self</span>.skip = skip                          <span class="comment"># é‡‡æ ·é—´éš”</span></span><br><span class="line">        <span class="variable language_">self</span>.load_sorted = load_sorted            <span class="comment"># æ˜¯å¦ä¿æŒé¡ºåº</span></span><br><span class="line">        <span class="variable language_">self</span>.load_img = load_img                  <span class="comment"># æ˜¯å¦å®é™…åŠ è½½å›¾åƒ</span></span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.imgs_dir = os.path.join(<span class="variable language_">self</span>.base_dir, <span class="variable language_">self</span>.scene_name)  <span class="comment"># æ„å»ºå›¾åƒç›®å½•è·¯å¾„</span></span><br><span class="line">        </span><br><span class="line">        image_data = load_imgs(<span class="variable language_">self</span>.imgs_dir, <span class="variable language_">self</span>.num_img_to_load,  <span class="comment"># åŠ è½½å›¾åƒæ•°æ®</span></span><br><span class="line">                              <span class="variable language_">self</span>.start, <span class="variable language_">self</span>.end, <span class="variable language_">self</span>.skip,</span><br><span class="line">                              <span class="variable language_">self</span>.load_sorted, <span class="variable language_">self</span>.load_img)</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.imgs = image_data[<span class="string">&#x27;imgs&#x27;</span>]             <span class="comment"># å›¾åƒå¼ é‡</span></span><br><span class="line">        <span class="variable language_">self</span>.img_names = image_data[<span class="string">&#x27;img_names&#x27;</span>]   <span class="comment"># æ–‡ä»¶ååˆ—è¡¨</span></span><br><span class="line">        <span class="variable language_">self</span>.N_imgs = image_data[<span class="string">&#x27;N_imgs&#x27;</span>]         <span class="comment"># å›¾åƒæ€»æ•°</span></span><br><span class="line">        <span class="variable language_">self</span>.ori_H = image_data[<span class="string">&#x27;H&#x27;</span>]               <span class="comment"># åŸå§‹é«˜åº¦</span></span><br><span class="line">        <span class="variable language_">self</span>.ori_W = image_data[<span class="string">&#x27;W&#x27;</span>]               <span class="comment"># åŸå§‹å®½åº¦</span></span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.near = <span class="number">0.0</span>                            <span class="comment"># è¿‘è£å‰ªé¢(NDC åæ ‡ç³»)</span></span><br><span class="line">        <span class="variable language_">self</span>.far = <span class="number">1.0</span>                             <span class="comment"># è¿œè£å‰ªé¢(NDC åæ ‡ç³»)</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.res_ratio &gt; <span class="number">1</span>:                     <span class="comment"># è®¡ç®—å®é™…ä½¿ç”¨åˆ†è¾¨ç‡</span></span><br><span class="line">            <span class="variable language_">self</span>.H = <span class="variable language_">self</span>.ori_H // <span class="variable language_">self</span>.res_ratio</span><br><span class="line">            <span class="variable language_">self</span>.W = <span class="variable language_">self</span>.ori_W // <span class="variable language_">self</span>.res_ratio</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.H = <span class="variable language_">self</span>.ori_H</span><br><span class="line">            <span class="variable language_">self</span>.W = <span class="variable language_">self</span>.ori_W</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.load_img:                          <span class="comment"># æ‰§è¡Œå›¾åƒç¼©æ”¾</span></span><br><span class="line">            <span class="variable language_">self</span>.imgs = resize_imgs(<span class="variable language_">self</span>.imgs, <span class="variable language_">self</span>.H, <span class="variable language_">self</span>.W)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    base_dir = <span class="string">&#x27;/your/data/path&#x27;</span>                   <span class="comment"># æ•°æ®æ ¹ç›®å½•é…ç½®ç¤ºä¾‹</span></span><br><span class="line">    scene_name = <span class="string">&#x27;LLFF/fern/images&#x27;</span>                <span class="comment"># åœºæ™¯è·¯å¾„é…ç½®ç¤ºä¾‹</span></span><br><span class="line">    resize_ratio = <span class="number">8</span>                               <span class="comment"># ç¼©æ”¾æ¯”ä¾‹é…ç½®</span></span><br><span class="line">    num_img_to_load = -<span class="number">1</span>                           <span class="comment"># åŠ è½½å…¨éƒ¨å›¾åƒ</span></span><br><span class="line">    start, end, skip = <span class="number">0</span>, -<span class="number">1</span>, <span class="number">1</span>                    <span class="comment"># é‡‡æ ·å‚æ•°åˆå§‹åŒ–</span></span><br><span class="line">    load_sorted, load_img = <span class="literal">True</span>, <span class="literal">True</span>             <span class="comment"># åŠ è½½é…ç½®å‚æ•°</span></span><br><span class="line">    </span><br><span class="line">    scene = DataLoaderAnyFolder(                   <span class="comment"># åˆ›å»ºæ•°æ®åŠ è½½å®ä¾‹</span></span><br><span class="line">        base_dir=base_dir,</span><br><span class="line">        scene_name=scene_name,</span><br><span class="line">        res_ratio=resize_ratio,</span><br><span class="line">        num_img_to_load=num_img_to_load,</span><br><span class="line">        start=start,</span><br><span class="line">        end=end,</span><br><span class="line">        skip=skip,</span><br><span class="line">        load_sorted=load_sorted,</span><br><span class="line">        load_img=load_img)</span><br></pre></td></tr></table></figure>

<h4 id="local-save-py"><a href="#local-save-py" class="headerlink" title="local_save.py"></a>local_save.py</h4><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">import</span> imageio</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> dataloader.with_colmap <span class="keyword">import</span> resize_imgs</span><br><span class="line"><span class="keyword">from</span> torchvision <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> torch.nn <span class="keyword">import</span> functional <span class="keyword">as</span> F</span><br><span class="line"></span><br><span class="line"><span class="meta">@torch.no_grad()</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Vgg19</span>(torch.nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, requires_grad=<span class="literal">False</span></span>):</span><br><span class="line">        <span class="comment"># è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="comment"># åŠ è½½é¢„è®­ç»ƒçš„ VGG19 æ¨¡å‹çš„ç‰¹å¾æå–éƒ¨åˆ†</span></span><br><span class="line">        <span class="variable language_">self</span>.vgg_pretrained_features = models.vgg19(pretrained=<span class="literal">True</span>).features</span><br><span class="line">        <span class="comment"># å¦‚æœä¸éœ€è¦è®¡ç®—æ¢¯åº¦ï¼Œåˆ™å°†æ¨¡å‹å‚æ•°çš„ requires_grad å±æ€§è®¾ç½®ä¸º False</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> requires_grad:</span><br><span class="line">            <span class="keyword">for</span> param <span class="keyword">in</span> <span class="variable language_">self</span>.parameters():</span><br><span class="line">                param.requires_grad = <span class="literal">False</span></span><br><span class="line">        <span class="comment"># åˆå§‹åŒ–ç‰¹å¾å›¾çš„å½¢çŠ¶ä¸º None</span></span><br><span class="line">        <span class="variable language_">self</span>.feature_shape = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, X, indices=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="comment"># è®°å½•è¾“å…¥ç‰¹å¾å›¾çš„å½¢çŠ¶</span></span><br><span class="line">        <span class="variable language_">self</span>.feature_shape = X.shape</span><br><span class="line">        <span class="comment"># å¦‚æœæ²¡æœ‰æŒ‡å®šç´¢å¼•ï¼Œåˆ™é»˜è®¤ä½¿ç”¨ [7, 25]</span></span><br><span class="line">        <span class="keyword">if</span> indices <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            indices = [<span class="number">7</span>,<span class="number">25</span>]</span><br><span class="line">        <span class="comment"># å­˜å‚¨æå–çš„ç‰¹å¾å›¾</span></span><br><span class="line">        out = []</span><br><span class="line">        <span class="comment"># éå†åˆ°æœ€åä¸€ä¸ªç´¢å¼•ä½ç½®</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(indices[-<span class="number">1</span>]):</span><br><span class="line">            <span class="comment"># é€šè¿‡ VGG19 çš„ç¬¬ i å±‚è¿›è¡Œç‰¹å¾æå–</span></span><br><span class="line">            X = <span class="variable language_">self</span>.vgg_pretrained_features[i](X)</span><br><span class="line">            <span class="comment"># å¦‚æœå½“å‰å±‚çš„ç´¢å¼•åŠ  1 åœ¨æŒ‡å®šçš„ç´¢å¼•åˆ—è¡¨ä¸­</span></span><br><span class="line">            <span class="keyword">if</span> (i+<span class="number">1</span>) <span class="keyword">in</span> indices:</span><br><span class="line">                <span class="keyword">if</span> <span class="variable language_">self</span>.feature_shape <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                    <span class="comment"># å¦‚æœç‰¹å¾å›¾å½¢çŠ¶ä¸º Noneï¼Œåˆ™è®°å½•å½“å‰ç‰¹å¾å›¾çš„å½¢çŠ¶</span></span><br><span class="line">                    <span class="variable language_">self</span>.feature_shape = X.shape</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="comment"># å¯¹ç‰¹å¾å›¾è¿›è¡ŒåŒçº¿æ€§æ’å€¼ï¼Œä½¿å…¶å°ºå¯¸ä¸è¾“å…¥ç‰¹å¾å›¾çš„å°ºå¯¸ä¸€è‡´</span></span><br><span class="line">                    X = F.interpolate(X,<span class="variable language_">self</span>.feature_shape[-<span class="number">2</span>:],mode=<span class="string">&#x27;bilinear&#x27;</span>,align_corners=<span class="literal">True</span>)</span><br><span class="line">                <span class="comment"># å°†å¤„ç†åçš„ç‰¹å¾å›¾æ·»åŠ åˆ°è¾“å‡ºåˆ—è¡¨ä¸­</span></span><br><span class="line">                out.append(X)</span><br><span class="line">        <span class="comment"># å°†æ‰€æœ‰æå–çš„ç‰¹å¾å›¾åœ¨é€šé“ç»´åº¦ä¸Šæ‹¼æ¥èµ·æ¥</span></span><br><span class="line">        <span class="keyword">return</span> torch.cat(out,<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_imgs</span>(<span class="params">image_dir, num_img_to_load, start, end, skip, load_sorted, load_img</span>):</span><br><span class="line">    <span class="comment"># è·å–å›¾åƒç›®å½•ä¸‹æ‰€æœ‰å›¾åƒçš„æ–‡ä»¶åï¼Œå¹¶æŒ‰å­—æ¯é¡ºåºæ’åº</span></span><br><span class="line">    img_names = np.array(<span class="built_in">sorted</span>(os.listdir(image_dir))) <span class="comment"># all image names</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ—¶é—´åŸŸä¸‹é‡‡æ ·ï¼šæ ¹æ® startã€end å’Œ skip å‚æ•°é€‰æ‹©å›¾åƒ</span></span><br><span class="line">    <span class="keyword">if</span> end == -<span class="number">1</span>:</span><br><span class="line">        img_names = img_names[start::skip]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        img_names = img_names[start:end:skip]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœä¸æŒ‰é¡ºåºåŠ è½½å›¾åƒï¼Œåˆ™å¯¹å›¾åƒæ–‡ä»¶åè¿›è¡Œéšæœºæ‰“ä¹±</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> load_sorted:</span><br><span class="line">        np.random.shuffle(img_names)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ£€æŸ¥è¦åŠ è½½çš„å›¾åƒæ•°é‡æ˜¯å¦è¶…è¿‡å¯ç”¨å›¾åƒæ•°é‡</span></span><br><span class="line">    <span class="keyword">if</span> num_img_to_load &gt; <span class="built_in">len</span>(img_names):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Asked for &#123;0:6d&#125; images but only &#123;1:6d&#125; available. Exit.&#x27;</span>.<span class="built_in">format</span>(num_img_to_load, <span class="built_in">len</span>(img_names)))</span><br><span class="line">        exit()</span><br><span class="line">    <span class="keyword">elif</span> num_img_to_load == -<span class="number">1</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Loading all available &#123;0:6d&#125; images&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(img_names)))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Loading &#123;0:6d&#125; images out of &#123;1:6d&#125; images.&#x27;</span>.<span class="built_in">format</span>(num_img_to_load, <span class="built_in">len</span>(img_names)))</span><br><span class="line">        <span class="comment"># æˆªå–å‰ num_img_to_load ä¸ªå›¾åƒæ–‡ä»¶å</span></span><br><span class="line">        img_names = img_names[:num_img_to_load]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ„å»ºå›¾åƒæ–‡ä»¶çš„å®Œæ•´è·¯å¾„</span></span><br><span class="line">    img_paths = [os.path.join(image_dir, n) <span class="keyword">for</span> n <span class="keyword">in</span> img_names]</span><br><span class="line">    <span class="comment"># å›¾åƒçš„æ•°é‡</span></span><br><span class="line">    N_imgs = <span class="built_in">len</span>(img_paths)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å­˜å‚¨åŠ è½½çš„å›¾åƒ</span></span><br><span class="line">    img_list = []</span><br><span class="line">    <span class="keyword">if</span> load_img:</span><br><span class="line">        <span class="comment"># ä½¿ç”¨ tqdm æ˜¾ç¤ºåŠ è½½è¿›åº¦</span></span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> tqdm(img_paths):</span><br><span class="line">            <span class="comment"># è¯»å–å›¾åƒå¹¶æˆªå–å‰ä¸‰ä¸ªé€šé“ï¼ˆRGBï¼‰</span></span><br><span class="line">            img = imageio.imread(p)[:, :, :<span class="number">3</span>] <span class="comment"># (H, W, 3) np.uint8</span></span><br><span class="line">            <span class="comment"># å°†å›¾åƒæ·»åŠ åˆ°åˆ—è¡¨ä¸­</span></span><br><span class="line">            img_list.append(img)</span><br><span class="line">        <span class="comment"># å°†å›¾åƒåˆ—è¡¨è½¬æ¢ä¸º numpy æ•°ç»„</span></span><br><span class="line">        img_list = np.stack(img_list) <span class="comment"># (N, H, W, 3)</span></span><br><span class="line">        <span class="comment"># å°† numpy æ•°ç»„è½¬æ¢ä¸º PyTorch å¼ é‡ï¼Œå¹¶å°†åƒç´ å€¼å½’ä¸€åŒ–åˆ° [0, 1] èŒƒå›´</span></span><br><span class="line">        img_list = torch.from_numpy(img_list).<span class="built_in">float</span>() / <span class="number">255</span> <span class="comment"># (N, H, W, 3) torch.float32</span></span><br><span class="line">        <span class="comment"># è·å–å›¾åƒçš„é«˜åº¦å’Œå®½åº¦</span></span><br><span class="line">        H, W = img_list.shape[<span class="number">1</span>], img_list.shape[<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># å¦‚æœä¸åŠ è½½å›¾åƒï¼Œåˆ™è¯»å–ç¬¬ä¸€å¼ å›¾åƒä»¥è·å–å›¾åƒçš„é«˜åº¦å’Œå®½åº¦</span></span><br><span class="line">        tmp_img = imageio.imread(img_paths[<span class="number">0</span>]) <span class="comment"># load one image to get H, W</span></span><br><span class="line">        H, W = tmp_img.shape[<span class="number">0</span>], tmp_img.shape[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å­˜å‚¨åŠ è½½å›¾åƒçš„ç›¸å…³ä¿¡æ¯</span></span><br><span class="line">    results = &#123;</span><br><span class="line">        <span class="string">&#x27;imgs&#x27;</span>: img_list, <span class="comment"># (N, H, W, 3) torch.float32</span></span><br><span class="line">        <span class="string">&#x27;img_names&#x27;</span>: img_names, <span class="comment"># (N, )</span></span><br><span class="line">        <span class="string">&#x27;N_imgs&#x27;</span>: N_imgs,</span><br><span class="line">        <span class="string">&#x27;H&#x27;</span>: H,</span><br><span class="line">        <span class="string">&#x27;W&#x27;</span>: W,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DataLoaderAnyFolder</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Most useful fields:</span></span><br><span class="line"><span class="string">    self.c2ws: (N_imgs, 4, 4) torch.float32</span></span><br><span class="line"><span class="string">    self.imgs (N_imgs, H, W, 4) torch.float32</span></span><br><span class="line"><span class="string">    self.ray_dir_cam (H, W, 3) torch.float32</span></span><br><span class="line"><span class="string">    self.H scalar</span></span><br><span class="line"><span class="string">    self.W scalar</span></span><br><span class="line"><span class="string">    self.N_imgs scalar</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, base_dir, scene_name, res_ratio, num_img_to_load, start, end, skip, load_sorted, load_img=<span class="literal">True</span>, device=<span class="string">&#x27;cpu&#x27;</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        :param base_dir: æ•°æ®çš„åŸºç¡€ç›®å½•</span></span><br><span class="line"><span class="string">        :param scene_name: åœºæ™¯çš„åç§°</span></span><br><span class="line"><span class="string">        :param res_ratio: æ•´æ•°ï¼Œå¦‚ [1, 2, 4] ç­‰ï¼Œç”¨äºå°†å›¾åƒè°ƒæ•´ä¸ºè¾ƒä½çš„åˆ†è¾¨ç‡ã€‚</span></span><br><span class="line"><span class="string">        :param start/end/skip: ç”¨äºåœ¨æ—¶é—´åŸŸä¸Šæ§åˆ¶å¸§çš„åŠ è½½ã€‚</span></span><br><span class="line"><span class="string">        :param load_sorted: å¸ƒå°”å€¼ï¼Œæ˜¯å¦æŒ‰é¡ºåºåŠ è½½å›¾åƒã€‚</span></span><br><span class="line"><span class="string">        :param load_img: å¸ƒå°”å€¼ã€‚å¦‚æœè®¾ç½®ä¸º Falseï¼šä»…ç»Ÿè®¡å›¾åƒæ•°é‡ã€è·å–å›¾åƒçš„é«˜åº¦å’Œå®½åº¦ï¼Œ</span></span><br><span class="line"><span class="string">                         ä½†ä¸åŠ è½½å›¾åƒã€‚åœ¨å¯è§†åŒ–ä½å§¿æˆ–è°ƒè¯•ç­‰æƒ…å†µä¸‹å¾ˆæœ‰ç”¨ã€‚</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.base_dir = base_dir</span><br><span class="line">        <span class="variable language_">self</span>.scene_name = scene_name</span><br><span class="line">        <span class="variable language_">self</span>.res_ratio = res_ratio</span><br><span class="line">        <span class="variable language_">self</span>.num_img_to_load = num_img_to_load</span><br><span class="line">        <span class="variable language_">self</span>.start = start</span><br><span class="line">        <span class="variable language_">self</span>.end = end</span><br><span class="line">        <span class="variable language_">self</span>.skip = skip</span><br><span class="line">        <span class="variable language_">self</span>.load_sorted = load_sorted</span><br><span class="line">        <span class="variable language_">self</span>.load_img = load_img</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ„å»ºå›¾åƒç›®å½•çš„å®Œæ•´è·¯å¾„</span></span><br><span class="line">        <span class="variable language_">self</span>.imgs_dir = os.path.join(<span class="variable language_">self</span>.base_dir, <span class="variable language_">self</span>.scene_name)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è°ƒç”¨ load_imgs å‡½æ•°åŠ è½½å›¾åƒ</span></span><br><span class="line">        image_data = load_imgs(<span class="variable language_">self</span>.imgs_dir, <span class="variable language_">self</span>.num_img_to_load, <span class="variable language_">self</span>.start, <span class="variable language_">self</span>.end, <span class="variable language_">self</span>.skip,</span><br><span class="line">                               <span class="variable language_">self</span>.load_sorted, <span class="variable language_">self</span>.load_img)</span><br><span class="line">        <span class="comment"># åŠ è½½çš„å›¾åƒå¼ é‡</span></span><br><span class="line">        <span class="variable language_">self</span>.imgs = image_data[<span class="string">&#x27;imgs&#x27;</span>] <span class="comment"># (N, H, W, 3) torch.float32</span></span><br><span class="line">        <span class="comment"># å›¾åƒçš„æ–‡ä»¶å</span></span><br><span class="line">        <span class="variable language_">self</span>.img_names = image_data[<span class="string">&#x27;img_names&#x27;</span>] <span class="comment"># (N, )</span></span><br><span class="line">        <span class="comment"># å›¾åƒçš„æ•°é‡</span></span><br><span class="line">        <span class="variable language_">self</span>.N_imgs = image_data[<span class="string">&#x27;N_imgs&#x27;</span>]</span><br><span class="line">        <span class="comment"># åŸå§‹å›¾åƒçš„é«˜åº¦</span></span><br><span class="line">        <span class="variable language_">self</span>.ori_H = image_data[<span class="string">&#x27;H&#x27;</span>]</span><br><span class="line">        <span class="comment"># åŸå§‹å›¾åƒçš„å®½åº¦</span></span><br><span class="line">        <span class="variable language_">self</span>.ori_W = image_data[<span class="string">&#x27;W&#x27;</span>]</span><br><span class="line">        <span class="comment"># åˆå§‹åŒ– VGG19 ç¼–ç å™¨</span></span><br><span class="line">        <span class="variable language_">self</span>.encoder = Vgg19()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¿‘è£å‰ªå¹³é¢è·ç¦»</span></span><br><span class="line">        <span class="variable language_">self</span>.near = <span class="number">0.0</span></span><br><span class="line">        <span class="comment"># è¿œè£å‰ªå¹³é¢è·ç¦»</span></span><br><span class="line">        <span class="variable language_">self</span>.far = <span class="number">1.0</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¦‚æœéœ€è¦è°ƒæ•´å›¾åƒåˆ†è¾¨ç‡</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.res_ratio &gt; <span class="number">1</span>:</span><br><span class="line">            <span class="variable language_">self</span>.H = <span class="variable language_">self</span>.ori_H // <span class="variable language_">self</span>.res_ratio</span><br><span class="line">            <span class="variable language_">self</span>.W = <span class="variable language_">self</span>.ori_W // <span class="variable language_">self</span>.res_ratio</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.H = <span class="variable language_">self</span>.ori_H</span><br><span class="line">            <span class="variable language_">self</span>.W = <span class="variable language_">self</span>.ori_W</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.load_img:</span><br><span class="line">            <span class="comment"># è°ƒæ•´å›¾åƒçš„åˆ†è¾¨ç‡</span></span><br><span class="line">            <span class="variable language_">self</span>.imgs = resize_imgs(<span class="variable language_">self</span>.imgs, <span class="variable language_">self</span>.H, <span class="variable language_">self</span>.W) <span class="comment"># (N, H, W, 3) torch.float32</span></span><br><span class="line">            <span class="comment"># å­˜å‚¨å›¾åƒçš„ç‰¹å¾</span></span><br><span class="line">            <span class="variable language_">self</span>.features = []</span><br><span class="line">            <span class="comment"># ä½¿ç”¨ tqdm æ˜¾ç¤ºå¤„ç†è¿›åº¦</span></span><br><span class="line">            <span class="keyword">for</span> img <span class="keyword">in</span> tqdm(<span class="variable language_">self</span>.imgs):</span><br><span class="line">                <span class="comment"># å¯¹å›¾åƒè¿›è¡Œé€šé“ç»´åº¦çš„è°ƒæ•´ï¼Œå¹¶é€šè¿‡ç¼–ç å™¨æå–ç‰¹å¾</span></span><br><span class="line">                <span class="variable language_">self</span>.features.append(<span class="variable language_">self</span>.encoder(img.permute(<span class="number">2</span>,<span class="number">0</span>,<span class="number">1</span>)[<span class="literal">None</span>,...]))</span><br><span class="line">            <span class="comment"># å°†æ‰€æœ‰å›¾åƒçš„ç‰¹å¾åœ¨æ‰¹æ¬¡ç»´åº¦ä¸Šæ‹¼æ¥èµ·æ¥</span></span><br><span class="line">            <span class="variable language_">self</span>.features = torch.cat(<span class="variable language_">self</span>.features,<span class="number">0</span>)</span><br><span class="line">            <span class="comment"># ç‰¹å¾å›¾çš„å°ºå¯¸</span></span><br><span class="line">            <span class="variable language_">self</span>.feature_size = (<span class="variable language_">self</span>.features.shape[-<span class="number">2</span>],<span class="variable language_">self</span>.features.shape[-<span class="number">1</span>]) <span class="comment"># (H,W)</span></span><br><span class="line">            <span class="comment"># æ‰“å°ç‰¹å¾å›¾çš„å½¢çŠ¶</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="variable language_">self</span>.features.shape)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># æ•°æ®çš„åŸºç¡€ç›®å½•ï¼Œéœ€è¦æ›¿æ¢ä¸ºå®é™…çš„è·¯å¾„</span></span><br><span class="line">    base_dir = <span class="string">&#x27;/your/data/path&#x27;</span></span><br><span class="line">    <span class="comment"># åœºæ™¯çš„åç§°</span></span><br><span class="line">    scene_name = <span class="string">&#x27;LLFF/fern/images&#x27;</span></span><br><span class="line">    <span class="comment"># å›¾åƒçš„ç¼©æ”¾æ¯”ä¾‹</span></span><br><span class="line">    resize_ratio = <span class="number">8</span></span><br><span class="line">    <span class="comment"># è¦åŠ è½½çš„å›¾åƒæ•°é‡ï¼Œ-1 è¡¨ç¤ºåŠ è½½æ‰€æœ‰å›¾åƒ</span></span><br><span class="line">    num_img_to_load = -<span class="number">1</span></span><br><span class="line">    <span class="comment"># å¼€å§‹åŠ è½½å›¾åƒçš„ç´¢å¼•</span></span><br><span class="line">    start = <span class="number">0</span></span><br><span class="line">    <span class="comment"># ç»“æŸåŠ è½½å›¾åƒçš„ç´¢å¼•ï¼Œ-1 è¡¨ç¤ºåŠ è½½åˆ°æœ€å</span></span><br><span class="line">    end = -<span class="number">1</span></span><br><span class="line">    <span class="comment"># åŠ è½½å›¾åƒçš„é—´éš”</span></span><br><span class="line">    skip = <span class="number">1</span></span><br><span class="line">    <span class="comment"># æ˜¯å¦æŒ‰é¡ºåºåŠ è½½å›¾åƒ</span></span><br><span class="line">    load_sorted = <span class="literal">True</span></span><br><span class="line">    <span class="comment"># æ˜¯å¦åŠ è½½å›¾åƒ</span></span><br><span class="line">    load_img = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆå§‹åŒ– DataLoaderAnyFolder ç±»</span></span><br><span class="line">    scene = DataLoaderAnyFolder(base_dir=base_dir,</span><br><span class="line">                                scene_name=scene_name,</span><br><span class="line">                                res_ratio=resize_ratio,</span><br><span class="line">                                num_img_to_load=num_img_to_load,</span><br><span class="line">                                start=start,</span><br><span class="line">                                end=end,</span><br><span class="line">                                skip=skip,</span><br><span class="line">                                load_sorted=load_sorted,</span><br><span class="line">                                load_img=load_img)</span><br></pre></td></tr></table></figure>



<h4 id="with-colmap-py"><a href="#with-colmap-py" class="headerlink" title="with_colmap.py"></a>with_colmap.py</h4><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="comment"># os æ¨¡å—æä¾›äº†ä¸æ“ä½œç³»ç»Ÿè¿›è¡Œäº¤äº’çš„åŠŸèƒ½ï¼Œ</span></span><br><span class="line"><span class="comment"># å¯ä»¥ç”¨æ¥å¤„ç†æ–‡ä»¶å’Œç›®å½•è·¯å¾„ã€åˆ›å»º/åˆ é™¤ç›®å½•ã€è·å–ç¯å¢ƒå˜é‡ç­‰ï¼Œ</span></span><br><span class="line"><span class="comment"># åœ¨ä»£ç ä¸­ä¸»è¦ç”¨äºæ„å»ºæ–‡ä»¶å’Œç›®å½•çš„è·¯å¾„ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="comment"># torch æ˜¯ PyTorch çš„æ ¸å¿ƒåº“ï¼Œæä¾›äº†å¼ é‡ï¼ˆTensorï¼‰æ•°æ®ç»“æ„ï¼Œ</span></span><br><span class="line"><span class="comment"># æ”¯æŒè‡ªåŠ¨æ±‚å¯¼æœºåˆ¶ï¼Œç”¨äºæ„å»ºå’Œè®­ç»ƒæ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œ</span></span><br><span class="line"><span class="comment"># å¯ä»¥åœ¨ CPU æˆ– GPU ä¸Šè¿›è¡Œé«˜æ•ˆçš„æ•°å€¼è®¡ç®—ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"><span class="comment"># torch.nn.functional æä¾›äº†è®¸å¤šç¥ç»ç½‘ç»œä¸­å¸¸ç”¨çš„å‡½æ•°ï¼Œ</span></span><br><span class="line"><span class="comment"># å¦‚æ¿€æ´»å‡½æ•°ã€æŸå¤±å‡½æ•°ã€å·ç§¯ã€æ± åŒ–ç­‰æ“ä½œï¼Œ</span></span><br><span class="line"><span class="comment"># è¿™äº›å‡½æ•°æ˜¯æ— çŠ¶æ€çš„ï¼Œé€šå¸¸ç”¨äºè‡ªå®šä¹‰ç¥ç»ç½‘ç»œå±‚ä¸­çš„å…·ä½“è¿ç®—ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="comment"># numpy æ˜¯ Python ä¸­ç”¨äºç§‘å­¦è®¡ç®—çš„åŸºç¡€åº“ï¼Œ</span></span><br><span class="line"><span class="comment"># æä¾›äº†é«˜æ•ˆçš„å¤šç»´æ•°ç»„å¯¹è±¡å’Œå„ç§æ•°å­¦å‡½æ•°ï¼Œ</span></span><br><span class="line"><span class="comment"># å¯ä»¥è¿›è¡Œæ•°ç»„æ“ä½œã€çº¿æ€§ä»£æ•°è¿ç®—ã€éšæœºæ•°ç”Ÿæˆç­‰ï¼Œ</span></span><br><span class="line"><span class="comment"># åœ¨ä»£ç ä¸­ä¸»è¦ç”¨äºå¤„ç†å›¾åƒæ•°æ®å’Œæ•°ç»„æ“ä½œã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="comment"># tqdm æ˜¯ä¸€ä¸ªå¿«é€Ÿã€å¯æ‰©å±•çš„è¿›åº¦æ¡å·¥å…·ï¼Œ</span></span><br><span class="line"><span class="comment"># å¯ä»¥åœ¨å¾ªç¯ä¸­æ˜¾ç¤ºè¿›åº¦æ¡ï¼Œæ–¹ä¾¿ç”¨æˆ·äº†è§£ä»£ç æ‰§è¡Œçš„è¿›åº¦ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> imageio</span><br><span class="line"><span class="comment"># imageio æ˜¯ä¸€ä¸ªç”¨äºè¯»å–å’Œå†™å…¥å¤šç§å›¾åƒæ–‡ä»¶æ ¼å¼çš„åº“ï¼Œ</span></span><br><span class="line"><span class="comment"># åœ¨ä»£ç ä¸­ä¸»è¦ç”¨äºè¯»å–å›¾åƒæ–‡ä»¶ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> utils.comp_ray_dir <span class="keyword">import</span> comp_ray_dir_cam</span><br><span class="line"><span class="comment"># ä» utils åŒ…ä¸­çš„ comp_ray_dir æ¨¡å—å¯¼å…¥ comp_ray_dir_cam å‡½æ•°ï¼Œ</span></span><br><span class="line"><span class="comment"># æ¨æµ‹è¯¥å‡½æ•°ç”¨äºè®¡ç®—ç›¸æœºåæ ‡ç³»ä¸‹çš„å…‰çº¿æ–¹å‘ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> utils.pose_utils <span class="keyword">import</span> center_poses</span><br><span class="line"><span class="comment"># ä» utils åŒ…ä¸­çš„ pose_utils æ¨¡å—å¯¼å…¥ center_poses å‡½æ•°ï¼Œ</span></span><br><span class="line"><span class="comment"># æ¨æµ‹è¯¥å‡½æ•°ç”¨äºå¯¹ç›¸æœºä½å§¿è¿›è¡Œä¸­å¿ƒåŒ–å¤„ç†ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> utils.lie_group_helper <span class="keyword">import</span> convert3x4_4x4</span><br><span class="line"><span class="comment"># ä» utils åŒ…ä¸­çš„ lie_group_helper æ¨¡å—å¯¼å…¥ convert3x4_4x4 å‡½æ•°ï¼Œ</span></span><br><span class="line"><span class="comment"># æ¨æµ‹è¯¥å‡½æ•°ç”¨äºå°† 3x4 çš„ç›¸æœºä½å§¿çŸ©é˜µè½¬æ¢ä¸º 4x4 çš„é½æ¬¡çŸ©é˜µã€‚</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">resize_imgs</span>(<span class="params">imgs, new_h, new_w</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    :param imgs:    (N, H, W, 3)            torch.float32 RGB</span></span><br><span class="line"><span class="string">    :param new_h:   int/torch int</span></span><br><span class="line"><span class="string">    :param new_w:   int/torch int</span></span><br><span class="line"><span class="string">    :return:        (N, new_H, new_W, 3)    torch.float32 RGB</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># å°†å›¾åƒå¼ é‡ä» (N, H, W, 3) è½¬æ¢ä¸º (N, 3, H, W) ä»¥é€‚åº” F.interpolate å‡½æ•°çš„è¾“å…¥è¦æ±‚</span></span><br><span class="line">    imgs = imgs.permute(<span class="number">0</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>)  <span class="comment"># (N, 3, H, W)</span></span><br><span class="line">    <span class="comment"># ä½¿ç”¨åŒçº¿æ€§æ’å€¼æ–¹æ³•å°†å›¾åƒè°ƒæ•´åˆ°æŒ‡å®šçš„æ–°é«˜åº¦å’Œæ–°å®½åº¦</span></span><br><span class="line">    imgs = F.interpolate(imgs, size=(new_h, new_w), mode=<span class="string">&#x27;bilinear&#x27;</span>)  <span class="comment"># (N, 3, new_H, new_W)</span></span><br><span class="line">    <span class="comment"># å°†å›¾åƒå¼ é‡ä» (N, 3, new_H, new_W) è½¬æ¢å› (N, new_H, new_W, 3)</span></span><br><span class="line">    imgs = imgs.permute(<span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>)  <span class="comment"># (N, new_H, new_W, 3)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> imgs  <span class="comment"># (N, new_H, new_W, 3) torch.float32 RGB</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_imgs</span>(<span class="params">image_dir, img_ids, new_h, new_w</span>):</span><br><span class="line">    <span class="comment"># è·å–å›¾åƒç›®å½•ä¸‹æ‰€æœ‰å›¾åƒæ–‡ä»¶åï¼Œå¹¶æŒ‰å­—æ¯é¡ºåºæ’åº</span></span><br><span class="line">    img_names = np.array(<span class="built_in">sorted</span>(os.listdir(image_dir)))  <span class="comment"># all image names</span></span><br><span class="line">    <span class="comment"># æ ¹æ®ç»™å®šçš„å›¾åƒç´¢å¼•ç­›é€‰å‡ºéœ€è¦çš„å›¾åƒæ–‡ä»¶å</span></span><br><span class="line">    img_names = img_names[img_ids]  <span class="comment"># image name for this split</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ„å»ºæ¯ä¸ªå›¾åƒçš„å®Œæ•´è·¯å¾„</span></span><br><span class="line">    img_paths = [os.path.join(image_dir, n) <span class="keyword">for</span> n <span class="keyword">in</span> img_names]</span><br><span class="line"></span><br><span class="line">    img_list = []</span><br><span class="line">    <span class="comment"># ä½¿ç”¨ tqdm æ˜¾ç¤ºåŠ è½½å›¾åƒçš„è¿›åº¦</span></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> tqdm(img_paths):</span><br><span class="line">        <span class="comment"># è¯»å–å›¾åƒå¹¶åªä¿ç•™å‰ä¸‰ä¸ªé€šé“ï¼ˆRGBï¼‰</span></span><br><span class="line">        img = imageio.imread(p)[:, :, :<span class="number">3</span>]  <span class="comment"># (H, W, 3) np.uint8</span></span><br><span class="line">        img_list.append(img)</span><br><span class="line">    <span class="comment"># å°†å›¾åƒåˆ—è¡¨è½¬æ¢ä¸º numpy æ•°ç»„</span></span><br><span class="line">    img_list = np.stack(img_list)  <span class="comment"># (N, H, W, 3)</span></span><br><span class="line">    <span class="comment"># å°† numpy æ•°ç»„è½¬æ¢ä¸º PyTorch å¼ é‡ï¼Œå¹¶å°†åƒç´ å€¼å½’ä¸€åŒ–åˆ° [0, 1] èŒƒå›´</span></span><br><span class="line">    img_list = torch.from_numpy(img_list).<span class="built_in">float</span>() / <span class="number">255</span>  <span class="comment"># (N, H, W, 3) torch.float32</span></span><br><span class="line">    <span class="comment"># è°ƒç”¨ resize_imgs å‡½æ•°å°†å›¾åƒè°ƒæ•´åˆ°æŒ‡å®šçš„æ–°é«˜åº¦å’Œæ–°å®½åº¦</span></span><br><span class="line">    img_list = resize_imgs(img_list, new_h, new_w)</span><br><span class="line">    <span class="keyword">return</span> img_list, img_names</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_meta</span>(<span class="params">in_dir, use_ndc</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Read the poses_bounds.npy file produced by LLFF imgs2poses.py.</span></span><br><span class="line"><span class="string">    This function is modified from https://github.com/kwea123/nerf_pl.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># åŠ è½½ poses_bounds.npy æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«ç›¸æœºä½å§¿å’Œæ·±åº¦è¾¹ç•Œä¿¡æ¯</span></span><br><span class="line">    poses_bounds = np.load(os.path.join(in_dir, <span class="string">&#x27;poses_bounds.npy&#x27;</span>))  <span class="comment"># (N_images, 17)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># æå–ç›¸æœºä½å§¿ä¿¡æ¯ï¼Œå°†å…¶é‡å¡‘ä¸º (N_images, 3, 5) çš„å½¢çŠ¶</span></span><br><span class="line">    c2ws = poses_bounds[:, :<span class="number">15</span>].reshape(-<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>)  <span class="comment"># (N_images, 3, 5)</span></span><br><span class="line">    <span class="comment"># æå–æ·±åº¦è¾¹ç•Œä¿¡æ¯</span></span><br><span class="line">    bounds = poses_bounds[:, -<span class="number">2</span>:]  <span class="comment"># (N_images, 2)</span></span><br><span class="line">    <span class="comment"># æå–å›¾åƒé«˜åº¦ã€å®½åº¦å’Œç„¦è·ä¿¡æ¯</span></span><br><span class="line">    H, W, focal = c2ws[<span class="number">0</span>, :, -<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä¿®æ­£ç›¸æœºä½å§¿çš„æ—‹è½¬éƒ¨åˆ†ï¼Œå°†æ—‹è½¬å½¢å¼ä» &quot;down right back&quot; æ”¹ä¸º &quot;right up back&quot;</span></span><br><span class="line">    <span class="comment"># å‚è€ƒ https://github.com/bmild/nerf/issues/34</span></span><br><span class="line">    c2ws = np.concatenate([c2ws[..., <span class="number">1</span>:<span class="number">2</span>], -c2ws[..., :<span class="number">1</span>], c2ws[..., <span class="number">2</span>:<span class="number">4</span>]], -<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¯¹ç›¸æœºä½å§¿è¿›è¡Œä¸­å¿ƒåŒ–å¤„ç†ï¼Œè¿”å›ä¸­å¿ƒåŒ–åçš„ç›¸æœºä½å§¿å’Œå¹³å‡ä½å§¿</span></span><br><span class="line">    <span class="comment"># pose_avg @ c2ws -&gt; centred c2ws</span></span><br><span class="line">    c2ws, pose_avg = center_poses(c2ws)  <span class="comment"># (N_images, 3, 4), (4, 4)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> use_ndc:</span><br><span class="line">        <span class="comment"># è·å–æœ€è¿‘æ·±åº¦å€¼</span></span><br><span class="line">        near_original = bounds.<span class="built_in">min</span>()</span><br><span class="line">        <span class="comment"># è®¡ç®—ç¼©æ”¾å› å­ï¼Œå°†æœ€è¿‘æ·±åº¦è°ƒæ•´åˆ°ç¨å¤§äº 1.0 çš„ä½ç½®</span></span><br><span class="line">        scale_factor = near_original * <span class="number">0.75</span>  <span class="comment"># 0.75 is the default parameter</span></span><br><span class="line">        <span class="comment"># å¯¹æ·±åº¦è¾¹ç•Œè¿›è¡Œç¼©æ”¾</span></span><br><span class="line">        bounds /= scale_factor</span><br><span class="line">        <span class="comment"># å¯¹ç›¸æœºä½å§¿çš„å¹³ç§»éƒ¨åˆ†è¿›è¡Œç¼©æ”¾</span></span><br><span class="line">        c2ws[..., <span class="number">3</span>] /= scale_factor</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å°† 3x4 çš„ç›¸æœºä½å§¿è½¬æ¢ä¸º 4x4 çš„é½æ¬¡çŸ©é˜µå½¢å¼</span></span><br><span class="line">    c2ws = convert3x4_4x4(c2ws)  <span class="comment"># (N, 4, 4)</span></span><br><span class="line"></span><br><span class="line">    results = &#123;</span><br><span class="line">        <span class="string">&#x27;c2ws&#x27;</span>: c2ws,       <span class="comment"># (N, 4, 4) np</span></span><br><span class="line">        <span class="string">&#x27;bounds&#x27;</span>: bounds,   <span class="comment"># (N_images, 2) np</span></span><br><span class="line">        <span class="string">&#x27;H&#x27;</span>: <span class="built_in">int</span>(H),        <span class="comment"># scalar</span></span><br><span class="line">        <span class="string">&#x27;W&#x27;</span>: <span class="built_in">int</span>(W),        <span class="comment"># scalar</span></span><br><span class="line">        <span class="string">&#x27;focal&#x27;</span>: focal,     <span class="comment"># scalar</span></span><br><span class="line">        <span class="string">&#x27;pose_avg&#x27;</span>: pose_avg,  <span class="comment"># (4, 4) np</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DataLoaderWithCOLMAP</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Most useful fields:</span></span><br><span class="line"><span class="string">        self.c2ws:          (N_imgs, 4, 4)      torch.float32</span></span><br><span class="line"><span class="string">        self.imgs           (N_imgs, H, W, 4)   torch.float32</span></span><br><span class="line"><span class="string">        self.ray_dir_cam    (H, W, 3)           torch.float32</span></span><br><span class="line"><span class="string">        self.H              scalar</span></span><br><span class="line"><span class="string">        self.W              scalar</span></span><br><span class="line"><span class="string">        self.N_imgs         scalar</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, base_dir, scene_name, data_type, res_ratio, num_img_to_load, skip, use_ndc, load_img=<span class="literal">True</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        :param base_dir:</span></span><br><span class="line"><span class="string">        :param scene_name:</span></span><br><span class="line"><span class="string">        :param data_type:   &#x27;train&#x27; or &#x27;val&#x27;.</span></span><br><span class="line"><span class="string">        :param res_ratio:   int [1, 2, 4] etc to resize images to a lower resolution.</span></span><br><span class="line"><span class="string">        :param num_img_to_load/skip: control frame loading in temporal domain.</span></span><br><span class="line"><span class="string">        :param use_ndc      True/False, just centre the poses and scale them.</span></span><br><span class="line"><span class="string">        :param load_img:    True/False. If set to false: only count number of images, get H and W,</span></span><br><span class="line"><span class="string">                            but do not load imgs. Useful when vis poses or debug etc.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.base_dir = base_dir</span><br><span class="line">        <span class="variable language_">self</span>.scene_name = scene_name</span><br><span class="line">        <span class="variable language_">self</span>.data_type = data_type</span><br><span class="line">        <span class="variable language_">self</span>.res_ratio = res_ratio</span><br><span class="line">        <span class="variable language_">self</span>.num_img_to_load = num_img_to_load</span><br><span class="line">        <span class="variable language_">self</span>.skip = skip</span><br><span class="line">        <span class="variable language_">self</span>.use_ndc = use_ndc</span><br><span class="line">        <span class="variable language_">self</span>.load_img = load_img</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ„å»ºåœºæ™¯ç›®å½•çš„å®Œæ•´è·¯å¾„</span></span><br><span class="line">        <span class="variable language_">self</span>.scene_dir = os.path.join(<span class="variable language_">self</span>.base_dir, <span class="variable language_">self</span>.scene_name)</span><br><span class="line">        <span class="comment"># æ„å»ºå›¾åƒç›®å½•çš„å®Œæ•´è·¯å¾„</span></span><br><span class="line">        <span class="variable language_">self</span>.img_dir = os.path.join(<span class="variable language_">self</span>.scene_dir, <span class="string">&#x27;images&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¯»å–æ‰€æœ‰çš„å…ƒä¿¡æ¯ï¼ŒåŒ…æ‹¬ç›¸æœºä½å§¿ã€æ·±åº¦è¾¹ç•Œã€å›¾åƒå°ºå¯¸å’Œç„¦è·ç­‰</span></span><br><span class="line">        meta = read_meta(<span class="variable language_">self</span>.scene_dir, <span class="variable language_">self</span>.use_ndc)</span><br><span class="line">        <span class="comment"># æå–ç›¸æœºä½å§¿ä¿¡æ¯</span></span><br><span class="line">        <span class="variable language_">self</span>.c2ws = meta[<span class="string">&#x27;c2ws&#x27;</span>]  <span class="comment"># (N, 4, 4) all camera pose</span></span><br><span class="line">        <span class="comment"># æå–å›¾åƒé«˜åº¦ä¿¡æ¯</span></span><br><span class="line">        <span class="variable language_">self</span>.H = meta[<span class="string">&#x27;H&#x27;</span>]</span><br><span class="line">        <span class="comment"># æå–å›¾åƒå®½åº¦ä¿¡æ¯</span></span><br><span class="line">        <span class="variable language_">self</span>.W = meta[<span class="string">&#x27;W&#x27;</span>]</span><br><span class="line">        <span class="comment"># æå–ç„¦è·ä¿¡æ¯</span></span><br><span class="line">        <span class="variable language_">self</span>.focal = <span class="built_in">float</span>(meta[<span class="string">&#x27;focal&#x27;</span>])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.res_ratio &gt; <span class="number">1</span>:</span><br><span class="line">            <span class="comment"># å¦‚æœéœ€è¦è°ƒæ•´å›¾åƒåˆ†è¾¨ç‡ï¼Œå¯¹å›¾åƒé«˜åº¦è¿›è¡Œç›¸åº”çš„ç¼©æ”¾</span></span><br><span class="line">            <span class="variable language_">self</span>.H = <span class="variable language_">self</span>.H // <span class="variable language_">self</span>.res_ratio</span><br><span class="line">            <span class="comment"># å¦‚æœéœ€è¦è°ƒæ•´å›¾åƒåˆ†è¾¨ç‡ï¼Œå¯¹å›¾åƒå®½åº¦è¿›è¡Œç›¸åº”çš„ç¼©æ”¾</span></span><br><span class="line">            <span class="variable language_">self</span>.W = <span class="variable language_">self</span>.W // <span class="variable language_">self</span>.res_ratio</span><br><span class="line">            <span class="comment"># å¦‚æœéœ€è¦è°ƒæ•´å›¾åƒåˆ†è¾¨ç‡ï¼Œå¯¹ç„¦è·è¿›è¡Œç›¸åº”çš„ç¼©æ”¾</span></span><br><span class="line">            <span class="variable language_">self</span>.focal /= <span class="variable language_">self</span>.res_ratio</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¿‘è£å‰ªå¹³é¢è·ç¦»</span></span><br><span class="line">        <span class="variable language_">self</span>.near = <span class="number">0.0</span></span><br><span class="line">        <span class="comment"># è¿œè£å‰ªå¹³é¢è·ç¦»</span></span><br><span class="line">        <span class="variable language_">self</span>.far = <span class="number">1.0</span></span><br><span class="line">        <span class="comment"># åŠ è½½å›¾åƒå¹¶è°ƒæ•´åˆ°æŒ‡å®šçš„é«˜åº¦å’Œå®½åº¦</span></span><br><span class="line">        <span class="variable language_">self</span>.imgs, <span class="variable language_">self</span>.img_names = load_imgs(<span class="variable language_">self</span>.img_dir, np.arange(num_img_to_load), <span class="variable language_">self</span>.H, <span class="variable language_">self</span>.W)  <span class="comment"># (N, H, W, 3) torch.float32</span></span><br><span class="line">        <span class="comment"># æˆªå–å‰ num_img_to_load ä¸ªç›¸æœºä½å§¿</span></span><br><span class="line">        <span class="variable language_">self</span>.c2ws = <span class="variable language_">self</span>.c2ws[:num_img_to_load]</span><br><span class="line">        <span class="comment"># å›¾åƒçš„æ•°é‡</span></span><br><span class="line">        <span class="variable language_">self</span>.N_imgs = <span class="variable language_">self</span>.c2ws.shape[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ç”Ÿæˆç›¸æœºåæ ‡ç³»ä¸‹çš„å…‰çº¿æ–¹å‘</span></span><br><span class="line">        <span class="variable language_">self</span>.ray_dir_cam = comp_ray_dir_cam(<span class="variable language_">self</span>.H, <span class="variable language_">self</span>.W, <span class="variable language_">self</span>.focal)  <span class="comment"># (H, W, 3) torch.float32</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># å°†ç›¸æœºä½å§¿ä» numpy æ•°ç»„è½¬æ¢ä¸º PyTorch å¼ é‡</span></span><br><span class="line">        <span class="variable language_">self</span>.c2ws = torch.from_numpy(<span class="variable language_">self</span>.c2ws).<span class="built_in">float</span>()  <span class="comment"># (N, 4, 4) torch.float32</span></span><br><span class="line">        <span class="comment"># å°†å…‰çº¿æ–¹å‘å¼ é‡è½¬æ¢ä¸º float32 ç±»å‹</span></span><br><span class="line">        <span class="variable language_">self</span>.ray_dir_cam = <span class="variable language_">self</span>.ray_dir_cam.<span class="built_in">float</span>()  <span class="comment"># (H, W, 3) torch.float32</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    scene_name = <span class="string">&#x27;LLFF/fern&#x27;</span></span><br><span class="line">    use_ndc = <span class="literal">True</span></span><br><span class="line">    <span class="comment"># æ³¨æ„ï¼šéœ€è¦å°† /your/data/path æ›¿æ¢ä¸ºå®é™…çš„æ•°æ®è·¯å¾„ï¼Œ</span></span><br><span class="line">    <span class="comment"># è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ª DataLoaderWithCOLMAP ç±»çš„å®ä¾‹ï¼Œç”¨äºåŠ è½½æŒ‡å®šåœºæ™¯çš„æ•°æ®</span></span><br><span class="line">    scene = DataLoaderWithCOLMAP(base_dir=<span class="string">&#x27;/your/data/path&#x27;</span>,</span><br><span class="line">                                 scene_name=scene_name,</span><br><span class="line">                                 data_type=<span class="string">&#x27;train&#x27;</span>,</span><br><span class="line">                                 res_ratio=<span class="number">8</span>,</span><br><span class="line">                                 num_img_to_load=-<span class="number">1</span>,</span><br><span class="line">                                 skip=<span class="number">1</span>,</span><br><span class="line">                                 use_ndc=use_ndc)</span><br></pre></td></tr></table></figure>



<h4 id="with-feature-colmap-py"><a href="#with-feature-colmap-py" class="headerlink" title="with_feature_colmap.py"></a>with_feature_colmap.py</h4><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="comment"># os æ¨¡å—æä¾›äº†ä¸æ“ä½œç³»ç»Ÿè¿›è¡Œäº¤äº’çš„åŠŸèƒ½ï¼Œ</span></span><br><span class="line"><span class="comment"># å¯ç”¨äºå¤„ç†æ–‡ä»¶å’Œç›®å½•è·¯å¾„ã€åˆ›å»º/åˆ é™¤ç›®å½•ã€è·å–ç¯å¢ƒå˜é‡ç­‰ï¼Œ</span></span><br><span class="line"><span class="comment"># åœ¨æœ¬ä»£ç é‡Œä¸»è¦ç”¨äºæ„å»ºæ–‡ä»¶å’Œç›®å½•çš„è·¯å¾„ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="comment"># torch æ˜¯ PyTorch çš„æ ¸å¿ƒåº“ï¼Œæä¾›äº†å¼ é‡ï¼ˆTensorï¼‰æ•°æ®ç»“æ„ï¼Œ</span></span><br><span class="line"><span class="comment"># æ”¯æŒè‡ªåŠ¨æ±‚å¯¼æœºåˆ¶ï¼Œç”¨äºæ„å»ºå’Œè®­ç»ƒæ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œ</span></span><br><span class="line"><span class="comment"># èƒ½å¤Ÿåœ¨ CPU æˆ– GPU ä¸Šé«˜æ•ˆåœ°è¿›è¡Œæ•°å€¼è®¡ç®—ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="comment"># numpy æ˜¯ Python ä¸­ç”¨äºç§‘å­¦è®¡ç®—çš„åŸºç¡€åº“ï¼Œ</span></span><br><span class="line"><span class="comment"># æä¾›äº†é«˜æ•ˆçš„å¤šç»´æ•°ç»„å¯¹è±¡å’Œå„ç§æ•°å­¦å‡½æ•°ï¼Œ</span></span><br><span class="line"><span class="comment"># å¯è¿›è¡Œæ•°ç»„æ“ä½œã€çº¿æ€§ä»£æ•°è¿ç®—ã€éšæœºæ•°ç”Ÿæˆç­‰ï¼Œ</span></span><br><span class="line"><span class="comment"># åœ¨ä»£ç ä¸­ä¸»è¦ç”¨äºå¤„ç†å›¾åƒæ•°æ®å’Œæ•°ç»„æ“ä½œã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="comment"># tqdm æ˜¯ä¸€ä¸ªå¿«é€Ÿã€å¯æ‰©å±•çš„è¿›åº¦æ¡å·¥å…·ï¼Œ</span></span><br><span class="line"><span class="comment"># èƒ½åœ¨å¾ªç¯ä¸­æ˜¾ç¤ºè¿›åº¦æ¡ï¼Œæ–¹ä¾¿ç”¨æˆ·äº†è§£ä»£ç æ‰§è¡Œçš„è¿›åº¦ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> imageio</span><br><span class="line"><span class="comment"># imageio æ˜¯ä¸€ä¸ªç”¨äºè¯»å–å’Œå†™å…¥å¤šç§å›¾åƒæ–‡ä»¶æ ¼å¼çš„åº“ï¼Œ</span></span><br><span class="line"><span class="comment"># åœ¨ä»£ç ä¸­ä¸»è¦ç”¨äºè¯»å–å›¾åƒæ–‡ä»¶ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> dataloader.with_colmap <span class="keyword">import</span> resize_imgs</span><br><span class="line"><span class="comment"># ä» dataloader.with_colmap æ¨¡å—å¯¼å…¥ resize_imgs å‡½æ•°ï¼Œ</span></span><br><span class="line"><span class="comment"># è¯¥å‡½æ•°ç”¨äºè°ƒæ•´å›¾åƒçš„å°ºå¯¸ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> torchvision <span class="keyword">import</span> models</span><br><span class="line"><span class="comment"># torchvision æ˜¯ PyTorch ä¸­ç”¨äºè®¡ç®—æœºè§†è§‰ä»»åŠ¡çš„åº“ï¼Œ</span></span><br><span class="line"><span class="comment"># models å­æ¨¡å—æä¾›äº†é¢„è®­ç»ƒçš„æ·±åº¦å­¦ä¹ æ¨¡å‹ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> torch.nn <span class="keyword">import</span> functional <span class="keyword">as</span> F</span><br><span class="line"><span class="comment"># torch.nn.functional æä¾›äº†è®¸å¤šç¥ç»ç½‘ç»œä¸­å¸¸ç”¨çš„å‡½æ•°ï¼Œ</span></span><br><span class="line"><span class="comment"># ä¾‹å¦‚æ¿€æ´»å‡½æ•°ã€æŸå¤±å‡½æ•°ã€å·ç§¯ã€æ± åŒ–ç­‰æ“ä½œï¼Œ</span></span><br><span class="line"><span class="comment"># è¿™äº›å‡½æ•°æ˜¯æ— çŠ¶æ€çš„ï¼Œé€šå¸¸ç”¨äºè‡ªå®šä¹‰ç¥ç»ç½‘ç»œå±‚ä¸­çš„å…·ä½“è¿ç®—ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> utils.comp_ray_dir <span class="keyword">import</span> comp_ray_dir_cam</span><br><span class="line"><span class="comment"># ä» utils åŒ…ä¸­çš„ comp_ray_dir æ¨¡å—å¯¼å…¥ comp_ray_dir_cam å‡½æ•°ï¼Œ</span></span><br><span class="line"><span class="comment"># æ¨æµ‹è¯¥å‡½æ•°ç”¨äºè®¡ç®—ç›¸æœºåæ ‡ç³»ä¸‹çš„å…‰çº¿æ–¹å‘ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> utils.pose_utils <span class="keyword">import</span> center_poses</span><br><span class="line"><span class="comment"># ä» utils åŒ…ä¸­çš„ pose_utils æ¨¡å—å¯¼å…¥ center_poses å‡½æ•°ï¼Œ</span></span><br><span class="line"><span class="comment"># æ¨æµ‹è¯¥å‡½æ•°ç”¨äºå¯¹ç›¸æœºä½å§¿è¿›è¡Œä¸­å¿ƒåŒ–å¤„ç†ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> utils.lie_group_helper <span class="keyword">import</span> convert3x4_4x4</span><br><span class="line"><span class="comment"># ä» utils åŒ…ä¸­çš„ lie_group_helper æ¨¡å—å¯¼å…¥ convert3x4_4x4 å‡½æ•°ï¼Œ</span></span><br><span class="line"><span class="comment"># æ¨æµ‹è¯¥å‡½æ•°ç”¨äºå°† 3x4 çš„ç›¸æœºä½å§¿çŸ©é˜µè½¬æ¢ä¸º 4x4 çš„é½æ¬¡çŸ©é˜µã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> utils.vgg <span class="keyword">import</span> Vgg19</span><br><span class="line"><span class="comment"># ä» utils.vgg æ¨¡å—å¯¼å…¥ Vgg19 ç±»ï¼Œå¯èƒ½ç”¨äºç‰¹å¾æå–ã€‚</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_imgs</span>(<span class="params">image_dir, num_img_to_load, start, end, skip, load_sorted, load_img</span>):</span><br><span class="line">    <span class="comment"># è·å–å›¾åƒç›®å½•ä¸‹æ‰€æœ‰å›¾åƒæ–‡ä»¶åï¼Œå¹¶æŒ‰å­—æ¯é¡ºåºæ’åº</span></span><br><span class="line">    img_names = np.array(<span class="built_in">sorted</span>(os.listdir(image_dir)))  <span class="comment"># all image names</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># åœ¨æ—¶é—´åŸŸä¸Šå¯¹å¸§è¿›è¡Œä¸‹é‡‡æ ·</span></span><br><span class="line">    <span class="keyword">if</span> end == -<span class="number">1</span>:</span><br><span class="line">        img_names = img_names[start::skip]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        img_names = img_names[start:end:skip]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœä¸æŒ‰é¡ºåºåŠ è½½å›¾åƒï¼Œåˆ™å¯¹å›¾åƒæ–‡ä»¶åè¿›è¡Œéšæœºæ‰“ä¹±</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> load_sorted:</span><br><span class="line">        np.random.shuffle(img_names)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åŠ è½½ä¸‹é‡‡æ ·åçš„å›¾åƒ</span></span><br><span class="line">    <span class="keyword">if</span> num_img_to_load &gt; <span class="built_in">len</span>(img_names):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Asked for &#123;0:6d&#125; images but only &#123;1:6d&#125; available. Exit.&#x27;</span>.<span class="built_in">format</span>(num_img_to_load, <span class="built_in">len</span>(img_names)))</span><br><span class="line">        exit()</span><br><span class="line">    <span class="keyword">elif</span> num_img_to_load == -<span class="number">1</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Loading all available &#123;0:6d&#125; images&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(img_names)))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Loading &#123;0:6d&#125; images out of &#123;1:6d&#125; images.&#x27;</span>.<span class="built_in">format</span>(num_img_to_load, <span class="built_in">len</span>(img_names)))</span><br><span class="line">        img_names = img_names[:num_img_to_load]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ„å»ºæ¯ä¸ªå›¾åƒçš„å®Œæ•´è·¯å¾„</span></span><br><span class="line">    img_paths = [os.path.join(image_dir, n) <span class="keyword">for</span> n <span class="keyword">in</span> img_names]</span><br><span class="line">    <span class="comment"># å›¾åƒçš„æ•°é‡</span></span><br><span class="line">    N_imgs = <span class="built_in">len</span>(img_paths)</span><br><span class="line"></span><br><span class="line">    img_list = []</span><br><span class="line">    <span class="keyword">if</span> load_img:</span><br><span class="line">        <span class="comment"># ä½¿ç”¨ tqdm æ˜¾ç¤ºåŠ è½½å›¾åƒçš„è¿›åº¦</span></span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> tqdm(img_paths):</span><br><span class="line">            <span class="comment"># è¯»å–å›¾åƒå¹¶åªä¿ç•™å‰ä¸‰ä¸ªé€šé“ï¼ˆRGBï¼‰</span></span><br><span class="line">            img = imageio.imread(p)[:, :, :<span class="number">3</span>]  <span class="comment"># (H, W, 3) np.uint8</span></span><br><span class="line">            img_list.append(img)</span><br><span class="line">        <span class="comment"># å°†å›¾åƒåˆ—è¡¨è½¬æ¢ä¸º numpy æ•°ç»„</span></span><br><span class="line">        img_list = np.stack(img_list)  <span class="comment"># (N, H, W, 3)</span></span><br><span class="line">        <span class="comment"># å°† numpy æ•°ç»„è½¬æ¢ä¸º PyTorch å¼ é‡ï¼Œå¹¶å°†åƒç´ å€¼å½’ä¸€åŒ–åˆ° [0, 1] èŒƒå›´</span></span><br><span class="line">        img_list = torch.from_numpy(img_list).<span class="built_in">float</span>() / <span class="number">255</span>  <span class="comment"># (N, H, W, 3) torch.float32</span></span><br><span class="line">        <span class="comment"># è·å–å›¾åƒçš„é«˜åº¦å’Œå®½åº¦</span></span><br><span class="line">        H, W = img_list.shape[<span class="number">1</span>], img_list.shape[<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># å¦‚æœä¸åŠ è½½å›¾åƒï¼Œåˆ™è¯»å–ç¬¬ä¸€å¼ å›¾åƒä»¥è·å–å›¾åƒçš„é«˜åº¦å’Œå®½åº¦</span></span><br><span class="line">        tmp_img = imageio.imread(img_paths[<span class="number">0</span>])  <span class="comment"># load one image to get H, W</span></span><br><span class="line">        H, W = tmp_img.shape[<span class="number">0</span>], tmp_img.shape[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    result = &#123;</span><br><span class="line">        <span class="string">&#x27;imgs&#x27;</span>: img_list,  <span class="comment"># (N, H, W, 3) torch.float32</span></span><br><span class="line">        <span class="string">&#x27;img_names&#x27;</span>: img_names,  <span class="comment"># (N, )</span></span><br><span class="line">        <span class="string">&#x27;N_imgs&#x27;</span>: N_imgs,</span><br><span class="line">        <span class="string">&#x27;H&#x27;</span>: H,</span><br><span class="line">        <span class="string">&#x27;W&#x27;</span>: W,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_meta</span>(<span class="params">in_dir, use_ndc</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Read the poses_bounds.npy file produced by LLFF imgs2poses.py.</span></span><br><span class="line"><span class="string">    This function is modified from https://github.com/kwea123/nerf_pl.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># åŠ è½½ poses_bounds.npy æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«ç›¸æœºä½å§¿å’Œæ·±åº¦è¾¹ç•Œä¿¡æ¯</span></span><br><span class="line">    poses_bounds = np.load(os.path.join(in_dir, <span class="string">&#x27;../poses_bounds.npy&#x27;</span>))  <span class="comment"># (N_images, 17)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># æå–ç›¸æœºä½å§¿ä¿¡æ¯ï¼Œå°†å…¶é‡å¡‘ä¸º (N_images, 3, 5) çš„å½¢çŠ¶</span></span><br><span class="line">    c2ws = poses_bounds[:, :<span class="number">15</span>].reshape(-<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>)  <span class="comment"># (N_images, 3, 5)</span></span><br><span class="line">    <span class="comment"># æå–æ·±åº¦è¾¹ç•Œä¿¡æ¯</span></span><br><span class="line">    bounds = poses_bounds[:, -<span class="number">2</span>:]  <span class="comment"># (N_images, 2)</span></span><br><span class="line">    <span class="comment"># æå–å›¾åƒé«˜åº¦ã€å®½åº¦å’Œç„¦è·ä¿¡æ¯</span></span><br><span class="line">    H, W, focal = c2ws[<span class="number">0</span>, :, -<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä¿®æ­£ç›¸æœºä½å§¿çš„æ—‹è½¬éƒ¨åˆ†ï¼Œå°†æ—‹è½¬å½¢å¼ä» &quot;down right back&quot; æ”¹ä¸º &quot;right up back&quot;</span></span><br><span class="line">    <span class="comment"># å‚è€ƒ https://github.com/bmild/nerf/issues/34</span></span><br><span class="line">    c2ws = np.concatenate([c2ws[..., <span class="number">1</span>:<span class="number">2</span>], -c2ws[..., :<span class="number">1</span>], c2ws[..., <span class="number">2</span>:<span class="number">4</span>]], -<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¯¹ç›¸æœºä½å§¿è¿›è¡Œä¸­å¿ƒåŒ–å¤„ç†ï¼Œè¿”å›ä¸­å¿ƒåŒ–åçš„ç›¸æœºä½å§¿å’Œå¹³å‡ä½å§¿</span></span><br><span class="line">    <span class="comment"># pose_avg @ c2ws -&gt; centred c2ws</span></span><br><span class="line">    c2ws, pose_avg = center_poses(c2ws)  <span class="comment"># (N_images, 3, 4), (4, 4)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> use_ndc:</span><br><span class="line">        <span class="comment"># ä¿®æ­£å°ºåº¦ï¼Œä½¿æœ€è¿‘çš„æ·±åº¦ç•¥å¤§äº 1.0</span></span><br><span class="line">        <span class="comment"># å‚è€ƒ https://github.com/bmild/nerf/issues/34</span></span><br><span class="line">        near_original = bounds.<span class="built_in">min</span>()</span><br><span class="line">        <span class="comment"># 0.75 æ˜¯é»˜è®¤å‚æ•°</span></span><br><span class="line">        scale_factor = near_original * <span class="number">0.75</span>  </span><br><span class="line">        <span class="comment"># æœ€è¿‘çš„æ·±åº¦çº¦ä¸º 1/0.75 = 1.33</span></span><br><span class="line">        bounds /= scale_factor</span><br><span class="line">        c2ws[..., <span class="number">3</span>] /= scale_factor</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å°† 3x4 çš„ç›¸æœºä½å§¿çŸ©é˜µè½¬æ¢ä¸º 4x4 çš„é½æ¬¡çŸ©é˜µå½¢å¼</span></span><br><span class="line">    c2ws = convert3x4_4x4(c2ws)  <span class="comment"># (N, 4, 4)</span></span><br><span class="line"></span><br><span class="line">    results = &#123;</span><br><span class="line">        <span class="string">&#x27;c2ws&#x27;</span>: c2ws,       <span class="comment"># (N, 4, 4) np</span></span><br><span class="line">        <span class="string">&#x27;bounds&#x27;</span>: bounds,   <span class="comment"># (N_images, 2) np</span></span><br><span class="line">        <span class="string">&#x27;H&#x27;</span>: <span class="built_in">int</span>(H),        <span class="comment"># scalar</span></span><br><span class="line">        <span class="string">&#x27;W&#x27;</span>: <span class="built_in">int</span>(W),        <span class="comment"># scalar</span></span><br><span class="line">        <span class="string">&#x27;focal&#x27;</span>: focal,     <span class="comment"># scalar</span></span><br><span class="line">        <span class="string">&#x27;pose_avg&#x27;</span>: pose_avg,  <span class="comment"># (4, 4) np</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dataloader_feature_n_colmap</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Most useful fields:</span></span><br><span class="line"><span class="string">        self.c2ws:          (N_imgs, 4, 4)      torch.float32</span></span><br><span class="line"><span class="string">        self.imgs           (N_imgs, H, W, 4)   torch.float32</span></span><br><span class="line"><span class="string">        self.ray_dir_cam    (H, W, 3)           torch.float32</span></span><br><span class="line"><span class="string">        self.H              scalar</span></span><br><span class="line"><span class="string">        self.W              scalar</span></span><br><span class="line"><span class="string">        self.N_imgs         scalar</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, base_dir, scene_name, res_ratio, num_img_to_load, start=<span class="number">0</span>, end=-<span class="number">1</span>, skip=<span class="number">1</span>,</span></span><br><span class="line"><span class="params">                 load_sorted=<span class="literal">True</span>, load_img=<span class="literal">True</span>, use_ndc=<span class="literal">True</span>, device=<span class="string">&#x27;cpu&#x27;</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        :param base_dir: æ•°æ®çš„åŸºç¡€ç›®å½•</span></span><br><span class="line"><span class="string">        :param scene_name: åœºæ™¯çš„åç§°</span></span><br><span class="line"><span class="string">        :param res_ratio: æ•´æ•°ï¼Œå¦‚ [1, 2, 4] ç­‰ï¼Œç”¨äºå°†å›¾åƒè°ƒæ•´ä¸ºè¾ƒä½çš„åˆ†è¾¨ç‡ã€‚</span></span><br><span class="line"><span class="string">        :param start/end/skip: ç”¨äºåœ¨æ—¶é—´åŸŸä¸Šæ§åˆ¶å¸§çš„åŠ è½½ã€‚</span></span><br><span class="line"><span class="string">        :param load_sorted: å¸ƒå°”å€¼ï¼Œæ˜¯å¦æŒ‰é¡ºåºåŠ è½½å›¾åƒã€‚</span></span><br><span class="line"><span class="string">        :param load_img: å¸ƒå°”å€¼ã€‚å¦‚æœè®¾ç½®ä¸º falseï¼šä»…ç»Ÿè®¡å›¾åƒæ•°é‡ã€è·å–å›¾åƒçš„é«˜åº¦å’Œå®½åº¦ï¼Œ</span></span><br><span class="line"><span class="string">                         ä½†ä¸åŠ è½½å›¾åƒã€‚åœ¨å¯è§†åŒ–ä½å§¿æˆ–è°ƒè¯•ç­‰æƒ…å†µä¸‹å¾ˆæœ‰ç”¨ã€‚</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.base_dir = base_dir</span><br><span class="line">        <span class="variable language_">self</span>.scene_name = scene_name</span><br><span class="line">        <span class="variable language_">self</span>.res_ratio = res_ratio</span><br><span class="line">        <span class="variable language_">self</span>.num_img_to_load = num_img_to_load</span><br><span class="line">        <span class="variable language_">self</span>.start = start</span><br><span class="line">        <span class="variable language_">self</span>.end = end</span><br><span class="line">        <span class="variable language_">self</span>.skip = skip</span><br><span class="line">        <span class="variable language_">self</span>.use_ndc = use_ndc</span><br><span class="line">        <span class="variable language_">self</span>.load_sorted = load_sorted</span><br><span class="line">        <span class="variable language_">self</span>.load_img = load_img</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ„å»ºå›¾åƒç›®å½•çš„å®Œæ•´è·¯å¾„</span></span><br><span class="line">        <span class="variable language_">self</span>.imgs_dir = os.path.join(<span class="variable language_">self</span>.base_dir, <span class="variable language_">self</span>.scene_name)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># è¯»å–æ‰€æœ‰çš„å…ƒä¿¡æ¯ï¼ŒåŒ…æ‹¬ç›¸æœºä½å§¿ã€æ·±åº¦è¾¹ç•Œã€å›¾åƒå°ºå¯¸å’Œç„¦è·ç­‰</span></span><br><span class="line">        meta = read_meta(<span class="variable language_">self</span>.imgs_dir, <span class="variable language_">self</span>.use_ndc)</span><br><span class="line">        <span class="comment"># æå–ç›¸æœºä½å§¿ä¿¡æ¯å¹¶è½¬æ¢ä¸º PyTorch å¼ é‡</span></span><br><span class="line">        <span class="variable language_">self</span>.c2ws = torch.Tensor(meta[<span class="string">&#x27;c2ws&#x27;</span>])  <span class="comment"># (N, 4, 4) all camera pose</span></span><br><span class="line">        <span class="comment"># æå–ç„¦è·ä¿¡æ¯</span></span><br><span class="line">        <span class="variable language_">self</span>.focal = <span class="built_in">float</span>(meta[<span class="string">&#x27;focal&#x27;</span>])</span><br><span class="line">        <span class="comment"># æ ¹æ® startã€end å’Œ skip å‚æ•°å¯¹ç›¸æœºä½å§¿è¿›è¡Œç­›é€‰</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.end == -<span class="number">1</span>:</span><br><span class="line">            <span class="variable language_">self</span>.c2ws = <span class="variable language_">self</span>.c2ws[<span class="variable language_">self</span>.start::<span class="variable language_">self</span>.skip]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.c2ws = <span class="variable language_">self</span>.c2ws[<span class="variable language_">self</span>.start:<span class="variable language_">self</span>.end:<span class="variable language_">self</span>.skip]</span><br><span class="line">        <span class="comment"># åŠ è½½å›¾åƒæ•°æ®</span></span><br><span class="line">        image_data = load_imgs(<span class="variable language_">self</span>.imgs_dir, <span class="variable language_">self</span>.num_img_to_load, <span class="variable language_">self</span>.start, <span class="variable language_">self</span>.end, <span class="variable language_">self</span>.skip,</span><br><span class="line">                                <span class="variable language_">self</span>.load_sorted, <span class="variable language_">self</span>.load_img)</span><br><span class="line">        <span class="comment"># æå–åŠ è½½çš„å›¾åƒæ•°æ®</span></span><br><span class="line">        <span class="variable language_">self</span>.imgs = image_data[<span class="string">&#x27;imgs&#x27;</span>]  <span class="comment"># (N, H, W, 3) torch.float32</span></span><br><span class="line">        <span class="comment"># æå–å›¾åƒæ–‡ä»¶å</span></span><br><span class="line">        <span class="variable language_">self</span>.img_names = image_data[<span class="string">&#x27;img_names&#x27;</span>]  <span class="comment"># (N, )</span></span><br><span class="line">        <span class="comment"># å›¾åƒçš„æ•°é‡</span></span><br><span class="line">        <span class="variable language_">self</span>.N_imgs = image_data[<span class="string">&#x27;N_imgs&#x27;</span>]</span><br><span class="line">        <span class="comment"># åŸå§‹å›¾åƒçš„é«˜åº¦</span></span><br><span class="line">        <span class="variable language_">self</span>.ori_H = image_data[<span class="string">&#x27;H&#x27;</span>]</span><br><span class="line">        <span class="comment"># åŸå§‹å›¾åƒçš„å®½åº¦</span></span><br><span class="line">        <span class="variable language_">self</span>.ori_W = image_data[<span class="string">&#x27;W&#x27;</span>]</span><br><span class="line">        <span class="comment"># åˆå§‹åŒ– Vgg19 ç¼–ç å™¨å¹¶å°†å…¶ç§»åŠ¨åˆ°æŒ‡å®šè®¾å¤‡</span></span><br><span class="line">        <span class="variable language_">self</span>.encoder = Vgg19().to(device)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å§‹ç»ˆä½¿ç”¨å½’ä¸€åŒ–è®¾å¤‡åæ ‡ï¼ˆNDCï¼‰</span></span><br><span class="line">        <span class="variable language_">self</span>.near = <span class="number">0.0</span></span><br><span class="line">        <span class="variable language_">self</span>.far = <span class="number">1.0</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¦‚æœéœ€è¦è°ƒæ•´å›¾åƒåˆ†è¾¨ç‡</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.res_ratio &gt; <span class="number">1</span>:</span><br><span class="line">            <span class="comment"># è®¡ç®—è°ƒæ•´åçš„å›¾åƒé«˜åº¦</span></span><br><span class="line">            <span class="variable language_">self</span>.H = <span class="variable language_">self</span>.ori_H // <span class="variable language_">self</span>.res_ratio</span><br><span class="line">            <span class="comment"># è®¡ç®—è°ƒæ•´åçš„å›¾åƒå®½åº¦</span></span><br><span class="line">            <span class="variable language_">self</span>.W = <span class="variable language_">self</span>.ori_W // <span class="variable language_">self</span>.res_ratio</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.H = <span class="variable language_">self</span>.ori_H</span><br><span class="line">            <span class="variable language_">self</span>.W = <span class="variable language_">self</span>.ori_W</span><br><span class="line">        <span class="comment"># è°ƒæ•´ç„¦è·</span></span><br><span class="line">        <span class="variable language_">self</span>.focal /= <span class="variable language_">self</span>.res_ratio</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.load_img:</span><br><span class="line">            <span class="comment"># è°ƒæ•´å›¾åƒçš„åˆ†è¾¨ç‡å¹¶å°†å…¶ç§»åŠ¨åˆ°æŒ‡å®šè®¾å¤‡</span></span><br><span class="line">            <span class="variable language_">self</span>.imgs = resize_imgs(<span class="variable language_">self</span>.imgs, <span class="variable language_">self</span>.H, <span class="variable language_">self</span>.W).to(device)  <span class="comment"># (N, H, W, 3) torch.float32</span></span><br><span class="line">            <span class="variable language_">self</span>.features = []</span><br><span class="line">            <span class="comment"># ä½¿ç”¨ tqdm æ˜¾ç¤ºå¤„ç†è¿›åº¦</span></span><br><span class="line">            <span class="keyword">for</span> img <span class="keyword">in</span> tqdm(<span class="variable language_">self</span>.imgs):</span><br><span class="line">                <span class="comment"># å¯¹å›¾åƒè¿›è¡Œé€šé“ç»´åº¦çš„è°ƒæ•´ï¼Œå¹¶é€šè¿‡ç¼–ç å™¨æå–ç‰¹å¾</span></span><br><span class="line">                <span class="variable language_">self</span>.features.append(<span class="variable language_">self</span>.encoder(img.permute(<span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>)[<span class="literal">None</span>, ...]))</span><br><span class="line">            <span class="comment"># è¿™é‡Œæ³¨é‡Šæ‰äº†ç‰¹å¾æ‹¼æ¥çš„ä»£ç ï¼Œå¯æ ¹æ®éœ€è¦å–æ¶ˆæ³¨é‡Š</span></span><br><span class="line">            <span class="comment"># self.features = torch.cat(self.features, 0)</span></span><br><span class="line">            <span class="comment"># print(self.features.shape)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># æ•°æ®çš„åŸºç¡€ç›®å½•ï¼Œéœ€è¦æ›¿æ¢ä¸ºå®é™…çš„è·¯å¾„</span></span><br><span class="line">    base_dir = <span class="string">&#x27;/your/data/path&#x27;</span></span><br><span class="line">    <span class="comment"># åœºæ™¯çš„åç§°</span></span><br><span class="line">    scene_name = <span class="string">&#x27;LLFF/fern/images&#x27;</span></span><br><span class="line">    <span class="comment"># å›¾åƒçš„ç¼©æ”¾æ¯”ä¾‹</span></span><br><span class="line">    resize_ratio = <span class="number">8</span></span><br><span class="line">    <span class="comment"># è¦åŠ è½½çš„å›¾åƒæ•°é‡ï¼Œ-1 è¡¨ç¤ºåŠ è½½æ‰€æœ‰å›¾åƒ</span></span><br><span class="line">    num_img_to_load = -<span class="number">1</span></span><br><span class="line">    <span class="comment"># å¼€å§‹åŠ è½½å›¾åƒçš„ç´¢å¼•</span></span><br><span class="line">    start = <span class="number">0</span></span><br><span class="line">    <span class="comment"># ç»“æŸåŠ è½½å›¾åƒçš„ç´¢å¼•ï¼Œ-1 è¡¨ç¤ºåŠ è½½åˆ°æœ€å</span></span><br><span class="line">    end = -<span class="number">1</span></span><br><span class="line">    <span class="comment"># åŠ è½½å›¾åƒçš„é—´éš”</span></span><br><span class="line">    skip = <span class="number">1</span></span><br><span class="line">    <span class="comment"># æ˜¯å¦æŒ‰é¡ºåºåŠ è½½å›¾åƒ</span></span><br><span class="line">    load_sorted = <span class="literal">True</span></span><br><span class="line">    <span class="comment"># æ˜¯å¦åŠ è½½å›¾åƒ</span></span><br><span class="line">    load_img = <span class="literal">True</span></span><br><span class="line">    <span class="comment"># æ˜¯å¦ä½¿ç”¨å½’ä¸€åŒ–è®¾å¤‡åæ ‡ï¼ˆNDCï¼‰</span></span><br><span class="line">    use_ndc = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆå§‹åŒ– Dataloader_feature_n_colmap ç±»</span></span><br><span class="line">    scene = Dataloader_feature_n_colmap(base_dir=base_dir,</span><br><span class="line">                                scene_name=scene_name,</span><br><span class="line">                                res_ratio=resize_ratio,</span><br><span class="line">                                num_img_to_load=num_img_to_load,</span><br><span class="line">                                start=start,</span><br><span class="line">                                end=end,</span><br><span class="line">                                skip=skip,</span><br><span class="line">                                load_sorted=load_sorted,</span><br><span class="line">                                load_img=load_img,</span><br><span class="line">                                use_ndc=use_ndc)</span><br></pre></td></tr></table></figure>



<h4 id="with-feature-py"><a href="#with-feature-py" class="headerlink" title="with_feature.py"></a>with_feature.py</h4><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="comment"># os æ¨¡å—æä¾›äº†ä¸æ“ä½œç³»ç»Ÿè¿›è¡Œäº¤äº’çš„åŠŸèƒ½ï¼Œ</span></span><br><span class="line"><span class="comment"># å¯ç”¨äºå¤„ç†æ–‡ä»¶å’Œç›®å½•è·¯å¾„ã€åˆ›å»º/åˆ é™¤ç›®å½•ã€è·å–ç¯å¢ƒå˜é‡ç­‰ï¼Œ</span></span><br><span class="line"><span class="comment"># åœ¨æœ¬ä»£ç é‡Œä¸»è¦ç”¨äºæ„å»ºæ–‡ä»¶å’Œç›®å½•çš„è·¯å¾„ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="comment"># torch æ˜¯ PyTorch çš„æ ¸å¿ƒåº“ï¼Œæä¾›äº†å¼ é‡ï¼ˆTensorï¼‰æ•°æ®ç»“æ„ï¼Œ</span></span><br><span class="line"><span class="comment"># æ”¯æŒè‡ªåŠ¨æ±‚å¯¼æœºåˆ¶ï¼Œç”¨äºæ„å»ºå’Œè®­ç»ƒæ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œ</span></span><br><span class="line"><span class="comment"># èƒ½å¤Ÿåœ¨ CPU æˆ– GPU ä¸Šé«˜æ•ˆåœ°è¿›è¡Œæ•°å€¼è®¡ç®—ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"><span class="comment"># torch.nn.functional æä¾›äº†è®¸å¤šç¥ç»ç½‘ç»œä¸­å¸¸ç”¨çš„å‡½æ•°ï¼Œ</span></span><br><span class="line"><span class="comment"># ä¾‹å¦‚æ¿€æ´»å‡½æ•°ã€æŸå¤±å‡½æ•°ã€å·ç§¯ã€æ± åŒ–ç­‰æ“ä½œï¼Œ</span></span><br><span class="line"><span class="comment"># è¿™äº›å‡½æ•°æ˜¯æ— çŠ¶æ€çš„ï¼Œé€šå¸¸ç”¨äºè‡ªå®šä¹‰ç¥ç»ç½‘ç»œå±‚ä¸­çš„å…·ä½“è¿ç®—ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="comment"># numpy æ˜¯ Python ä¸­ç”¨äºç§‘å­¦è®¡ç®—çš„åŸºç¡€åº“ï¼Œ</span></span><br><span class="line"><span class="comment"># æä¾›äº†é«˜æ•ˆçš„å¤šç»´æ•°ç»„å¯¹è±¡å’Œå„ç§æ•°å­¦å‡½æ•°ï¼Œ</span></span><br><span class="line"><span class="comment"># å¯è¿›è¡Œæ•°ç»„æ“ä½œã€çº¿æ€§ä»£æ•°è¿ç®—ã€éšæœºæ•°ç”Ÿæˆç­‰ï¼Œ</span></span><br><span class="line"><span class="comment"># åœ¨ä»£ç ä¸­ä¸»è¦ç”¨äºå¤„ç†å›¾åƒæ•°æ®å’Œæ•°ç»„æ“ä½œã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="comment"># tqdm æ˜¯ä¸€ä¸ªå¿«é€Ÿã€å¯æ‰©å±•çš„è¿›åº¦æ¡å·¥å…·ï¼Œ</span></span><br><span class="line"><span class="comment"># èƒ½åœ¨å¾ªç¯ä¸­æ˜¾ç¤ºè¿›åº¦æ¡ï¼Œæ–¹ä¾¿ç”¨æˆ·äº†è§£ä»£ç æ‰§è¡Œçš„è¿›åº¦ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> imageio</span><br><span class="line"><span class="comment"># imageio æ˜¯ä¸€ä¸ªç”¨äºè¯»å–å’Œå†™å…¥å¤šç§å›¾åƒæ–‡ä»¶æ ¼å¼çš„åº“ï¼Œ</span></span><br><span class="line"><span class="comment"># åœ¨ä»£ç ä¸­ä¸»è¦ç”¨äºè¯»å–å›¾åƒæ–‡ä»¶ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> utils.comp_ray_dir <span class="keyword">import</span> comp_ray_dir_cam</span><br><span class="line"><span class="comment"># ä» utils åŒ…ä¸­çš„ comp_ray_dir æ¨¡å—å¯¼å…¥ comp_ray_dir_cam å‡½æ•°ï¼Œ</span></span><br><span class="line"><span class="comment"># æ¨æµ‹è¯¥å‡½æ•°ç”¨äºè®¡ç®—ç›¸æœºåæ ‡ç³»ä¸‹çš„å…‰çº¿æ–¹å‘ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> utils.pose_utils <span class="keyword">import</span> center_poses</span><br><span class="line"><span class="comment"># ä» utils åŒ…ä¸­çš„ pose_utils æ¨¡å—å¯¼å…¥ center_poses å‡½æ•°ï¼Œ</span></span><br><span class="line"><span class="comment"># æ¨æµ‹è¯¥å‡½æ•°ç”¨äºå¯¹ç›¸æœºä½å§¿è¿›è¡Œä¸­å¿ƒåŒ–å¤„ç†ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> utils.lie_group_helper <span class="keyword">import</span> convert3x4_4x4</span><br><span class="line"><span class="comment"># ä» utils åŒ…ä¸­çš„ lie_group_helper æ¨¡å—å¯¼å…¥ convert3x4_4x4 å‡½æ•°ï¼Œ</span></span><br><span class="line"><span class="comment"># æ¨æµ‹è¯¥å‡½æ•°ç”¨äºå°† 3x4 çš„ç›¸æœºä½å§¿çŸ©é˜µè½¬æ¢ä¸º 4x4 çš„é½æ¬¡çŸ©é˜µã€‚</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">resize_imgs</span>(<span class="params">imgs, new_h, new_w</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    :param imgs:    (N, H, W, 3)            torch.float32 æ ¼å¼çš„ RGB å›¾åƒ</span></span><br><span class="line"><span class="string">    :param new_h:   æ•´æ•°æˆ– torch æ•´æ•°ç±»å‹ï¼Œè¡¨ç¤ºæ–°çš„å›¾åƒé«˜åº¦</span></span><br><span class="line"><span class="string">    :param new_w:   æ•´æ•°æˆ– torch æ•´æ•°ç±»å‹ï¼Œè¡¨ç¤ºæ–°çš„å›¾åƒå®½åº¦</span></span><br><span class="line"><span class="string">    :return:        (N, new_H, new_W, 3)    torch.float32 æ ¼å¼çš„ RGB å›¾åƒ</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># å°†å›¾åƒå¼ é‡çš„ç»´åº¦ä» (N, H, W, 3) è°ƒæ•´ä¸º (N, 3, H, W)ï¼Œä»¥é€‚é… F.interpolate å‡½æ•°çš„è¾“å…¥è¦æ±‚</span></span><br><span class="line">    imgs = imgs.permute(<span class="number">0</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>)  <span class="comment"># å˜ä¸º (N, 3, H, W)</span></span><br><span class="line">    <span class="comment"># ä½¿ç”¨åŒçº¿æ€§æ’å€¼æ–¹æ³•å°†å›¾åƒè°ƒæ•´åˆ°æŒ‡å®šçš„æ–°é«˜åº¦å’Œæ–°å®½åº¦</span></span><br><span class="line">    imgs = F.interpolate(imgs, size=(new_h, new_w), mode=<span class="string">&#x27;bilinear&#x27;</span>)  <span class="comment"># å˜ä¸º (N, 3, new_H, new_W)</span></span><br><span class="line">    <span class="comment"># å°†å›¾åƒå¼ é‡çš„ç»´åº¦ä» (N, 3, new_H, new_W) è°ƒæ•´å› (N, new_H, new_W, 3)</span></span><br><span class="line">    imgs = imgs.permute(<span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>)  <span class="comment"># å˜ä¸º (N, new_H, new_W, 3)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> imgs  <span class="comment"># è¿”å› (N, new_H, new_W, 3) æ ¼å¼çš„ torch.float32 ç±»å‹ RGB å›¾åƒ</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_imgs</span>(<span class="params">image_dir, img_ids, new_h, new_w</span>):</span><br><span class="line">    <span class="comment"># è·å–å›¾åƒç›®å½•ä¸‹æ‰€æœ‰å›¾åƒæ–‡ä»¶åï¼Œå¹¶æŒ‰å­—æ¯é¡ºåºæ’åº</span></span><br><span class="line">    img_names = np.array(<span class="built_in">sorted</span>(os.listdir(image_dir)))  <span class="comment"># å¾—åˆ°æ‰€æœ‰å›¾åƒæ–‡ä»¶å</span></span><br><span class="line">    <span class="comment"># æ ¹æ®ç»™å®šçš„å›¾åƒç´¢å¼•ç­›é€‰å‡ºæœ¬æ¬¡éœ€è¦çš„å›¾åƒæ–‡ä»¶å</span></span><br><span class="line">    img_names = img_names[img_ids]  <span class="comment"># å¾—åˆ°æœ¬æ¬¡åˆ†å‰²æ‰€éœ€çš„å›¾åƒæ–‡ä»¶å</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ„å»ºæ¯ä¸ªå›¾åƒçš„å®Œæ•´è·¯å¾„</span></span><br><span class="line">    img_paths = [os.path.join(image_dir, n) <span class="keyword">for</span> n <span class="keyword">in</span> img_names]</span><br><span class="line"></span><br><span class="line">    img_list = []</span><br><span class="line">    <span class="comment"># ä½¿ç”¨ tqdm æ˜¾ç¤ºåŠ è½½å›¾åƒçš„è¿›åº¦</span></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> tqdm(img_paths):</span><br><span class="line">        <span class="comment"># è¯»å–å›¾åƒå¹¶åªä¿ç•™å‰ä¸‰ä¸ªé€šé“ï¼ˆRGBï¼‰</span></span><br><span class="line">        img = imageio.imread(p)[:, :, :<span class="number">3</span>]  <span class="comment"># å¾—åˆ° (H, W, 3) æ ¼å¼çš„ np.uint8 ç±»å‹å›¾åƒ</span></span><br><span class="line">        img_list.append(img)</span><br><span class="line">    <span class="comment"># å°†å›¾åƒåˆ—è¡¨è½¬æ¢ä¸º numpy æ•°ç»„</span></span><br><span class="line">    img_list = np.stack(img_list)  <span class="comment"># å˜ä¸º (N, H, W, 3) æ ¼å¼</span></span><br><span class="line">    <span class="comment"># å°† numpy æ•°ç»„è½¬æ¢ä¸º PyTorch å¼ é‡ï¼Œå¹¶å°†åƒç´ å€¼å½’ä¸€åŒ–åˆ° [0, 1] èŒƒå›´</span></span><br><span class="line">    img_list = torch.from_numpy(img_list).<span class="built_in">float</span>() / <span class="number">255</span>  <span class="comment"># å˜ä¸º (N, H, W, 3) æ ¼å¼çš„ torch.float32 ç±»å‹</span></span><br><span class="line">    <span class="comment"># è°ƒç”¨ resize_imgs å‡½æ•°å°†å›¾åƒè°ƒæ•´åˆ°æŒ‡å®šçš„æ–°é«˜åº¦å’Œæ–°å®½åº¦</span></span><br><span class="line">    img_list = resize_imgs(img_list, new_h, new_w)</span><br><span class="line">    <span class="keyword">return</span> img_list, img_names</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_meta</span>(<span class="params">in_dir, use_ndc</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    è¯»å–ç”± LLFF çš„ imgs2poses.py ç”Ÿæˆçš„ poses_bounds.npy æ–‡ä»¶ã€‚</span></span><br><span class="line"><span class="string">    æ­¤å‡½æ•°æ”¹ç¼–è‡ª https://github.com/kwea123/nerf_plã€‚</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># åŠ è½½ poses_bounds.npy æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«ç›¸æœºä½å§¿å’Œæ·±åº¦è¾¹ç•Œä¿¡æ¯</span></span><br><span class="line">    poses_bounds = np.load(os.path.join(in_dir, <span class="string">&#x27;poses_bounds.npy&#x27;</span>))  <span class="comment"># å¾—åˆ° (N_images, 17) æ ¼å¼çš„æ•°ç»„</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># æå–ç›¸æœºä½å§¿ä¿¡æ¯ï¼Œå°†å…¶é‡å¡‘ä¸º (N_images, 3, 5) çš„å½¢çŠ¶</span></span><br><span class="line">    c2ws = poses_bounds[:, :<span class="number">15</span>].reshape(-<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>)  <span class="comment"># å˜ä¸º (N_images, 3, 5) æ ¼å¼</span></span><br><span class="line">    <span class="comment"># æå–æ·±åº¦è¾¹ç•Œä¿¡æ¯</span></span><br><span class="line">    bounds = poses_bounds[:, -<span class="number">2</span>:]  <span class="comment"># å˜ä¸º (N_images, 2) æ ¼å¼</span></span><br><span class="line">    <span class="comment"># æå–å›¾åƒé«˜åº¦ã€å®½åº¦å’Œç„¦è·ä¿¡æ¯</span></span><br><span class="line">    H, W, focal = c2ws[<span class="number">0</span>, :, -<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä¿®æ­£ç›¸æœºä½å§¿çš„æ—‹è½¬éƒ¨åˆ†ï¼Œå°†æ—‹è½¬å½¢å¼ä» &quot;ä¸‹ å³ å&quot; æ”¹ä¸º &quot;å³ ä¸Š å&quot;</span></span><br><span class="line">    <span class="comment"># å‚è€ƒ https://github.com/bmild/nerf/issues/34</span></span><br><span class="line">    c2ws = np.concatenate([c2ws[..., <span class="number">1</span>:<span class="number">2</span>], -c2ws[..., :<span class="number">1</span>], c2ws[..., <span class="number">2</span>:<span class="number">4</span>]], -<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¯¹ç›¸æœºä½å§¿è¿›è¡Œä¸­å¿ƒåŒ–å¤„ç†ï¼Œè¿”å›ä¸­å¿ƒåŒ–åçš„ç›¸æœºä½å§¿å’Œå¹³å‡ä½å§¿</span></span><br><span class="line">    <span class="comment"># pose_avg @ c2ws å¾—åˆ°ä¸­å¿ƒåŒ–åçš„ c2ws</span></span><br><span class="line">    c2ws, pose_avg = center_poses(c2ws)  <span class="comment"># åˆ†åˆ«å¾—åˆ° (N_images, 3, 4) å’Œ (4, 4) æ ¼å¼çš„æ•°ç»„</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> use_ndc:</span><br><span class="line">        <span class="comment"># è·å–æœ€è¿‘æ·±åº¦å€¼</span></span><br><span class="line">        near_original = bounds.<span class="built_in">min</span>()</span><br><span class="line">        <span class="comment"># è®¡ç®—ç¼©æ”¾å› å­ï¼Œä½¿æœ€è¿‘æ·±åº¦è°ƒæ•´åˆ°ç¨å¤§äº 1.0 çš„ä½ç½®</span></span><br><span class="line">        scale_factor = near_original * <span class="number">0.75</span>  <span class="comment"># 0.75 æ˜¯é»˜è®¤å‚æ•°</span></span><br><span class="line">        <span class="comment"># ç°åœ¨æœ€è¿‘æ·±åº¦çº¦ä¸º 1/0.75 = 1.33</span></span><br><span class="line">        <span class="comment"># å¯¹æ·±åº¦è¾¹ç•Œè¿›è¡Œç¼©æ”¾</span></span><br><span class="line">        bounds /= scale_factor</span><br><span class="line">        <span class="comment"># å¯¹ç›¸æœºä½å§¿çš„å¹³ç§»éƒ¨åˆ†è¿›è¡Œç¼©æ”¾</span></span><br><span class="line">        c2ws[..., <span class="number">3</span>] /= scale_factor</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å°† 3x4 çš„ç›¸æœºä½å§¿çŸ©é˜µè½¬æ¢ä¸º 4x4 çš„é½æ¬¡çŸ©é˜µå½¢å¼</span></span><br><span class="line">    c2ws = convert3x4_4x4(c2ws)  <span class="comment"># å˜ä¸º (N, 4, 4) æ ¼å¼</span></span><br><span class="line"></span><br><span class="line">    results = &#123;</span><br><span class="line">        <span class="string">&#x27;c2ws&#x27;</span>: c2ws,       <span class="comment"># (N, 4, 4) æ ¼å¼çš„ numpy æ•°ç»„</span></span><br><span class="line">        <span class="string">&#x27;bounds&#x27;</span>: bounds,   <span class="comment"># (N_images, 2) æ ¼å¼çš„ numpy æ•°ç»„</span></span><br><span class="line">        <span class="string">&#x27;H&#x27;</span>: <span class="built_in">int</span>(H),        <span class="comment"># æ ‡é‡ï¼Œå›¾åƒé«˜åº¦</span></span><br><span class="line">        <span class="string">&#x27;W&#x27;</span>: <span class="built_in">int</span>(W),        <span class="comment"># æ ‡é‡ï¼Œå›¾åƒå®½åº¦</span></span><br><span class="line">        <span class="string">&#x27;focal&#x27;</span>: focal,     <span class="comment"># æ ‡é‡ï¼Œç„¦è·</span></span><br><span class="line">        <span class="string">&#x27;pose_avg&#x27;</span>: pose_avg,  <span class="comment"># (4, 4) æ ¼å¼çš„ numpy æ•°ç»„</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DataLoaderWithCOLMAP</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    æœ€æœ‰ç”¨çš„å­—æ®µï¼š</span></span><br><span class="line"><span class="string">        self.c2ws:          (N_imgs, 4, 4) æ ¼å¼çš„ torch.float32 ç±»å‹å¼ é‡ï¼Œè¡¨ç¤ºç›¸æœºä½å§¿</span></span><br><span class="line"><span class="string">        self.imgs           (N_imgs, H, W, 4) æ ¼å¼çš„ torch.float32 ç±»å‹å¼ é‡ï¼Œè¡¨ç¤ºå›¾åƒ</span></span><br><span class="line"><span class="string">        self.ray_dir_cam    (H, W, 3) æ ¼å¼çš„ torch.float32 ç±»å‹å¼ é‡ï¼Œè¡¨ç¤ºç›¸æœºåæ ‡ç³»ä¸‹çš„å…‰çº¿æ–¹å‘</span></span><br><span class="line"><span class="string">        self.H              æ ‡é‡ï¼Œå›¾åƒé«˜åº¦</span></span><br><span class="line"><span class="string">        self.W              æ ‡é‡ï¼Œå›¾åƒå®½åº¦</span></span><br><span class="line"><span class="string">        self.N_imgs         æ ‡é‡ï¼Œå›¾åƒæ•°é‡</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, base_dir, scene_name, data_type, res_ratio, num_img_to_load, skip, use_ndc, load_img=<span class="literal">True</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        :param base_dir: æ•°æ®çš„åŸºç¡€ç›®å½•</span></span><br><span class="line"><span class="string">        :param scene_name: åœºæ™¯çš„åç§°</span></span><br><span class="line"><span class="string">        :param data_type: æ•°æ®ç±»å‹ï¼Œ&#x27;train&#x27; æˆ– &#x27;val&#x27;ã€‚</span></span><br><span class="line"><span class="string">        :param res_ratio: æ•´æ•°ï¼Œå¦‚ [1, 2, 4] ç­‰ï¼Œç”¨äºå°†å›¾åƒè°ƒæ•´ä¸ºè¾ƒä½çš„åˆ†è¾¨ç‡ã€‚</span></span><br><span class="line"><span class="string">        :param num_img_to_load/skip: ç”¨äºåœ¨æ—¶é—´åŸŸä¸Šæ§åˆ¶å¸§çš„åŠ è½½ã€‚</span></span><br><span class="line"><span class="string">        :param use_ndc: å¸ƒå°”å€¼ï¼Œæ˜¯å¦å¯¹ç›¸æœºä½å§¿è¿›è¡Œä¸­å¿ƒåŒ–å’Œç¼©æ”¾ã€‚</span></span><br><span class="line"><span class="string">        :param load_img: å¸ƒå°”å€¼ã€‚å¦‚æœè®¾ç½®ä¸º Falseï¼šä»…ç»Ÿè®¡å›¾åƒæ•°é‡ã€è·å–å›¾åƒçš„é«˜åº¦å’Œå®½åº¦ï¼Œ</span></span><br><span class="line"><span class="string">                         ä½†ä¸åŠ è½½å›¾åƒã€‚åœ¨å¯è§†åŒ–ä½å§¿æˆ–è°ƒè¯•ç­‰æƒ…å†µä¸‹å¾ˆæœ‰ç”¨ã€‚</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.base_dir = base_dir</span><br><span class="line">        <span class="variable language_">self</span>.scene_name = scene_name</span><br><span class="line">        <span class="variable language_">self</span>.data_type = data_type</span><br><span class="line">        <span class="variable language_">self</span>.res_ratio = res_ratio</span><br><span class="line">        <span class="variable language_">self</span>.num_img_to_load = num_img_to_load</span><br><span class="line">        <span class="variable language_">self</span>.skip = skip</span><br><span class="line">        <span class="variable language_">self</span>.use_ndc = use_ndc</span><br><span class="line">        <span class="variable language_">self</span>.load_img = load_img</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ„å»ºåœºæ™¯ç›®å½•çš„å®Œæ•´è·¯å¾„</span></span><br><span class="line">        <span class="variable language_">self</span>.scene_dir = os.path.join(<span class="variable language_">self</span>.base_dir, <span class="variable language_">self</span>.scene_name)</span><br><span class="line">        <span class="comment"># æ„å»ºå›¾åƒç›®å½•çš„å®Œæ•´è·¯å¾„</span></span><br><span class="line">        <span class="variable language_">self</span>.img_dir = os.path.join(<span class="variable language_">self</span>.scene_dir, <span class="string">&#x27;images&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¯»å–æ‰€æœ‰çš„å…ƒä¿¡æ¯ï¼ŒåŒ…æ‹¬ç›¸æœºä½å§¿ã€æ·±åº¦è¾¹ç•Œã€å›¾åƒå°ºå¯¸å’Œç„¦è·ç­‰</span></span><br><span class="line">        meta = read_meta(<span class="variable language_">self</span>.scene_dir, <span class="variable language_">self</span>.use_ndc)</span><br><span class="line">        <span class="comment"># æå–ç›¸æœºä½å§¿ä¿¡æ¯</span></span><br><span class="line">        <span class="variable language_">self</span>.c2ws = meta[<span class="string">&#x27;c2ws&#x27;</span>]  <span class="comment"># (N, 4, 4) æ ¼å¼çš„ numpy æ•°ç»„ï¼Œè¡¨ç¤ºæ‰€æœ‰ç›¸æœºä½å§¿</span></span><br><span class="line">        <span class="comment"># æå–å›¾åƒé«˜åº¦ä¿¡æ¯</span></span><br><span class="line">        <span class="variable language_">self</span>.H = meta[<span class="string">&#x27;H&#x27;</span>]</span><br><span class="line">        <span class="comment"># æå–å›¾åƒå®½åº¦ä¿¡æ¯</span></span><br><span class="line">        <span class="variable language_">self</span>.W = meta[<span class="string">&#x27;W&#x27;</span>]</span><br><span class="line">        <span class="comment"># æå–ç„¦è·ä¿¡æ¯</span></span><br><span class="line">        <span class="variable language_">self</span>.focal = <span class="built_in">float</span>(meta[<span class="string">&#x27;focal&#x27;</span>])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.res_ratio &gt; <span class="number">1</span>:</span><br><span class="line">            <span class="comment"># å¦‚æœéœ€è¦è°ƒæ•´å›¾åƒåˆ†è¾¨ç‡ï¼Œå¯¹å›¾åƒé«˜åº¦è¿›è¡Œç›¸åº”çš„ç¼©æ”¾</span></span><br><span class="line">            <span class="variable language_">self</span>.H = <span class="variable language_">self</span>.H // <span class="variable language_">self</span>.res_ratio</span><br><span class="line">            <span class="comment"># å¦‚æœéœ€è¦è°ƒæ•´å›¾åƒåˆ†è¾¨ç‡ï¼Œå¯¹å›¾åƒå®½åº¦è¿›è¡Œç›¸åº”çš„ç¼©æ”¾</span></span><br><span class="line">            <span class="variable language_">self</span>.W = <span class="variable language_">self</span>.W // <span class="variable language_">self</span>.res_ratio</span><br><span class="line">            <span class="comment"># å¦‚æœéœ€è¦è°ƒæ•´å›¾åƒåˆ†è¾¨ç‡ï¼Œå¯¹ç„¦è·è¿›è¡Œç›¸åº”çš„ç¼©æ”¾</span></span><br><span class="line">            <span class="variable language_">self</span>.focal /= <span class="variable language_">self</span>.res_ratio</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¿‘è£å‰ªå¹³é¢è·ç¦»</span></span><br><span class="line">        <span class="variable language_">self</span>.near = <span class="number">0.0</span></span><br><span class="line">        <span class="comment"># è¿œè£å‰ªå¹³é¢è·ç¦»</span></span><br><span class="line">        <span class="variable language_">self</span>.far = <span class="number">1.0</span></span><br><span class="line">        <span class="comment"># åŠ è½½å›¾åƒå¹¶è°ƒæ•´åˆ°æŒ‡å®šçš„é«˜åº¦å’Œå®½åº¦</span></span><br><span class="line">        <span class="variable language_">self</span>.imgs, <span class="variable language_">self</span>.img_names = load_imgs(<span class="variable language_">self</span>.img_dir, np.arange(num_img_to_load), <span class="variable language_">self</span>.H, <span class="variable language_">self</span>.W)  <span class="comment"># (N, H, W, 3) æ ¼å¼çš„ torch.float32 ç±»å‹å¼ é‡</span></span><br><span class="line">        <span class="comment"># æˆªå–å‰ num_img_to_load ä¸ªç›¸æœºä½å§¿</span></span><br><span class="line">        <span class="variable language_">self</span>.c2ws = <span class="variable language_">self</span>.c2ws[:num_img_to_load]</span><br><span class="line">        <span class="comment"># å›¾åƒçš„æ•°é‡</span></span><br><span class="line">        <span class="variable language_">self</span>.N_imgs = <span class="variable language_">self</span>.c2ws.shape[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ç”Ÿæˆç›¸æœºåæ ‡ç³»ä¸‹çš„å…‰çº¿æ–¹å‘</span></span><br><span class="line">        <span class="variable language_">self</span>.ray_dir_cam = comp_ray_dir_cam(<span class="variable language_">self</span>.H, <span class="variable language_">self</span>.W, <span class="variable language_">self</span>.focal)  <span class="comment"># (H, W, 3) æ ¼å¼çš„ torch.float32 ç±»å‹å¼ é‡</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># å°†ç›¸æœºä½å§¿ä» numpy æ•°ç»„è½¬æ¢ä¸º PyTorch å¼ é‡</span></span><br><span class="line">        <span class="variable language_">self</span>.c2ws = torch.from_numpy(<span class="variable language_">self</span>.c2ws).<span class="built_in">float</span>()  <span class="comment"># (N, 4, 4) æ ¼å¼çš„ torch.float32 ç±»å‹å¼ é‡</span></span><br><span class="line">        <span class="comment"># å°†å…‰çº¿æ–¹å‘å¼ é‡è½¬æ¢ä¸º float32 ç±»å‹</span></span><br><span class="line">        <span class="variable language_">self</span>.ray_dir_cam = <span class="variable language_">self</span>.ray_dir_cam.<span class="built_in">float</span>()  <span class="comment"># (H, W, 3) æ ¼å¼çš„ torch.float32 ç±»å‹å¼ é‡</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    scene_name = <span class="string">&#x27;LLFF/fern&#x27;</span></span><br><span class="line">    use_ndc = <span class="literal">True</span></span><br><span class="line">    <span class="comment"># æ³¨æ„ï¼šéœ€è¦å°† /your/data/path æ›¿æ¢ä¸ºå®é™…çš„æ•°æ®è·¯å¾„ï¼Œ</span></span><br><span class="line">    <span class="comment"># è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ª DataLoaderWithCOLMAP ç±»çš„å®ä¾‹ï¼Œç”¨äºåŠ è½½æŒ‡å®šåœºæ™¯çš„æ•°æ®</span></span><br><span class="line">    scene = DataLoaderWithCOLMAP(base_dir=<span class="string">&#x27;/your/data/path&#x27;</span>,</span><br><span class="line">                                 scene_name=scene_name,</span><br><span class="line">                                 data_type=<span class="string">&#x27;train&#x27;</span>,</span><br><span class="line">                                 res_ratio=<span class="number">8</span>,</span><br><span class="line">                                 num_img_to_load=-<span class="number">1</span>,</span><br><span class="line">                                 skip=<span class="number">1</span>,</span><br><span class="line">                                 use_ndc=use_ndc)</span><br></pre></td></tr></table></figure>



<h4 id="with-mask-py"><a href="#with-mask-py" class="headerlink" title="with_mask.py"></a>with_mask.py</h4><p>ä»–ä»¬çš„maskå…¶å®æ˜¯æ©ç æ–‡ä»¶ï¼Œæœ‰æ²¡æœ‰å¯èƒ½åªåŸºäºæ©ç æ–‡ä»¶å»åšå‘¢ï¼Ÿ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="comment"># os æ¨¡å—æä¾›äº†ä¸æ“ä½œç³»ç»Ÿè¿›è¡Œäº¤äº’çš„åŠŸèƒ½ï¼Œ</span></span><br><span class="line"><span class="comment"># å¯ç”¨äºå¤„ç†æ–‡ä»¶å’Œç›®å½•è·¯å¾„ã€åˆ›å»º/åˆ é™¤ç›®å½•ã€è·å–ç¯å¢ƒå˜é‡ç­‰ï¼Œ</span></span><br><span class="line"><span class="comment"># åœ¨æœ¬ä»£ç é‡Œä¸»è¦ç”¨äºæ„å»ºæ–‡ä»¶å’Œç›®å½•çš„è·¯å¾„ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="comment"># torch æ˜¯ PyTorch çš„æ ¸å¿ƒåº“ï¼Œæä¾›äº†å¼ é‡ï¼ˆTensorï¼‰æ•°æ®ç»“æ„ï¼Œ</span></span><br><span class="line"><span class="comment"># æ”¯æŒè‡ªåŠ¨æ±‚å¯¼æœºåˆ¶ï¼Œç”¨äºæ„å»ºå’Œè®­ç»ƒæ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œ</span></span><br><span class="line"><span class="comment"># èƒ½å¤Ÿåœ¨ CPU æˆ– GPU ä¸Šé«˜æ•ˆåœ°è¿›è¡Œæ•°å€¼è®¡ç®—ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="comment"># numpy æ˜¯ Python ä¸­ç”¨äºç§‘å­¦è®¡ç®—çš„åŸºç¡€åº“ï¼Œ</span></span><br><span class="line"><span class="comment"># æä¾›äº†é«˜æ•ˆçš„å¤šç»´æ•°ç»„å¯¹è±¡å’Œå„ç§æ•°å­¦å‡½æ•°ï¼Œ</span></span><br><span class="line"><span class="comment"># å¯è¿›è¡Œæ•°ç»„æ“ä½œã€çº¿æ€§ä»£æ•°è¿ç®—ã€éšæœºæ•°ç”Ÿæˆç­‰ï¼Œ</span></span><br><span class="line"><span class="comment"># åœ¨ä»£ç ä¸­ä¸»è¦ç”¨äºå¤„ç†å›¾åƒæ•°æ®å’Œæ•°ç»„æ“ä½œã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="comment"># tqdm æ˜¯ä¸€ä¸ªå¿«é€Ÿã€å¯æ‰©å±•çš„è¿›åº¦æ¡å·¥å…·ï¼Œ</span></span><br><span class="line"><span class="comment"># èƒ½åœ¨å¾ªç¯ä¸­æ˜¾ç¤ºè¿›åº¦æ¡ï¼Œæ–¹ä¾¿ç”¨æˆ·äº†è§£ä»£ç æ‰§è¡Œçš„è¿›åº¦ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> imageio</span><br><span class="line"><span class="comment"># imageio æ˜¯ä¸€ä¸ªç”¨äºè¯»å–å’Œå†™å…¥å¤šç§å›¾åƒæ–‡ä»¶æ ¼å¼çš„åº“ï¼Œ</span></span><br><span class="line"><span class="comment"># åœ¨ä»£ç ä¸­ä¸»è¦ç”¨äºè¯»å–å›¾åƒæ–‡ä»¶ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> dataloader.with_colmap <span class="keyword">import</span> resize_imgs</span><br><span class="line"><span class="comment"># ä» dataloader.with_colmap æ¨¡å—å¯¼å…¥ resize_imgs å‡½æ•°ï¼Œ</span></span><br><span class="line"><span class="comment"># è¯¥å‡½æ•°ç”¨äºè°ƒæ•´å›¾åƒçš„å°ºå¯¸ã€‚</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_imgs</span>(<span class="params">image_dir, mask_dir, num_img_to_load, start, end, skip, load_sorted, load_img</span>):</span><br><span class="line">    <span class="comment"># è·å–å›¾åƒç›®å½•ä¸‹æ‰€æœ‰å›¾åƒæ–‡ä»¶åï¼Œå¹¶æŒ‰å­—æ¯é¡ºåºæ’åº</span></span><br><span class="line">    img_names = np.array(<span class="built_in">sorted</span>(os.listdir(image_dir)))  <span class="comment"># all image names</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># åœ¨æ—¶é—´åŸŸä¸Šå¯¹å¸§è¿›è¡Œä¸‹é‡‡æ ·</span></span><br><span class="line">    <span class="keyword">if</span> end == -<span class="number">1</span> <span class="keyword">and</span> <span class="built_in">len</span>(os.listdir(mask_dir)) == <span class="built_in">len</span>(img_names):</span><br><span class="line">        <span class="comment"># è‹¥ end ä¸º -1 ä¸”æ©ç ç›®å½•å’Œå›¾åƒç›®å½•æ–‡ä»¶æ•°é‡ç›¸åŒï¼Œåˆ™æŒ‰ skip é—´éš”é€‰å–</span></span><br><span class="line">        img_names = img_names[start::skip]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># å– end å’Œæ©ç ç›®å½•æ–‡ä»¶æ•°é‡çš„æœ€å°å€¼ï¼Œé¿å…è¶Šç•Œ</span></span><br><span class="line">        end = <span class="built_in">min</span>(end, <span class="built_in">len</span>(os.listdir(mask_dir)))</span><br><span class="line">        img_names = img_names[start:end:skip]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœä¸æŒ‰é¡ºåºåŠ è½½å›¾åƒï¼Œåˆ™å¯¹å›¾åƒæ–‡ä»¶åè¿›è¡Œéšæœºæ‰“ä¹±</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> load_sorted:</span><br><span class="line">        np.random.shuffle(img_names)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åŠ è½½ä¸‹é‡‡æ ·åçš„å›¾åƒ</span></span><br><span class="line">    <span class="keyword">if</span> num_img_to_load &gt; <span class="built_in">len</span>(img_names):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Asked for &#123;0:6d&#125; images but only &#123;1:6d&#125; available. Exit.&#x27;</span>.<span class="built_in">format</span>(num_img_to_load, <span class="built_in">len</span>(img_names)))</span><br><span class="line">        exit()</span><br><span class="line">    <span class="keyword">elif</span> num_img_to_load == -<span class="number">1</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Loading all available &#123;0:6d&#125; images&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(img_names)))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Loading &#123;0:6d&#125; images out of &#123;1:6d&#125; images.&#x27;</span>.<span class="built_in">format</span>(num_img_to_load, <span class="built_in">len</span>(img_names)))</span><br><span class="line">        img_names = img_names[:num_img_to_load]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ„å»ºæ¯ä¸ªå›¾åƒçš„å®Œæ•´è·¯å¾„</span></span><br><span class="line">    img_paths = [os.path.join(image_dir, n) <span class="keyword">for</span> n <span class="keyword">in</span> img_names]</span><br><span class="line">    <span class="comment"># æ„å»ºæ¯ä¸ªæ©ç å›¾åƒçš„å®Œæ•´è·¯å¾„ï¼Œå‡è®¾æ©ç å›¾åƒä¸º png æ ¼å¼ï¼Œä¸”æ–‡ä»¶åå’Œå›¾åƒæ–‡ä»¶åå¯¹åº”</span></span><br><span class="line">    mask_paths = [os.path.join(mask_dir, n[:-<span class="number">4</span>]+<span class="string">&#x27;.png&#x27;</span>) <span class="keyword">for</span> n <span class="keyword">in</span> img_names]</span><br><span class="line">    <span class="comment"># å›¾åƒçš„æ•°é‡</span></span><br><span class="line">    N_imgs = <span class="built_in">len</span>(img_paths)</span><br><span class="line"></span><br><span class="line">    img_list, mask_list = [], []</span><br><span class="line">    <span class="keyword">if</span> load_img:</span><br><span class="line">        <span class="comment"># ä½¿ç”¨ tqdm æ˜¾ç¤ºåŠ è½½å›¾åƒçš„è¿›åº¦</span></span><br><span class="line">        <span class="keyword">for</span> i, p <span class="keyword">in</span> tqdm(<span class="built_in">enumerate</span>(img_paths)):</span><br><span class="line">            <span class="comment"># è¯»å–å›¾åƒå¹¶åªä¿ç•™å‰ä¸‰ä¸ªé€šé“ï¼ˆRGBï¼‰</span></span><br><span class="line">            img = imageio.imread(p)[:, :, :<span class="number">3</span>]  <span class="comment"># (H, W, 3) np.uint8</span></span><br><span class="line">            img_list.append(img)</span><br><span class="line">            <span class="comment"># è¯»å–å¯¹åº”çš„æ©ç å›¾åƒï¼Œåªå–ç¬¬ä¸€ä¸ªé€šé“</span></span><br><span class="line">            img = imageio.imread(mask_paths[i])[:, :, [<span class="number">0</span>]]  <span class="comment"># (H, W, 1)</span></span><br><span class="line">            mask_list.append(img)</span><br><span class="line">        <span class="comment"># å°†å›¾åƒåˆ—è¡¨è½¬æ¢ä¸º numpy æ•°ç»„</span></span><br><span class="line">        img_list = np.stack(img_list)  <span class="comment"># (N, H, W, 3)</span></span><br><span class="line">        <span class="comment"># å°†æ©ç åˆ—è¡¨è½¬æ¢ä¸º numpy æ•°ç»„</span></span><br><span class="line">        mask_list = np.stack(mask_list)</span><br><span class="line">        <span class="comment"># å°† numpy æ•°ç»„è½¬æ¢ä¸º PyTorch å¼ é‡ï¼Œå¹¶å°†åƒç´ å€¼å½’ä¸€åŒ–åˆ° [0, 1] èŒƒå›´</span></span><br><span class="line">        img_list = torch.from_numpy(img_list).<span class="built_in">float</span>() / <span class="number">255</span>  <span class="comment"># (N, H, W, 3) torch.float32</span></span><br><span class="line">        mask_list = torch.from_numpy(mask_list).<span class="built_in">float</span>() / <span class="number">255</span></span><br><span class="line">        <span class="comment"># è·å–å›¾åƒçš„é«˜åº¦å’Œå®½åº¦</span></span><br><span class="line">        H, W = img_list.shape[<span class="number">1</span>], img_list.shape[<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># å¦‚æœä¸åŠ è½½å›¾åƒï¼Œåˆ™è¯»å–ç¬¬ä¸€å¼ å›¾åƒä»¥è·å–å›¾åƒçš„é«˜åº¦å’Œå®½åº¦</span></span><br><span class="line">        tmp_img = imageio.imread(img_paths[<span class="number">0</span>])  <span class="comment"># load one image to get H, W</span></span><br><span class="line">        H, W = tmp_img.shape[<span class="number">0</span>], tmp_img.shape[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    results = &#123;</span><br><span class="line">        <span class="string">&#x27;imgs&#x27;</span>: img_list,  <span class="comment"># (N, H, W, 3) torch.float32</span></span><br><span class="line">        <span class="string">&#x27;img_names&#x27;</span>: img_names,  <span class="comment"># (N, )</span></span><br><span class="line">        <span class="string">&#x27;masks&#x27;</span>: mask_list,  <span class="comment"># æ©ç å›¾åƒå¼ é‡</span></span><br><span class="line">        <span class="string">&#x27;N_imgs&#x27;</span>: N_imgs,</span><br><span class="line">        <span class="string">&#x27;H&#x27;</span>: H,</span><br><span class="line">        <span class="string">&#x27;W&#x27;</span>: W,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DataLoaderAnyFolder</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Most useful fields:</span></span><br><span class="line"><span class="string">        self.c2ws:          (N_imgs, 4, 4)      torch.float32</span></span><br><span class="line"><span class="string">        self.imgs           (N_imgs, H, W, 4)   torch.float32</span></span><br><span class="line"><span class="string">        self.ray_dir_cam    (H, W, 3)           torch.float32</span></span><br><span class="line"><span class="string">        self.H              scalar</span></span><br><span class="line"><span class="string">        self.W              scalar</span></span><br><span class="line"><span class="string">        self.N_imgs         scalar</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, base_dir, scene_name, res_ratio, num_img_to_load, start, end, skip, load_sorted, load_img=<span class="literal">True</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        :param base_dir: æ•°æ®çš„åŸºç¡€ç›®å½•</span></span><br><span class="line"><span class="string">        :param scene_name: åœºæ™¯çš„åç§°</span></span><br><span class="line"><span class="string">        :param res_ratio: æ•´æ•°ï¼Œå¦‚ [1, 2, 4] ç­‰ï¼Œç”¨äºå°†å›¾åƒè°ƒæ•´ä¸ºè¾ƒä½çš„åˆ†è¾¨ç‡ã€‚</span></span><br><span class="line"><span class="string">        :param start/end/skip: ç”¨äºåœ¨æ—¶é—´åŸŸä¸Šæ§åˆ¶å¸§çš„åŠ è½½ã€‚</span></span><br><span class="line"><span class="string">        :param load_sorted: å¸ƒå°”å€¼ï¼Œæ˜¯å¦æŒ‰é¡ºåºåŠ è½½å›¾åƒã€‚</span></span><br><span class="line"><span class="string">        :param load_img: å¸ƒå°”å€¼ã€‚å¦‚æœè®¾ç½®ä¸º falseï¼šä»…ç»Ÿè®¡å›¾åƒæ•°é‡ã€è·å–å›¾åƒçš„é«˜åº¦å’Œå®½åº¦ï¼Œ</span></span><br><span class="line"><span class="string">                         ä½†ä¸åŠ è½½å›¾åƒã€‚åœ¨å¯è§†åŒ–ä½å§¿æˆ–è°ƒè¯•ç­‰æƒ…å†µä¸‹å¾ˆæœ‰ç”¨ã€‚</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.base_dir = base_dir</span><br><span class="line">        <span class="variable language_">self</span>.scene_name = scene_name</span><br><span class="line">        <span class="variable language_">self</span>.res_ratio = res_ratio</span><br><span class="line">        <span class="variable language_">self</span>.num_img_to_load = num_img_to_load</span><br><span class="line">        <span class="variable language_">self</span>.start = start</span><br><span class="line">        <span class="variable language_">self</span>.end = end</span><br><span class="line">        <span class="variable language_">self</span>.skip = skip</span><br><span class="line">        <span class="variable language_">self</span>.load_sorted = load_sorted</span><br><span class="line">        <span class="variable language_">self</span>.load_img = load_img</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ„å»ºå›¾åƒç›®å½•çš„å®Œæ•´è·¯å¾„</span></span><br><span class="line">        <span class="variable language_">self</span>.imgs_dir = os.path.join(<span class="variable language_">self</span>.base_dir, <span class="variable language_">self</span>.scene_name)</span><br><span class="line">        <span class="comment"># æ„å»ºæ©ç ç›®å½•çš„å®Œæ•´è·¯å¾„ï¼Œå‡è®¾æ©ç ç›®å½•åœ¨å›¾åƒç›®å½•çš„ä¸Šä¸€çº§çš„ mask æ–‡ä»¶å¤¹ä¸‹</span></span><br><span class="line">        <span class="variable language_">self</span>.mask_dir = os.path.join(<span class="variable language_">self</span>.imgs_dir, <span class="string">&#x27;../mask/&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è°ƒç”¨ load_imgs å‡½æ•°åŠ è½½å›¾åƒå’Œæ©ç æ•°æ®</span></span><br><span class="line">        image_data = load_imgs(<span class="variable language_">self</span>.imgs_dir, <span class="variable language_">self</span>.mask_dir, <span class="variable language_">self</span>.num_img_to_load, <span class="variable language_">self</span>.start, <span class="variable language_">self</span>.end, <span class="variable language_">self</span>.skip,</span><br><span class="line">                               <span class="variable language_">self</span>.load_sorted, <span class="variable language_">self</span>.load_img)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æå–åŠ è½½çš„å›¾åƒæ•°æ®</span></span><br><span class="line">        <span class="variable language_">self</span>.imgs = image_data[<span class="string">&#x27;imgs&#x27;</span>]  <span class="comment"># (N, H, W, 3) torch.float32</span></span><br><span class="line">        <span class="comment"># æå–å›¾åƒæ–‡ä»¶å</span></span><br><span class="line">        <span class="variable language_">self</span>.img_names = image_data[<span class="string">&#x27;img_names&#x27;</span>]  <span class="comment"># (N, )</span></span><br><span class="line">        <span class="comment"># æå–æ©ç æ•°æ®</span></span><br><span class="line">        <span class="variable language_">self</span>.masks = image_data[<span class="string">&#x27;masks&#x27;</span>]</span><br><span class="line">        <span class="comment"># å›¾åƒçš„æ•°é‡</span></span><br><span class="line">        <span class="variable language_">self</span>.N_imgs = image_data[<span class="string">&#x27;N_imgs&#x27;</span>]</span><br><span class="line">        <span class="comment"># åŸå§‹å›¾åƒçš„é«˜åº¦</span></span><br><span class="line">        <span class="variable language_">self</span>.ori_H = image_data[<span class="string">&#x27;H&#x27;</span>]</span><br><span class="line">        <span class="comment"># åŸå§‹å›¾åƒçš„å®½åº¦</span></span><br><span class="line">        <span class="variable language_">self</span>.ori_W = image_data[<span class="string">&#x27;W&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å§‹ç»ˆä½¿ç”¨å½’ä¸€åŒ–è®¾å¤‡åæ ‡ï¼ˆNDCï¼‰ï¼Œè®¾ç½®è¿‘è£å‰ªå¹³é¢è·ç¦»</span></span><br><span class="line">        <span class="variable language_">self</span>.near = <span class="number">0.0</span></span><br><span class="line">        <span class="comment"># å§‹ç»ˆä½¿ç”¨å½’ä¸€åŒ–è®¾å¤‡åæ ‡ï¼ˆNDCï¼‰ï¼Œè®¾ç½®è¿œè£å‰ªå¹³é¢è·ç¦»</span></span><br><span class="line">        <span class="variable language_">self</span>.far = <span class="number">1.0</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¦‚æœéœ€è¦è°ƒæ•´å›¾åƒåˆ†è¾¨ç‡</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.res_ratio &gt; <span class="number">1</span>:</span><br><span class="line">            <span class="comment"># è®¡ç®—è°ƒæ•´åçš„å›¾åƒé«˜åº¦</span></span><br><span class="line">            <span class="variable language_">self</span>.H = <span class="variable language_">self</span>.ori_H // <span class="variable language_">self</span>.res_ratio</span><br><span class="line">            <span class="comment"># è®¡ç®—è°ƒæ•´åçš„å›¾åƒå®½åº¦</span></span><br><span class="line">            <span class="variable language_">self</span>.W = <span class="variable language_">self</span>.ori_W // <span class="variable language_">self</span>.res_ratio</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.H = <span class="variable language_">self</span>.ori_H</span><br><span class="line">            <span class="variable language_">self</span>.W = <span class="variable language_">self</span>.ori_W</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.load_img:</span><br><span class="line">            <span class="comment"># è°ƒæ•´å›¾åƒçš„åˆ†è¾¨ç‡</span></span><br><span class="line">            <span class="variable language_">self</span>.imgs = resize_imgs(<span class="variable language_">self</span>.imgs, <span class="variable language_">self</span>.H, <span class="variable language_">self</span>.W)  <span class="comment"># (N, H, W, 3) torch.float32</span></span><br><span class="line">            <span class="comment"># è°ƒæ•´æ©ç å›¾åƒçš„åˆ†è¾¨ç‡</span></span><br><span class="line">            <span class="variable language_">self</span>.masks = resize_imgs(<span class="variable language_">self</span>.masks, <span class="variable language_">self</span>.H, <span class="variable language_">self</span>.W)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># æ•°æ®çš„åŸºç¡€ç›®å½•ï¼Œéœ€è¦æ›¿æ¢ä¸ºå®é™…çš„è·¯å¾„</span></span><br><span class="line">    base_dir = <span class="string">&#x27;/your/data/path&#x27;</span></span><br><span class="line">    <span class="comment"># åœºæ™¯çš„åç§°</span></span><br><span class="line">    scene_name = <span class="string">&#x27;LLFF/fern/images&#x27;</span></span><br><span class="line">    <span class="comment"># å›¾åƒçš„ç¼©æ”¾æ¯”ä¾‹</span></span><br><span class="line">    resize_ratio = <span class="number">8</span></span><br><span class="line">    <span class="comment"># è¦åŠ è½½çš„å›¾åƒæ•°é‡ï¼Œ-1 è¡¨ç¤ºåŠ è½½æ‰€æœ‰å›¾åƒ</span></span><br><span class="line">    num_img_to_load = -<span class="number">1</span></span><br><span class="line">    <span class="comment"># å¼€å§‹åŠ è½½å›¾åƒçš„ç´¢å¼•</span></span><br><span class="line">    start = <span class="number">0</span></span><br><span class="line">    <span class="comment"># ç»“æŸåŠ è½½å›¾åƒçš„ç´¢å¼•ï¼Œ-1 è¡¨ç¤ºåŠ è½½åˆ°æœ€å</span></span><br><span class="line">    end = -<span class="number">1</span></span><br><span class="line">    <span class="comment"># åŠ è½½å›¾åƒçš„é—´éš”</span></span><br><span class="line">    skip = <span class="number">1</span></span><br><span class="line">    <span class="comment"># æ˜¯å¦æŒ‰é¡ºåºåŠ è½½å›¾åƒ</span></span><br><span class="line">    load_sorted = <span class="literal">True</span></span><br><span class="line">    <span class="comment"># æ˜¯å¦åŠ è½½å›¾åƒ</span></span><br><span class="line">    load_img = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆå§‹åŒ– DataLoaderAnyFolder ç±»</span></span><br><span class="line">    scene = DataLoaderAnyFolder(base_dir=base_dir,</span><br><span class="line">                                scene_name=scene_name,</span><br><span class="line">                                res_ratio=resize_ratio,</span><br><span class="line">                                num_img_to_load=num_img_to_load,</span><br><span class="line">                                start=start,</span><br><span class="line">                                end=end,</span><br><span class="line">                                skip=skip,</span><br><span class="line">                                load_sorted=load_sorted,</span><br><span class="line">                                load_img=load_img)</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>ç§‘ç ”</category>
      </categories>
      <tags>
        <tag>è®ºæ–‡å¤ç°</tag>
      </tags>
  </entry>
  <entry>
    <title>æ‰‹æ’•è®ºæ–‡çŸ¥è¯†åº“</title>
    <url>/%E6%89%8B%E6%92%95%E7%9F%A5%E8%AF%86%E5%BA%93/</url>
    <content><![CDATA[<p>æ‰‹æ’•è®ºæ–‡çŸ¥è¯†åº“</p>
<h2 id="PyTorch"><a href="#PyTorch" class="headerlink" title="PyTorch"></a>PyTorch</h2><h3 id="ä»€ä¹ˆæ˜¯torch"><a href="#ä»€ä¹ˆæ˜¯torch" class="headerlink" title="ä»€ä¹ˆæ˜¯torch"></a>ä»€ä¹ˆæ˜¯torch</h3><p>Torch æ˜¯ PyTorch æ·±åº¦å­¦ä¹ æ¡†æ¶çš„æ ¸å¿ƒåº“ï¼Œå…·å¤‡å¼ºå¤§çš„åŠŸèƒ½ä¸å¹¿æ³›çš„ç”¨é€”ã€‚å®ƒæä¾›äº†ä¸°å¯Œçš„å¼ é‡æ“ä½œï¼Œå¯åœ¨ CPU æˆ– GPU ä¸Šé«˜æ•ˆè®¡ç®—ï¼Œèƒ½è½»æ¾å¤„ç†å„ç±»æ•°æ®ï¼›å…¶è‡ªåŠ¨æ±‚å¯¼æœºåˆ¶æå¤§ç®€åŒ–äº†æ·±åº¦å­¦ä¹ ä¸­æ¢¯åº¦è®¡ç®—ä¸åå‘ä¼ æ’­çš„è¿‡ç¨‹ï¼Œè®©æ¨¡å‹è®­ç»ƒæ›´ä¸ºä¾¿æ·ã€‚å€ŸåŠ©<code>torch.nn</code>æ¨¡å—å¯æ–¹ä¾¿æ„å»ºå¦‚ CNNã€RNN ç­‰å¤æ‚ç¥ç»ç½‘ç»œæ¶æ„ï¼Œ<code>torch.optim</code>æ¨¡å—æä¾›å¤šç§ä¼˜åŒ–ç®—æ³•ç”¨äºæ¨¡å‹å‚æ•°æ›´æ–°ã€‚æ­¤å¤–ï¼ŒTorch è¿˜æ”¯æŒé¢„è®­ç»ƒæ¨¡å‹çš„ä½¿ç”¨ä¸å¾®è°ƒï¼Œç»“åˆå¯è§†åŒ–å·¥å…·èƒ½åŠ©åŠ›ç›‘æ§è®­ç»ƒè¿‡ç¨‹ï¼Œå¹¿æ³›åº”ç”¨äºå›¾åƒã€è‡ªç„¶è¯­è¨€å¤„ç†ã€æ¨èç³»ç»Ÿç­‰è¯¸å¤šé¢†åŸŸã€‚</p>
<h3 id="torchå¸¸ç”¨å‡½æ•°å’ŒåŠŸèƒ½"><a href="#torchå¸¸ç”¨å‡½æ•°å’ŒåŠŸèƒ½" class="headerlink" title="torchå¸¸ç”¨å‡½æ•°å’ŒåŠŸèƒ½"></a>torchå¸¸ç”¨å‡½æ•°å’ŒåŠŸèƒ½</h3><h4 id="å¼ é‡"><a href="#å¼ é‡" class="headerlink" title="å¼ é‡"></a>å¼ é‡</h4><h5 id="ä»€ä¹ˆæ˜¯å¼ é‡"><a href="#ä»€ä¹ˆæ˜¯å¼ é‡" class="headerlink" title="ä»€ä¹ˆæ˜¯å¼ é‡"></a>ä»€ä¹ˆæ˜¯å¼ é‡</h5><p>å¼ é‡æ˜¯å¤šç»´æ•°ç»„çš„æ³›åŒ–è¡¨ç¤ºï¼Œå¯ç†è§£ä¸ºä¸€ä¸ªå¤šç»´çš„æ•°æ®å®¹å™¨ï¼Œé›¶ç»´å¼ é‡æ˜¯æ ‡é‡ï¼Œä¸€ç»´å¼ é‡æ˜¯å‘é‡ï¼ŒäºŒç»´å¼ é‡æ˜¯çŸ©é˜µï¼Œä¸‰ç»´åŠä»¥ä¸Šåˆ™æ˜¯æ›´é«˜é˜¶çš„å¼ é‡ã€‚åœ¨æ·±åº¦å­¦ä¹ é‡Œï¼Œä½¿ç”¨å¼ é‡æ˜¯å› ä¸ºå®ƒèƒ½å¤Ÿé«˜æ•ˆåœ°è¡¨ç¤ºå’Œå¤„ç†å¤§é‡çš„æ•°æ®ï¼Œåƒå›¾åƒå¯è¡¨ç¤ºä¸ºä¸‰ç»´å¼ é‡ï¼ˆé«˜åº¦ã€å®½åº¦ã€é€šé“æ•°ï¼‰ï¼Œè§†é¢‘å¯è¡¨ç¤ºä¸ºå››ç»´å¼ é‡ï¼ˆå¸§æ•°ã€é«˜åº¦ã€å®½åº¦ã€é€šé“æ•°ï¼‰ã€‚å¹¶ä¸”ï¼Œæ·±åº¦å­¦ä¹ æ¡†æ¶ï¼ˆå¦‚ PyTorchï¼‰é’ˆå¯¹å¼ é‡è¿ç®—è¿›è¡Œäº†é«˜åº¦ä¼˜åŒ–ï¼Œèƒ½åˆ©ç”¨ GPU ç­‰ç¡¬ä»¶åŠ é€Ÿè®¡ç®—ï¼Œå¼ é‡è¿˜èƒ½è‡ªç„¶åœ°æ”¯æŒè‡ªåŠ¨æ±‚å¯¼æœºåˆ¶ï¼Œæ–¹ä¾¿è¿›è¡Œæ¨¡å‹è®­ç»ƒæ—¶çš„æ¢¯åº¦è®¡ç®—å’Œå‚æ•°æ›´æ–°ã€‚</p>
<p>å¼ é‡æ˜¯ PyTorch ä¸­æœ€åŸºç¡€çš„æ•°æ®ç»“æ„ï¼Œç±»ä¼¼äº NumPy çš„å¤šç»´æ•°ç»„ï¼Œä½†å®ƒå¯ä»¥åœ¨ GPU ä¸Šè¿›è¡ŒåŠ é€Ÿè®¡ç®—ï¼Œå¹¶ä¸”æ”¯æŒè‡ªåŠ¨æ±‚å¯¼ç­‰æ·±åº¦å­¦ä¹ æ‰€éœ€çš„ç‰¹æ€§ã€‚</p>
<h5 id="å¼ é‡çš„ç»´åº¦"><a href="#å¼ é‡çš„ç»´åº¦" class="headerlink" title="å¼ é‡çš„ç»´åº¦"></a>å¼ é‡çš„ç»´åº¦</h5><p>ç»´åº¦ï¼ˆä¹Ÿç§°ä¸ºè½´ï¼‰æ˜¯æŒ‡å¼ é‡åœ¨æŸä¸ªæ–¹å‘ä¸Šçš„å»¶ä¼¸ã€‚å¯ä»¥å°†ç»´åº¦ç†è§£ä¸ºæ•°æ®ç»„ç»‡çš„ä¸€ä¸ªæ–¹å‘æˆ–ä¸€ä¸ªå±‚æ¬¡ï¼Œç±»ä¼¼äºåœ¨åœ°ç†åæ ‡ç³»ç»Ÿä¸­ï¼Œç»åº¦å’Œçº¬åº¦åˆ†åˆ«ä»£è¡¨äº†ä¸åŒçš„æ–¹å‘ï¼Œå¼ é‡çš„æ¯ä¸ªç»´åº¦ä¹Ÿä»£è¡¨äº†æ•°æ®çš„ä¸€ä¸ªç‰¹å®šæ–¹å‘çš„æ’åˆ—ã€‚ç»´åº¦çš„æ•°é‡è¢«ç§°ä¸ºå¼ é‡çš„é˜¶ï¼ˆrankï¼‰ï¼Œé›¶é˜¶å¼ é‡æ˜¯æ ‡é‡ï¼ˆä¸€ä¸ªå•ç‹¬çš„æ•°å€¼ï¼‰ï¼Œä¸€é˜¶å¼ é‡æ˜¯å‘é‡ï¼ˆä¸€ç»´æ•°ç»„ï¼‰ï¼ŒäºŒé˜¶å¼ é‡æ˜¯çŸ©é˜µï¼ˆäºŒç»´æ•°ç»„ï¼‰ï¼Œä¸‰é˜¶åŠä»¥ä¸Šçš„å¼ é‡åˆ™ç”¨äºè¡¨ç¤ºæ›´å¤æ‚çš„æ•°æ®ç»“æ„ã€‚</p>
<p><strong>æ³¨ï¼šç»´åº¦ä»0å¼€å§‹ç®—èµ·ï¼Œæ¯”å¦‚å¯¹äºäºŒé˜¶å¼ é‡ï¼Œç»´åº¦0ä»£è¡¨è¡Œï¼Œç»´åº¦1ä»£è¡¨åˆ—</strong></p>
<p><strong>å¦ï¼šç»´åº¦æ’åˆ—éµå¾ªï¼ˆ$a_n$, $a_{n-1}$, â€¦, $a_1$ï¼‰çš„å½¢å¼ï¼Œæ•°å­—è¶Šå‰ä»£è¡¨è¶Šé«˜ç»´çš„å †å ã€‚æ¯”å¦‚<code>torch.zeros((2, 3, 4, 5))</code>ï¼Œé‚£å°±æ˜¯ä¸¤ä¸ªä¸‰ç»´ï¼ˆä¸‰å±‚ï¼‰çš„4x5çŸ©é˜µå åœ¨ä¸€èµ·</strong></p>
<p><strong>1.é›¶é˜¶å¼ é‡ï¼ˆæ ‡é‡ï¼‰</strong></p>
<p>é›¶é˜¶å¼ é‡åªæœ‰ä¸€ä¸ªæ•°å€¼ï¼Œå®ƒæ²¡æœ‰æ–¹å‘çš„æ¦‚å¿µï¼Œç»´åº¦æ•°é‡ä¸º 0ã€‚ä¾‹å¦‚è¿™é‡Œçš„ <code>scalar</code> å°±æ˜¯ä¸€ä¸ªé›¶é˜¶å¼ é‡ï¼Œå®ƒä»£è¡¨ä¸€ä¸ªå•ä¸€çš„æ•°å€¼ï¼Œä¸æ¶‰åŠæ–¹å‘æˆ–å¤šä¸ªå…ƒç´ çš„æ’åˆ—ã€‚</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line">scalar = torch.tensor(<span class="number">5</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;æ ‡é‡çš„ç»´åº¦æ•°é‡:&quot;</span>, scalar.dim()) </span><br></pre></td></tr></table></figure>

<p><strong>2.ä¸€é˜¶å¼ é‡ï¼ˆå‘é‡ï¼‰</strong></p>
<p>ä¸€é˜¶å¼ é‡å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªå‘é‡ï¼Œå®ƒæœ‰ä¸€ä¸ªç»´åº¦ã€‚è¿™ä¸ªç»´åº¦ä»£è¡¨äº†å‘é‡ä¸­å…ƒç´ çš„æ’åˆ—æ–¹å‘ï¼Œå‘é‡çš„é•¿åº¦å°±æ˜¯è¿™ä¸ªç»´åº¦çš„å¤§å°ã€‚ä¾‹å¦‚<code>vector</code> æ˜¯ä¸€ä¸ªä¸€é˜¶å¼ é‡ï¼Œç»´åº¦æ•°é‡ä¸º 1ï¼Œè¯¥ç»´åº¦çš„å¤§å°ä¸º 4ï¼Œè¡¨ç¤ºå‘é‡ä¸­æœ‰ 4 ä¸ªå…ƒç´ ã€‚</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">vector = torch.tensor([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;å‘é‡çš„ç»´åº¦æ•°é‡:&quot;</span>, vector.dim()) </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;å‘é‡åœ¨è¯¥ç»´åº¦çš„å¤§å°:&quot;</span>, vector.size(<span class="number">0</span>)) </span><br></pre></td></tr></table></figure>

<p><strong>3.äºŒé˜¶å¼ é‡ï¼ˆçŸ©é˜µï¼‰</strong></p>
<p>äºŒé˜¶å¼ é‡æ˜¯ä¸€ä¸ªçŸ©é˜µï¼Œæœ‰ä¸¤ä¸ªç»´åº¦ï¼Œé€šå¸¸ç§°ä¸ºè¡Œå’Œåˆ—ã€‚ç¬¬ä¸€ä¸ªç»´åº¦ä»£è¡¨çŸ©é˜µçš„è¡Œæ–¹å‘ï¼Œç¬¬äºŒä¸ªç»´åº¦ä»£è¡¨çŸ©é˜µçš„åˆ—æ–¹å‘ã€‚ä¾‹å¦‚<code>matrix</code> æ˜¯ä¸€ä¸ª 2 è¡Œ 3 åˆ—çš„çŸ©é˜µï¼Œç¬¬ä¸€ä¸ªç»´åº¦çš„å¤§å°ä¸º 2 è¡¨ç¤ºæœ‰ 2 è¡Œï¼Œç¬¬äºŒä¸ªç»´åº¦çš„å¤§å°ä¸º 3 è¡¨ç¤ºæœ‰ 3 åˆ—ã€‚</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">matrix = torch.tensor([[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;çŸ©é˜µçš„ç»´åº¦æ•°é‡:&quot;</span>, matrix.dim()) </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;çŸ©é˜µç¬¬ä¸€ä¸ªç»´åº¦ï¼ˆè¡Œï¼‰çš„å¤§å°:&quot;</span>, matrix.size(<span class="number">0</span>)) </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;çŸ©é˜µç¬¬äºŒä¸ªç»´åº¦ï¼ˆåˆ—ï¼‰çš„å¤§å°:&quot;</span>, matrix.size(<span class="number">1</span>)) </span><br></pre></td></tr></table></figure>

<p><strong>4.é«˜é˜¶å¼ é‡ï¼ˆå›¾åƒã€è§†é¢‘ç­‰ï¼‰</strong></p>
<p>å¯¹äºä¸‰é˜¶åŠä»¥ä¸Šçš„å¼ é‡ï¼Œç»´åº¦çš„å«ä¹‰æ›´åŠ ä¸°å¯Œï¼Œé€šå¸¸ä¸å…·ä½“çš„æ•°æ®ç±»å‹å’Œåº”ç”¨åœºæ™¯ç›¸å…³ã€‚</p>
<p><strong>å›¾åƒæ•°æ®</strong>ï¼šåœ¨å¤„ç†å›¾åƒæ—¶ï¼Œé€šå¸¸ä½¿ç”¨ä¸‰é˜¶å¼ é‡ã€‚ä¾‹å¦‚ï¼Œä¸€å¼ å½©è‰²å›¾åƒå¯ä»¥è¡¨ç¤ºä¸ºä¸€ä¸ªå½¢çŠ¶ä¸º <code>(é«˜åº¦, å®½åº¦, é€šé“æ•°)</code> çš„ä¸‰é˜¶å¼ é‡ã€‚è¿™é‡Œçš„ç¬¬ä¸€ä¸ªç»´åº¦ä»£è¡¨å›¾åƒçš„é«˜åº¦æ–¹å‘ï¼Œç¬¬äºŒä¸ªç»´åº¦ä»£è¡¨å›¾åƒçš„å®½åº¦æ–¹å‘ï¼Œç¬¬ä¸‰ä¸ªç»´åº¦ä»£è¡¨å›¾åƒçš„é€šé“ï¼ˆå¦‚ RGB ä¸‰ä¸ªé€šé“ï¼‰ã€‚</p>
<p><code>image = torch.randn(224, 224, 3)</code> è¿™è¡Œä»£ç èƒ½å¤Ÿéšæœºç”Ÿæˆä¸€ä¸ªå½¢çŠ¶ä¸º <code>(224, 224, 3)</code> çš„å¼ é‡æ¥æ¨¡æ‹Ÿå›¾åƒçš„ä¸‰é€šé“æ•°å€¼ã€‚</p>
<p>ç”±äº <code>torch.randn()</code> ç”Ÿæˆçš„æ˜¯æœä»æ ‡å‡†æ­£æ€åˆ†å¸ƒçš„éšæœºæ•°ï¼Œè¿™äº›æ•°å€¼å¯èƒ½ä¸ºè´Ÿæ•°ï¼Œä¹Ÿå¯èƒ½è¶…å‡ºäº†å¸¸è§å›¾åƒåƒç´ å€¼çš„èŒƒå›´ï¼ˆé€šå¸¸æ˜¯ 0 - 255 æˆ–è€… 0 - 1ï¼‰ã€‚åœ¨å®é™…çš„å›¾åƒå¤„ç†ä»»åŠ¡ä¸­ï¼Œå¦‚æœéœ€è¦æ¨¡æ‹ŸçœŸå®å›¾åƒï¼Œå¯èƒ½éœ€è¦å¯¹è¿™äº›éšæœºå€¼è¿›è¡Œè¿›ä¸€æ­¥çš„å¤„ç†ï¼Œä¾‹å¦‚é€šè¿‡å½’ä¸€åŒ–æˆ–è£å‰ªæ“ä½œå°†å…¶é™åˆ¶åœ¨åˆé€‚çš„èŒƒå›´å†…ã€‚</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">image = torch.randn(<span class="number">224</span>, <span class="number">224</span>, <span class="number">3</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;å›¾åƒå¼ é‡çš„ç»´åº¦æ•°é‡:&quot;</span>, image.dim()) </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;å›¾åƒé«˜åº¦ç»´åº¦çš„å¤§å°:&quot;</span>, image.size(<span class="number">0</span>)) </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;å›¾åƒå®½åº¦ç»´åº¦çš„å¤§å°:&quot;</span>, image.size(<span class="number">1</span>)) </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;å›¾åƒé€šé“ç»´åº¦çš„å¤§å°:&quot;</span>, image.size(<span class="number">2</span>)) </span><br></pre></td></tr></table></figure>

<p><img src="/./%E6%89%8B%E6%92%95%E7%9F%A5%E8%AF%86%E5%BA%93/image-20250219032451598.png" alt="image-20250219032451598"></p>
<p><strong>è§†é¢‘æ•°æ®</strong>ï¼šè§†é¢‘å¯ä»¥çœ‹ä½œæ˜¯ä¸€ç³»åˆ—çš„å›¾åƒå¸§ï¼Œå› æ­¤å¯ä»¥ç”¨å››é˜¶å¼ é‡è¡¨ç¤ºï¼Œå½¢çŠ¶é€šå¸¸ä¸º <code>(å¸§æ•°, é«˜åº¦, å®½åº¦, é€šé“æ•°)</code>ã€‚ç¬¬ä¸€ä¸ªç»´åº¦ä»£è¡¨è§†é¢‘ä¸­çš„å¸§æ•°ï¼Œå…¶ä½™ç»´åº¦ä¸å›¾åƒå¼ é‡çš„å«ä¹‰ç›¸åŒã€‚</p>
<p>*<strong>5.é€šé“</strong></p>
<p>é€šé“æŒ‡å›¾åƒä¸­ç‰¹å®šç±»å‹ä¿¡æ¯çš„é›†åˆï¼Œå›¾åƒå¯å«ä¸€ä¸ªæˆ–å¤šä¸ªé€šé“ï¼Œå„é€šé“å­˜å‚¨å›¾åƒæŸæ–¹é¢ç‰¹å¾æ•°æ®ã€‚åƒå•é€šé“å­˜äº®åº¦ï¼ŒRGB ä¸‰é€šé“åˆ†åˆ«å­˜çº¢ã€ç»¿ã€è“é¢œè‰²ä¿¡æ¯ï¼Œå››é€šé“è¿˜å¤šäº†é€æ˜åº¦é€šé“ï¼Œä»¥æ­¤ç»„åˆå®Œæ•´å‘ˆç°å›¾åƒã€‚</p>
<p>é€šé“èƒ½å®ç°é¢œè‰²è¡¨ç¤ºä¸æ··åˆï¼Œå¦‚ RGB ä¸‰é€šé“é€šè¿‡ä¸åŒæ•°å€¼ç»„åˆå‘ˆç°ä¸°å¯Œè‰²å½©ï¼›å¯ç”¨äºç‰¹å¾æå–ä¸åˆ†æï¼Œä¸åŒé€šé“æä¾›ä¸åŒç‰¹å¾ï¼ŒåŠ©åŠ›å›¾åƒåˆ†æå’Œç›®æ ‡è¯†åˆ«ï¼›è¿˜èƒ½ç”¨äºå›¾åƒåˆæˆä¸ç‰¹æ•ˆåˆ¶ä½œï¼Œå€ŸåŠ©é€æ˜åº¦é€šé“å¯æ§åˆ¶å›¾åƒé€æ˜æ•ˆæœå®ç°åˆæˆã€‚</p>
<p>åœ¨å›¾ç‰‡é‡Œï¼Œç°åº¦å›¾ç”¨å•é€šé“å‘ˆç°é»‘ç™½å½±åƒï¼›å½©è‰²ç…§ç‰‡é  RGB ä¸‰é€šé“å±•ç¤ºå¤šå½©ç”»é¢ï¼›PNG å›¾ç‰‡åˆ©ç”¨å››é€šé“å«é€æ˜åº¦ä¿¡æ¯å®ç°å›¾åƒèåˆã€‚è§†é¢‘æ˜¯è¿ç»­çš„å›¾ç‰‡å¸§ï¼ŒåŒæ ·åˆ©ç”¨é€šé“æ¥å‘ˆç°è‰²å½©ã€è¿›è¡Œç‰¹æ•ˆå¤„ç†ï¼Œå¦‚å½±è§†ä¸­å¸¸è§çš„æŠ å›¾åˆæˆåœºæ™¯å°±å€ŸåŠ©äº†é€šé“ç‰¹æ€§ã€‚</p>
<h5 id="å¼ é‡ç›¸å…³å‡½æ•°"><a href="#å¼ é‡ç›¸å…³å‡½æ•°" class="headerlink" title="å¼ é‡ç›¸å…³å‡½æ•°"></a>å¼ é‡ç›¸å…³å‡½æ•°</h5><p><strong>1.åˆ›å»º</strong></p>
<ul>
<li><p>åˆ›å»ºå¼ é‡<code>torch.tensor()</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line">data = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">tensor = torch.tensor(data)</span><br></pre></td></tr></table></figure></li>
</ul>
<p>å½“ä½ æœ‰ç°æœ‰çš„æ•°æ®å­˜å‚¨åœ¨ Python åˆ—è¡¨æˆ– NumPy æ•°ç»„ä¸­ï¼Œå¹¶ä¸”éœ€è¦å°†å…¶è¾“å…¥åˆ° PyTorch æ¨¡å‹è¿›è¡Œè®¡ç®—æ—¶ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œåœ¨åŠ è½½æ•°æ®é›†åï¼Œå°†æ•°æ®è½¬æ¢ä¸ºå¼ é‡å½¢å¼ä»¥ä¾¿åç»­å¤„ç†ã€‚</p>
<p>ä»æ•°æ®å­˜å‚¨çš„è§’åº¦æ¥çœ‹ï¼Œ<code>tensor</code> å­˜å‚¨äº† Python åˆ—è¡¨ <code>data</code> ä¸­çš„å…ƒç´  <code>[1, 2, 3]</code>ã€‚å®ƒå°†è¿™äº›æ•°æ®ä»¥ä¸€ç§é«˜æ•ˆçš„ã€é€‚åˆè®¡ç®—æœºå¤„ç†çš„æ–¹å¼ç»„ç»‡èµ·æ¥ï¼Œå­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>tensor</code> æ˜¯ä¸€ä¸ªä¸€ç»´å¼ é‡ï¼Œå½¢çŠ¶ä¸º <code>(3,)</code>ï¼Œè¿™æ„å‘³ç€å®ƒåŒ…å« 3 ä¸ªå…ƒç´ ã€‚</p>
<p>åœ¨æ•°å­¦è¿ç®—æ–¹é¢ï¼Œ<code>tensor</code> å¯ä»¥å‚ä¸å„ç§æ•°å­¦è¿ç®—ï¼Œå¦‚åŠ æ³•ã€ä¹˜æ³•ã€çŸ©é˜µä¹˜æ³•ç­‰ã€‚PyTorch ä¸ºå¼ é‡æä¾›äº†ä¸°å¯Œçš„æ•°å­¦è¿ç®—å‡½æ•°ï¼Œè¿™äº›è¿ç®—å¯ä»¥åœ¨ CPU æˆ– GPU ä¸Šé«˜æ•ˆæ‰§è¡Œã€‚</p>
<p>åœ¨æ·±åº¦å­¦ä¹ çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œ<code>tensor</code> æ˜¯æ¨¡å‹è¾“å…¥ã€è¾“å‡ºä»¥åŠå‚æ•°çš„åŸºæœ¬è¡¨ç¤ºå½¢å¼ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªç®€å•çš„å…¨è¿æ¥ç¥ç»ç½‘ç»œä¸­ï¼Œè¾“å…¥æ•°æ®ä¼šè¢«è½¬æ¢ä¸ºå¼ é‡è¾“å…¥åˆ°ç½‘ç»œä¸­ï¼Œç½‘ç»œçš„æƒé‡å’Œåç½®ä¹Ÿæ˜¯ä»¥å¼ é‡çš„å½¢å¼å­˜å‚¨å’Œæ›´æ–°çš„ã€‚åœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œ<code>tensor</code> å¯ä»¥ä½œä¸ºä¸€ä¸ªç®€å•çš„è¾“å…¥æ•°æ®ç¤ºä¾‹ï¼Œå¦‚æœè¦æ„å»ºä¸€ä¸ªç¥ç»ç½‘ç»œå¤„ç†è¿™ä¸ªè¾“å…¥ï¼Œå¯èƒ½ä¼šè¿›è¡Œå¦‚ä¸‹æ“ä½œï¼ˆä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•ç¤ºä¾‹ï¼‰ï¼š</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ä¸€ä¸ªç®€å•çš„å…¨è¿æ¥å±‚</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleNet</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(SimpleNet, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.fc = nn.Linear(<span class="number">3</span>, <span class="number">1</span>)  <span class="comment"># è¾“å…¥ç»´åº¦ä¸º 3ï¼Œè¾“å‡ºç»´åº¦ä¸º 1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.fc(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæ¨¡å‹å®ä¾‹</span></span><br><span class="line">model = SimpleNet()</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡†å¤‡è¾“å…¥æ•°æ®</span></span><br><span class="line">data = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">tensor = torch.tensor(data, dtype=torch.float32).unsqueeze(<span class="number">0</span>)  <span class="comment"># è½¬æ¢ä¸ºé€‚åˆè¾“å…¥æ¨¡å‹çš„å½¢çŠ¶</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›è¡Œå‰å‘ä¼ æ’­</span></span><br><span class="line">output = model(tensor)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;æ¨¡å‹è¾“å‡º:&quot;</span>, output)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>åˆ›å»ºå…¨é›¶å¼ é‡<code>torch.zeros()</code></p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">zeros_tensor = torch.zeros((<span class="number">2</span>, <span class="number">3</span>))</span><br></pre></td></tr></table></figure></li>
</ul>
<p>å¸¸ç”¨äºåˆå§‹åŒ–æŸäº›å˜é‡ï¼Œå¦‚åœ¨åˆå§‹åŒ–ç¥ç»ç½‘ç»œçš„åç½®é¡¹æ—¶ï¼Œå¯ä½¿ç”¨å…¨é›¶å¼ é‡ã€‚å¦å¤–ï¼Œåœ¨éœ€è¦å¡«å……é›¶å€¼è¿›è¡Œæ•°æ®é¢„å¤„ç†æˆ–å ä½æ—¶ä¹Ÿä¼šç”¨åˆ°ã€‚</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">åˆ›å»ºçš„å…¨é›¶å¼ é‡ï¼š</span><br><span class="line">tensor([[<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>],</span><br><span class="line">        [<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>]])</span><br><span class="line">å¼ é‡çš„å½¢çŠ¶ï¼š torch.Size([<span class="number">2</span>, <span class="number">3</span>])</span><br></pre></td></tr></table></figure>

<p>ä¼ å…¥çš„å‚æ•° <code>(2, 3)</code>å¯¹åº”åˆ›å»ºçš„ <code>zeros_tensor</code> æ˜¯ä¸€ä¸ª 2 è¡Œ 3 åˆ—çš„äºŒç»´å¼ é‡ã€‚å¦‚æœä½¿ç”¨ <code>torch.zeros((2, 3, 4))</code> è¿™æ ·çš„ä»£ç ï¼Œé‚£ä¹ˆåˆ›å»ºçš„å°±æ˜¯ä¸€ä¸ªä¸‰ç»´å¼ é‡ï¼Œå…¶ä¸­ <code>2</code> è¡¨ç¤ºæœ€å¤–å±‚ç»´åº¦çš„å¤§å°ï¼ˆå¯ä»¥æƒ³è±¡æˆæœ‰ 2 ä¸ªäºŒç»´çŸ©é˜µå †å åœ¨ä¸€èµ·ï¼‰ï¼Œ<code>3</code> è¡¨ç¤ºæ¯ä¸ªäºŒç»´çŸ©é˜µçš„è¡Œæ•°ï¼Œ<code>4</code> è¡¨ç¤ºæ¯ä¸ªäºŒç»´çŸ©é˜µçš„åˆ—æ•°ã€‚ä¾æ­¤ç±»æ¨ï¼Œå¯¹äºæ›´é«˜ç»´çš„å¼ é‡ï¼Œæ¯ä¸ªæ•°å­—éƒ½ä»£è¡¨å¯¹åº”ç»´åº¦ä¸Šçš„å¤§å°ã€‚ç›¸å½“äºé«˜æ˜¯2ï¼Œè¡Œæ˜¯3ï¼Œåˆ—æ˜¯4</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">åˆ›å»ºçš„å…¨é›¶å¼ é‡ï¼š</span><br><span class="line">tensor([[[<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>],</span><br><span class="line">         [<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>],</span><br><span class="line">         [<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>]],</span><br><span class="line"></span><br><span class="line">        [[<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>],</span><br><span class="line">         [<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>],</span><br><span class="line">         [<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>]]])</span><br><span class="line">å¼ é‡çš„å½¢çŠ¶ï¼š torch.Size([<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ˜¯<code>torch.zeros((2, 3, 4, 5))</code>ï¼Œé‚£å°±æ˜¯ä¸¤ä¸ªä¸‰ç»´ï¼ˆä¸‰å±‚ï¼‰çš„4x5çŸ©é˜µå åœ¨ä¸€èµ·ï¼Œæ•°å­—è¶Šå‰å°±ä»£è¡¨è¶Šé«˜ç»´çš„å †å ã€‚</p>
<ul>
<li><p>åˆ›å»ºå…¨ä¸€å¼ é‡**<code>torch.ones()</code>**</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">ones_tensor = torch.ones((<span class="number">2</span>, <span class="number">3</span>))</span><br></pre></td></tr></table></figure></li>
</ul>
<p>ä¸ <code>torch.zeros()</code> ç±»ä¼¼ï¼Œå¯ç”¨äºåˆå§‹åŒ–ç‰¹å®šå˜é‡ã€‚åœ¨ä¸€äº›å½’ä¸€åŒ–æ“ä½œæˆ–éœ€è¦ç‰¹å®šåˆå§‹å€¼ä¸º 1 çš„åœºæ™¯ä¸­ä¼šä½¿ç”¨ã€‚</p>
<ul>
<li><p>åˆ›å»ºæŒ‡å®šå½¢çŠ¶çš„éšæœºå¼ é‡ï¼Œå…ƒç´ å€¼åœ¨[0 , 1)ä¹‹é—´**<code>torch.rand()</code>**</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">random_tensor = torch.rand((<span class="number">2</span>, <span class="number">3</span>))</span><br></pre></td></tr></table></figure></li>
</ul>
<p>åœ¨åˆå§‹åŒ–ç¥ç»ç½‘ç»œçš„æƒé‡æ—¶ï¼Œéšæœºåˆå§‹åŒ–æ˜¯å¸¸è§çš„åšæ³•ï¼Œå¯ä½¿ç”¨ <code>torch.rand()</code> ç”Ÿæˆåˆå§‹æƒé‡å¼ é‡ã€‚</p>
<p><strong>2.æ“ä½œ</strong></p>
<ul>
<li><p><strong><code>torch.cat()</code></strong>ï¼šç”¨äºåœ¨æŒ‡å®šç»´åº¦ä¸Šæ‹¼æ¥å¤šä¸ªå¼ é‡ã€‚</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">a = torch.tensor([[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>]])</span><br><span class="line">b = torch.tensor([[<span class="number">5</span>, <span class="number">6</span>], [<span class="number">7</span>, <span class="number">8</span>]])</span><br><span class="line">c = torch.cat((a, b), dim=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>å½“éœ€è¦å°†å¤šä¸ªå¼ é‡åˆå¹¶ä¸ºä¸€ä¸ªæ›´å¤§çš„å¼ é‡æ—¶ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œåœ¨å¤„ç†å¤šæ¨¡æ€æ•°æ®æ—¶ï¼Œå°†ä¸åŒæ¨¡æ€çš„ç‰¹å¾å¼ é‡æ‹¼æ¥åœ¨ä¸€èµ·ã€‚</p>
<p><code>torch.cat((a, b), dim=1)</code> è¡¨ç¤ºåœ¨ç»´åº¦ 1ï¼ˆåˆ—æ–¹å‘ï¼‰ä¸Šå¯¹å¼ é‡ <code>a</code> å’Œ <code>b</code> è¿›è¡Œæ‹¼æ¥ã€‚å¯ä»¥çœ‹åˆ°ï¼Œæ‹¼æ¥åçš„å¼ é‡ <code>c</code> æ˜¯å°† <code>a</code> å’Œ <code>b</code> çš„åˆ—è¿›è¡Œäº†åˆå¹¶ï¼Œè¡Œæ•°ä¸å˜ï¼Œåˆ—æ•°å˜ä¸ºåŸæ¥ä¸¤ä¸ªå¼ é‡åˆ—æ•°ä¹‹å’Œã€‚åœ¨å¤„ç†å¤šæ¨¡æ€æ•°æ®æ—¶ï¼Œæ¯”å¦‚ä¸€ä¸ªæ¨¡æ€çš„æ•°æ®ç‰¹å¾ç”¨å¼ é‡ <code>a</code> è¡¨ç¤ºï¼Œå¦ä¸€ä¸ªæ¨¡æ€çš„æ•°æ®ç‰¹å¾ç”¨å¼ é‡ <code>b</code> è¡¨ç¤ºï¼Œé€šè¿‡è¿™ç§æ‹¼æ¥æ“ä½œå¯ä»¥å°†ä¸åŒæ¨¡æ€çš„ç‰¹å¾åˆå¹¶åœ¨ä¸€èµ·ï¼Œæ–¹ä¾¿åç»­çš„å¤„ç†ã€‚</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">å¼ é‡ aï¼š</span><br><span class="line">tensor([[<span class="number">1</span>, <span class="number">2</span>],</span><br><span class="line">        [<span class="number">3</span>, <span class="number">4</span>]])</span><br><span class="line">å¼ é‡ bï¼š</span><br><span class="line">tensor([[<span class="number">5</span>, <span class="number">6</span>],</span><br><span class="line">        [<span class="number">7</span>, <span class="number">8</span>]])</span><br><span class="line">æ‹¼æ¥åçš„å¼ é‡ cï¼š</span><br><span class="line">tensor([[<span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">6</span>],</span><br><span class="line">        [<span class="number">3</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">8</span>]])</span><br></pre></td></tr></table></figure>

<p>åœ¨äºŒç»´å¼ é‡çš„è¯­å¢ƒä¸‹ï¼Œç»´åº¦ 0 ä»£è¡¨è¡Œæ–¹å‘ã€‚<code>torch.cat((a, b), dim=0)</code> ä¼šå°†å¼ é‡ <code>b</code> æŒ‰è¡Œçš„é¡ºåºæ‹¼æ¥åˆ°å¼ é‡ <code>a</code> çš„ä¸‹æ–¹ï¼Œæ‹¼æ¥åçš„å¼ é‡åˆ—æ•°ä¸å˜ï¼Œè¡Œæ•°ä¸ºåŸæ¥ä¸¤ä¸ªå¼ é‡è¡Œæ•°ä¹‹å’Œã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè‹¥ <code>a</code> å’Œ <code>b</code> åˆ†åˆ«è¡¨ç¤ºä¸¤ç»„æ ·æœ¬æ•°æ®ï¼Œåœ¨ç»´åº¦ 0 ä¸Šæ‹¼æ¥å°±ç›¸å½“äºå°†è¿™ä¸¤ç»„æ ·æœ¬åˆå¹¶æˆä¸€ç»„æ›´å¤§çš„æ ·æœ¬é›†ã€‚</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">å¼ é‡ aï¼š</span><br><span class="line">tensor([[<span class="number">1</span>, <span class="number">2</span>],</span><br><span class="line">        [<span class="number">3</span>, <span class="number">4</span>]])</span><br><span class="line">å¼ é‡ bï¼š</span><br><span class="line">tensor([[<span class="number">5</span>, <span class="number">6</span>],</span><br><span class="line">        [<span class="number">7</span>, <span class="number">8</span>]])</span><br><span class="line">åœ¨ç»´åº¦ <span class="number">0</span> ä¸Šæ‹¼æ¥åçš„å¼ é‡ cï¼š</span><br><span class="line">tensor([[<span class="number">1</span>, <span class="number">2</span>],</span><br><span class="line">        [<span class="number">3</span>, <span class="number">4</span>],</span><br><span class="line">        [<span class="number">5</span>, <span class="number">6</span>],</span><br><span class="line">        [<span class="number">7</span>, <span class="number">8</span>]])</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong><code>torch.reshape()</code></strong>ï¼šæ”¹å˜å¼ é‡çš„å½¢çŠ¶ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">x = torch.tensor([1, 2, 3, 4])</span><br><span class="line">reshaped_x = torch.reshape(x, (2, 2))</span><br></pre></td></tr></table></figure>

<p>åœ¨ç¥ç»ç½‘ç»œä¸­ï¼Œä¸åŒå±‚ä¹‹é—´çš„æ•°æ®å½¢çŠ¶å¯èƒ½éœ€è¦è¿›è¡Œè°ƒæ•´ï¼Œä½¿ç”¨ <code>torch.reshape()</code> å¯ä»¥æ–¹ä¾¿åœ°æ”¹å˜å¼ é‡å½¢çŠ¶ä»¥æ»¡è¶³å±‚çš„è¾“å…¥è¦æ±‚ã€‚</p>
<p><code>torch.reshape(x, (2, 2))</code> æ˜¯å°†ä¸€ç»´å¼ é‡ <code>x</code> é‡å¡‘ä¸ºäºŒç»´å¼ é‡ <code>reshaped_x</code>ï¼Œå½¢çŠ¶ä¸º <code>(2, 2)</code>ã€‚åœ¨ç¥ç»ç½‘ç»œä¸­ï¼Œä¸åŒå±‚ä¹‹é—´çš„æ•°æ®å½¢çŠ¶å¯èƒ½ä¸åŒ¹é…ï¼Œä¾‹å¦‚æŸä¸€å±‚çš„è¾“å‡ºæ˜¯ä¸€ç»´å‘é‡ï¼Œè€Œåç»­å±‚éœ€è¦äºŒç»´çŸ©é˜µä½œä¸ºè¾“å…¥ï¼Œè¿™æ—¶å°±å¯ä»¥ä½¿ç”¨ <code>torch.reshape()</code> æ¥è°ƒæ•´æ•°æ®çš„å½¢çŠ¶ï¼Œä½¿å…¶æ»¡è¶³å±‚çš„è¾“å…¥è¦æ±‚ã€‚</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">åŸå§‹å¼ é‡ xï¼š</span><br><span class="line">tensor([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line">é‡å¡‘åçš„å¼ é‡ reshaped_xï¼š</span><br><span class="line">tensor([[<span class="number">1</span>, <span class="number">2</span>],</span><br><span class="line">        [<span class="number">3</span>, <span class="number">4</span>]])</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong><code>torch.transpose()</code></strong>ï¼šäº¤æ¢å¼ é‡çš„ä¸¤ä¸ªç»´åº¦ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">x = torch.tensor([[1, 2], [3, 4]])</span><br><span class="line">transposed_x = torch.transpose(x, 0, 1)</span><br></pre></td></tr></table></figure>

<p>åœ¨çŸ©é˜µè¿ç®—ä¸­ï¼Œæœ‰æ—¶éœ€è¦å¯¹çŸ©é˜µè¿›è¡Œè½¬ç½®æ“ä½œã€‚åœ¨å›¾åƒå¤„ç†ä¸­ï¼Œå¯èƒ½éœ€è¦è°ƒæ•´å›¾åƒå¼ é‡çš„ç»´åº¦é¡ºåºã€‚</p>
<p><code>torch.transpose(x, 0, 1)</code> è¡¨ç¤ºäº¤æ¢å¼ é‡ <code>x</code> çš„ç¬¬ 0 ç»´å’Œç¬¬ 1 ç»´ã€‚åœ¨è¿™ä¸ªäºŒç»´çŸ©é˜µçš„ä¾‹å­ä¸­ï¼Œå°±æ˜¯å¯¹çŸ©é˜µè¿›è¡Œäº†è½¬ç½®æ“ä½œï¼ŒåŸæ¥çš„è¡Œå˜æˆäº†åˆ—ï¼Œåˆ—å˜æˆäº†è¡Œã€‚åœ¨çŸ©é˜µè¿ç®—ä¸­ï¼ŒçŸ©é˜µè½¬ç½®æ˜¯ä¸€ä¸ªå¸¸è§çš„æ“ä½œï¼Œä¾‹å¦‚åœ¨è®¡ç®—çŸ©é˜µä¹˜æ³•æ—¶å¯èƒ½éœ€è¦å¯¹çŸ©é˜µè¿›è¡Œè½¬ç½®ã€‚åœ¨å›¾åƒå¤„ç†ä¸­ï¼Œå›¾åƒå¼ é‡çš„ç»´åº¦é¡ºåºå¯èƒ½éœ€è¦è°ƒæ•´ï¼Œæ¯”å¦‚å°† <code>(é«˜åº¦, å®½åº¦, é€šé“æ•°)</code> è°ƒæ•´ä¸º <code>(é€šé“æ•°, é«˜åº¦, å®½åº¦)</code> ä»¥é€‚åº”æŸäº›æ¨¡å‹çš„è¾“å…¥è¦æ±‚ï¼Œè¿™æ—¶å°±å¯ä»¥ä½¿ç”¨ <code>torch.transpose()</code> æ¥å®ç°ã€‚</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">åŸå§‹å¼ é‡ xï¼š</span><br><span class="line">tensor([[<span class="number">1</span>, <span class="number">2</span>],</span><br><span class="line">        [<span class="number">3</span>, <span class="number">4</span>]])</span><br><span class="line">è½¬ç½®åçš„å¼ é‡ transposed_xï¼š</span><br><span class="line">tensor([[<span class="number">1</span>, <span class="number">3</span>],</span><br><span class="line">        [<span class="number">2</span>, <span class="number">4</span>]])</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="è‡ªåŠ¨æ±‚å¯¼"><a href="#è‡ªåŠ¨æ±‚å¯¼" class="headerlink" title="è‡ªåŠ¨æ±‚å¯¼"></a>è‡ªåŠ¨æ±‚å¯¼</h4><p><code>requires_grad</code> å’Œ <code>backward()</code></p>
<p>è®¾ç½®å¼ é‡çš„ <code>requires_grad=True</code> æ¥è·Ÿè¸ªå…¶æ“ä½œï¼Œä½¿ç”¨ <code>backward()</code> è®¡ç®—æ¢¯åº¦ã€‚</p>
<p>åœ¨æ·±åº¦å­¦ä¹ æ¨¡å‹è®­ç»ƒä¸­ï¼Œéœ€è¦è®¡ç®—æŸå¤±å‡½æ•°å…³äºæ¨¡å‹å‚æ•°çš„æ¢¯åº¦ï¼Œä»¥ä¾¿ä½¿ç”¨ä¼˜åŒ–ç®—æ³•æ›´æ–°å‚æ•°ã€‚é€šè¿‡è®¾ç½®å‚æ•°å¼ é‡çš„ <code>requires_grad=True</code>ï¼Œå¯ä»¥åˆ©ç”¨è‡ªåŠ¨æ±‚å¯¼æœºåˆ¶è‡ªåŠ¨è®¡ç®—æ¢¯åº¦ã€‚</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">x = torch.tensor([<span class="number">2.0</span>], requires_grad=<span class="literal">True</span>)</span><br><span class="line">y = x ** <span class="number">2</span></span><br><span class="line">y.backward()</span><br><span class="line"><span class="built_in">print</span>(x.grad)  <span class="comment"># è¾“å‡º 4.0</span></span><br></pre></td></tr></table></figure>



<h4 id="ç¥ç»ç½‘ç»œ"><a href="#ç¥ç»ç½‘ç»œ" class="headerlink" title="ç¥ç»ç½‘ç»œ"></a>ç¥ç»ç½‘ç»œ</h4><p>1.<code>torch.nn.Linear</code>å®šä¹‰å…¨è¿æ¥å±‚ã€‚å…¨è¿æ¥å±‚å¸¸ç”¨äºå¤šå±‚æ„ŸçŸ¥æœºï¼ˆMLPï¼‰ä¸­ï¼Œç”¨äºå°†è¾“å…¥ç‰¹å¾æ˜ å°„åˆ°è¾“å‡ºç‰¹å¾ã€‚</p>
<p>è¾“å…¥å¼ é‡ <code>input_tensor = torch.randn(1, 10)</code> ï¼Œå½¢çŠ¶ä¸º <code>(1, 10)</code>ï¼Œè¿™é‡Œçš„ <code>1</code> è¡¨ç¤ºæ ·æœ¬æ•°é‡ä¸º 1ï¼Œ<code>10</code> è¡¨ç¤ºæ¯ä¸ªæ ·æœ¬å…·æœ‰ 10 ä¸ªç‰¹å¾ï¼Œè¿™ä¸å…¨è¿æ¥å±‚å®šä¹‰çš„è¾“å…¥ç»´åº¦ <code>in_features = 10</code> ç›¸åŒ¹é…ã€‚å¯ä»¥æŠŠç»´åº¦ç†è§£ä¸º10ä¸ªç‰¹å¾ï¼Œå› æ­¤<code>torch.randn(1, 10)</code>å°±æ˜¯ä¸€ä¸ª10ç»´å‘é‡ï¼ˆæœ‰10ä¸ªæ•°å¯¹åº”10ä¸ªç‰¹å¾ï¼‰</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"></span><br><span class="line">linear_layer = nn.Linear(<span class="number">10</span>, <span class="number">5</span>)  <span class="comment"># è¾“å…¥ç»´åº¦ä¸º 10ï¼Œè¾“å‡ºç»´åº¦ä¸º 5</span></span><br><span class="line">input_tensor = torch.randn(<span class="number">1</span>, <span class="number">10</span>)</span><br><span class="line">output = linear_layer(input_tensor)</span><br></pre></td></tr></table></figure>



<p>2.<code>torch.nn.Conv2d</code>å®šä¹‰äºŒç»´å·ç§¯å±‚ã€‚åœ¨è®¡ç®—æœºè§†è§‰é¢†åŸŸï¼Œå·ç§¯å±‚å¹¿æ³›åº”ç”¨äºå›¾åƒåˆ†ç±»ã€ç›®æ ‡æ£€æµ‹ã€è¯­ä¹‰åˆ†å‰²ç­‰ä»»åŠ¡ä¸­ï¼Œç”¨äºæå–å›¾åƒçš„ç‰¹å¾ã€‚</p>
<p>â‘ <code>out_channels = 16</code> çš„å«ä¹‰</p>
<ul>
<li><strong>è¾“å‡ºé€šé“çš„æ•°é‡</strong>ï¼š<code>out_channels</code> è¡¨ç¤ºå·ç§¯å±‚è¾“å‡ºç‰¹å¾å›¾çš„é€šé“æ•°é‡ã€‚åœ¨å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰ä¸­ï¼Œå·ç§¯å±‚é€šè¿‡ä¸€ç³»åˆ—å·ç§¯æ ¸åœ¨è¾“å…¥ç‰¹å¾å›¾ä¸Šæ»‘åŠ¨è¿›è¡Œå·ç§¯æ“ä½œï¼Œæ¯ä¸ªå·ç§¯æ ¸ä¼šç”Ÿæˆä¸€ä¸ªå¯¹åº”çš„è¾“å‡ºç‰¹å¾å›¾ã€‚è¿™é‡Œ <code>out_channels = 16</code> æ„å‘³ç€è¯¥å·ç§¯å±‚ä½¿ç”¨äº† 16 ä¸ªä¸åŒçš„å·ç§¯æ ¸ï¼Œæ¯ä¸ªå·ç§¯æ ¸ä¼šå¯¹è¾“å…¥ç‰¹å¾å›¾è¿›è¡Œå·ç§¯è®¡ç®—ï¼Œæœ€ç»ˆä¼šè¾“å‡º 16 ä¸ªç‰¹å¾å›¾ï¼Œè¿™äº›ç‰¹å¾å›¾å…±åŒæ„æˆäº†å·ç§¯å±‚çš„è¾“å‡ºï¼Œä¸”è¾“å‡ºçš„é€šé“æ•°ä¸º 16ã€‚</li>
<li><strong>ç‰¹å¾æå–çš„å¤šæ ·æ€§</strong>ï¼šä¸åŒçš„å·ç§¯æ ¸å¯ä»¥å­¦ä¹ åˆ°è¾“å…¥å›¾åƒçš„ä¸åŒç‰¹å¾ï¼Œä¾‹å¦‚è¾¹ç¼˜ã€çº¹ç†ã€é¢œè‰²ç­‰ã€‚é€šè¿‡è®¾ç½®å¤šä¸ªè¾“å‡ºé€šé“ï¼Œå·ç§¯å±‚èƒ½å¤Ÿä»è¾“å…¥å›¾åƒä¸­æå–å¤šç§ä¸åŒç±»å‹çš„ç‰¹å¾ï¼Œä»è€Œä¸°å¯Œäº†æ¨¡å‹å¯¹å›¾åƒç‰¹å¾çš„è¡¨è¾¾èƒ½åŠ›ã€‚åœ¨åç»­çš„ç½‘ç»œå±‚ä¸­ï¼Œè¿™äº›æå–åˆ°çš„ç‰¹å¾ä¼šè¢«è¿›ä¸€æ­¥å¤„ç†å’Œç»„åˆï¼Œç”¨äºå®Œæˆå›¾åƒåˆ†ç±»ã€ç›®æ ‡æ£€æµ‹ç­‰ä»»åŠ¡ã€‚</li>
</ul>
<p>â‘¡<code>kernel_size = 3</code> çš„å«ä¹‰</p>
<ul>
<li><strong>å·ç§¯æ ¸çš„å¤§å°</strong>ï¼š<code>kernel_size</code> å®šä¹‰äº†å·ç§¯æ ¸çš„å°ºå¯¸ã€‚<code>kernel_size = 3</code> è¡¨ç¤ºä½¿ç”¨çš„æ˜¯ä¸€ä¸ª 3x3 çš„å·ç§¯æ ¸ã€‚å·ç§¯æ ¸æ˜¯ä¸€ä¸ªå°çš„äºŒç»´çŸ©é˜µï¼Œåœ¨å·ç§¯æ“ä½œä¸­ï¼Œå®ƒä¼šåœ¨è¾“å…¥ç‰¹å¾å›¾ä¸Šé€è¡Œé€åˆ—åœ°æ»‘åŠ¨ï¼Œä¸è¾“å…¥ç‰¹å¾å›¾çš„å¯¹åº”åŒºåŸŸè¿›è¡Œå…ƒç´ ç›¸ä¹˜å¹¶æ±‚å’Œï¼Œä»è€Œå¾—åˆ°è¾“å‡ºç‰¹å¾å›¾çš„ä¸€ä¸ªå…ƒç´ ã€‚</li>
<li><strong>ç‰¹å¾æ„Ÿå—é‡</strong>ï¼šå·ç§¯æ ¸çš„å¤§å°å†³å®šäº†å·ç§¯å±‚çš„æ„Ÿå—é‡ï¼Œå³è¾“å‡ºç‰¹å¾å›¾ä¸Šçš„ä¸€ä¸ªå…ƒç´ å—åˆ°è¾“å…¥ç‰¹å¾å›¾ä¸Šå¤šå¤§åŒºåŸŸçš„å½±å“ã€‚ä¸€ä¸ª 3x3 çš„å·ç§¯æ ¸æ„å‘³ç€è¾“å‡ºç‰¹å¾å›¾ä¸Šçš„æ¯ä¸ªå…ƒç´ æ˜¯ç”±è¾“å…¥ç‰¹å¾å›¾ä¸Šä¸€ä¸ª 3x3 çš„åŒºåŸŸè®¡ç®—å¾—åˆ°çš„ï¼Œå®ƒèƒ½å¤Ÿæ•æ‰åˆ°è¾“å…¥å›¾åƒä¸­ 3x3 é‚»åŸŸå†…çš„å±€éƒ¨ç‰¹å¾ã€‚è¾ƒå¤§çš„å·ç§¯æ ¸å¯ä»¥æ•æ‰åˆ°æ›´å¤§èŒƒå›´çš„ç‰¹å¾ï¼Œä½†åŒæ—¶ä¹Ÿä¼šå¢åŠ æ¨¡å‹çš„å‚æ•°æ•°é‡å’Œè®¡ç®—é‡ï¼›è¾ƒå°çš„å·ç§¯æ ¸åˆ™æ›´ä¾§é‡äºæ•æ‰å±€éƒ¨ç»†èŠ‚ç‰¹å¾ï¼Œå¹¶ä¸”è®¡ç®—æ•ˆç‡æ›´é«˜ã€‚</li>
</ul>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">conv_layer = nn.Conv2d(in_channels=<span class="number">3</span>, out_channels=<span class="number">16</span>, kernel_size=<span class="number">3</span>)</span><br><span class="line">input_image = torch.randn(<span class="number">1</span>, <span class="number">3</span>, <span class="number">224</span>, <span class="number">224</span>)  <span class="comment"># å‡è®¾è¾“å…¥ä¸º 1 å¼  3 é€šé“ã€224x224 çš„å›¾åƒ</span></span><br><span class="line">output = conv_layer(input_image)</span><br></pre></td></tr></table></figure>



<p>3.<code>torch.nn.ReLU</code>å®šä¹‰ ReLU æ¿€æ´»å‡½æ•°å±‚ã€‚æ¿€æ´»å‡½æ•°ç”¨äºå¼•å…¥éçº¿æ€§ï¼Œä½¿å¾—ç¥ç»ç½‘ç»œèƒ½å¤Ÿå­¦ä¹ æ›´å¤æ‚çš„å‡½æ•°ã€‚ReLU æ˜¯ä¸€ç§å¸¸ç”¨çš„æ¿€æ´»å‡½æ•°ï¼Œåœ¨è®¸å¤šç¥ç»ç½‘ç»œæ¶æ„ä¸­éƒ½æœ‰åº”ç”¨ã€‚</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">relu = nn.ReLU()</span><br><span class="line">input_tensor = torch.randn(<span class="number">1</span>, <span class="number">10</span>)</span><br><span class="line">output = relu(input_tensor)</span><br></pre></td></tr></table></figure>



<h4 id="ä¼˜åŒ–å™¨å’ŒæŸå¤±å‡½æ•°"><a href="#ä¼˜åŒ–å™¨å’ŒæŸå¤±å‡½æ•°" class="headerlink" title="ä¼˜åŒ–å™¨å’ŒæŸå¤±å‡½æ•°"></a>ä¼˜åŒ–å™¨å’ŒæŸå¤±å‡½æ•°</h4><p>1.<code>torch.optim.SGD</code>å®šä¹‰éšæœºæ¢¯åº¦ä¸‹é™ä¼˜åŒ–å™¨ã€‚åœ¨æ¨¡å‹è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œéœ€è¦ä½¿ç”¨ä¼˜åŒ–å™¨æ¥æ›´æ–°æ¨¡å‹çš„å‚æ•°ã€‚SGD æ˜¯ä¸€ç§åŸºæœ¬çš„ä¼˜åŒ–ç®—æ³•ï¼Œé€‚ç”¨äºå¤§å¤šæ•°åœºæ™¯ã€‚</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch.optim <span class="keyword">as</span> optim</span><br><span class="line"></span><br><span class="line">model = nn.Linear(<span class="number">10</span>, <span class="number">5</span>)</span><br><span class="line">optimizer = optim.SGD(model.parameters(), lr=<span class="number">0.01</span>)</span><br></pre></td></tr></table></figure>

<p>2.<code>torch.nn.MSELoss</code>å®šä¹‰å‡æ–¹è¯¯å·®æŸå¤±å‡½æ•°ã€‚å‡æ–¹è¯¯å·®æŸå¤±å‡½æ•°å¸¸ç”¨äºå›å½’é—®é¢˜ï¼Œç”¨äºè¡¡é‡é¢„æµ‹å€¼ä¸çœŸå®å€¼ä¹‹é—´çš„å·®å¼‚ã€‚</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">criterion = nn.MSELoss()</span><br><span class="line">predictions = torch.randn(<span class="number">1</span>, <span class="number">5</span>)</span><br><span class="line">targets = torch.randn(<span class="number">1</span>, <span class="number">5</span>)</span><br><span class="line">loss = criterion(predictions, targets)</span><br></pre></td></tr></table></figure>

<p>3.<code>torch.nn.CrossEntropyLoss</code>å®šä¹‰äº¤å‰ç†µæŸå¤±å‡½æ•°ã€‚äº¤å‰ç†µæŸå¤±å‡½æ•°å¸¸ç”¨äºåˆ†ç±»é—®é¢˜ï¼Œç”¨äºè¡¡é‡æ¨¡å‹è¾“å‡ºçš„æ¦‚ç‡åˆ†å¸ƒä¸çœŸå®æ ‡ç­¾ä¹‹é—´çš„å·®å¼‚ã€‚</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">criterion = nn.CrossEntropyLoss()</span><br><span class="line">logits = torch.randn(<span class="number">1</span>, <span class="number">5</span>)</span><br><span class="line">targets = torch.tensor([<span class="number">1</span>])</span><br><span class="line">loss = criterion(logits, targets)</span><br></pre></td></tr></table></figure>

<h4 id="é¢„è®­ç»ƒæ¨¡å‹ï¼ˆtorchvision-modelsï¼‰"><a href="#é¢„è®­ç»ƒæ¨¡å‹ï¼ˆtorchvision-modelsï¼‰" class="headerlink" title="é¢„è®­ç»ƒæ¨¡å‹ï¼ˆtorchvision.modelsï¼‰"></a>é¢„è®­ç»ƒæ¨¡å‹ï¼ˆtorchvision.modelsï¼‰</h4><h2 id="OSæ“ä½œç³»ç»Ÿæ¥å£æ¨¡å—"><a href="#OSæ“ä½œç³»ç»Ÿæ¥å£æ¨¡å—" class="headerlink" title="OSæ“ä½œç³»ç»Ÿæ¥å£æ¨¡å—"></a>OSæ“ä½œç³»ç»Ÿæ¥å£æ¨¡å—</h2>]]></content>
      <categories>
        <category>ç§‘ç ”</category>
      </categories>
      <tags>
        <tag>ç§‘ç ”çŸ¥è¯†ç§¯ç´¯</tag>
      </tags>
  </entry>
</search>
